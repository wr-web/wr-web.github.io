<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="RT"><meta name="copyright" content="RT"><meta name="generator" content="Hexo 6.0.0"><meta name="theme" content="hexo-theme-yun"><title>DX12 第七章习题 | R0gerThat</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/github/wr-web/picture/blob/main/author2.ico"><link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/github/wr-web/picture/blob/main/author2.ico" color="#6200ee"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"wr-web.github.io","root":"/","title":"RT の Diary","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="R0gerThat" type="application/atom+xml"><meta name="description" content="learn from DX12">
<meta property="og:type" content="article">
<meta property="og:title" content="DX12 第七章习题">
<meta property="og:url" content="https://wr-web.github.io/2022/03/16/d3d12-7/index.html">
<meta property="og:site_name" content="R0gerThat">
<meta property="og:description" content="learn from DX12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184610201.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184900170.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185018939.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185143381.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185238091.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316125456736.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316123341882.png">
<meta property="article:published_time" content="2022-03-16T12:00:00.000Z">
<meta property="article:modified_time" content="2022-03-16T05:21:12.123Z">
<meta property="article:author" content="RT">
<meta property="article:tag" content="directX 12">
<meta property="article:tag" content="图形学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184610201.png"><script src="/js/ui/mode.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="RT"><img width="96" loading="lazy" src="https://cdn.jsdelivr.net/gh/wr-web/picture/author2.ico" alt="RT"></a><div class="site-author-name"><a href="/about/">RT</a></div><span class="site-name">R0gerThat</span><sub class="site-subtitle"></sub><div class="site-desciption">@Vidar-Team @CTFer @Game Lover </div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">22</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">17</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">23</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/wr-web" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/13582048" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/R0gerTh4t" title="Telegram" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:orz1053131305@outlook.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DX12-7th"><span class="toc-number">1.</span> <span class="toc-text">DX12-7th</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7th-Capture"><span class="toc-number">1.1.</span> <span class="toc-text">7th Capture</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#something-before-7"><span class="toc-number">1.1.1.</span> <span class="toc-text">something before 7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-1"><span class="toc-number">1.1.2.</span> <span class="toc-text">7.9.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-2"><span class="toc-number">1.1.3.</span> <span class="toc-text">7.9.2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-3"><span class="toc-number">1.1.4.</span> <span class="toc-text">7.9.3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-X"><span class="toc-number">1.1.5.</span> <span class="toc-text">7.9.X</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://wr-web.github.io/2022/03/16/d3d12-7/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="RT"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="R0gerThat"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">DX12 第七章习题</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2022-03-16 20:00:00" itemprop="dateCreated datePublished" datetime="2022-03-16T20:00:00+08:00">2022-03-16</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/DX12/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">DX12</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/directX-12/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">directX 12</span></a><a class="tag-item" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">图形学</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#6200ee;"><h1 id="DX12-7th"><a href="#DX12-7th" class="headerlink" title="DX12-7th"></a>DX12-7th</h1><h2 id="7th-Capture"><a href="#7th-Capture" class="headerlink" title="7th Capture"></a>7th Capture</h2><h3 id="something-before-7"><a href="#something-before-7" class="headerlink" title="something before 7"></a>something before 7</h3><p>记忆被清空了，有点搞不懂 worldViewProj 是怎么产生的了，还有 cb 是怎么绑定的？</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">world 就是物体在世界空间的位置
view 是物体从世界空间，变换到摄像机空间（视察空间）的矩阵
Proj 则是物体在视察空间中映射到二维平面上的矩阵<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>constant buffer 的绑定过程，以下是需要绑定的结构体</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 需要绑定的 CB</span>
<span class="token keyword">struct</span> <span class="token class-name">ObjectConstants</span>
<span class="token punctuation">&#123;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 World <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">PassConstants</span>
<span class="token punctuation">&#123;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 View <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvView <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 Proj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 ViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT4X4 InvViewProj <span class="token operator">=</span> <span class="token class-name">MathHelper</span><span class="token double-colon punctuation">::</span><span class="token function">Identity4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT3 EyePosW <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> cbPerObjectPad1 <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT2 RenderTargetSize <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    DirectX<span class="token double-colon punctuation">::</span>XMFLOAT2 InvRenderTargetSize <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> NearZ <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> FarZ <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> TotalTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> DeltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

cbuffer cbPerObject <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	float4x4 gWorld<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

cbuffer cbPass <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    float4x4 gView<span class="token punctuation">;</span>
    float4x4 gInvView<span class="token punctuation">;</span>
    float4x4 gProj<span class="token punctuation">;</span>
    float4x4 gInvProj<span class="token punctuation">;</span>
    float4x4 gViewProj<span class="token punctuation">;</span>
    float4x4 gInvViewProj<span class="token punctuation">;</span>
    float3 gEyePosW<span class="token punctuation">;</span>
    <span class="token keyword">float</span> cbPerObjectPad1<span class="token punctuation">;</span>
    float2 gRenderTargetSize<span class="token punctuation">;</span>
    float2 gInvRenderTargetSize<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gNearZ<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gFarZ<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gTotalTime<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gDeltaTime<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">FrameResource</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    
    <span class="token function">FrameResource</span><span class="token punctuation">(</span>ID3D12Device<span class="token operator">*</span> device<span class="token punctuation">,</span> UINT passCount<span class="token punctuation">,</span> UINT objectCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">FrameResource</span><span class="token punctuation">(</span><span class="token keyword">const</span> FrameResource<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    FrameResource<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> FrameResource<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">FrameResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// We cannot reset the allocator until the GPU is done processing the commands.</span>
    <span class="token comment">// So each frame needs their own allocator.</span>
    Microsoft<span class="token double-colon punctuation">::</span>WRL<span class="token double-colon punctuation">::</span>ComPtr<span class="token operator">&lt;</span>ID3D12CommandAllocator<span class="token operator">></span> CmdListAlloc<span class="token punctuation">;</span>

    <span class="token comment">// We cannot update a cbuffer until the GPU is done processing the commands</span>
    <span class="token comment">// that reference it.  So each frame needs their own cbuffers.</span>
    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>UploadBuffer<span class="token operator">&lt;</span>PassConstants<span class="token operator">>></span> PassCB <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>UploadBuffer<span class="token operator">&lt;</span>ObjectConstants<span class="token operator">>></span> ObjectCB <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

    <span class="token comment">// Fence value to mark commands up to this fence point.  This lets us</span>
    <span class="token comment">// check if these frame resources are still in use by the GPU.</span>
    UINT64 Fence <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
第一步:创建根签名，把一个含有 cbv 的描述符表 绑定到常量缓冲区寄存器 0，总感觉这个绑定过程有冗余
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildRootSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    CD3DX12_DESCRIPTOR_RANGE cbvTable0<span class="token punctuation">;</span>
	cbvTable0<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>D3D12_DESCRIPTOR_RANGE_TYPE_CBV<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    <span class="token comment">// Create root CBVs.</span>
    slotRootParameter<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">InitAsDescriptorTable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbvTable0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    HRESULT hr <span class="token operator">=</span> <span class="token function">D3D12SerializeRootSignature</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rootSigDesc<span class="token punctuation">,</span> D3D_ROOT_SIGNATURE_VERSION_1<span class="token punctuation">,</span>
		serializedRootSig<span class="token punctuation">.</span><span class="token function">GetAddressOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errorBlob<span class="token punctuation">.</span><span class="token function">GetAddressOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    md3dDevice<span class="token operator">-></span><span class="token function">CreateRootSignature</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
第二步：创建了帧资源，在帧资源中存储着 PassCB，ObjectCB 的指针
简单初始化了 mFrameResources 
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildFrameResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gNumFrameResources<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        mFrameResources<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>FrameResource<span class="token operator">></span></span></span><span class="token punctuation">(</span>md3dDevice<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mAllRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
第三步：创建了堆描述符，为了将常量缓冲区绑定到渲染流水线上，但是此时还没有绑定
创建了 mCbvHeap，以及一些数据 mPassCbvOffset
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildDescriptorHeaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Need a CBV descriptor for each object for each frame resource,</span>
    <span class="token comment">// +1 for the perPass CBV for each frame resource.</span>
    UINT numDescriptors <span class="token operator">=</span> <span class="token punctuation">(</span>objCount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> gNumFrameResources<span class="token punctuation">;</span>

    <span class="token comment">// Save an offset to the start of the pass CBVs.  These are the last 3 descriptors.</span>
    mPassCbvOffset <span class="token operator">=</span> objCount <span class="token operator">*</span> gNumFrameResources<span class="token punctuation">;</span>

    D3D12_DESCRIPTOR_HEAP_DESC cbvHeapDesc<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>NumDescriptors <span class="token operator">=</span> numDescriptors<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>Type <span class="token operator">=</span> D3D12_DESCRIPTOR_HEAP_TYPE_CBV_SRV_UAV<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>Flags <span class="token operator">=</span> D3D12_DESCRIPTOR_HEAP_FLAG_SHADER_VISIBLE<span class="token punctuation">;</span>
    cbvHeapDesc<span class="token punctuation">.</span>NodeMask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">ThrowIfFailed</span><span class="token punctuation">(</span>md3dDevice<span class="token operator">-></span><span class="token function">CreateDescriptorHeap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cbvHeapDesc<span class="token punctuation">,</span>
        <span class="token function">IID_PPV_ARGS</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mCbvHeap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
第四步：对每一个帧资源，使用 Resource() 获得 ID3D12Resource* objectCB，然后通过，GetGPUVirtualAddress() 循环获得D3D12_GPU_VIRTUAL_ADDRESS cbAddress，修改到对应数据的偏移位置处，

UploadBuffer::Resource(...)->ID3D12Resource*
ID3D12Resource::GetGPUVirtualAddress(...)->D3D12_GPU_VIRTUAL_ADDRESS

再把 cbAddress 偏移到不同物体的上，对每一个物体（用 heapIndex 指明是哪个物体），获取 handle 再配置 cbvDesc（其中包含有 cbAddress 确保偏移） 创建 cbv

CD3DX12_CPU_DESCRIPTOR_HANDLE->CD3DX12_CPU_DESCRIPTOR_HANDLE
ID3D12Device->CreateConstantBufferView(&amp;cbvDesc, handle)
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">BuildConstantBufferViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCBByteSize <span class="token operator">=</span> d3dUtil<span class="token double-colon punctuation">::</span><span class="token function">CalcConstantBufferByteSize</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ObjectConstants<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    UINT objCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Need a CBV descriptor for each object for each frame resource.</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> frameIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> frameIndex <span class="token operator">&lt;</span> gNumFrameResources<span class="token punctuation">;</span> <span class="token operator">++</span>frameIndex<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> objectCB <span class="token operator">=</span> mFrameResources<span class="token punctuation">[</span>frameIndex<span class="token punctuation">]</span><span class="token operator">-></span>ObjectCB<span class="token operator">-></span><span class="token function">Resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>UINT i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> objCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            D3D12_GPU_VIRTUAL_ADDRESS cbAddress <span class="token operator">=</span> objectCB<span class="token operator">-></span><span class="token function">GetGPUVirtualAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Offset to the ith object constant buffer in the buffer.</span>
            cbAddress <span class="token operator">+=</span> i<span class="token operator">*</span>objCBByteSize<span class="token punctuation">;</span>

            <span class="token comment">// Offset to the object cbv in the descriptor heap.</span>
            <span class="token keyword">int</span> heapIndex <span class="token operator">=</span> frameIndex<span class="token operator">*</span>objCount <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">auto</span> handle <span class="token operator">=</span> <span class="token function">CD3DX12_CPU_DESCRIPTOR_HANDLE</span><span class="token punctuation">(</span>mCbvHeap<span class="token operator">-></span><span class="token function">GetCPUDescriptorHandleForHeapStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            handle<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>heapIndex<span class="token punctuation">,</span> mCbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

            D3D12_CONSTANT_BUFFER_VIEW_DESC cbvDesc<span class="token punctuation">;</span>
            cbvDesc<span class="token punctuation">.</span>BufferLocation <span class="token operator">=</span> cbAddress<span class="token punctuation">;</span>
            cbvDesc<span class="token punctuation">.</span>SizeInBytes <span class="token operator">=</span> objCBByteSize<span class="token punctuation">;</span>

            md3dDevice<span class="token operator">-></span><span class="token function">CreateConstantBufferView</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cbvDesc<span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//...</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
第五步:还需要最终的绑定，需要 gpu 去执行指令（不知道可不可以这么理解）
*/</span>
<span class="token keyword">void</span> <span class="token class-name">ShapesApp</span><span class="token double-colon punctuation">::</span><span class="token function">DrawRenderItems</span><span class="token punctuation">(</span>ID3D12GraphicsCommandList<span class="token operator">*</span> cmdList<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>RenderItem<span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> ritems<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    UINT objCBByteSize <span class="token operator">=</span> d3dUtil<span class="token double-colon punctuation">::</span><span class="token function">CalcConstantBufferByteSize</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ObjectConstants<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
	<span class="token keyword">auto</span> objectCB <span class="token operator">=</span> mCurrFrameResource<span class="token operator">-></span>ObjectCB<span class="token operator">-></span><span class="token function">Resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// For each render item...</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ritems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> ri <span class="token operator">=</span> ritems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">IASetVertexBuffers</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ri<span class="token operator">-></span>Geo<span class="token operator">-></span><span class="token function">VertexBufferView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmdList<span class="token operator">-></span><span class="token function">IASetIndexBuffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ri<span class="token operator">-></span>Geo<span class="token operator">-></span><span class="token function">IndexBufferView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmdList<span class="token operator">-></span><span class="token function">IASetPrimitiveTopology</span><span class="token punctuation">(</span>ri<span class="token operator">-></span>PrimitiveType<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Offset to the CBV in the descriptor heap for this object and for this frame resource.</span>
        UINT cbvIndex <span class="token operator">=</span> mCurrFrameResourceIndex<span class="token operator">*</span><span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>mOpaqueRitems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> ri<span class="token operator">-></span>ObjCBIndex<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> cbvHandle <span class="token operator">=</span> <span class="token function">CD3DX12_GPU_DESCRIPTOR_HANDLE</span><span class="token punctuation">(</span>mCbvHeap<span class="token operator">-></span><span class="token function">GetGPUDescriptorHandleForHeapStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cbvHandle<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>cbvIndex<span class="token punctuation">,</span> mCbvSrvUavDescriptorSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">SetGraphicsRootDescriptorTable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cbvHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        cmdList<span class="token operator">-></span><span class="token function">DrawIndexedInstanced</span><span class="token punctuation">(</span>ri<span class="token operator">-></span>IndexCount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ri<span class="token operator">-></span>StartIndexLocation<span class="token punctuation">,</span> ri<span class="token operator">-></span>BaseVertexLocation<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 上面的顺序也能替换一下，BuildRootSignature() 放后面一点也没事。</span>
<span class="token comment">// 最后保持映射状态，直接 CopyData 就好了，不断更新。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-1"><a href="#7-9-1" class="headerlink" title="7.9.1"></a>7.9.1</h3><p>Modify the “Shape” demo to use GeometryGenerator::CreateGeosphere instead of GeometryGenerator::CreateSphere. Try with 0, 1, 2, and 3 subdivision levels</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// GeometryGenerator::MeshData GeometryGenerator::CreateGeosphere(float radius, uint32 numSubdivisions)</span>
GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData sphere <span class="token operator">=</span> geoGen<span class="token punctuation">.</span><span class="token function">CreateGeosphere</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//以下分别为0，1，2，3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184610201.png" alt="image-20220315184610201" loading="lazy"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315184900170.png" alt="image-20220315184900170" loading="lazy"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185018939.png" alt="image-20220315185018939" loading="lazy"><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185143381.png" alt="image-20220315185143381" loading="lazy"></p>
<p>细分调很高的话会有一部分看不见了，尚未找到原因<img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220315185238091.png" alt="image-20220315185238091" loading="lazy"></p>
<h3 id="7-9-2"><a href="#7-9-2" class="headerlink" title="7.9.2"></a>7.9.2</h3><p>Modify the “Shapes” demo to use sixteen root constants to set the per-object world matrix instead of a descriptor table</p>
<p>我就说我看完了这一章有些东西真的只是看看过，知识没有进脑子，这练习多是一件美事啊啊哈哈哈哈…</p>
<p>服了，他的坐标系，i，j 和我理解的不太一样，画出来就异常的不对劲。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
前面的任务就是删掉第一个 CB，CBV 等。修改根签名。看了别人的做法，特意修改了 ObjectCB，其实没有必要，因为是常量，不需要每次去修改，赋值

gWorld,按照我的理解，应该是竖向的填充。
*/</span>


<span class="token keyword">float</span> srcData<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ri<span class="token operator">-></span><span class="token function">World</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
            
cmdList<span class="token operator">-></span><span class="token function">SetGraphicsRoot32BitConstants</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> srcData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//color.hlsl</span>
<span class="token comment">/*
这个没什么好改的
*/</span>
cbuffer cbPerObject <span class="token operator">:</span> <span class="token keyword">register</span><span class="token punctuation">(</span>b0<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	float4x4 gWorld<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 花了几个小时，就因为这个顺序。。。还得是动调</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-3"><a href="#7-9-3" class="headerlink" title="7.9.3"></a>7.9.3</h3><p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316125456736.png" alt="image-20220316125456736" loading="lazy"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wr-web/picture/image-20220316123341882.png" alt="image-20220316123341882" loading="lazy"></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
Summary:  从一定格式的文件中读取顶点和索引
Parameters:
	path: 路径
	numSubdivisions: 细分次数,似乎这个图像不太能继续细分了
*/</span>

MeshData <span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> uint32 numSubdivisions<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData <span class="token class-name">GeometryGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> uint32 numSubdivisions<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	MeshData meshData<span class="token punctuation">;</span>
	<span class="token keyword">float</span> pos<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> normal<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">uint32_t</span> tlist<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> mystr<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">uint64_t</span> vertexCount<span class="token punctuation">;</span>
	<span class="token keyword">uint64_t</span> triangleCount<span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">infile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>infile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		infile <span class="token operator">>></span> mystr <span class="token operator">>></span> vertexCount<span class="token punctuation">;</span>
		infile <span class="token operator">>></span> mystr <span class="token operator">>></span> triangleCount<span class="token punctuation">;</span>

		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>vertexCount<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> pos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> infile <span class="token operator">>></span> normal<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			Vertex vertex <span class="token operator">=</span> <span class="token function">Vertex</span><span class="token punctuation">(</span>
				pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				normal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normal<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
				<span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		infile<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>mystr<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>triangleCount<span class="token operator">--</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			infile <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> tlist<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tlist<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		infile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numSubdivisions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">Subdivide</span><span class="token punctuation">(</span>meshData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> meshData<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后要修改一下 BuildShapeGeometry</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">GeometryGenerator<span class="token double-colon punctuation">::</span>MeshData skull <span class="token operator">=</span> geoGen<span class="token punctuation">.</span><span class="token function">CreateFromFile</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\orz10\\ROOT\\directx12\\d3d12book\\Chapter 7 Drawing in Direct3D Part II\\Shapes\\skull.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
UINT skullIndexOffset <span class="token operator">=</span> cylinderIndexOffset <span class="token operator">+</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>cylinder<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...</span>
SubmeshGeometry skullSubmesh<span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>IndexCount <span class="token operator">=</span> <span class="token punctuation">(</span>UINT<span class="token punctuation">)</span>skull<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>StartIndexLocation <span class="token operator">=</span> skullIndexOffset<span class="token punctuation">;</span>
skullSubmesh<span class="token punctuation">.</span>BaseVertexLocation <span class="token operator">=</span> skullVertexOffset<span class="token punctuation">;</span>
<span class="token comment">//...</span>
<span class="token keyword">auto</span> totalVertexCount <span class="token operator">=</span>
    box<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    grid<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    sphere<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    cylinder<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//来一手黑色骨头，我发现白色的更带劲</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">,</span> <span class="token operator">++</span>k<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    vertices<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>Pos <span class="token operator">=</span> skull<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Position<span class="token punctuation">;</span>
    vertices<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>Color <span class="token operator">=</span> <span class="token function">XMFLOAT4</span><span class="token punctuation">(</span>DirectX<span class="token double-colon punctuation">::</span>Colors<span class="token double-colon punctuation">::</span>Black<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//...</span>
geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span> <span class="token operator">=</span> skullSubmesh<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后把 BuildRenderItems 改一下就好了，这个拷贝了数据给要画的 mOpaqueRitems，算是最后一步了。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> skullRitem <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>RenderItem<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">XMStoreFloat4x4</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>skullRitem<span class="token operator">-></span>World<span class="token punctuation">,</span> <span class="token function">XMMatrixScaling</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">XMMatrixTranslation</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>ObjCBIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>Geo <span class="token operator">=</span> mGeometries<span class="token punctuation">[</span><span class="token string">"shapeGeo"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>PrimitiveType <span class="token operator">=</span> D3D_PRIMITIVE_TOPOLOGY_TRIANGLELIST<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>IndexCount <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>IndexCount<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>StartIndexLocation <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>StartIndexLocation<span class="token punctuation">;</span>
  skullRitem<span class="token operator">-></span>BaseVertexLocation <span class="token operator">=</span> skullRitem<span class="token operator">-></span>Geo<span class="token operator">-></span>DrawArgs<span class="token punctuation">[</span><span class="token string">"skull"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>BaseVertexLocation<span class="token punctuation">;</span>
  mAllRitems<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>skullRitem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-9-X"><a href="#7-9-X" class="headerlink" title="7.9.X"></a>7.9.X</h3><p>关于这个曲面细分我有点迷糊，不知道为什么有些显示不了了</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 摘抄</span>
<span class="token keyword">void</span> <span class="token class-name">GeometryGenerator</span><span class="token double-colon punctuation">::</span><span class="token function">Subdivide</span><span class="token punctuation">(</span>MeshData<span class="token operator">&amp;</span> meshData<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment">// Save a copy of the input geometry.</span>
	MeshData inputCopy <span class="token operator">=</span> meshData<span class="token punctuation">;</span>


	meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//       v1</span>
	<span class="token comment">//       *</span>
	<span class="token comment">//      / \
	//     /   \
	//  m0*-----*m1</span>
	<span class="token comment">//   / \   / \
	//  /   \ /   \
	// *-----*-----*</span>
	<span class="token comment">// v0    m2     v2</span>

	uint32 numTris <span class="token operator">=</span> <span class="token punctuation">(</span>uint32<span class="token punctuation">)</span>inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>uint32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numTris<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		Vertex v0 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
		Vertex v1 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
		Vertex v2 <span class="token operator">=</span> inputCopy<span class="token punctuation">.</span>Vertices<span class="token punctuation">[</span> inputCopy<span class="token punctuation">.</span>Indices32<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token comment">//</span>
		<span class="token comment">// Generate the midpoints.</span>
		<span class="token comment">//</span>

        Vertex m0 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vertex m1 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Vertex m2 <span class="token operator">=</span> <span class="token function">MidPoint</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//</span>
		<span class="token comment">// Add new geometry.</span>
		<span class="token comment">//</span>

		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
		meshData<span class="token punctuation">.</span>Vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
 
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		meshData<span class="token punctuation">.</span>Indices32<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>把两个点的所有属性平分了。最为关键的是 MidPoint 中存在  XMVECTOR pos &#x3D; 0.5f*(p0 + p1);<br>这个我觉得有一点点不合理，不过对于平面来说是没问题的。这里暂时也是只是用到了正方体中。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/wr-web/picture/zhifubao_reward.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/wr-web/picture/zhifubao_reward.png" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/wr-web/picture/wechat_reward.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/wr-web/picture/wechat_reward.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>RT</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://wr-web.github.io/2022/03/16/d3d12-7/" title="DX12 第七章习题">https://wr-web.github.io/2022/03/16/d3d12-7/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2022/03/17/d3d12-8/" rel="prev" title="DX12 第八章学习"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">DX12 第八章学习</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/03/13/d3d12-6/" rel="next" title="DX12 第六章习题"><span class="post-nav-text">DX12 第六章习题</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> RT</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.0.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>